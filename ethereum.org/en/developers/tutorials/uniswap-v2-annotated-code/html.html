<!DOCTYPE html><html dir="ltr" lang="en" data-theme="light" style="color-scheme: light;"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><title>Uniswap-v2 Contract Walk-Through | ethereum.org</title><meta name="image" content="https://ethereum.org/heroes/developers-hub-hero.jpg"><meta name="description" content="How does the Uniswap-v2 contract work? Why is it written that way?"><meta name="docsearch:description" content="How does the Uniswap-v2 contract work? Why is it written that way?"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="Ori Pomerantz"><meta name="twitter:site" content="Ori Pomerantz"><meta name="twitter:title" content="Uniswap-v2 Contract Walk-Through | ethereum.org"><meta name="twitter:description" content="How does the Uniswap-v2 contract work? Why is it written that way?"><meta name="twitter:image" content="https://ethereum.org/heroes/developers-hub-hero.jpg"><meta property="og:title" content="Uniswap-v2 Contract Walk-Through | ethereum.org"><meta property="og:locale" content="en"><meta property="og:description" content="How does the Uniswap-v2 contract work? Why is it written that way?"><meta property="og:type" content="website"><meta property="og:url" content="https://ethereum.org/en/developers/tutorials/uniswap-v2-annotated-code/"><meta property="og:image" content="https://ethereum.org/heroes/developers-hub-hero.jpg"><meta property="og:site_name" content="ethereum.org"><link rel="canonical" href="https://ethereum.org/en/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="x-default" href="https://ethereum.org/en/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="en" href="https://ethereum.org/en/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="am" href="https://ethereum.org/am/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="ar" href="https://ethereum.org/ar/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="az" href="https://ethereum.org/az/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="be" href="https://ethereum.org/be/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="bg" href="https://ethereum.org/bg/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="bn" href="https://ethereum.org/bn/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="bs" href="https://ethereum.org/bs/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="ca" href="https://ethereum.org/ca/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="cs" href="https://ethereum.org/cs/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="da" href="https://ethereum.org/da/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="de" href="https://ethereum.org/de/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="el" href="https://ethereum.org/el/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="es" href="https://ethereum.org/es/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="fa" href="https://ethereum.org/fa/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="fi" href="https://ethereum.org/fi/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="fr" href="https://ethereum.org/fr/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="gl" href="https://ethereum.org/gl/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="gu" href="https://ethereum.org/gu/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="he" href="https://ethereum.org/he/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="hi" href="https://ethereum.org/hi/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="hr" href="https://ethereum.org/hr/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="hu" href="https://ethereum.org/hu/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="hy-am" href="https://ethereum.org/hy-am/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="id" href="https://ethereum.org/id/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="ig" href="https://ethereum.org/ig/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="it" href="https://ethereum.org/it/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="ja" href="https://ethereum.org/ja/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="ka" href="https://ethereum.org/ka/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="kk" href="https://ethereum.org/kk/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="km" href="https://ethereum.org/km/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="kn" href="https://ethereum.org/kn/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="ko" href="https://ethereum.org/ko/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="lt" href="https://ethereum.org/lt/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="ml" href="https://ethereum.org/ml/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="mr" href="https://ethereum.org/mr/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="ms" href="https://ethereum.org/ms/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="ne-np" href="https://ethereum.org/ne-np/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="nl" href="https://ethereum.org/nl/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="nb" href="https://ethereum.org/nb/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="pcm" href="https://ethereum.org/pcm/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="fil" href="https://ethereum.org/fil/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="pl" href="https://ethereum.org/pl/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="pt-br" href="https://ethereum.org/pt-br/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="pt" href="https://ethereum.org/pt/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="ro" href="https://ethereum.org/ro/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="ru" href="https://ethereum.org/ru/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="se" href="https://ethereum.org/se/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="sk" href="https://ethereum.org/sk/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="sl" href="https://ethereum.org/sl/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="sr" href="https://ethereum.org/sr/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="sw" href="https://ethereum.org/sw/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="ta" href="https://ethereum.org/ta/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="te" href="https://ethereum.org/te/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="tk" href="https://ethereum.org/tk/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="th" href="https://ethereum.org/th/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="tr" href="https://ethereum.org/tr/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="uk" href="https://ethereum.org/uk/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="ur" href="https://ethereum.org/ur/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="uz" href="https://ethereum.org/uz/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="vi" href="https://ethereum.org/vi/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="zh-tw" href="https://ethereum.org/zh-tw/developers/tutorials/uniswap-v2-annotated-code/"><link rel="alternate" hreflang="zh" href="https://ethereum.org/zh/developers/tutorials/uniswap-v2-annotated-code/"><meta name="next-head-count" content="84"><link rel="icon" type="image/x-icon" href="/favicon.png"><link rel="manifest" href="/manifest.json"><link rel="preload" href="/fonts/inter/latin.woff2" as="font" type="font/woff2" crossorigin="anonymous"><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"><link rel="preload" href="/_next/static/css/72eeeb24c192c0f1.css" as="style"><link rel="stylesheet" href="/_next/static/css/72eeeb24c192c0f1.css" data-n-g=""><link rel="preload" href="/_next/static/css/c49ea44ddcb26f2f.css" as="style"><link rel="stylesheet" href="/_next/static/css/c49ea44ddcb26f2f.css" data-n-p=""><noscript data-n-css=""></noscript><script type="text/javascript" async="" defer="" src="https://ethereumfoundation.matomo.cloud/matomo.js"></script><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-b9e53e7753a82430.js" defer=""></script><script src="/_next/static/chunks/framework-56eb74ff06128874.js" defer=""></script><script src="/_next/static/chunks/main-738a713c7878423a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-611bee6d8e5d5230.js" defer=""></script><script src="/_next/static/chunks/d7eeaac4-0cd44fb4b4bdc4df.js" defer=""></script><script src="/_next/static/chunks/c31f1870-3599ec4ae8b3819b.js" defer=""></script><script src="/_next/static/chunks/959-86506501aac85d41.js" defer=""></script><script src="/_next/static/chunks/3945-a4c5ba05d0fafb91.js" defer=""></script><script src="/_next/static/chunks/5872-e21005d816429481.js" defer=""></script><script src="/_next/static/chunks/4317-74ae53f988358076.js" defer=""></script><script src="/_next/static/chunks/2310-2863805e3b0d538e.js" defer=""></script><script src="/_next/static/chunks/9734-f6f8f59e20cea8c6.js" defer=""></script><script src="/_next/static/chunks/8376-324d8f56497848a2.js" defer=""></script><script src="/_next/static/chunks/5412-1cb77277ac322fc2.js" defer=""></script><script src="/_next/static/chunks/3023-0677d3cc5b24a398.js" defer=""></script><script src="/_next/static/chunks/3754-ab1a40cf8a5e9540.js" defer=""></script><script src="/_next/static/chunks/6554-ad9018a040454bed.js" defer=""></script><script src="/_next/static/chunks/8588-d84ab08b9f5842ba.js" defer=""></script><script src="/_next/static/chunks/2340-4de84dbd0bee9543.js" defer=""></script><script src="/_next/static/chunks/2067-642f04354727efb0.js" defer=""></script><script src="/_next/static/chunks/pages/%5B...slug%5D-e16bdfb1fd24d738.js" defer=""></script><script src="/_next/static/QEaqpGwTe2tBcFk8hwuEt/_buildManifest.js" defer=""></script><script src="/_next/static/QEaqpGwTe2tBcFk8hwuEt/_ssgManifest.js" defer=""></script><style id="__jsx-3436778983">:root{--font-inter:Inter, sans-serif;--font-mono:'__mono_0c3795', '__mono_Fallback_0c3795', Courier, monospace}</style><style data-emotion="css-global" data-s="">:host,:root,[data-theme]{--chakra-ring-inset:var(--chakra-empty,/*!*/ /*!*/);--chakra-ring-offset-width:0px;--chakra-ring-offset-color:#fff;--chakra-ring-color:rgba(66, 153, 225, 0.6);--chakra-ring-offset-shadow:0 0 #0000;--chakra-ring-shadow:0 0 #0000;--chakra-space-x-reverse:0;--chakra-space-y-reverse:0;--eth-colors-transparent:transparent;--eth-colors-current:currentColor;--eth-colors-whiteAlpha-50:rgba(255, 255, 255, 0.04);--eth-colors-whiteAlpha-100:rgba(255, 255, 255, 0.06);--eth-colors-whiteAlpha-200:rgba(255, 255, 255, 0.08);--eth-colors-whiteAlpha-300:rgba(255, 255, 255, 0.16);--eth-colors-whiteAlpha-400:rgba(255, 255, 255, 0.24);--eth-colors-whiteAlpha-500:rgba(255, 255, 255, 0.36);--eth-colors-whiteAlpha-600:rgba(255, 255, 255, 0.48);--eth-colors-whiteAlpha-700:rgba(255, 255, 255, 0.64);--eth-colors-whiteAlpha-800:rgba(255, 255, 255, 0.80);--eth-colors-whiteAlpha-900:rgba(255, 255, 255, 0.92);--eth-colors-blackAlpha-50:rgba(0, 0, 0, 0.04);--eth-colors-blackAlpha-100:rgba(0, 0, 0, 0.06);--eth-colors-blackAlpha-200:rgba(0, 0, 0, 0.08);--eth-colors-blackAlpha-300:rgba(0, 0, 0, 0.16);--eth-colors-blackAlpha-400:rgba(0, 0, 0, 0.24);--eth-colors-blackAlpha-500:rgba(0, 0, 0, 0.36);--eth-colors-blackAlpha-600:rgba(0, 0, 0, 0.48);--eth-colors-blackAlpha-700:rgba(0, 0, 0, 0.64);--eth-colors-blackAlpha-800:rgba(0, 0, 0, 0.80);--eth-colors-blackAlpha-900:rgba(0, 0, 0, 0.92);--eth-colors-gray-50:#F7FAFC;--eth-colors-gray-100:#F7F7F7;--eth-colors-gray-150:#F2F2F2;--eth-colors-gray-200:#E7E7E7;--eth-colors-gray-300:#C8C8C8;--eth-colors-gray-400:#8C8C8C;--eth-colors-gray-500:#616161;--eth-colors-gray-600:#333333;--eth-colors-gray-700:#222222;--eth-colors-gray-800:#1B1B1B;--eth-colors-gray-900:#141414;--eth-colors-red-50:#FFF5F5;--eth-colors-red-100:#f7c8c8;--eth-colors-red-200:#FEB2B2;--eth-colors-red-300:#FC8181;--eth-colors-red-400:#F56565;--eth-colors-red-500:#b80000;--eth-colors-red-600:#C53030;--eth-colors-red-700:#9B2C2C;--eth-colors-red-800:#822727;--eth-colors-red-900:#1B0C0C;--eth-colors-orange-50:#FFF3ED;--eth-colors-orange-100:#FFE5D6;--eth-colors-orange-200:#FFCBAD;--eth-colors-orange-300:#FFB185;--eth-colors-orange-400:#FF985C;--eth-colors-orange-500:#FF7324;--eth-colors-orange-550:#DF5A0E;--eth-colors-orange-600:#B84300;--eth-colors-orange-700:#7A2D00;--eth-colors-orange-800:#521E00;--eth-colors-orange-900:#2F1000;--eth-colors-yellow-50:#FFFFF0;--eth-colors-yellow-100:#FEFCBF;--eth-colors-yellow-200:#fff8df;--eth-colors-yellow-300:#F6E05E;--eth-colors-yellow-400:#ECC94B;--eth-colors-yellow-500:#bd8400;--eth-colors-yellow-600:#B7791F;--eth-colors-yellow-700:#975A16;--eth-colors-yellow-800:#744210;--eth-colors-yellow-900:#5F370E;--eth-colors-green-50:#F0FFF4;--eth-colors-green-100:#ddf4e4;--eth-colors-green-200:#9AE6B4;--eth-colors-green-300:#68D391;--eth-colors-green-400:#48BB78;--eth-colors-green-500:#0a7146;--eth-colors-green-600:#2F855A;--eth-colors-green-700:#276749;--eth-colors-green-800:#22543D;--eth-colors-green-900:#0A160E;--eth-colors-teal-50:#E6FFFA;--eth-colors-teal-100:#B2F5EA;--eth-colors-teal-200:#81E6D9;--eth-colors-teal-300:#4FD1C5;--eth-colors-teal-400:#38B2AC;--eth-colors-teal-500:#319795;--eth-colors-teal-600:#2C7A7B;--eth-colors-teal-700:#285E61;--eth-colors-teal-800:#234E52;--eth-colors-teal-900:#1D4044;--eth-colors-blue-50:#F6F6FF;--eth-colors-blue-100:#EBEBFF;--eth-colors-blue-200:#D6D6FF;--eth-colors-blue-300:#9999FF;--eth-colors-blue-400:#5555FF;--eth-colors-blue-500:#1C1CFF;--eth-colors-blue-600:#0000E0;--eth-colors-blue-700:#0000A3;--eth-colors-blue-800:#000066;--eth-colors-blue-900:#000029;--eth-colors-cyan-50:#EDFDFD;--eth-colors-cyan-100:#C4F1F9;--eth-colors-cyan-200:#9DECF9;--eth-colors-cyan-300:#76E4F7;--eth-colors-cyan-400:#0BC5EA;--eth-colors-cyan-500:#00B5D8;--eth-colors-cyan-600:#00A3C4;--eth-colors-cyan-700:#0987A0;--eth-colors-cyan-800:#086F83;--eth-colors-cyan-900:#065666;--eth-colors-purple-50:#FAF5FF;--eth-colors-purple-100:#E9D8FD;--eth-colors-purple-200:#D6BCFA;--eth-colors-purple-300:#B794F4;--eth-colors-purple-400:#9F7AEA;--eth-colors-purple-500:#805AD5;--eth-colors-purple-600:#6B46C1;--eth-colors-purple-700:#553C9A;--eth-colors-purple-800:#44337A;--eth-colors-purple-900:#322659;--eth-colors-pink-50:#FFF5F7;--eth-colors-pink-100:#FED7E2;--eth-colors-pink-200:#FBB6CE;--eth-colors-pink-300:#F687B3;--eth-colors-pink-400:#ED64A6;--eth-colors-pink-500:#D53F8C;--eth-colors-pink-600:#B83280;--eth-colors-pink-700:#97266D;--eth-colors-pink-800:#702459;--eth-colors-pink-900:#521B41;--eth-colors-linkedin-50:#E8F4F9;--eth-colors-linkedin-100:#CFEDFB;--eth-colors-linkedin-200:#9BDAF3;--eth-colors-linkedin-300:#68C7EC;--eth-colors-linkedin-400:#34B3E4;--eth-colors-linkedin-500:#00A0DC;--eth-colors-linkedin-600:#008CC9;--eth-colors-linkedin-700:#0077B5;--eth-colors-linkedin-800:#005E93;--eth-colors-linkedin-900:#004471;--eth-colors-facebook-50:#E8F4F9;--eth-colors-facebook-100:#D9DEE9;--eth-colors-facebook-200:#B7C2DA;--eth-colors-facebook-300:#6482C0;--eth-colors-facebook-400:#4267B2;--eth-colors-facebook-500:#385898;--eth-colors-facebook-600:#314E89;--eth-colors-facebook-700:#29487D;--eth-colors-facebook-800:#223B67;--eth-colors-facebook-900:#1E355B;--eth-colors-messenger-50:#D0E6FF;--eth-colors-messenger-100:#B9DAFF;--eth-colors-messenger-200:#A2CDFF;--eth-colors-messenger-300:#7AB8FF;--eth-colors-messenger-400:#2E90FF;--eth-colors-messenger-500:#0078FF;--eth-colors-messenger-600:#0063D1;--eth-colors-messenger-700:#0052AC;--eth-colors-messenger-800:#003C7E;--eth-colors-messenger-900:#002C5C;--eth-colors-whatsapp-50:#dffeec;--eth-colors-whatsapp-100:#b9f5d0;--eth-colors-whatsapp-200:#90edb3;--eth-colors-whatsapp-300:#65e495;--eth-colors-whatsapp-400:#3cdd78;--eth-colors-whatsapp-500:#22c35e;--eth-colors-whatsapp-600:#179848;--eth-colors-whatsapp-700:#0c6c33;--eth-colors-whatsapp-800:#01421c;--eth-colors-whatsapp-900:#001803;--eth-colors-twitter-50:#E5F4FD;--eth-colors-twitter-100:#C8E9FB;--eth-colors-twitter-200:#A8DCFA;--eth-colors-twitter-300:#83CDF7;--eth-colors-twitter-400:#57BBF5;--eth-colors-twitter-500:#1DA1F2;--eth-colors-twitter-600:#1A94DA;--eth-colors-twitter-700:#1681BF;--eth-colors-twitter-800:#136B9E;--eth-colors-twitter-900:#0D4D71;--eth-colors-telegram-50:#E3F2F9;--eth-colors-telegram-100:#C5E4F3;--eth-colors-telegram-200:#A2D4EC;--eth-colors-telegram-300:#7AC1E4;--eth-colors-telegram-400:#47A9DA;--eth-colors-telegram-500:#0088CC;--eth-colors-telegram-600:#007AB8;--eth-colors-telegram-700:#006BA1;--eth-colors-telegram-800:#005885;--eth-colors-telegram-900:#003F5E;--eth-borders-none:0;--eth-borders-1px:1px solid;--eth-borders-2px:2px solid;--eth-borders-4px:4px solid;--eth-borders-8px:8px solid;--eth-fonts-heading:var(--font-inter);--eth-fonts-body:var(--font-inter);--eth-fonts-mono:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--eth-fonts-monospace:var(--font-mono);--eth-fontSizes-3xs:0.45rem;--eth-fontSizes-2xs:0.625rem;--eth-fontSizes-xs:0.75rem;--eth-fontSizes-sm:0.875rem;--eth-fontSizes-md:1rem;--eth-fontSizes-lg:1.125rem;--eth-fontSizes-xl:1.25rem;--eth-fontSizes-2xl:1.5rem;--eth-fontSizes-3xl:1.875rem;--eth-fontSizes-4xl:2.25rem;--eth-fontSizes-5xl:3rem;--eth-fontSizes-6xl:3.75rem;--eth-fontSizes-7xl:4.5rem;--eth-fontSizes-8xl:6rem;--eth-fontSizes-9xl:8rem;--eth-fontWeights-hairline:100;--eth-fontWeights-thin:200;--eth-fontWeights-light:300;--eth-fontWeights-normal:400;--eth-fontWeights-medium:500;--eth-fontWeights-semibold:600;--eth-fontWeights-bold:700;--eth-fontWeights-extrabold:800;--eth-fontWeights-black:900;--eth-letterSpacings-tighter:-0.05em;--eth-letterSpacings-tight:-0.025em;--eth-letterSpacings-normal:0;--eth-letterSpacings-wide:0.025em;--eth-letterSpacings-wider:0.05em;--eth-letterSpacings-widest:0.1em;--eth-lineHeights-3:.75rem;--eth-lineHeights-4:1rem;--eth-lineHeights-5:1.25rem;--eth-lineHeights-6:1.5rem;--eth-lineHeights-7:1.75rem;--eth-lineHeights-8:2rem;--eth-lineHeights-9:2.25rem;--eth-lineHeights-10:2.5rem;--eth-lineHeights-normal:normal;--eth-lineHeights-none:1;--eth-lineHeights-shorter:1.25;--eth-lineHeights-short:1.375;--eth-lineHeights-base:1.6;--eth-lineHeights-tall:1.625;--eth-lineHeights-taller:2;--eth-lineHeights-6xs:1.1;--eth-lineHeights-5xs:1.15;--eth-lineHeights-4xs:1.2;--eth-lineHeights-3xs:1.25;--eth-lineHeights-2xs:1.3;--eth-lineHeights-xs:1.4;--eth-lineHeights-sm:1.5;--eth-radii-none:0;--eth-radii-sm:0.125rem;--eth-radii-base:0.25rem;--eth-radii-md:0.375rem;--eth-radii-lg:0.5rem;--eth-radii-xl:0.75rem;--eth-radii-2xl:1rem;--eth-radii-3xl:1.5rem;--eth-radii-full:9999px;--eth-space-1:0.25rem;--eth-space-2:0.5rem;--eth-space-3:0.75rem;--eth-space-4:1rem;--eth-space-5:1.25rem;--eth-space-6:1.5rem;--eth-space-7:1.75rem;--eth-space-8:2rem;--eth-space-9:2.25rem;--eth-space-10:2.5rem;--eth-space-12:3rem;--eth-space-14:3.5rem;--eth-space-16:4rem;--eth-space-19:4.75rem;--eth-space-20:5rem;--eth-space-24:6rem;--eth-space-28:7rem;--eth-space-32:8rem;--eth-space-36:9rem;--eth-space-40:10rem;--eth-space-44:11rem;--eth-space-48:12rem;--eth-space-52:13rem;--eth-space-56:14rem;--eth-space-60:15rem;--eth-space-64:16rem;--eth-space-72:18rem;--eth-space-80:20rem;--eth-space-96:24rem;--eth-space-px:1px;--eth-space-0-5:0.125rem;--eth-space-1-5:0.375rem;--eth-space-2-5:0.625rem;--eth-space-3-5:0.875rem;--eth-space-7-5:1.875rem;--eth-space-10-5:2.625rem;--eth-shadows-xs:0 0 0 1px rgba(0, 0, 0, 0.05);--eth-shadows-sm:0 1px 2px 0 rgba(0, 0, 0, 0.05);--eth-shadows-base:0 1px 3px 0 rgba(0, 0, 0, 0.1),0 1px 2px 0 rgba(0, 0, 0, 0.06);--eth-shadows-md:0 4px 6px -1px rgba(0, 0, 0, 0.1),0 2px 4px -1px rgba(0, 0, 0, 0.06);--eth-shadows-lg:0 10px 15px -3px rgba(0, 0, 0, 0.1),0 4px 6px -2px rgba(0, 0, 0, 0.05);--eth-shadows-xl:0 20px 25px -5px rgba(0, 0, 0, 0.1),0 10px 10px -5px rgba(0, 0, 0, 0.04);--eth-shadows-2xl:0 25px 50px -12px rgba(0, 0, 0, 0.25);--eth-shadows-outline:0 0 0 4px var(--eth-colors-primary-hover);--eth-shadows-inner:inset 0 2px 4px 0 rgba(0,0,0,0.06);--eth-shadows-none:none;--eth-shadows-dark-lg:rgba(0, 0, 0, 0.1) 0px 0px 0px 1px,rgba(0, 0, 0, 0.2) 0px 5px 10px,rgba(0, 0, 0, 0.4) 0px 15px 40px;--eth-shadows-table:0 14px 66px rgba(0,0,0,.07),0 10px 17px rgba(0,0,0,.03),0 4px 7px rgba(0,0,0,.05);--eth-shadows-drop:0 4px 17px 0 var(--eth-colors-blackAlpha-200);--eth-shadows-tableBox-light:0 14px 66px rgba(0,0,0,.07),0 10px 17px rgba(0,0,0,.03),0 4px 7px rgba(0,0,0,.05);--eth-shadows-tableBox-dark:0 14px 66px hsla(0,0%,96.1%,.07),0 10px 17px hsla(0,0%,96.1%,.03),0 4px 7px hsla(0,0%,96.1%,.05);--eth-shadows-tableBoxHover:0px 8px 17px rgba(0, 0, 0, 0.15);--eth-shadows-tableItemBox-light:0 1px 1px rgba(0, 0, 0, 0.1);--eth-shadows-tableItemBox-dark:0 1px 1px hsla(0,0%,100%,.1);--eth-shadows-tableItemBoxHover:0 0 1px var(--eth-colors-primary-base);--eth-shadows-gridYellowBoxShadow:8px 8px 0px 0px var(--eth-colors-gridYellow);--eth-shadows-gridBlueBowShadow:8px 8px 0px 0px var(--eth-colors-gridBlue);--eth-shadows-primary:4px 4px 0px 0px var(--eth-colors-primary-light);--eth-shadows-buttonHover:4px 4px 0 0 var(--eth-colors-primary-lowContrast);--eth-shadows-tooltip:0 0 16px var(--eth-colors-tooltipShadow);--eth-sizes-1:0.25rem;--eth-sizes-2:0.5rem;--eth-sizes-3:0.75rem;--eth-sizes-4:1rem;--eth-sizes-5:1.25rem;--eth-sizes-6:1.5rem;--eth-sizes-7:1.75rem;--eth-sizes-8:2rem;--eth-sizes-9:2.25rem;--eth-sizes-10:2.5rem;--eth-sizes-12:3rem;--eth-sizes-14:3.5rem;--eth-sizes-16:4rem;--eth-sizes-19:4.75rem;--eth-sizes-20:5rem;--eth-sizes-24:6rem;--eth-sizes-28:7rem;--eth-sizes-32:8rem;--eth-sizes-36:9rem;--eth-sizes-40:10rem;--eth-sizes-44:11rem;--eth-sizes-48:12rem;--eth-sizes-52:13rem;--eth-sizes-56:14rem;--eth-sizes-60:15rem;--eth-sizes-64:16rem;--eth-sizes-72:18rem;--eth-sizes-80:20rem;--eth-sizes-96:24rem;--eth-sizes-px:1px;--eth-sizes-0-5:0.125rem;--eth-sizes-1-5:0.375rem;--eth-sizes-2-5:0.625rem;--eth-sizes-3-5:0.875rem;--eth-sizes-max:max-content;--eth-sizes-min:min-content;--eth-sizes-full:100%;--eth-sizes-3xs:14rem;--eth-sizes-2xs:16rem;--eth-sizes-xs:20rem;--eth-sizes-sm:24rem;--eth-sizes-md:28rem;--eth-sizes-lg:32rem;--eth-sizes-xl:36rem;--eth-sizes-2xl:42rem;--eth-sizes-3xl:48rem;--eth-sizes-4xl:56rem;--eth-sizes-5xl:64rem;--eth-sizes-6xl:72rem;--eth-sizes-7xl:80rem;--eth-sizes-8xl:90rem;--eth-sizes-prose:60ch;--eth-sizes-container-sm:640px;--eth-sizes-container-md:768px;--eth-sizes-container-lg:1024px;--eth-sizes-container-xl:1280px;--eth-sizes-container-2xl:1440px;--eth-sizes-7-5:1.875rem;--eth-sizes-10-5:2.625rem;--eth-zIndices-hide:-1;--eth-zIndices-auto:auto;--eth-zIndices-base:0;--eth-zIndices-docked:10;--eth-zIndices-dropdown:1000;--eth-zIndices-sticky:1100;--eth-zIndices-banner:1200;--eth-zIndices-overlay:1300;--eth-zIndices-modal:1400;--eth-zIndices-popover:1500;--eth-zIndices-skipLink:1600;--eth-zIndices-toast:1700;--eth-zIndices-tooltip:1800;--eth-transition-property-common:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform;--eth-transition-property-colors:background-color,border-color,color,fill,stroke;--eth-transition-property-dimensions:width,height;--eth-transition-property-position:left,right,top,bottom;--eth-transition-property-background:background-color,background-image,background-position;--eth-transition-easing-ease-in:cubic-bezier(0.4, 0, 1, 1);--eth-transition-easing-ease-out:cubic-bezier(0, 0, 0.2, 1);--eth-transition-easing-ease-in-out:cubic-bezier(0.4, 0, 0.2, 1);--eth-transition-duration-ultra-fast:50ms;--eth-transition-duration-faster:100ms;--eth-transition-duration-fast:150ms;--eth-transition-duration-normal:200ms;--eth-transition-duration-slow:300ms;--eth-transition-duration-slower:400ms;--eth-transition-duration-ultra-slow:500ms;--eth-blur-none:0;--eth-blur-sm:4px;--eth-blur-base:8px;--eth-blur-md:12px;--eth-blur-lg:16px;--eth-blur-xl:24px;--eth-blur-2xl:40px;--eth-blur-3xl:64px;--eth-breakpoints-base:0em;--eth-breakpoints-sm:30em;--eth-breakpoints-md:48em;--eth-breakpoints-lg:62em;--eth-breakpoints-xl:80em;--eth-breakpoints-2xl:96em;--eth-colors-success-base:var(--eth-colors-green-500);--eth-colors-success-light:var(--eth-colors-green-100);--eth-colors-attention-base:var(--eth-colors-yellow-500);--eth-colors-attention-light:var(--eth-colors-yellow-200);--eth-colors-error-base:var(--eth-colors-red-500);--eth-colors-error-light:var(--eth-colors-red-100);--eth-shadows-menu-accordion:0px 2px 2px 0px rgba(0, 0, 0, 0.12) inset,0px -3px 2px 0px rgba(0, 0, 0, 0.14) inset;}.chakra-ui-light :host:not([data-theme]),.chakra-ui-light :root:not([data-theme]),.chakra-ui-light [data-theme]:not([data-theme]),[data-theme=light] :host:not([data-theme]),[data-theme=light] :root:not([data-theme]),[data-theme=light] [data-theme]:not([data-theme]),:host[data-theme=light],:root[data-theme=light],[data-theme][data-theme=light]{--eth-colors-black:#000000;--eth-colors-white:#ffffff;--eth-colors-chakra-body-text:var(--eth-colors-gray-800);--eth-colors-chakra-body-bg:var(--eth-colors-white);--eth-colors-chakra-border-color:var(--eth-colors-gray-200);--eth-colors-chakra-inverse-text:var(--eth-colors-white);--eth-colors-chakra-subtle-bg:var(--eth-colors-gray-100);--eth-colors-chakra-subtle-text:var(--eth-colors-gray-600);--eth-colors-chakra-placeholder-color:var(--eth-colors-gray-500);--eth-colors-white500:#ffffff;--eth-colors-white600:#f7f7f7;--eth-colors-white700:#e5e5e5;--eth-colors-white800:#ccc;--eth-colors-white900:#b2b2b2;--eth-colors-black500:#000000;--eth-colors-black400:#191919;--eth-colors-black300:#333;--eth-colors-black200:#4c4c4c;--eth-colors-black100:#666;--eth-colors-black50:#7f7f7f;--eth-colors-boxShadow:rgba(0,0,0,0.12);--eth-colors-boxShadowHover:rgba(0,0,0,0.24);--eth-colors-secondary:#b2b2b2;--eth-colors-success900:#031f13;--eth-colors-success800:#063f27;--eth-colors-success700:#095e3a;--eth-colors-success600:#0c7e4e;--eth-colors-success-outline:var(--eth-colors-success-base);--eth-colors-success-neutral:var(--eth-colors-green-100);--eth-colors-success500:#109e62;--eth-colors-success400:#3fb181;--eth-colors-success300:#6fc4a0;--eth-colors-success200:#9fd8c0;--eth-colors-success100:#cfebdf;--eth-colors-fail900:#240000;--eth-colors-fail800:#490000;--eth-colors-fail700:#6e0000;--eth-colors-fail600:#930000;--eth-colors-fail:#b80000;--eth-colors-fail500:#b80000;--eth-colors-fail400:#c63333;--eth-colors-fail300:#d46666;--eth-colors-fail200:#e29999;--eth-colors-fail100:#f0cccc;--eth-colors-tagBlue:#d1d1ff;--eth-colors-tagOrange:#ffe3d3;--eth-colors-tagGreen:#cfebdf;--eth-colors-tagRed:#f0cccc;--eth-colors-tagTurquoise:#ccfcff;--eth-colors-tagGray:#e5e5e5;--eth-colors-tagYellow:#fff8df;--eth-colors-tagMint:#e1fefa;--eth-colors-tagPink:#ffe5f9;--eth-colors-warning:#ffe3d3;--eth-colors-warningLink:#994515;--eth-colors-warningLinkHover:#321607;--eth-colors-lowBug:#ffe3d3;--eth-colors-mediumBug:#ffab7b;--eth-colors-primaryLight300:#7676ff;--eth-colors-primaryDark300:#ffab7b;--eth-colors-yellow:#fff8df;--eth-colors-gridYellow:#ffe78e;--eth-colors-gridRed:#ef7d7d;--eth-colors-gridBlue:#a7d0f4;--eth-colors-gridGreen:#6fc4a0;--eth-colors-gridOrange:#ffab7b;--eth-colors-gridPink:#ffa1c3;--eth-colors-gridPurple:#a4a4ff;--eth-colors-infoBanner:#e8e8ff;--eth-colors-buttonColor:#ffffff;--eth-colors-upgradesGradient:linear-gradient(285.24deg, #F7CBC0 0%, #F4B1AB 29.8%, #8476D9 49.78%, #85ACF9 54.14%, #1C1CE1 61.77%, #000000 69.77%);--eth-colors-runNodeGradient:linear-gradient(0deg, rgba(153, 157, 244, 0.1) 0%, rgba(153, 157, 244, 0) 100%),linear-gradient(270.72deg, #FDF0FF 0.62%, rgba(236, 195, 195, 0.557292) 32.61%, rgba(207, 189, 230, 0.296875) 49.67%, rgba(196, 196, 196, 0) 72.88%);--eth-colors-runNodeGradient2:linear-gradient(135deg, rgba(79, 113, 235, 0.2) 9.8%, rgba(232, 79, 235, 0.2) 92.84%);--eth-colors-ghostCardBackground:#ffffff;--eth-colors-ghostCardGhost:#f7f7f7;--eth-colors-secondaryButtonBackgroundActive:#e5e5e5;--eth-colors-primary-base:var(--eth-colors-blue-500);--eth-colors-primary-highContrast:var(--eth-colors-blue-800);--eth-colors-primary-lowContrast:var(--eth-colors-blue-100);--eth-colors-primary-hover:var(--eth-colors-blue-400);--eth-colors-primary-visited:var(--eth-colors-blue-700);--eth-colors-primary-light:var(--eth-colors-blue-100);--eth-colors-primary-dark:var(--eth-colors-blue-700);--eth-colors-primary-pressed:var(--eth-colors-blue-400);--eth-colors-primary950:#040426;--eth-colors-primary900:#050532;--eth-colors-primary800:#0b0b66;--eth-colors-primary700:#101099;--eth-colors-primary600:#1616cc;--eth-colors-primary500:#1c1cff;--eth-colors-primary400:#4949ff;--eth-colors-primary300:#7676ff;--eth-colors-primary200:#a4a4ff;--eth-colors-primary100:#d1d1ff;--eth-colors-primaryHover:rgba(28, 28, 225, 0.8);--eth-colors-primaryActive:#1616cc;--eth-colors-lightBorder:#ececec;--eth-colors-priceCardBackgroundPositive:linear-gradient( 0, rgba(207, 236, 224, 0.6) 0%, rgba(207, 236, 224, 0) 100%);--eth-colors-priceCardBackgroundNegative:linear-gradient(180deg, rgba(241, 204, 204, 0.4) 0%, rgba(241, 204, 204, 0) 100%);--eth-colors-priceCardBorder:#ececec;--eth-colors-priceCardBorderNegative:#ececec;--eth-colors-searchBorder:#7f7f7f;--eth-colors-searchBackground:#ffffff;--eth-colors-searchBackgroundEmpty:#f2f2f2;--eth-colors-searchResultText:#33363d;--eth-colors-searchResultBackground:#f1f3f5;--eth-colors-selectHover:#d1d1ff;--eth-colors-selectActive:#a4a4ff;--eth-colors-dropdownBackground:#ffffff;--eth-colors-dropdownBackgroundHover:#f2f2f2;--eth-colors-dropdownBorder:#e5e5e5;--eth-colors-markBackground:rgba(143,187,237,.1);--eth-colors-markUnderline:rgba(143,187,237,.5);--eth-colors-modalBackground:hsla(0, 0%, 69.8%, 0.9);--eth-colors-text:#333333;--eth-colors-text200:#666666;--eth-colors-text300:#4c4c4c;--eth-colors-textTableOfContents:#7f7f7f;--eth-colors-background-base:var(--eth-colors-white);--eth-colors-background-highlight:var(--eth-colors-gray-100);--eth-colors-ednBackground:#f7f7f7;--eth-colors-layer2ContentSecondary:#e5e5e5;--eth-colors-border:#e5e5e5;--eth-colors-tableBoxShadow:0 14px 66px rgba(0,0,0,.07),0 10px 17px rgba(0,0,0,.03),0 4px 7px rgba(0,0,0,.05);--eth-colors-tableItemBoxShadow:rgba(0, 0, 0, 0.1);--eth-colors-tableBackgroundHover:#f2f2f2;--eth-colors-preBackground:#f2f2f2;--eth-colors-preBorder:rgba(0,0,0,.05);--eth-colors-homeDivider:#a4a4f3;--eth-colors-displayDark:none;--eth-colors-displayLight:block;--eth-colors-grayBackground:#fcfcfc;--eth-colors-cardGradient:radial-gradient(46.28% 66.31% at 66.95% 58.35%, #e6e6f7 0%, #e7edfa 50%, #e9fbfa 100%);--eth-colors-upgradeStatusBackground:linear-gradient(180deg, rgba(0, 240, 255, 0.2) 0%, rgba(255, 255, 255, 0) 100%),linear-gradient(0deg, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.8)),#1c1ce1;--eth-colors-upgradeStatusShippedBackground:linear-gradient(180deg, rgba(0, 240, 255, 0.2) 0%, rgba(255, 255, 255, 0) 100%),linear-gradient(0deg, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.8)),#109e62;--eth-colors-upgradeStatusBorder:none;--eth-colors-upgradeStatusShippedBorder:none;--eth-colors-mainnet:#9fd8c0;--eth-colors-mainnetBorder:#7f7f7f;--eth-colors-beaconchain:#ccfcff;--eth-colors-beaconchainBorder:#7f7f7f;--eth-colors-shard:#ffe3d3;--eth-colors-shardBorder:#7f7f7f;--eth-colors-infoLink:#0b0b66;--eth-colors-infoLinkHover:#050532;--eth-colors-cardBoxShadow:4px 4px 0px 0px #d2d2f9;--eth-colors-homeBoxMint:#e1fefa;--eth-colors-homeBoxTurquoise:#ccfcff;--eth-colors-homeBoxOrange:#ffe3d3;--eth-colors-homeBoxPurple:#e8e8ff;--eth-colors-homeBoxPink:#ffe5f9;--eth-colors-codeBackground:#fafafa;--eth-colors-rollupDevDocList:#e8e8ff;--eth-colors-beta:radial-gradient(25.56% 133.51% at 28.36% 45.54%, rgba(28, 28, 225, 0) 0%, rgba(28, 28, 225, 0.06) 100%);--eth-colors-offBackground:#f7f7f7;--eth-colors-stakingPillPlatform:#cd9df3;--eth-colors-stakingPillUI:#ebd27a;--eth-colors-stakingGold:#be8d10;--eth-colors-stakingGoldFill:#fef9ef;--eth-colors-stakingGreen:#129e5b;--eth-colors-stakingGreenFill:#f7faf1;--eth-colors-stakingBlue:#0b83dc;--eth-colors-stakingBlueFill:#f1fcf5;--eth-colors-stakingRed:#a0524c;--eth-colors-stakingRedFill:#f8fbf9;--eth-colors-layer2Gradient:linear-gradient(85.12deg, rgba(185, 185, 241, 0.2) 0%, rgba(84, 132, 234, 0.2) 56.29%, rgba(58, 142, 137, 0.2) 99.99%);--eth-colors-feedbackGradient:linear-gradient(102.7deg, rgba(185, 185, 241, 0.2) 0%, rgba(84, 132, 234, 0.2) 51.56%, rgba(58, 142, 137, 0.2) 100%);--eth-colors-bannerGridGradient:linear-gradient(90deg, rgba(127,127,213,0.2) 0%, rgba(132,145,221,0.2) 50%, rgba(145,234,228,0.2) 100%);--eth-colors-sliderBg:#F7F7F7;--eth-colors-sliderBorder:#ECECEC;--eth-colors-sliderDot:#A4A4A4;--eth-colors-sliderDotActive:#1C1DFF;--eth-colors-sliderBtnBg:#A4A4A4;--eth-colors-sliderBtnColor:#ffffff;--eth-colors-sliderBtnBgDisabled:#E7E7E7;--eth-colors-sliderBtnColorDisabled:#737373;--eth-colors-body-base:var(--eth-colors-gray-800);--eth-colors-body-medium:var(--eth-colors-gray-500);--eth-colors-body-light:var(--eth-colors-gray-200);--eth-colors-body-inverted:var(--eth-colors-gray-100);--eth-colors-disabled:var(--eth-colors-gray-400);--eth-colors-neutral:var(--eth-colors-white);--eth-colors-attention-outline:var(--eth-colors-attention-base);--eth-colors-error-outline:var(--eth-colors-error-base);--eth-colors-error-neutral:var(--eth-colors-red-100);--eth-colors-tooltipShadow:var(--eth-colors-blackAlpha-400);--eth-colors-switchBackground:var(--eth-colors-gray-300);--eth-colors-hubHeroContentBg:rgba(255, 255, 255, 0.80);--eth-gradients-bgMainGradient:linear-gradient(102.7deg, rgba(185, 185, 241, 0.2) 0%, rgba(84, 132, 234, 0.2) 51.56%, rgba(58, 142, 137, 0.2) 100%);}.chakra-ui-dark :host:not([data-theme]),.chakra-ui-dark :root:not([data-theme]),.chakra-ui-dark [data-theme]:not([data-theme]),[data-theme=dark] :host:not([data-theme]),[data-theme=dark] :root:not([data-theme]),[data-theme=dark] [data-theme]:not([data-theme]),:host[data-theme=dark],:root[data-theme=dark],[data-theme][data-theme=dark]{--eth-colors-black:#000000;--eth-colors-white:#ffffff;--eth-colors-chakra-body-text:var(--eth-colors-whiteAlpha-900);--eth-colors-chakra-body-bg:var(--eth-colors-gray-800);--eth-colors-chakra-border-color:var(--eth-colors-whiteAlpha-300);--eth-colors-chakra-inverse-text:var(--eth-colors-gray-800);--eth-colors-chakra-subtle-bg:var(--eth-colors-gray-700);--eth-colors-chakra-subtle-text:var(--eth-colors-gray-400);--eth-colors-chakra-placeholder-color:var(--eth-colors-whiteAlpha-400);--eth-colors-white500:#ffffff;--eth-colors-white600:#f7f7f7;--eth-colors-white700:#e5e5e5;--eth-colors-white800:#ccc;--eth-colors-white900:#b2b2b2;--eth-colors-black500:#000000;--eth-colors-black400:#191919;--eth-colors-black300:#333;--eth-colors-black200:#4c4c4c;--eth-colors-black100:#666;--eth-colors-black50:#7f7f7f;--eth-colors-boxShadow:rgba(0,0,0,0.12);--eth-colors-boxShadowHover:rgba(0,0,0,0.24);--eth-colors-secondary:#b2b2b2;--eth-colors-success900:#031f13;--eth-colors-success800:#063f27;--eth-colors-success700:#095e3a;--eth-colors-success600:#0c7e4e;--eth-colors-success-outline:var(--eth-colors-success-light);--eth-colors-success-neutral:var(--eth-colors-green-900);--eth-colors-success500:#109e62;--eth-colors-success400:#3fb181;--eth-colors-success300:#6fc4a0;--eth-colors-success200:#9fd8c0;--eth-colors-success100:#cfebdf;--eth-colors-fail900:#240000;--eth-colors-fail800:#490000;--eth-colors-fail700:#6e0000;--eth-colors-fail600:#930000;--eth-colors-fail:#b80000;--eth-colors-fail500:#b80000;--eth-colors-fail400:#c63333;--eth-colors-fail300:#d46666;--eth-colors-fail200:#e29999;--eth-colors-fail100:#f0cccc;--eth-colors-tagBlue:#d1d1ff;--eth-colors-tagOrange:#ffe3d3;--eth-colors-tagGreen:#cfebdf;--eth-colors-tagRed:#f0cccc;--eth-colors-tagTurquoise:#ccfcff;--eth-colors-tagGray:#e5e5e5;--eth-colors-tagYellow:#fff8df;--eth-colors-tagMint:#e1fefa;--eth-colors-tagPink:#ffe5f9;--eth-colors-warning:#ffe3d3;--eth-colors-warningLink:#994515;--eth-colors-warningLinkHover:#321607;--eth-colors-lowBug:#ffe3d3;--eth-colors-mediumBug:#ffab7b;--eth-colors-primaryLight300:#7676ff;--eth-colors-primaryDark300:#ffab7b;--eth-colors-yellow:#fff8df;--eth-colors-gridYellow:#ffe78e;--eth-colors-gridRed:#ef7d7d;--eth-colors-gridBlue:#a7d0f4;--eth-colors-gridGreen:#6fc4a0;--eth-colors-gridOrange:#ffab7b;--eth-colors-gridPink:#ffa1c3;--eth-colors-gridPurple:#a4a4ff;--eth-colors-infoBanner:#e8e8ff;--eth-colors-buttonColor:#333;--eth-colors-upgradesGradient:linear-gradient(285.24deg, #f7cbc0 0%, #fbeae3 17.81%, #f4b1ab 29.8%, #8476d9 49.78%, #8db4ff 69.77%);--eth-colors-runNodeGradient:linear-gradient(0deg, rgba(153, 157, 244, 0.35) 0%, rgba(153, 157, 244, 0) 100%),linear-gradient(89.24deg, rgba(253, 240, 255, 0.7) -64.3%, rgba(212, 119, 119, 0.390104) -7.43%, rgba(188, 163, 220, 0.207813) 46.66%, rgba(196, 196, 196, 0) 99.16%);--eth-colors-runNodeGradient2:linear-gradient(135deg, rgba(79, 113, 235, 0.2) 9.8%, rgba(232, 79, 235, 0.2) 92.84%);--eth-colors-ghostCardBackground:#333;--eth-colors-ghostCardGhost:#7f7f7f;--eth-colors-secondaryButtonBackgroundActive:#333;--eth-colors-primary-base:var(--eth-colors-orange-500);--eth-colors-primary-highContrast:var(--eth-colors-orange-100);--eth-colors-primary-lowContrast:var(--eth-colors-orange-800);--eth-colors-primary-hover:var(--eth-colors-orange-400);--eth-colors-primary-visited:var(--eth-colors-orange-550);--eth-colors-primary-light:var(--eth-colors-orange-100);--eth-colors-primary-dark:var(--eth-colors-orange-800);--eth-colors-primary-pressed:var(--eth-colors-orange-800);--eth-colors-primary950:#190b03;--eth-colors-primary900:#321607;--eth-colors-primary800:#662e0e;--eth-colors-primary700:#994515;--eth-colors-primary600:#cc5c1c;--eth-colors-primary500:#ff7324;--eth-colors-primary400:#ff8f4f;--eth-colors-primary300:#ffab7b;--eth-colors-primary200:#ffc7a7;--eth-colors-primary100:#ffe3d3;--eth-colors-primaryHover:#ff8f4f;--eth-colors-primaryActive:#ffc7a7;--eth-colors-lightBorder:#404040;--eth-colors-priceCardBackgroundPositive:var(--eth-colors-transparent);--eth-colors-priceCardBackgroundNegative:var(--eth-colors-transparent);--eth-colors-priceCardBorder:#095e3a;--eth-colors-priceCardBorderNegative:#d46666;--eth-colors-searchBorder:#b2b2b2;--eth-colors-searchBackground:#4c4c4c;--eth-colors-searchBackgroundEmpty:#333333;--eth-colors-searchResultText:#f1f3f5;--eth-colors-searchResultBackground:#33363d;--eth-colors-selectHover:#994515;--eth-colors-selectActive:#cc5c1c;--eth-colors-dropdownBackground:#191919;--eth-colors-dropdownBackgroundHover:#000000;--eth-colors-dropdownBorder:#333333;--eth-colors-markBackground:rgb(255, 115, 36, .1);--eth-colors-markUnderline:rgb(255, 115, 36, .5);--eth-colors-modalBackground:rgba(25,25,25,0.8);--eth-colors-text:#f2f2f2;--eth-colors-text200:#b2b2b2;--eth-colors-text300:#cccccc;--eth-colors-textTableOfContents:hsla(0,0%,69.8%,.8);--eth-colors-background-base:var(--eth-colors-gray-800);--eth-colors-background-highlight:var(--eth-colors-gray-900);--eth-colors-ednBackground:#191919;--eth-colors-layer2ContentSecondary:#333;--eth-colors-border:#333;--eth-colors-tableBoxShadow:0 14px 66px hsla(0,0%,96.1%,.07),0 10px 17px hsla(0,0%,96.1%,.03),0 4px 7px hsla(0,0%,96.1%,.05);--eth-colors-tableItemBoxShadow:hsla(0,0%,100%,.1);--eth-colors-tableBackgroundHover:rgba(255,115,36,.013);--eth-colors-preBackground:#191919;--eth-colors-preBorder:hsla(0,0%,100%,.05);--eth-colors-homeDivider:#ffc7a7;--eth-colors-displayDark:block;--eth-colors-displayLight:none;--eth-colors-grayBackground:#272627;--eth-colors-cardGradient:linear-gradient(49.21deg, rgba(127, 127, 213, 0.2) 19.87%, rgba(134, 168, 231, 0.2) 58.46%, rgba(145, 234, 228, 0.2) 97.05% );--eth-colors-upgradeStatusBackground:#222222;--eth-colors-upgradeStatusShippedBackground:#222222;--eth-colors-upgradeStatusBorder:#a4a4ff solid 2px;--eth-colors-upgradeStatusShippedBorder:#3fb181 solid 2px;--eth-colors-mainnet:#222222;--eth-colors-mainnetBorder:#6fc4a0;--eth-colors-beaconchain:#222222;--eth-colors-beaconchainBorder:#ffe5f9;--eth-colors-shard:#222222;--eth-colors-shardBorder:#ff7324;--eth-colors-infoLink:#0b0b66;--eth-colors-infoLinkHover:#050532;--eth-colors-cardBoxShadow:4px 4px 0px 0px #ffab7c;--eth-colors-homeBoxMint:#2d3332;--eth-colors-homeBoxTurquoise:#293233;--eth-colors-homeBoxOrange:#332821;--eth-colors-homeBoxPurple:#212131;--eth-colors-homeBoxPink:#332027;--eth-colors-codeBackground:#2a2734;--eth-colors-rollupDevDocList:#4c4c4c;--eth-colors-beta:background:radial-gradient(25.56% 133.51% at 28.36% 45.54%, rgba(255, 143, 80, 0.72) 0%, rgba(255, 143, 80, 0.22) 100%);--eth-colors-offBackground:#181818;--eth-colors-stakingPillPlatform:#cd9df3;--eth-colors-stakingPillUI:#ebd27a;--eth-colors-stakingGold:#F2BB2F;--eth-colors-stakingGoldFill:#373228;--eth-colors-stakingGreen:#49DE96;--eth-colors-stakingGreenFill:#30342b;--eth-colors-stakingBlue:#A9D3F2;--eth-colors-stakingBlueFill:#2b352f;--eth-colors-stakingRed:#D6BBB9;--eth-colors-stakingRedFill:#313432;--eth-colors-layer2Gradient:linear-gradient(83.46deg, rgba(127, 127, 213, 0.2) 7.03%, rgba(138, 168, 231, 0.2) 52.42%, rgba(145, 234, 228, 0.2) 98.77%),#1E1E1E;--eth-colors-feedbackGradient:linear-gradient(83.46deg, #2C2C32 7.03%, #44404D 52.42%, #303038 98.77%);--eth-colors-bannerGridGradient:linear-gradient(90deg, rgba(172, 182, 229, 0.08) 0%, rgba(134, 253, 232, 0.08) 100%);--eth-colors-sliderBg:#191919;--eth-colors-sliderBorder:#404040;--eth-colors-sliderDot:#A4A4A4;--eth-colors-sliderDotActive:#FF7324;--eth-colors-sliderBtnBg:#404040;--eth-colors-sliderBtnColor:#ffffff;--eth-colors-sliderBtnBgDisabled:#404040;--eth-colors-sliderBtnColorDisabled:#737373;--eth-colors-body-base:var(--eth-colors-gray-100);--eth-colors-body-medium:var(--eth-colors-gray-400);--eth-colors-body-light:var(--eth-colors-gray-600);--eth-colors-body-inverted:var(--eth-colors-gray-800);--eth-colors-disabled:var(--eth-colors-gray-500);--eth-colors-neutral:var(--eth-colors-gray-900);--eth-colors-attention-outline:var(--eth-colors-attention-light);--eth-colors-error-outline:var(--eth-colors-error-light);--eth-colors-error-neutral:var(--eth-colors-red-900);--eth-colors-tooltipShadow:var(--eth-colors-whiteAlpha-400);--eth-colors-switchBackground:var(--eth-colors-whiteAlpha-400);--eth-colors-hubHeroContentBg:rgba(34, 34, 34, 0.80);--eth-gradients-bgMainGradient:linear-gradient(102.7deg, rgba(185, 185, 241, 0.2) 0%, rgba(84, 132, 234, 0.2) 51.56%, rgba(58, 142, 137, 0.2) 100%);}</style><style data-emotion="css-global" data-s="">html{line-height:1.5;-webkit-text-size-adjust:100%;font-family:system-ui,sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;-moz-osx-font-smoothing:grayscale;touch-action:manipulation;}body{position:relative;min-height:100%;margin:0;font-feature-settings:"kern";}:where(*, *::before, *::after){border-width:0;border-style:solid;box-sizing:border-box;word-wrap:break-word;}main{display:block;}hr{border-top-width:1px;box-sizing:content-box;height:0;overflow:visible;}:where(pre, code, kbd,samp){font-family:SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:1em;}a{background-color:transparent;color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit;}abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;}:where(b, strong){font-weight:bold;}small{font-size:80%;}:where(sub,sup){font-size:75%;line-height:0;position:relative;vertical-align:baseline;}sub{bottom:-0.25em;}sup{top:-0.5em;}img{border-style:none;}:where(button, input, optgroup, select, textarea){font-family:inherit;font-size:100%;line-height:1.15;margin:0;}:where(button, input){overflow:visible;}:where(button, select){text-transform:none;}:where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ){border-style:none;padding:0;}fieldset{padding:0.35em 0.75em 0.625em;}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;}progress{vertical-align:baseline;}textarea{overflow:auto;}:where([type="checkbox"], [type="radio"]){box-sizing:border-box;padding:0;}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{-webkit-appearance:none!important;}input[type="number"]{-moz-appearance:textfield;}input[type="search"]{-webkit-appearance:textfield;outline-offset:-2px;}input[type="search"]::-webkit-search-decoration{-webkit-appearance:none!important;}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}details{display:block;}summary{display:-webkit-box;display:-webkit-list-item;display:-ms-list-itembox;display:list-item;}template{display:none;}[hidden]{display:none!important;}:where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ){margin:0;}button{background:transparent;padding:0;}fieldset{margin:0;padding:0;}:where(ol, ul){margin:0;padding:0;}textarea{resize:vertical;}:where(button, [role="button"]){cursor:pointer;}button::-moz-focus-inner{border:0!important;}table{border-collapse:collapse;}:where(h1, h2, h3, h4, h5, h6){font-size:inherit;font-weight:inherit;}:where(button, input, optgroup, select, textarea){padding:0;line-height:inherit;color:inherit;}:where(img, svg, video, canvas, audio, iframe, embed, object){display:block;}:where(img, video){max-width:100%;height:auto;}[data-js-focus-visible] :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ){outline:none;box-shadow:none;}select::-ms-expand{display:none;}:root,:host{--chakra-vh:100vh;}@supports (height: -webkit-fill-available){:root,:host{--chakra-vh:-webkit-fill-available;}}@supports (height: -moz-fill-available){:root,:host{--chakra-vh:-moz-fill-available;}}@supports (height: 100dvh){:root,:host{--chakra-vh:100dvh;}}</style><style data-emotion="css-global" data-s="">body{font-family:var(--eth-fonts-body);color:var(--eth-colors-chakra-body-text);background:var(--eth-colors-background-base);transition-property:background-color;transition-duration:var(--eth-transition-duration-normal);line-height:var(--eth-lineHeights-base);font-size:var(--eth-fontSizes-sm);}@media screen and (min-width: 62em){body{font-size:var(--eth-fontSizes-md);}}*::-webkit-input-placeholder{color:var(--eth-colors-chakra-placeholder-color);}*::-moz-placeholder{color:var(--eth-colors-chakra-placeholder-color);}*:-ms-input-placeholder{color:var(--eth-colors-chakra-placeholder-color);}*::placeholder{color:var(--eth-colors-chakra-placeholder-color);}*,*::before,::after{border-color:var(--eth-colors-chakra-border-color);}a{color:var(--eth-colors-primary-base);-webkit-text-decoration:underline;text-decoration:underline;}ul,ol{margin:0px 0px 1.45rem 1.45rem;padding:0px;}li{margin-bottom:calc(1.45rem / 2);}ol li{-webkit-padding-start:0px;padding-inline-start:0px;}ul li{-webkit-padding-start:0px;padding-inline-start:0px;}li>ol{-webkit-margin-start:1.45rem;margin-inline-start:1.45rem;margin-bottom:calc(1.45rem / 2);margin-top:calc(1.45rem / 2);}li>ul{-webkit-margin-start:1.45rem;margin-inline-start:1.45rem;margin-bottom:calc(1.45rem / 2);margin-top:calc(1.45rem / 2);}li *:last-child{margin-bottom:0px;}li>p{margin-bottom:calc(1.45rem / 2);}.header-anchor{position:relative!important;display:initial;-webkit-margin-start:-1.5em;margin-inline-start:-1.5em;-webkit-padding-end:0.5rem!important;padding-inline-end:0.5rem!important;font-size:1rem;vertical-align:middle;}.header-anchor svg{display:inline;fill:var(--eth-colors-primary-base);visibility:hidden;}h1:hover .header-anchor svg,h2:hover .header-anchor svg,h3:hover .header-anchor svg,h4:hover .header-anchor svg,h5:hover .header-anchor svg,h6:hover .header-anchor svg{visibility:visible;}.header-anchor:focus svg{visibility:visible;}pre,code,kbd,samp{font-size:var(--eth-fontSizes-md);line-height:var(--eth-lineHeights-base);font-family:var(--eth-fonts-monospace);}</style><style data-emotion="css 1ms4467" data-s="">.css-1ms4467{-webkit-margin-start:auto;margin-inline-start:auto;-webkit-margin-end:auto;margin-inline-end:auto;max-width:1504px;}</style><style data-emotion="css 1webc1y" data-s="">.css-1webc1y{background:var(--eth-colors-primary-base);}</style><style data-emotion="css ma288p" data-s="">.css-ma288p{transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-fast);transition-timing-function:var(--eth-transition-easing-ease-out);cursor:pointer;-webkit-text-decoration:underline;text-decoration:underline;outline:2px solid transparent;outline-offset:2px;text-underline-offset:3px;line-height:var(--eth-lineHeights-taller);position:absolute;top:calc(var(--eth-space-12) * -1);-webkit-margin-start:var(--eth-space-2);margin-inline-start:var(--eth-space-2);color:var(--eth-colors-background-base);text-decoration-line:none;}.css-ma288p:focus-visible,.css-ma288p[data-focus-visible]{box-shadow:var(--eth-shadows-none);outline:2px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:2px;border-radius:var(--eth-radii-sm);}.css-ma288p[data-inline-link]:visited{color:var(--eth-colors-primary-visited);}.css-ma288p:hover,.css-ma288p[data-hover]{-webkit-text-decoration:none;text-decoration:none;}.css-ma288p:focus,.css-ma288p[data-focus]{position:static;}</style><style data-emotion="css 134kjkj" data-s="">.css-134kjkj{position:-webkit-sticky;position:sticky;top:0px;z-index:var(--eth-zIndices-sticky);width:var(--eth-sizes-full);}</style><style data-emotion="css 14w48ls" data-s="">.css-14w48ls{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;background:var(--eth-colors-background-base);border-bottom:var(--eth-borders-1px);border-color:rgba(0, 0, 0, 0.1);height:4.75rem;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:var(--eth-space-4);padding-bottom:var(--eth-space-4);-webkit-padding-start:var(--eth-space-4);padding-inline-start:var(--eth-space-4);-webkit-padding-end:var(--eth-space-4);padding-inline-end:var(--eth-space-4);}@media screen and (min-width: 80em){.css-14w48ls{-webkit-padding-start:var(--eth-space-8);padding-inline-start:var(--eth-space-8);-webkit-padding-end:var(--eth-space-8);padding-inline-end:var(--eth-space-8);}}</style><style data-emotion="css bxyjz5" data-s="">.css-bxyjz5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;width:var(--eth-sizes-full);max-width:var(--eth-sizes-container-2xl);}@media screen and (min-width: 48em){.css-bxyjz5{-webkit-align-items:normal;-webkit-box-align:normal;-ms-flex-align:normal;align-items:normal;-webkit-box-pack:normal;-ms-flex-pack:normal;-webkit-justify-content:normal;justify-content:normal;}}</style><style data-emotion="css 10crrtt" data-s="">.css-10crrtt{transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-fast);transition-timing-function:var(--eth-transition-easing-ease-out);cursor:pointer;-webkit-text-decoration:none;text-decoration:none;outline:2px solid transparent;outline-offset:2px;text-underline-offset:3px;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:var(--eth-colors-primary-base);}.css-10crrtt:hover,.css-10crrtt[data-hover]{-webkit-text-decoration:underline;text-decoration:underline;color:var(--eth-colors-primary-hover);}.css-10crrtt:focus-visible,.css-10crrtt[data-focus-visible]{box-shadow:var(--eth-shadows-none);outline:2px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:2px;border-radius:var(--eth-radii-sm);}.css-10crrtt[data-inline-link]:visited{color:var(--eth-colors-primary-visited);}</style><style data-emotion="css 1io60e2" data-s="">.css-1io60e2{width:22px;height:35px;display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentColor;vertical-align:middle;opacity:0.85;}.css-1io60e2:hover,.css-1io60e2[data-hover]{opacity:1;}</style><style data-emotion="css 25akuw" data-s="">.css-25akuw{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:var(--eth-sizes-full);-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;-webkit-margin-start:var(--eth-space-3);margin-inline-start:var(--eth-space-3);}@media screen and (min-width: 48em){.css-25akuw{-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;}}@media screen and (min-width: 80em){.css-25akuw{-webkit-margin-start:var(--eth-space-8);margin-inline-start:var(--eth-space-8);}}</style><style data-emotion="css a6pwa6" data-s="">@media screen and (max-width: 47.98em){.css-a6pwa6{display:none;}}</style><style data-emotion="css 17ym3gp" data-s="">.css-17ym3gp{list-style-type:none;-webkit-margin-start:1em;margin-inline-start:1em;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:0px;}</style><style data-emotion="css bxts4e" data-s="">.css-bxts4e{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;vertical-align:middle;outline:2px solid transparent;outline-offset:2px;border-radius:var(--eth-radii-base);border:var(--eth-borders-1px);line-height:1.6;transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-normal);padding:unset;border-color:var(--eth-colors-transparent);padding-top:var(--eth-space-2);padding-bottom:var(--eth-space-2);-webkit-padding-start:var(--eth-space-3);padding-inline-start:var(--eth-space-3);-webkit-padding-end:var(--eth-space-3);padding-inline-end:var(--eth-space-3);white-space:nowrap;color:var(--eth-colors-body-base);}.css-bxts4e:focus-visible,.css-bxts4e[data-focus-visible]{outline:4px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:-1px;}.css-bxts4e:disabled,.css-bxts4e[disabled],.css-bxts4e[aria-disabled=true],.css-bxts4e[data-disabled]{color:var(--eth-colors-disabled);pointer-events:none;}.css-bxts4e:hover,.css-bxts4e[data-hover]{color:var(--eth-colors-primary-hover);}.css-bxts4e[data-secondary='true']{color:var(--eth-colors-body-base);}.css-bxts4e.chakra-link{-webkit-text-decoration:none;text-decoration:none;}.css-bxts4e.chakra-link:hover,.css-bxts4e.chakra-link[data-hover]{-webkit-text-decoration:none;text-decoration:none;}.css-bxts4e svg{font-size:var(--eth-fontSizes-2xl);}@media screen and (min-width: 62em){.css-bxts4e{-webkit-padding-start:var(--eth-space-4);padding-inline-start:var(--eth-space-4);-webkit-padding-end:var(--eth-space-4);padding-inline-end:var(--eth-space-4);}}.css-bxts4e::after{content:"";position:absolute;inset-inline:0px;top:100%;height:var(--eth-sizes-4);}</style><style data-emotion="css rqgsqp" data-s="">.css-rqgsqp{position:relative;z-index:1;}</style><style data-emotion="css 70qvj9" data-s="">.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion="css 1hwt4l5" data-s="">@media screen and (max-width: 79.98em){.css-1hwt4l5{display:none;}}</style><style data-emotion="css 1ktosf4" data-s="">.css-1ktosf4{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;white-space:normal;vertical-align:middle;outline:2px solid transparent;outline-offset:2px;color:var(--eth-colors-background-base);line-height:1.6;transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-normal);padding:unset;padding-top:var(--eth-space-2);padding-bottom:var(--eth-space-2);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-radius:var(--eth-radii-base);border:var(--eth-borders-1px);border-color:var(--eth-colors-disabled);height:42px;background:none;gap:var(--eth-space-4);margin:0px;-webkit-margin-end:var(--eth-space-3);margin-inline-end:var(--eth-space-3);-webkit-padding-start:var(--eth-space-3);padding-inline-start:var(--eth-space-3);-webkit-padding-end:var(--eth-space-3);padding-inline-end:var(--eth-space-3);--docsearch-searchbox-shadow:inset 0 0 0 1px var(--eth-colors-primary-highContrast);}.css-1ktosf4:focus-visible,.css-1ktosf4[data-focus-visible]{outline:4px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:-1px;}.css-1ktosf4:disabled,.css-1ktosf4[disabled],.css-1ktosf4[aria-disabled=true],.css-1ktosf4[data-disabled]{color:var(--eth-colors-background-base);pointer-events:none;background:var(--eth-colors-disabled);}.css-1ktosf4[data-secondary='true']{color:var(--eth-colors-body-base);}.css-1ktosf4.chakra-link{-webkit-text-decoration:none;text-decoration:none;}.css-1ktosf4.chakra-link:hover,.css-1ktosf4.chakra-link[data-hover]{-webkit-text-decoration:none;text-decoration:none;}.css-1ktosf4 svg{font-size:var(--eth-fontSizes-2xl);}.css-1ktosf4:hover,.css-1ktosf4[data-hover]{box-shadow:var(--eth-shadows-none);background:none;outline:1px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:-2px;}.css-1ktosf4:hover .DocSearch-Button-Keys kbd,.css-1ktosf4[data-hover] .DocSearch-Button-Keys kbd{color:var(--eth-colors-disabled);border-color:var(--eth-colors-disabled);}.css-1ktosf4:focus,.css-1ktosf4[data-focus]{box-shadow:var(--eth-shadows-none);background:none;outline:1px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:-2px;}.css-1ktosf4:active,.css-1ktosf4[data-active]{box-shadow:var(--eth-shadows-none);background:none;outline:1px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:-2px;}.css-1ktosf4 .DocSearch-Button-Container svg{width:var(--eth-sizes-3-5);height:var(--eth-sizes-3-5);}.css-1ktosf4 .DocSearch-Search-Icon,.css-1ktosf4 .DocSearch-Button-Placeholder{color:var(--eth-colors-body-base);}.css-1ktosf4 .DocSearch-Button-Placeholder{font-weight:var(--eth-fontWeights-normal);text-transform:lowercase;}.css-1ktosf4 .DocSearch-Button-Keys{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:var(--eth-space-1);height:var(--eth-sizes-full);margin-top:var(--eth-space-0-5);min-width:44px;padding:0px;}.css-1ktosf4 .DocSearch-Button-Keys kbd{background:none;border:var(--eth-borders-1px);border-color:var(--eth-colors-disabled);width:var(--eth-sizes-5);height:var(--eth-sizes-5);box-shadow:var(--eth-shadows-none);color:var(--eth-colors-disabled);font-size:var(--eth-fontSizes-sm);margin:0px;padding:var(--eth-space-0-5);text-transform:lowercase;}.css-1ktosf4 .DocSearch-Button-Keys kbd:first-of-type{font-size:var(--eth-fontSizes-md);padding-top:var(--eth-space-1);}</style><style data-emotion="css fsnnks" data-s="">@media screen and (min-width: 80em){.css-fsnnks{display:none;}}</style><style data-emotion="css w76hfq" data-s="">.css-w76hfq{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;white-space:normal;vertical-align:middle;outline:2px solid transparent;outline-offset:2px;border-radius:var(--eth-radii-base);border:var(--eth-borders-1px);color:var(--eth-colors-primary-base);line-height:1.6;transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-normal);padding:unset;padding-top:var(--eth-space-2);padding-bottom:var(--eth-space-2);border-color:var(--eth-colors-transparent);-webkit-padding-start:var(--eth-space-2);padding-inline-start:var(--eth-space-2);-webkit-padding-end:var(--eth-space-2);padding-inline-end:var(--eth-space-2);-webkit-transition:-webkit-transform 0.2s ease-in-out;transition:transform 0.2s ease-in-out;}.css-w76hfq:focus-visible,.css-w76hfq[data-focus-visible]{outline:4px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:-1px;}.css-w76hfq:disabled,.css-w76hfq[disabled],.css-w76hfq[aria-disabled=true],.css-w76hfq[data-disabled]{color:var(--eth-colors-disabled);pointer-events:none;}.css-w76hfq[data-secondary='true']{color:var(--eth-colors-body-base);}.css-w76hfq.chakra-link{-webkit-text-decoration:none;text-decoration:none;}.css-w76hfq.chakra-link:hover,.css-w76hfq.chakra-link[data-hover]{-webkit-text-decoration:none;text-decoration:none;}.css-w76hfq svg{font-size:var(--eth-fontSizes-2xl);}.css-w76hfq:hover,.css-w76hfq[data-hover]{color:var(--eth-colors-primary-base);-webkit-transform:rotate(5deg);-moz-transform:rotate(5deg);-ms-transform:rotate(5deg);transform:rotate(5deg);-webkit-transition:-webkit-transform 0.2s ease-in-out;transition:transform 0.2s ease-in-out;}</style><style data-emotion="css uxwtj7" data-s="">.css-uxwtj7{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;gap:0px;}@media screen and (max-width: 47.98em){.css-uxwtj7{display:none;}}</style><style data-emotion="css zxv2q6" data-s="">.css-zxv2q6{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;white-space:normal;vertical-align:middle;outline:2px solid transparent;outline-offset:2px;border-radius:var(--eth-radii-base);border:var(--eth-borders-1px);color:var(--eth-colors-primary-base);line-height:1.6;transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-normal);padding:0px;padding-top:var(--eth-space-2);padding-bottom:var(--eth-space-2);border-color:var(--eth-colors-transparent);-webkit-transition:-webkit-transform 0.5s,color 0.2s;transition:transform 0.5s,color 0.2s;-webkit-padding-start:var(--eth-space-2);padding-inline-start:var(--eth-space-2);-webkit-padding-end:var(--eth-space-2);padding-inline-end:var(--eth-space-2);}.css-zxv2q6:focus-visible,.css-zxv2q6[data-focus-visible]{outline:4px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:-1px;}.css-zxv2q6:disabled,.css-zxv2q6[disabled],.css-zxv2q6[aria-disabled=true],.css-zxv2q6[data-disabled]{color:var(--eth-colors-disabled);pointer-events:none;}.css-zxv2q6[data-secondary='true']{color:var(--eth-colors-body-base);}.css-zxv2q6.chakra-link{-webkit-text-decoration:none;text-decoration:none;}.css-zxv2q6.chakra-link:hover,.css-zxv2q6.chakra-link[data-hover]{-webkit-text-decoration:none;text-decoration:none;}.css-zxv2q6 svg{font-size:var(--eth-fontSizes-2xl);}@media screen and (min-width: 80em){.css-zxv2q6{-webkit-padding-start:var(--eth-space-3);padding-inline-start:var(--eth-space-3);-webkit-padding-end:var(--eth-space-3);padding-inline-end:var(--eth-space-3);}}.css-zxv2q6:hover,.css-zxv2q6[data-hover]{-webkit-transform:rotate(10deg);-moz-transform:rotate(10deg);-ms-transform:rotate(10deg);transform:rotate(10deg);color:var(--eth-colors-primary-hover);}</style><style data-emotion="css 18kt1pz" data-s="">.css-18kt1pz{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;white-space:normal;vertical-align:middle;outline:2px solid transparent;outline-offset:2px;border-radius:var(--eth-radii-base);border:var(--eth-borders-1px);line-height:1.6;transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-normal);padding:unset;padding-top:var(--eth-space-2);padding-bottom:var(--eth-space-2);border-color:var(--eth-colors-transparent);color:var(--eth-colors-body-base);-webkit-transition:color 0.2s;transition:color 0.2s;-webkit-padding-start:var(--eth-space-2);padding-inline-start:var(--eth-space-2);-webkit-padding-end:var(--eth-space-2);padding-inline-end:var(--eth-space-2);}.css-18kt1pz:focus-visible,.css-18kt1pz[data-focus-visible]{outline:4px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:-1px;}.css-18kt1pz:disabled,.css-18kt1pz[disabled],.css-18kt1pz[aria-disabled=true],.css-18kt1pz[data-disabled]{color:var(--eth-colors-disabled);pointer-events:none;}.css-18kt1pz[data-secondary='true']{color:var(--eth-colors-body-base);}.css-18kt1pz.chakra-link{-webkit-text-decoration:none;text-decoration:none;}.css-18kt1pz.chakra-link:hover,.css-18kt1pz.chakra-link[data-hover]{-webkit-text-decoration:none;text-decoration:none;}@media screen and (min-width: 80em){.css-18kt1pz{-webkit-padding-start:var(--eth-space-3);padding-inline-start:var(--eth-space-3);-webkit-padding-end:var(--eth-space-3);padding-inline-end:var(--eth-space-3);}}.css-18kt1pz:hover,.css-18kt1pz[data-hover]{color:var(--eth-colors-primary-hover);}.css-18kt1pz:hover svg,.css-18kt1pz[data-hover] svg{-webkit-transform:rotate(10deg);-moz-transform:rotate(10deg);-ms-transform:rotate(10deg);transform:rotate(10deg);-webkit-transition:-webkit-transform 0.5s;transition:transform 0.5s;}.css-18kt1pz:active,.css-18kt1pz[data-active]{color:var(--eth-colors-primary-hover);background:var(--eth-colors-primary-lowContrast);}.css-18kt1pz svg{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-ms-transform:rotate(0deg);transform:rotate(0deg);-webkit-transition:-webkit-transform 0.5s;transition:transform 0.5s;}</style><style data-emotion="css xl71ch" data-s="">.css-xl71ch{pointer-events:none;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;min-width:0px;}</style><style data-emotion="css 7qbck7" data-s="">.css-7qbck7{width:1em;height:1em;display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentColor;font-size:var(--eth-fontSizes-2xl);vertical-align:middle;-webkit-margin-end:var(--eth-space-2);margin-inline-end:var(--eth-space-2);}</style><style data-emotion="css yvcseo" data-s="">@media screen and (max-width: 61.98em){.css-yvcseo{display:none;}}</style><style data-emotion="css r6z5ec" data-s="">.css-r6z5ec{z-index:1;}</style><style data-emotion="css 7hkc0x" data-s="">.css-7hkc0x{outline:2px solid transparent;outline-offset:2px;--menu-bg:#fff;--menu-shadow:var(--eth-shadows-sm);color:inherit;min-width:var(--eth-sizes-3xs);z-index:1;border-width:1px;background:var(--menu-bg);box-shadow:var(--menu-shadow);position:relative;overflow:auto;border-radius:var(--eth-radii-base);padding-top:0px;padding-bottom:0px;min-height:unset;max-height:75vh;width:var(--eth-sizes-xs);inset:unset;top:unset;}.chakra-ui-dark .css-7hkc0x:not([data-theme]),[data-theme=dark] .css-7hkc0x:not([data-theme]),.css-7hkc0x[data-theme=dark]{--menu-bg:var(--eth-colors-gray-700);--menu-shadow:var(--eth-shadows-dark-lg);}</style><style data-emotion="css x9rfcz" data-s="">.css-x9rfcz{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;white-space:normal;vertical-align:middle;outline:2px solid transparent;outline-offset:2px;border-radius:var(--eth-radii-base);border:var(--eth-borders-1px);line-height:1.6;transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-normal);padding:0px;padding-top:var(--eth-space-2);padding-bottom:var(--eth-space-2);border-color:var(--eth-colors-transparent);-webkit-padding-start:0px;padding-inline-start:0px;-webkit-padding-end:0px;padding-inline-end:0px;color:var(--eth-colors-body-base);}.css-x9rfcz:focus-visible,.css-x9rfcz[data-focus-visible]{outline:4px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:-1px;}.css-x9rfcz:disabled,.css-x9rfcz[disabled],.css-x9rfcz[aria-disabled=true],.css-x9rfcz[data-disabled]{color:var(--eth-colors-disabled);pointer-events:none;}.css-x9rfcz:hover,.css-x9rfcz[data-hover]{color:var(--eth-colors-primary-hover);}.css-x9rfcz[data-secondary='true']{color:var(--eth-colors-body-base);}.css-x9rfcz.chakra-link{-webkit-text-decoration:none;text-decoration:none;}.css-x9rfcz.chakra-link:hover,.css-x9rfcz.chakra-link[data-hover]{-webkit-text-decoration:none;text-decoration:none;}.css-x9rfcz svg{font-size:var(--eth-fontSizes-2xl);}@media screen and (min-width: 48em){.css-x9rfcz{display:none;}}</style><style data-emotion="css abvgdf" data-s="">.css-abvgdf{width:var(--eth-sizes-6);height:var(--eth-sizes-10);display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentColor;vertical-align:middle;pointer-events:auto;-webkit-margin-start:var(--eth-space-0-5);margin-inline-start:var(--eth-space-0-5);-webkit-margin-end:var(--eth-space-0-5);margin-inline-end:var(--eth-space-0-5);position:relative;}.css-abvgdf:hover,.css-abvgdf[data-hover]{color:var(--eth-colors-primary-base);}.css-abvgdf:hover>path,.css-abvgdf[data-hover]>path{stroke:var(--eth-colors-primary-base);}.css-abvgdf>path{stroke:var(--eth-colors-text);fill:none;}</style><style data-emotion="css 7ok86h" data-s="">.css-7ok86h{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;border-bottom:1px solid var(--eth-colors-border);margin:2rem 0rem;padding:0px;background:var(--eth-colors-background-base);}@media screen and (min-width: 62em){.css-7ok86h{margin:0 auto;padding:0 2rem 0 0;background:var(--eth-colors-ednBackground);}}</style><style data-emotion="css d59fxx" data-s="">.css-d59fxx{max-width:1000px;min-width:0px;background:var(--eth-colors-background-base);box-shadow:var(--eth-shadows-none);margin:2.5rem 0rem;padding:3rem 2rem;border-radius:4px;}@media screen and (min-width: 62em){.css-d59fxx{box-shadow:var(--eth-colors-tableBoxShadow);margin:2rem 2rem 6rem;padding:var(--eth-space-16);}}.css-d59fxx .citation p{color:var(--eth-colors-text200);}</style><style data-emotion="css 3el9kh" data-s="">.css-3el9kh{scroll-margin-top:var(--eth-space-24);max-width:1000px;min-width:0px;background:var(--eth-colors-background-base);box-shadow:var(--eth-shadows-none);margin:2.5rem 0rem;padding:3rem 2rem;border-radius:4px;}@media screen and (min-width: 62em){.css-3el9kh{box-shadow:var(--eth-colors-tableBoxShadow);margin:2rem 2rem 6rem;padding:var(--eth-space-16);}}.css-3el9kh .citation p{color:var(--eth-colors-text200);}</style><style data-emotion="css 1vx691u" data-s="">.css-1vx691u{margin-top:var(--eth-space-8);margin-bottom:var(--eth-space-8);line-height:1.4;font-weight:700;font-size:1.75rem;font-family:var(--eth-fonts-monospace);text-transform:uppercase;}@media screen and (min-width: 62em){.css-1vx691u{font-size:2.5rem;}}</style><style data-emotion="css acl8ja" data-s="">.css-acl8ja{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;border-bottom-width:0;border-bottom-color:var(--eth-colors-border);}@media screen and (min-width: 62em){.css-acl8ja{border-bottom-width:1px;}}</style><style data-emotion="css 1n6aqim" data-s="">.css-1n6aqim{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:var(--eth-sizes-full);margin-bottom:var(--eth-space-8);}</style><style data-emotion="css 7nlxkq" data-s="">.css-7nlxkq{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;width:var(--eth-sizes-full);}</style><style data-emotion="css 830gq8" data-s="">.css-830gq8{display:inline-block;white-space:nowrap;vertical-align:middle;-webkit-padding-start:var(--eth-space-2);padding-inline-start:var(--eth-space-2);-webkit-padding-end:var(--eth-space-2);padding-inline-end:var(--eth-space-2);text-transform:uppercase;font-size:var(--eth-fontSizes-xs);border-radius:var(--eth-radii-base);font-weight:initial;background:var(--eth-colors-tagOrange);color:var(--eth-colors-black300);box-shadow:var(--badge-shadow);border:1px solid;border-color:var(--eth-colors-transparent);padding-top:var(--eth-space-1);padding-bottom:var(--eth-space-1);line-height:1.6rem;-webkit-margin-end:var(--eth-space-2);margin-inline-end:var(--eth-space-2);margin-bottom:var(--eth-space-2);}</style><style data-emotion="css ieugrb" data-s="">.css-ieugrb{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-self:flex-start;-ms-flex-item-align:flex-start;align-self:flex-start;margin-bottom:var(--eth-space-2);white-space:nowrap;}</style><style data-emotion="css 1f5nvj7" data-s="">.css-1f5nvj7{display:inline-block;white-space:nowrap;vertical-align:middle;-webkit-padding-start:var(--eth-space-2);padding-inline-start:var(--eth-space-2);-webkit-padding-end:var(--eth-space-2);padding-inline-end:var(--eth-space-2);text-transform:uppercase;font-size:var(--eth-fontSizes-xs);border-radius:var(--eth-radii-base);font-weight:initial;background:var(--eth-colors-transparent);color:var(--eth-colors-text);box-shadow:var(--badge-shadow);border:1px solid;border-color:var(--eth-colors-orange-100);padding-top:var(--eth-space-1);padding-bottom:var(--eth-space-1);line-height:1.6rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-self:flex-start;-ms-flex-item-align:flex-start;align-self:flex-start;margin-bottom:var(--eth-space-2);white-space:nowrap;}</style><style data-emotion="css 17kxk4t" data-s="">.css-17kxk4t{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:var(--eth-space-4);margin-bottom:var(--eth-space-6);margin-top:calc(var(--eth-space-4) * -1);font-size:var(--eth-fontSizes-sm);color:var(--eth-colors-text300);}</style><style data-emotion="css 12av2tg" data-s="">.css-12av2tg{display:inline-block;line-height:var(--eth-lineHeights-none);font-size:var(--eth-fontSizes-sm);-webkit-margin-end:var(--eth-space-2);margin-inline-end:var(--eth-space-2);}.css-12av2tg>img{margin:0!important;display:initial;}</style><style data-emotion="css 82jv69" data-s="">.css-82jv69{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:0.5rem;margin-bottom:var(--eth-space-6);margin-top:calc(var(--eth-space-4) * -1);font-size:var(--eth-fontSizes-sm);color:var(--eth-colors-text300);}</style><style data-emotion="css 1edfksr" data-s="">.css-1edfksr{background:var(--eth-colors-background-base);border:var(--eth-borders-1px);border-color:var(--eth-colors-border);border-radius:4px;padding-top:var(--eth-space-2);padding-bottom:var(--eth-space-2);-webkit-padding-start:var(--eth-space-4);padding-inline-start:var(--eth-space-4);-webkit-padding-end:var(--eth-space-4);padding-inline-end:var(--eth-space-4);}@media screen and (min-width: 62em){.css-1edfksr{display:none;}}</style><style data-emotion="css vmunoe" data-s="">.css-vmunoe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;color:var(--eth-colors-text200);cursor:pointer;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion="css c13byp" data-s="">.css-c13byp{-webkit-flex:1;-ms-flex:1;flex:1;font-weight:500;}</style><style data-emotion="css l4bwj9" data-s="">.css-l4bwj9{width:var(--eth-sizes-6);height:var(--eth-sizes-6);display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentColor;-webkit-transform:rotate(-90deg);-moz-transform:rotate(-90deg);-ms-transform:rotate(-90deg);transform:rotate(-90deg);-webkit-transition:-webkit-transform .4s;transition:transform .4s;}</style><style data-emotion="css 1plxn13" data-s="">.css-1plxn13{list-style-type:none;border-inline-start:1px solid;border-inline-start-color:var(--eth-colors-dropdownBorder);border-top:0;font-size:var(--eth-fontSizes-sm);line-height:1.6;font-weight:400;margin:0px;margin-top:var(--eth-space-2);margin-bottom:var(--eth-space-2);-webkit-padding-start:var(--eth-space-4);padding-inline-start:var(--eth-space-4);-webkit-padding-end:var(--eth-space-1);padding-inline-end:var(--eth-space-1);padding-top:0px;}@media (max-width: var(--eth-breakpoints-lg)){.css-1plxn13{border-inline-start:0;border-top:var(--eth-borders-1px);border-top-color:var(--eth-colors-primary300);-webkit-padding-start:0px;padding-inline-start:0px;padding-top:var(--eth-space-4);}}</style><style data-emotion="css dpoqzr" data-s="">.css-dpoqzr{margin:0px;}</style><style data-emotion="css 1a78bay" data-s="">.css-1a78bay{transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-fast);transition-timing-function:var(--eth-transition-easing-ease-out);cursor:pointer;outline:2px solid transparent;outline-offset:2px;-webkit-text-decoration:none;text-decoration:none;text-underline-offset:3px;display:inline-block;position:relative;color:var(--eth-colors-textTableOfContents);font-weight:var(--eth-fontWeights-normal);margin-bottom:0.5rem!important;width:100%;--dot-bg:colors.background;}.css-1a78bay:focus-visible,.css-1a78bay[data-focus-visible]{box-shadow:var(--eth-shadows-none);outline:2px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:2px;border-radius:var(--eth-radii-sm);}.css-1a78bay[data-inline-link]:visited{color:var(--eth-colors-primary-visited);}@media screen and (min-width: 62em){.css-1a78bay{width:auto;}}.css-1a78bay:hover,.css-1a78bay[data-hover]{color:var(--eth-colors-primary-base);}.css-1a78bay:hover::after,.css-1a78bay[data-hover]::after{content:"";background:var(--dot-bg);border:var(--eth-borders-1px);border-color:var(--eth-colors-primary-base);border-radius:50%;width:var(--eth-sizes-2);height:var(--eth-sizes-2);position:absolute;left:-1.29rem;top:50%;margin-top:calc(var(--eth-space-1) * -1);}.css-1a78bay.active{--dot-bg:colors.primary;color:var(--eth-colors-primary-base);}.css-1a78bay.active::after{content:"";background:var(--dot-bg);border:var(--eth-borders-1px);border-color:var(--eth-colors-primary-base);border-radius:50%;width:var(--eth-sizes-2);height:var(--eth-sizes-2);position:absolute;left:-1.29rem;top:50%;margin-top:calc(var(--eth-space-1) * -1);}.css-1a78bay.nested::before{content:"";opacity:0.5;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;position:absolute;left:calc(var(--eth-space-3-5) * -1);top:calc(var(--eth-space-1) * -1);}.css-1a78bay.nested.active::after,.css-1a78bay.nested:hover::after{left:-2.29rem;}</style><style data-emotion="css ycb9ue" data-s="">.css-ycb9ue{list-style-type:none;font-size:var(--eth-fontSizes-sm);line-height:1.6;font-weight:400;-webkit-padding-start:var(--eth-space-4);padding-inline-start:var(--eth-space-4);-webkit-padding-end:var(--eth-space-1);padding-inline-end:var(--eth-space-1);margin:0px;}</style><style data-emotion="css 4y8d04" data-s="">.css-4y8d04{margin-top:var(--eth-space-12);margin-bottom:var(--eth-space-8);line-height:1.4;font-weight:700;scroll-margin-top:var(--eth-space-40);position:relative;font-size:var(--eth-fontSizes-2xl);font-family:var(--eth-fonts-monospace);text-transform:uppercase;}@media screen and (min-width: 48em){.css-4y8d04{font-size:2rem;}}</style><style data-emotion="css 1qbzvaj" data-s="">.css-1qbzvaj{transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-fast);transition-timing-function:var(--eth-transition-easing-ease-out);cursor:pointer;-webkit-text-decoration:underline;text-decoration:underline;outline:2px solid transparent;outline-offset:2px;color:var(--eth-colors-primary-base);text-underline-offset:3px;position:absolute;right:100%;opacity:0;-webkit-transition:opacity 0.1s ease-in-out;transition:opacity 0.1s ease-in-out;}.css-1qbzvaj:hover,.css-1qbzvaj[data-hover]{-webkit-text-decoration:underline;text-decoration:underline;color:var(--eth-colors-primary-hover);}.css-1qbzvaj:focus-visible,.css-1qbzvaj[data-focus-visible]{box-shadow:var(--eth-shadows-none);outline:2px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:2px;border-radius:var(--eth-radii-sm);}.css-1qbzvaj[data-inline-link]:visited{color:var(--eth-colors-primary-visited);}[role=group]:hover .css-1qbzvaj,[role=group][data-hover] .css-1qbzvaj,[data-group]:hover .css-1qbzvaj,[data-group][data-hover] .css-1qbzvaj,.group:hover .css-1qbzvaj,.group[data-hover] .css-1qbzvaj{opacity:1;}.css-1qbzvaj:focus,.css-1qbzvaj[data-focus]{opacity:1;}</style><style data-emotion="css 1ff30mc" data-s="">.css-1ff30mc{width:1em;height:1em;display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentColor;font-size:var(--eth-fontSizes-xl);-webkit-margin-end:var(--eth-space-1);margin-inline-end:var(--eth-space-1);}</style><style data-emotion="css 1bpgf5e" data-s="">.css-1bpgf5e{margin-top:var(--eth-space-8);margin-bottom:var(--eth-space-4);-webkit-margin-start:0px;margin-inline-start:0px;-webkit-margin-end:0px;margin-inline-end:0px;color:var(--eth-colors-text300);font-size:var(--eth-fontSizes-md);}</style><style data-emotion="css 1f04442" data-s="">.css-1f04442{transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-fast);transition-timing-function:var(--eth-transition-easing-ease-out);cursor:pointer;-webkit-text-decoration:underline;text-decoration:underline;outline:2px solid transparent;outline-offset:2px;color:var(--eth-colors-primary-base);text-underline-offset:3px;}.css-1f04442:hover,.css-1f04442[data-hover]{-webkit-text-decoration:underline;text-decoration:underline;color:var(--eth-colors-primary-hover);}.css-1f04442:focus-visible,.css-1f04442[data-focus-visible]{box-shadow:var(--eth-shadows-none);outline:2px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:2px;border-radius:var(--eth-radii-sm);}.css-1f04442[data-inline-link]:visited{color:var(--eth-colors-primary-visited);}</style><style data-emotion="css idkz9h" data-s="">.css-idkz9h{border:0;clip:rect(0, 0, 0, 0);height:1px;width:1px;margin:-1px;padding:0px;overflow:hidden;white-space:nowrap;position:absolute;}</style><style data-emotion="css 1bbj57d" data-s="">.css-1bbj57d{width:var(--eth-sizes-6);height:var(--eth-sizes-6);display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentColor;padding:var(--eth-space-1);vertical-align:middle;-webkit-margin-end:calc(var(--eth-space-1) * -1);margin-inline-end:calc(var(--eth-space-1) * -1);}</style><style data-emotion="css 1a19hgi" data-s="">.css-1a19hgi{font-family:var(--eth-fonts-heading);margin-top:var(--eth-space-10);margin-bottom:var(--eth-space-8);line-height:1.4;font-weight:var(--eth-fontWeights-semibold);scroll-margin-top:var(--eth-space-40);position:relative;font-size:1rem;}@media screen and (min-width: 48em){.css-1a19hgi{font-size:1.5rem;}}</style><style data-emotion="css 1dg6mvm" data-s="">.css-1dg6mvm{list-style-type:decimal;-webkit-margin-start:1em;margin-inline-start:1em;}</style><style data-emotion="css 1w8u43l" data-s="">.css-1w8u43l{font-family:var(--eth-fonts-heading);margin-top:var(--eth-space-8);margin-bottom:var(--eth-space-8);line-height:1.4;font-weight:var(--eth-fontWeights-semibold);scroll-margin-top:var(--eth-space-40);position:relative;font-size:1rem;}@media screen and (min-width: 48em){.css-1w8u43l{font-size:1.25rem;}}</style><style data-emotion="css 79elbk" data-s="">.css-79elbk{position:relative;}</style><style data-emotion="css y3pvpz" data-s="">.css-y3pvpz{border-radius:var(--eth-radii-base);border:1px solid;border-color:var(--eth-colors-border);max-height:calc((1.2rem * 8) + 4.185rem);overflow:scroll;margin-bottom:var(--eth-space-4);}</style><style data-emotion="css raz5zi" data-s="">.css-raz5zi{padding-top:2.75rem;-webkit-padding-start:var(--eth-space-4);padding-inline-start:var(--eth-space-4);margin:0px;overflow:visible;min-width:var(--eth-sizes-full);width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;}</style><style data-emotion="css ds3kc" data-s="">.css-ds3kc{display:table-row;}</style><style data-emotion="css 90nu49" data-s="">.css-90nu49{display:table-cell;text-align:end;-webkit-padding-end:var(--eth-space-8);padding-inline-end:var(--eth-space-8);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.4;}</style><style data-emotion="css 2qghsv" data-s="">.css-2qghsv{display:table-cell;}</style><style data-emotion="css 1wk40fs" data-s="">.css-1wk40fs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;position:absolute;top:var(--eth-space-3);right:var(--eth-space-4);}</style><style data-emotion="css wzpu9d" data-s="">.css-wzpu9d{border:var(--eth-borders-1px);border-radius:var(--eth-radii-base);border-color:var(--eth-colors-searchBorder);background:#f7f7f7;-webkit-margin-start:var(--eth-space-2);margin-inline-start:var(--eth-space-2);padding-top:var(--eth-space-1);padding-bottom:var(--eth-space-1);-webkit-padding-start:var(--eth-space-2);padding-inline-start:var(--eth-space-2);-webkit-padding-end:var(--eth-space-2);padding-inline-end:var(--eth-space-2);}.css-wzpu9d:hover,.css-wzpu9d[data-hover]{cursor:pointer;color:text100;-webkit-transform:scale(1.04);-moz-transform:scale(1.04);-ms-transform:scale(1.04);transform:scale(1.04);box-shadow:1px 1px 8px 1px rgba(0, 0, 0, 0.5);}</style><style data-emotion="css 501625" data-s="">.css-501625{cursor:pointer;display:block;}</style><style data-emotion="css 1o4u1zp" data-s="">.css-1o4u1zp{display:inline-block;line-height:var(--eth-lineHeights-none);font-size:var(--eth-fontSizes-md);}.css-1o4u1zp>img{margin:0!important;display:initial;}</style><style data-emotion="css k002eo" data-s="">.css-k002eo{display:block;-webkit-overflow-scrolling:touch;overflow-x:auto;overflow-y:hidden;max-width:100%;white-space:normal;position:relative;}</style><style data-emotion="css 1u5689g" data-s="">.css-1u5689g{font-variant-numeric:lining-nums tabular-nums;border-collapse:collapse;width:var(--eth-sizes-full);--bg-color:var(--eth-colors-background-highlight);}</style><style data-emotion="css rz7efy" data-s="">.css-rz7efy{background:var(--bg-color);}</style><style data-emotion="css czbvy" data-s="">.css-czbvy th:not(:last-of-type),.css-czbvy td:not(:last-of-type){border-inline-end:var(--eth-borders-2px);border-inline-end-color:var(--eth-colors-background-base);}</style><style data-emotion="css jejxkf" data-s="">.css-jejxkf{font-family:var(--eth-fonts-heading);font-weight:var(--eth-fontWeights-bold);text-transform:capitalize;letter-spacing:var(--eth-letterSpacings-wider);text-align:start;border-bottom:var(--eth-borders-1px);border-color:var(--eth-colors-body-base);color:var(--eth-colors-body-base);vertical-align:bottom;padding:var(--eth-space-4);}</style><style data-emotion="css 9snn25" data-s="">.css-9snn25{font-family:var(--eth-fonts-heading);font-weight:var(--eth-fontWeights-bold);text-transform:capitalize;letter-spacing:var(--eth-letterSpacings-wider);border-bottom:var(--eth-borders-1px);border-color:var(--eth-colors-body-base);color:var(--eth-colors-body-base);vertical-align:bottom;padding:var(--eth-space-4);text-align:right;}</style><style data-emotion="css gabqlo" data-s="">.css-gabqlo tr{vertical-align:top;}.css-gabqlo tr:hover,.css-gabqlo tr[data-hover]{background:var(--bg-color);}</style><style data-emotion="css 1ijcw7e" data-s="">.css-1ijcw7e{text-align:start;padding:var(--eth-space-4);}</style><style data-emotion="css 1qt9prs" data-s="">.css-1qt9prs{padding:var(--eth-space-4);text-align:right;}</style><style data-emotion="css tu0njr" data-s="">.css-tu0njr{list-style-type:initial;-webkit-margin-start:1em;margin-inline-start:1em;}</style><style data-emotion="css 1l4w6pd" data-s="">.css-1l4w6pd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}</style><style data-emotion="css 1tgbn0p" data-s="">.css-1tgbn0p{width:800px;height:auto;}</style><style data-emotion="css 1ac81qj" data-s="">.css-1ac81qj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:0px;}@media screen and (min-width: 48em){.css-1ac81qj{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;padding:var(--eth-space-2);}}</style><style data-emotion="css 1scb1kk" data-s="">.css-1scb1kk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-margin-end:var(--eth-space-4);margin-inline-end:var(--eth-space-4);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex:1;-ms-flex:1;flex:1;}@media screen and (max-width: 47.98em){.css-1scb1kk{display:none;}}</style><style data-emotion="css cm1z1v" data-s="">.css-cm1z1v{border-radius:var(--eth-radii-full);border-width:1px;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;text-transform:uppercase;font-weight:var(--eth-fontWeights-medium);position:relative;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;background:var(--avatar-bg);font-size:var(--avatar-font-size);color:var(--eth-colors-white);border-color:var(--avatar-border-color);vertical-align:top;--avatar-border-color:transparent;height:40px;width:40px;-webkit-margin-end:var(--eth-space-2);margin-inline-end:var(--eth-space-2);}.css-cm1z1v:not([data-loaded]){--avatar-bg:#078beb;}.chakra-ui-dark .css-cm1z1v:not([data-theme]),[data-theme=dark] .css-cm1z1v:not([data-theme]),.css-cm1z1v[data-theme=dark]{--avatar-border-color:var(--eth-colors-gray-800);}.css-cm1z1v:hover,[data-peer]:hover~.css-cm1z1v{box-shadow:0.15em 0.15em 0 var(--eth-colors-primary-lowContrast);}.css-cm1z1v:focus,.css-cm1z1v[data-focus]{outline:4px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:-1px;}.css-cm1z1v:active,.css-cm1z1v[data-active]{--avatar-border-color:var(--eth-colors-primary-hover);box-shadow:var(--eth-shadows-none);}.css-cm1z1v:active img,.css-cm1z1v[data-active] img{opacity:0.7;}[role='group'] .css-cm1z1v{--avatar-border-color:var(--eth-colors-background-base);}[role='group'] .css-cm1z1v:not(:last-of-type){-webkit-margin-start:var(--ml-by-size);margin-inline-start:var(--ml-by-size);}</style><style data-emotion="css 4v8a79" data-s="">.css-4v8a79{margin-bottom:1.45rem;line-height:1.6rem;margin:0px;color:var(--eth-colors-text200);}</style><style data-emotion="css 1lby19v" data-s="">.css-1lby19v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:var(--eth-space-2);}</style><style data-emotion="css l8may3" data-s="">.css-l8may3{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;white-space:normal;vertical-align:middle;outline:2px solid transparent;outline-offset:2px;border-radius:var(--eth-radii-base);color:var(--eth-colors-primary-base);line-height:1.6;transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-normal);padding:unset;padding-top:var(--eth-space-2);padding-bottom:var(--eth-space-2);-webkit-padding-start:var(--eth-space-4);padding-inline-start:var(--eth-space-4);-webkit-padding-end:var(--eth-space-4);padding-inline-end:var(--eth-space-4);background:var(--eth-colors-background-base);border:0;margin-bottom:var(--eth-space-4);width:var(--eth-sizes-full);}.css-l8may3:focus-visible,.css-l8may3[data-focus-visible]{outline:4px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:-1px;}.css-l8may3:disabled,.css-l8may3[disabled],.css-l8may3[aria-disabled=true],.css-l8may3[data-disabled]{color:var(--eth-colors-disabled);pointer-events:none;}.css-l8may3:hover,.css-l8may3[data-hover]{color:var(--eth-colors-primary-hover);box-shadow:var(--eth-shadows-buttonHover);}.css-l8may3[data-secondary='true']{color:var(--eth-colors-body-base);}.css-l8may3.chakra-link{-webkit-text-decoration:none;text-decoration:none;}.css-l8may3.chakra-link:hover,.css-l8may3.chakra-link[data-hover]{-webkit-text-decoration:none;text-decoration:none;}.css-l8may3 svg{font-size:var(--eth-fontSizes-2xl);}.css-l8may3:active,.css-l8may3[data-active]{box-shadow:var(--eth-shadows-none);}@media screen and (min-width: 48em){.css-l8may3{margin-bottom:0px;width:inherit;}}</style><style data-emotion="css 13i3mb1" data-s="">.css-13i3mb1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;border:var(--eth-borders-1px);border-color:var(--eth-colors-border);background:var(--eth-colors-feedbackGradient);border-radius:var(--eth-radii-base);padding:var(--eth-space-6);margin-bottom:var(--eth-space-4);margin-top:var(--eth-space-8);width:var(--eth-sizes-full);}</style><style data-emotion="css tn44ti" data-s="">.css-tn44ti{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:var(--eth-space-4);}</style><style data-emotion="css vh68c1" data-s="">.css-vh68c1{font-family:var(--eth-fonts-heading);line-height:var(--eth-lineHeights-2xs);margin:0px;margin-bottom:var(--eth-space-2);font-size:1.375rem;font-weight:var(--eth-fontWeights-bold);}@media screen and (min-width: 62em){.css-vh68c1{line-height:var(--eth-lineHeights-4xs);}}</style><style data-emotion="css 11f4u18" data-s="">.css-11f4u18{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:var(--eth-space-4);}</style><style data-emotion="css uy7vvo" data-s="">.css-uy7vvo{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;white-space:normal;vertical-align:middle;outline:2px solid transparent;outline-offset:2px;border-radius:var(--eth-radii-base);border:var(--eth-borders-1px);color:var(--eth-colors-primary-base);line-height:1.6;transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-normal);padding:unset;padding-top:var(--eth-space-2);padding-bottom:var(--eth-space-2);-webkit-padding-start:var(--eth-space-4);padding-inline-start:var(--eth-space-4);-webkit-padding-end:var(--eth-space-4);padding-inline-end:var(--eth-space-4);}.css-uy7vvo:focus-visible,.css-uy7vvo[data-focus-visible]{outline:4px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:-1px;}.css-uy7vvo:disabled,.css-uy7vvo[disabled],.css-uy7vvo[aria-disabled=true],.css-uy7vvo[data-disabled]{color:var(--eth-colors-disabled);pointer-events:none;}.css-uy7vvo:hover,.css-uy7vvo[data-hover]{color:var(--eth-colors-primary-hover);}.css-uy7vvo[data-secondary='true']{color:var(--eth-colors-body-base);}.css-uy7vvo.chakra-link{-webkit-text-decoration:none;text-decoration:none;}.css-uy7vvo.chakra-link:hover,.css-uy7vvo.chakra-link[data-hover]{-webkit-text-decoration:none;text-decoration:none;}.css-uy7vvo svg{font-size:var(--eth-fontSizes-2xl);}</style><style data-emotion="css 1wh2kri" data-s="">.css-1wh2kri{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-margin-end:0.5rem;margin-inline-end:0.5rem;}</style><style data-emotion="css 8889cn" data-s="">.css-8889cn{width:var(--eth-sizes-6);height:var(--eth-sizes-6);display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentColor;vertical-align:middle;}</style><style data-emotion="css 1rf6jrc" data-s="">.css-1rf6jrc{width:var(--eth-sizes-6);height:var(--eth-sizes-6);display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentColor;vertical-align:middle;-webkit-transform:scaleY(-1);-moz-transform:scaleY(-1);-ms-transform:scaleY(-1);transform:scaleY(-1);}</style><style data-emotion="css 1eoeohq" data-s="">.css-1eoeohq{position:-webkit-sticky;position:sticky;top:var(--eth-space-19);padding:var(--eth-space-4);-webkit-padding-end:0px;padding-inline-end:0px;max-width:25%;min-width:var(--eth-sizes-48);height:calc(100vh - 80px);overflow-y:auto;padding-top:var(--eth-space-16);}@media screen and (max-width: 62em){.css-1eoeohq{display:none;}}</style><style data-emotion="css 1h4oxa0" data-s="">.css-1h4oxa0{margin-bottom:var(--eth-space-2);}</style><style data-emotion="css 1icw53j" data-s="">.css-1icw53j{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;white-space:normal;vertical-align:middle;outline:2px solid transparent;outline-offset:2px;border-radius:var(--eth-radii-base);border:var(--eth-borders-1px);color:var(--eth-colors-primary-base);line-height:1.6;transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-normal);padding:unset;padding-top:var(--eth-space-2);padding-bottom:var(--eth-space-2);-webkit-padding-start:var(--eth-space-4);padding-inline-start:var(--eth-space-4);-webkit-padding-end:var(--eth-space-4);padding-inline-end:var(--eth-space-4);}.css-1icw53j:focus-visible,.css-1icw53j[data-focus-visible]{outline:4px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:-1px;}.css-1icw53j:disabled,.css-1icw53j[disabled],.css-1icw53j[aria-disabled=true],.css-1icw53j[data-disabled]{color:var(--eth-colors-disabled);pointer-events:none;}.css-1icw53j:hover,.css-1icw53j[data-hover]{color:var(--eth-colors-primary-hover);box-shadow:var(--eth-shadows-buttonHover);}.css-1icw53j[data-secondary='true']{color:var(--eth-colors-body-base);}.css-1icw53j.chakra-link{-webkit-text-decoration:none;text-decoration:none;}.css-1icw53j.chakra-link:hover,.css-1icw53j.chakra-link[data-hover]{-webkit-text-decoration:none;text-decoration:none;}.css-1icw53j svg{font-size:var(--eth-fontSizes-2xl);}.css-1icw53j:active,.css-1icw53j[data-active]{box-shadow:var(--eth-shadows-none);}</style><style data-emotion="css 1bjm1n1" data-s="">.css-1bjm1n1{transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-fast);transition-timing-function:var(--eth-transition-easing-ease-out);cursor:pointer;-webkit-text-decoration:underline;text-decoration:underline;outline:2px solid transparent;outline-offset:2px;color:var(--eth-colors-primary-base);text-underline-offset:3px;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;white-space:normal;vertical-align:middle;outline:2px solid transparent;outline-offset:2px;border-radius:var(--eth-radii-base);border:var(--eth-borders-1px);color:var(--eth-colors-primary-base);line-height:1.6;transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-normal);padding:unset;padding-top:var(--eth-space-2);padding-bottom:var(--eth-space-2);-webkit-padding-start:var(--eth-space-4);padding-inline-start:var(--eth-space-4);-webkit-padding-end:var(--eth-space-4);padding-inline-end:var(--eth-space-4);}.css-1bjm1n1:hover,.css-1bjm1n1[data-hover]{-webkit-text-decoration:underline;text-decoration:underline;color:var(--eth-colors-primary-hover);}.css-1bjm1n1:focus-visible,.css-1bjm1n1[data-focus-visible]{box-shadow:var(--eth-shadows-none);outline:2px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:2px;border-radius:var(--eth-radii-sm);}.css-1bjm1n1[data-inline-link]:visited{color:var(--eth-colors-primary-visited);}.css-1bjm1n1:focus-visible,.css-1bjm1n1[data-focus-visible]{outline:4px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:-1px;}.css-1bjm1n1:disabled,.css-1bjm1n1[disabled],.css-1bjm1n1[aria-disabled=true],.css-1bjm1n1[data-disabled]{color:var(--eth-colors-disabled);pointer-events:none;}.css-1bjm1n1:hover,.css-1bjm1n1[data-hover]{color:var(--eth-colors-primary-hover);box-shadow:var(--eth-shadows-buttonHover);}.css-1bjm1n1[data-secondary='true']{color:var(--eth-colors-body-base);}.css-1bjm1n1.chakra-link{-webkit-text-decoration:none;text-decoration:none;}.css-1bjm1n1.chakra-link:hover,.css-1bjm1n1.chakra-link[data-hover]{-webkit-text-decoration:none;text-decoration:none;}.css-1bjm1n1 svg{font-size:var(--eth-fontSizes-2xl);}.css-1bjm1n1:active,.css-1bjm1n1[data-active]{box-shadow:var(--eth-shadows-none);}</style><style data-emotion="css 13otjrl" data-s="">.css-13otjrl{width:1em;height:1em;display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentColor;}</style><style data-emotion="css 19pws62" data-s="">.css-19pws62{margin-bottom:var(--eth-space-2);text-transform:uppercase;}</style><style data-emotion="css 11lhp75" data-s="">.css-11lhp75{list-style-type:none;margin:0px;}</style><style data-emotion="css g8mt53" data-s="">.css-g8mt53{padding-top:var(--eth-space-4);padding-bottom:var(--eth-space-4);-webkit-padding-start:var(--eth-space-8);padding-inline-start:var(--eth-space-8);-webkit-padding-end:var(--eth-space-8);padding-inline-end:var(--eth-space-8);}</style><style data-emotion="css 19szh4y" data-s="">.css-19szh4y{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;font-size:var(--eth-fontSizes-md);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}</style><style data-emotion="css 9p2ato" data-s="">.css-9p2ato{margin-top:var(--eth-space-4);margin-bottom:var(--eth-space-4);}</style><style data-emotion="css g3hlzg" data-s="">.css-g3hlzg{transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-fast);transition-timing-function:var(--eth-transition-easing-ease-out);cursor:pointer;-webkit-text-decoration:underline;text-decoration:underline;outline:2px solid transparent;outline-offset:2px;text-underline-offset:3px;color:var(--eth-colors-body-base);-webkit-margin-start:var(--eth-space-4);margin-inline-start:var(--eth-space-4);}.css-g3hlzg:hover,.css-g3hlzg[data-hover]{-webkit-text-decoration:underline;text-decoration:underline;color:var(--eth-colors-primary-hover);}.css-g3hlzg:focus-visible,.css-g3hlzg[data-focus-visible]{box-shadow:var(--eth-shadows-none);outline:2px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:2px;border-radius:var(--eth-radii-sm);}.css-g3hlzg[data-inline-link]:visited{color:var(--eth-colors-primary-visited);}.css-g3hlzg:focus,.css-g3hlzg[data-focus]{color:var(--eth-colors-primary-base);}</style><style data-emotion="css 1n2168i" data-s="">.css-1n2168i{width:1em;height:1em;display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentColor;font-size:var(--eth-fontSizes-4xl);}.css-1n2168i:hover,.css-1n2168i[data-hover]{-webkit-transition:color 0.2s ease-in-out,-webkit-transform 0.2s ease-in-out;transition:color 0.2s ease-in-out,transform 0.2s ease-in-out;}</style><style data-emotion="css 1gzw5ei" data-s="">.css-1gzw5ei{display:grid;grid-gap:var(--eth-space-4);grid-template-columns:auto;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;}@media screen and (min-width: 30em){.css-1gzw5ei{grid-template-columns:repeat(2, auto);}}@media screen and (min-width: 48em){.css-1gzw5ei{grid-template-columns:repeat(3, auto);}}@media screen and (min-width: 80em){.css-1gzw5ei{grid-template-columns:repeat(6, auto);}}</style><style data-emotion="css 1nql6gs" data-s="">.css-1nql6gs{font-family:var(--eth-fonts-heading);font-weight:var(--eth-fontWeights-bold);font-size:var(--eth-fontSizes-sm);line-height:var(--eth-lineHeights-base);margin-top:1.14em;margin-bottom:1.14em;}</style><style data-emotion="css n65e7v" data-s="">.css-n65e7v{list-style-type:none;font-size:var(--eth-fontSizes-sm);line-height:var(--eth-lineHeights-base);font-weight:var(--eth-fontWeights-normal);margin:0px;}</style><style data-emotion="css 679ng4" data-s="">.css-679ng4{margin-bottom:var(--eth-space-4);}</style><style data-emotion="css u2dix7" data-s="">.css-u2dix7{transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-fast);transition-timing-function:var(--eth-transition-easing-ease-out);cursor:pointer;-webkit-text-decoration:none;text-decoration:none;outline:2px solid transparent;outline-offset:2px;text-underline-offset:3px;color:var(--eth-colors-body-medium);font-weight:var(--eth-fontWeights-normal);}.css-u2dix7:focus-visible,.css-u2dix7[data-focus-visible]{box-shadow:var(--eth-shadows-none);outline:2px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:2px;border-radius:var(--eth-radii-sm);}.css-u2dix7[data-inline-link]:visited{color:var(--eth-colors-primary-visited);}.css-u2dix7:hover,.css-u2dix7[data-hover]{-webkit-text-decoration:none;text-decoration:none;color:var(--eth-colors-primary-base);}.css-u2dix7:hover::after,.css-u2dix7[data-hover]::after{color:var(--eth-colors-primary-base);}.css-u2dix7:hover svg,.css-u2dix7[data-hover] svg{fill:var(--eth-colors-primary-base);}.css-u2dix7 svg{fill:var(--eth-colors-body-medium);}</style><style data-emotion="css v5mvu7" data-s="">.css-v5mvu7{list-style-type:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;margin-top:var(--eth-space-6);margin-bottom:var(--eth-space-6);-webkit-margin-start:0px;margin-inline-start:0px;-webkit-margin-end:0px;margin-inline-end:0px;padding-top:var(--eth-space-8);padding-bottom:var(--eth-space-8);-webkit-padding-start:var(--eth-space-2);padding-inline-start:var(--eth-space-2);-webkit-padding-end:var(--eth-space-2);padding-inline-end:var(--eth-space-2);line-height:var(--eth-lineHeights-base);font-weight:var(--eth-fontWeights-normal);font-size:var(--eth-fontSizes-sm);background:var(--eth-colors-background-highlight);}</style><style data-emotion="css 4qpsz7" data-s="">.css-4qpsz7{padding:var(--eth-space-2);margin:0px;}</style><style data-emotion="css 6qp3mu" data-s="">.css-6qp3mu{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;white-space:normal;vertical-align:middle;outline:2px solid transparent;outline-offset:2px;border:var(--eth-borders-1px);line-height:1.6;transition-property:var(--eth-transition-property-common);transition-duration:var(--eth-transition-duration-normal);padding:unset;padding-top:var(--eth-space-2);padding-bottom:var(--eth-space-2);-webkit-padding-start:var(--eth-space-4);padding-inline-start:var(--eth-space-4);-webkit-padding-end:var(--eth-space-4);padding-inline-end:var(--eth-space-4);background:var(--eth-colors-primary-base);border-color:var(--eth-colors-transparent);height:var(--eth-sizes-12);width:var(--eth-sizes-12);border-radius:var(--eth-radii-full);box-shadow:tableItemBox;position:-webkit-sticky;position:sticky;bottom:1rem;color:var(--eth-colors-white);-webkit-margin-start:auto;margin-inline-start:auto;-webkit-margin-end:var(--eth-space-4);margin-inline-end:var(--eth-space-4);z-index:98;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:-webkit-transform 0.2s ease-in-out,width 0.25s ease-in-out,border-radius 0.25s linear;transition:transform 0.2s ease-in-out,width 0.25s ease-in-out,border-radius 0.25s linear;}.css-6qp3mu:focus-visible,.css-6qp3mu[data-focus-visible]{outline:4px solid;outline-color:var(--eth-colors-primary-hover);outline-offset:-1px;}.css-6qp3mu:disabled,.css-6qp3mu[disabled],.css-6qp3mu[aria-disabled=true],.css-6qp3mu[data-disabled]{color:var(--eth-colors-background-base);pointer-events:none;background:var(--eth-colors-disabled);}.css-6qp3mu[data-secondary='true']{color:var(--eth-colors-body-base);}.css-6qp3mu.chakra-link{-webkit-text-decoration:none;text-decoration:none;}.css-6qp3mu.chakra-link:hover,.css-6qp3mu.chakra-link[data-hover]{-webkit-text-decoration:none;text-decoration:none;}.css-6qp3mu svg{font-size:var(--eth-fontSizes-2xl);}.css-6qp3mu:active,.css-6qp3mu[data-active]{box-shadow:var(--eth-shadows-none);}@media screen and (min-width: 62em){.css-6qp3mu{width:var(--eth-sizes-12);bottom:var(--eth-space-4);margin-top:inherit;}}.css-6qp3mu:hover,.css-6qp3mu[data-hover]{-webkit-transform:scale(1.1);-moz-transform:scale(1.1);-ms-transform:scale(1.1);transform:scale(1.1);-webkit-transition:-webkit-transform 0.2s ease-in-out;transition:transform 0.2s ease-in-out;}.css-6qp3mu .chakra-button__icon{-webkit-margin-end:0px;margin-inline-end:0px;}</style><style data-emotion="css 1vrwnyo" data-s="">.css-1vrwnyo{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-margin-end:0px;margin-inline-end:0px;}@media screen and (min-width: 62em){.css-1vrwnyo{-webkit-margin-end:var(--eth-space-3);margin-inline-end:var(--eth-space-3);}}</style><style data-emotion="css lxjpd2" data-s="">.css-lxjpd2{width:26px;height:32px;display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:var(--eth-colors-white);vertical-align:middle;}</style><style data-emotion="css ki11z" data-s="">.css-ki11z{font-weight:var(--eth-fontWeights-bold);overflow:hidden;text-overflow:ellipsis;display:none;-webkit-box-orient:vertical;-webkit-line-clamp:var(--chakra-line-clamp);--chakra-line-clamp:2;height:100%;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}@media screen and (min-width: 62em){.css-ki11z{display:none;}}</style></head><body class="chakra-ui-light"><script id="chakra-script">!(function(){try{var a=function(c){var v="(prefers-color-scheme: dark)",h=window.matchMedia(v).matches?"dark":"light",r=c==="system"?h:c,o=document.documentElement,s=document.body,l="chakra-ui-light",d="chakra-ui-dark",i=r==="dark";return s.classList.add(i?d:l),s.classList.remove(i?l:d),o.style.colorScheme=r,o.dataset.theme=r,r},n=a,m="system",e="chakra-ui-color-mode",t=localStorage.getItem(e);t?a(t):localStorage.setItem(e,a(m))}catch(a){}})();</script><div id="__next"><div class="chakra-container css-1ms4467"><div class="css-1webc1y"><a class="chakra-link css-ma288p" href="#main-content">Skip to main content</a></div><div class="css-134kjkj"><nav aria-label="Primary" class="css-14w48ls"><div class="css-bxyjz5"><a class="chakra-link css-10crrtt" aria-label="Home" href="/en/"><svg viewBox="0 0 115 182" focusable="false" class="chakra-icon css-1io60e2"><path d="M57.5054 181V135.84L1.64064 103.171L57.5054 181Z" fill="#F0CDC2" stroke="#1616B4" stroke-linejoin="round"></path><path d="M57.6906 181V135.84L113.555 103.171L57.6906 181Z" fill="#C9B3F5" stroke="#1616B4" stroke-linejoin="round"></path><path d="M57.5055 124.615V66.9786L1 92.2811L57.5055 124.615Z" fill="#88AAF1" stroke="#1616B4" stroke-linejoin="round"></path><path d="M57.6903 124.615V66.9786L114.196 92.2811L57.6903 124.615Z" fill="#C9B3F5" stroke="#1616B4" stroke-linejoin="round"></path><path d="M1.00006 92.2811L57.5054 1V66.9786L1.00006 92.2811Z" fill="#F0CDC2" stroke="#1616B4" stroke-linejoin="round"></path><path d="M114.196 92.2811L57.6906 1V66.9786L114.196 92.2811Z" fill="#B8FAF6" stroke="#1616B4" stroke-linejoin="round"></path></svg></a><div class="css-25akuw"><div class="css-a6pwa6"><nav aria-label="Main" data-orientation="horizontal" dir="ltr"><div style="position:relative"><ul role="list" id="main-navigation" data-orientation="horizontal" dir="ltr" class="css-17ym3gp"><li><button type="button" class="chakra-button css-bxts4e" id="radix-:R2dal9t6:-trigger-Learn" data-state="closed" aria-expanded="false" aria-controls="radix-:R2dal9t6:-content-Learn" data-radix-collection-item=""><span class="chakra-text css-rqgsqp">Learn</span></button></li><li><button type="button" class="chakra-button css-bxts4e" id="radix-:R2dal9t6:-trigger-Use" data-state="closed" aria-expanded="false" aria-controls="radix-:R2dal9t6:-content-Use" data-radix-collection-item=""><span class="chakra-text css-rqgsqp">Use</span></button></li><li><button type="button" class="chakra-button css-bxts4e" id="radix-:R2dal9t6:-trigger-Build" data-state="closed" aria-expanded="false" aria-controls="radix-:R2dal9t6:-content-Build" data-radix-collection-item=""><span class="chakra-text css-rqgsqp">Build</span></button></li><li><button type="button" class="chakra-button css-bxts4e" id="radix-:R2dal9t6:-trigger-Participate" data-state="closed" aria-expanded="false" aria-controls="radix-:R2dal9t6:-content-Participate" data-radix-collection-item=""><span class="chakra-text css-rqgsqp">Participate</span></button></li><li><button type="button" class="chakra-button css-bxts4e" id="radix-:R2dal9t6:-trigger-Research" data-state="closed" aria-expanded="false" aria-controls="radix-:R2dal9t6:-content-Research" data-radix-collection-item=""><span class="chakra-text css-rqgsqp">Research</span></button></li></ul></div></nav></div><div class="css-70qvj9"><div class="css-1hwt4l5"><button class="chakra-button DocSearch-Button css-1ktosf4" aria-label="Search" type="button"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><div class="css-fsnnks"><button type="button" class="chakra-button css-w76hfq" data-secondary="true" aria-label="Toggle search button"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg></button></div><div class="chakra-stack css-uxwtj7"><button type="button" class="chakra-button css-zxv2q6" aria-label="Switch to Dark Theme" data-secondary="true"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" aria-hidden="true" focusable="false" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M10 2c-1.82 0-3.53.5-5 1.35C7.99 5.08 10 8.3 10 12s-2.01 6.92-5 8.65C6.47 21.5 8.18 22 10 22c5.52 0 10-4.48 10-10S15.52 2 10 2z"></path></svg></button><button type="button" class="chakra-button chakra-menu__menu-button css-18kt1pz" name="desktop-language-button" id="menu-button-:Rdalal9t6H1:" aria-expanded="false" aria-haspopup="menu" aria-controls="menu-list-:Rdalal9t6H1:"><span class="css-xl71ch"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" focusable="false" class="chakra-icon css-7qbck7" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4.545 6.714 4.11 8H3l1.862-5h1.284L8 8H6.833l-.435-1.286H4.545zm1.634-.736L5.5 3.956h-.049l-.679 2.022H6.18z"></path><path d="M0 2a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v3h3a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-3H2a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H2zm7.138 9.995c.193.301.402.583.63.846-.748.575-1.673 1.001-2.768 1.292.178.217.451.635.555.867 1.125-.359 2.08-.844 2.886-1.494.777.665 1.739 1.165 2.93 1.472.133-.254.414-.673.629-.89-1.125-.253-2.057-.694-2.82-1.284.681-.747 1.222-1.651 1.621-2.757H14V8h-3v1.047h.765c-.318.844-.74 1.546-1.272 2.13a6.066 6.066 0 0 1-.415-.492 1.988 1.988 0 0 1-.94.31z"></path></svg><span class="chakra-text css-yvcseo">Languages<!-- -->&nbsp;</span>EN</span></button><div style="visibility:hidden;position:absolute;min-width:max-content;inset:0 auto auto 0" class="css-r6z5ec"><div class="chakra-menu__menu-list css-7hkc0x" tabindex="-1" role="menu" id="menu-list-:Rdalal9t6H1:" aria-orientation="vertical" style="transform-origin:var(--popper-transform-origin);opacity:0;visibility:hidden;transform:scale(0.8) translateZ(0)"></div></div></div><button type="button" class="chakra-button css-x9rfcz" aria-label="Toggle search button" data-secondary="true" id="mobile-menu-button"><svg viewBox="0 0 24 40" focusable="false" class="chakra-icon css-abvgdf" stroke-width="2px" aria-hidden="true"><path d="M 2 13 l 10 0 l 0 0 l 10 0 M 4 19 l 8 0 M 12 19 l 8 0 M 2 25 l 10 0 l 0 0 l 10 0"></path></svg></button></div></div></div></nav></div><div class="css-7ok86h"><article id="main-content" dir="unset" class="css-3el9kh"><h1 class="chakra-heading css-1vx691u">Uniswap-v2 Contract Walk-Through</h1><div class="css-acl8ja"><div class="css-1n6aqim"><div class="css-7nlxkq"><span class="chakra-badge css-830gq8">solidity</span></div><span class="chakra-badge css-1f5nvj7">Intermediate</span></div><div class="chakra-stack css-17kxk4t"><div class="css-0"><span class="css-12av2tg undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/270d.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span>Ori Pomerantz</div><div class="css-0"><span class="css-12av2tg undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4c6.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->May 1, 2021</div><div class="css-0"><span class="css-12av2tg undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/23f1.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span>60<!-- --> <!-- -->minute read<!-- --> minute read</div></div><div class="chakra-stack css-82jv69"></div></div><aside class="css-1edfksr"><div aria-expanded="false" aria-controls="disclosure-:R3kppt6:" class="css-vmunoe"><span class="css-c13byp">On this page</span><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-l4bwj9" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div><div class="chakra-fade" hidden="" id="disclosure-:R3kppt6:" style="opacity:0"><ul role="list" class="css-1plxn13"><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#introduction">Introduction</a><ul role="list" class="css-ycb9ue"><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#what-does-uniswap-do">What Does Uniswap Do?</a></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#why-v2">Why v2? Why not v3?</a></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#contract-types">Core Contracts vs Periphery Contracts</a></li></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#flows">Data and Control Flows</a><ul role="list" class="css-ycb9ue"><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#swap-flow">Swap</a><ul role="list" class="css-ycb9ue"></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#add-liquidity-flow">Add Liquidity</a><ul role="list" class="css-ycb9ue"></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#remove-liquidity-flow">Remove Liquidity</a><ul role="list" class="css-ycb9ue"></ul></li></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#core-contracts">The Core Contracts</a><ul role="list" class="css-ycb9ue"><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#uniswapv2pair">UniswapV2Pair.sol</a><ul role="list" class="css-ycb9ue"></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#uniswapv2factory">UniswapV2Factory.sol</a></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#uniswapv2erc20">UniswapV2ERC20.sol</a></li></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#periphery-contracts">The Periphery Contracts</a><ul role="list" class="css-ycb9ue"><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#uniswapv2router01">UniswapV2Router01.sol</a></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#uniswapv2router02">UniswapV2Router02.sol</a><ul role="list" class="css-ycb9ue"></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#uniswapv2migrator">UniswapV2Migrator.sol</a></li></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#libraries">The Libraries</a><ul role="list" class="css-ycb9ue"><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#math">Math</a></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#fixedpoint">Fixed Point Fractions (UQ112x112)</a></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#uniswapv2library">UniswapV2Library</a></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#transfer-helper">Transfer Helper</a></li></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#conclusion">Conclusion</a></li></ul></div></aside><h2 class="chakra-heading css-4y8d04" id="introduction" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="introduction permalink" href="#introduction"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Introduction</h2><p class="chakra-text css-1bpgf5e"><a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://uniswap.org/whitepaper.pdf">Uniswap v2<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a> can create an exchange market between any two ERC-20 tokens. In this article we will go over the source code for the contracts that implement this protocol and see why they are written this way.</p><h3 class="chakra-heading css-1a19hgi" id="what-does-uniswap-do" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="what does uniswap do permalink" href="#what-does-uniswap-do"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>What Does Uniswap Do?</h3><p class="chakra-text css-1bpgf5e">Basically, there are two types of users: liquidity providers and traders.</p><p class="chakra-text css-1bpgf5e">The <em>liquidity providers</em> provide the pool with the two tokens that can be exchanged (we'll call them <strong>Token0</strong> and <strong>Token1</strong>). In return, they receive a third token that represents partial ownership of the pool called a <em>liquidity token</em>.</p><p class="chakra-text css-1bpgf5e"><em>Traders</em> send one type of token to the pool and receive the other (for example, send <strong>Token0</strong> and receive <strong>Token1</strong>) out of the pool provided by the liquidity providers. The exchange rate is determined by the relative number of <strong>Token0</strong>s and <strong>Token1</strong>s that the pool has. In addition, the pool takes a small percent as a reward for the liquidity pool.</p><p class="chakra-text css-1bpgf5e">When liquidity providers want their assets back they can burn the pool tokens and receive back their tokens, including their share of the rewards.</p><p class="chakra-text css-1bpgf5e"><a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://docs.uniswap.org/contracts/v2/concepts/core-concepts/swaps/">Click here for a fuller description<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>.</p><h3 class="chakra-heading css-1a19hgi" id="why-v2" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="why v2 permalink" href="#why-v2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Why v2? Why not v3?</h3><p class="chakra-text css-1bpgf5e"><a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://uniswap.org/whitepaper-v3.pdf">Uniswap v3<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a> is an upgrade that is much more complicated than the v2. It is easier to first learn v2 and then go to v3.</p><h3 class="chakra-heading css-1a19hgi" id="contract-types" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="contract types permalink" href="#contract-types"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Core Contracts vs Periphery Contracts</h3><p class="chakra-text css-1bpgf5e">Uniswap v2 is divided into two components, a core and a periphery. This division allows the core contracts, which hold the assets and therefore <em>have</em> to be secure, to be simpler and easier to audit. All the extra functionality required by traders can then be provided by periphery contracts.</p><h2 class="chakra-heading css-4y8d04" id="flows" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="flows permalink" href="#flows"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Data and Control Flows</h2><p class="chakra-text css-1bpgf5e">This is the flow of data and control that happens when you perform the three main actions of Uniswap:</p><ol role="list" class="css-1dg6mvm"><li class="css-0">Swap between different tokens</li><li class="css-0">Add liquidity to the market and get rewarded with pair exchange ERC-20 liquidity tokens</li><li class="css-0">Burn ERC-20 liquidity tokens and get back the ERC-20 tokens that the pair exchange allows traders to exchange</li></ol><h3 class="chakra-heading css-1a19hgi" id="swap-flow" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="swap flow permalink" href="#swap-flow"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Swap</h3><p class="chakra-text css-1bpgf5e">This is most common flow, used by traders:</p><h4 class="chakra-heading css-1w8u43l" id="caller" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="caller permalink" href="#caller"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Caller</h4><ol role="list" class="css-1dg6mvm"><li class="css-0">Provide the periphery account with an allowance in the amount to be swapped.</li><li class="css-0">Call one of the periphery contract's many swap functions (which one depends on whether ETH is involved or not, whether the trader specifies the amount of tokens to deposit or the amount of tokens to get back, etc).
Every swap function accepts a <code>path</code>, an array of exchanges to go through.</li></ol><h4 class="chakra-heading css-1w8u43l" id="in-the-periphery-contract-uniswapv2router02-sol" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="in the periphery contract uniswapv2router02 sol permalink" href="#in-the-periphery-contract-uniswapv2router02-sol"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>In the periphery contract (UniswapV2Router02.sol)</h4><ol role="list" start="3" class="css-1dg6mvm"><li class="css-0">Identify the amounts that need to be traded on each exchange along the path.</li><li class="css-0">Iterates over the path. For every exchange along the way it sends the input token and then calls the exchange's <code>swap</code> function.
In most cases the destination address for the tokens is the next pair exchange in the path. In the final exchange it is the address provided by the trader.</li></ol><h4 class="chakra-heading css-1w8u43l" id="in-the-core-contract-uniswapv2pairsol-2" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="in the core contract uniswapv2pairsol 2 permalink" href="#in-the-core-contract-uniswapv2pairsol-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>In the core contract (UniswapV2Pair.sol)</h4><ol role="list" start="5" class="css-1dg6mvm"><li class="css-0">Verify that the core contract is not being cheated and can maintain sufficient liquidity after the swap.</li><li class="css-0">See how many extra tokens we have in addition to the known reserves. That amount is the number of input tokens we received to exchange.</li><li class="css-0">Send the output tokens to the destination.</li><li class="css-0">Call <code>_update</code> to update the reserve amounts</li></ol><h4 class="chakra-heading css-1w8u43l" id="back-in-the-periphery-contract-uniswapv2router02-sol" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="back in the periphery contract uniswapv2router02 sol permalink" href="#back-in-the-periphery-contract-uniswapv2router02-sol"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Back in the periphery contract (UniswapV2Router02.sol)</h4><ol role="list" start="9" class="css-1dg6mvm"><li class="css-0">Perform any necessary cleanup (for example, burn WETH tokens to get back ETH to send the trader)</li></ol><h3 class="chakra-heading css-1a19hgi" id="add-liquidity-flow" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="add liquidity flow permalink" href="#add-liquidity-flow"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Add Liquidity</h3><h4 class="chakra-heading css-1w8u43l" id="caller-2" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="caller 2 permalink" href="#caller-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Caller</h4><ol role="list" class="css-1dg6mvm"><li class="css-0">Provide the periphery account with an allowance in the amounts to be added to the liquidity pool.</li><li class="css-0">Call one of the periphery contract's <code>addLiquidity</code> functions.</li></ol><h4 class="chakra-heading css-1w8u43l" id="in-the-periphery-contract-uniswapv2router02sol-2" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="in the periphery contract uniswapv2router02sol 2 permalink" href="#in-the-periphery-contract-uniswapv2router02sol-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>In the periphery contract (UniswapV2Router02.sol)</h4><ol role="list" start="3" class="css-1dg6mvm"><li class="css-0">Create a new pair exchange if necessary</li><li class="css-0">If there is an existing pair exchange, calculate the amount of tokens to add. This is supposed to be identical value for both tokens, so the same ratio of new tokens to existing tokens.</li><li class="css-0">Check if the amounts are acceptable (callers can specify a minimum amount below which they'd rather not add liquidity)</li><li class="css-0">Call the core contract.</li></ol><h4 class="chakra-heading css-1w8u43l" id="in-the-core-contract-uniswapv2pairsol-2" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="in the core contract uniswapv2pairsol 2 permalink" href="#in-the-core-contract-uniswapv2pairsol-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>In the core contract (UniswapV2Pair.sol)</h4><ol role="list" start="7" class="css-1dg6mvm"><li class="css-0">Mint liquidity tokens and send them to the caller</li><li class="css-0">Call <code>_update</code> to update the reserve amounts</li></ol><h3 class="chakra-heading css-1a19hgi" id="remove-liquidity-flow" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="remove liquidity flow permalink" href="#remove-liquidity-flow"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Remove Liquidity</h3><h4 class="chakra-heading css-1w8u43l" id="caller-3" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="caller 3 permalink" href="#caller-3"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Caller</h4><ol role="list" class="css-1dg6mvm"><li class="css-0">Provide the periphery account with an allowance of liquidity tokens to be burned in exchange for the underlying tokens.</li><li class="css-0">Call one of the periphery contract's <code>removeLiquidity</code> functions.</li></ol><h4 class="chakra-heading css-1w8u43l" id="in-the-periphery-contract-uniswapv2router02sol-3" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="in the periphery contract uniswapv2router02sol 3 permalink" href="#in-the-periphery-contract-uniswapv2router02sol-3"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>In the periphery contract (UniswapV2Router02.sol)</h4><ol role="list" start="3" class="css-1dg6mvm"><li class="css-0">Send the liquidity tokens to the pair exchange</li></ol><h4 class="chakra-heading css-1w8u43l" id="in-the-core-contract-uniswapv2pairsol-3" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="in the core contract uniswapv2pairsol 3 permalink" href="#in-the-core-contract-uniswapv2pairsol-3"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>In the core contract (UniswapV2Pair.sol)</h4><ol role="list" start="4" class="css-1dg6mvm"><li class="css-0">Send the destination address the underlying tokens in proportion to the burned tokens. For example if there are 1000 A tokens in the pool, 500 B tokens, and 90 liquidity tokens, and we receive 9 tokens to burn, we're burning 10% of the liquidity tokens so we send back the user 100 A tokens and 50 B tokens.</li><li class="css-0">Burn the liquidity tokens</li><li class="css-0">Call <code>_update</code> to update the reserve amounts</li></ol><h2 class="chakra-heading css-4y8d04" id="core-contracts" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="core contracts permalink" href="#core-contracts"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>The Core Contracts</h2><p class="chakra-text css-1bpgf5e">These are the secure contracts which hold the liquidity.</p><h3 class="chakra-heading css-1a19hgi" id="uniswapv2pair" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="uniswapv2pair permalink" href="#uniswapv2pair"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>UniswapV2Pair.sol</h3><p class="chakra-text css-1bpgf5e"><a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://github.com/Uniswap/uniswap-v2-core/blob/master/contracts/UniswapV2Pair.sol">This contract<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a> implements the actual pool that exchanges tokens. It is the core Uniswap functionality.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token keyword" style="color:#498bb5">pragma</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">solidity</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token number" style="color:#e09142">0.5</span><span class="token number" style="color:#e09142">.16</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'./interfaces/IUniswapV2Pair.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'./UniswapV2ERC20.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'./libraries/Math.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'./libraries/UQ112x112.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'./interfaces/IERC20.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'./interfaces/IUniswapV2Factory.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'./interfaces/IUniswapV2Callee.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">These are all the interfaces that the contract needs to know about, either because the contract implements them (<code>IUniswapV2Pair</code> and <code>UniswapV2ERC20</code>) or because it calls contracts that implement them.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token keyword" style="color:#498bb5">contract</span><span class="token plain"> </span><span class="token class-name">UniswapV2Pair</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">is</span><span class="token plain"> IUniswapV2Pair</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> UniswapV2ERC20 </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This contract inherits from <code>UniswapV2ERC20</code>, which provides the ERC-20 functions for the liquidity tokens.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">using</span><span class="token plain"> </span><span class="token class-name">SafeMath</span><span class="token plain">  </span><span class="token keyword" style="color:#498bb5">for</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://docs.openzeppelin.com/contracts/2.x/api/math">SafeMath library<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a> is used to avoid overflows and underflows. This is important because otherwise we might end up with a situation where a value should be <code>-1</code>, but is instead <code>2^256-1</code>.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">using</span><span class="token plain"> </span><span class="token class-name">UQ112x112</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">for</span><span class="token plain"> </span><span class="token builtin">uint224</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">A lot of calculations in the pool contract require fractions. However, fractions are not supported by the EVM.
The solution that Uniswap found is to use 224 bit values, with 112 bits for the integer part, and 112 bits for the fraction. So <code>1.0</code> is represented as <code>2^112</code>, <code>1.5</code> is represented as <code>2^112 + 2^111</code>, etc.</p><p class="chakra-text css-1bpgf5e">More details about this library are available <a class="chakra-link css-1f04442" data-inline-link="true" href="#FixedPoint">later in the document</a>.</p><h4 class="chakra-heading css-1w8u43l" id="pair-vars" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="pair vars permalink" href="#pair-vars"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Variables</h4><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">uint</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">constant</span><span class="token plain"> MINIMUM_LIQUIDITY </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">10</span><span class="token operator" style="color:#e09142">**</span><span class="token number" style="color:#e09142">3</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">To avoid cases of division by zero, there is a minimum number of liquidity tokens that always exist (but are owned by account zero). That number is <strong>MINIMUM_LIQUIDITY</strong>, a thousand.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">bytes4</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">private</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">constant</span><span class="token plain"> SELECTOR </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token builtin">bytes4</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#ff7324">keccak256</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">bytes</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#498bb5">'transfer(address,uint256)'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This is the ABI selector for the ERC-20 transfer function. It is used to transfer ERC-20 tokens in the two token accounts.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">address</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> factory</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This is the factory contract that created this pool. Every pool is an exchange between two ERC-20 tokens, the factory is a central point that connects all of these pools.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">address</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">address</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">There are the addresses of the contracts for the two types of ERC-20 tokens that can be exchanged by this pool.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">uint112</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">private</span><span class="token plain"> reserve0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain">           </span><span class="token comment" style="color:#6c6783">// uses single storage slot, accessible via getReserves</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">uint112</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">private</span><span class="token plain"> reserve1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain">           </span><span class="token comment" style="color:#6c6783">// uses single storage slot, accessible via getReserves</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The reserves the pool has for each token type. We assume that the two represent the same amount of value, and therefore each token0 is worth reserve1/reserve0 token1's.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">uint32</span><span class="token plain">  </span><span class="token keyword" style="color:#498bb5">private</span><span class="token plain"> blockTimestampLast</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// uses single storage slot, accessible via getReserves</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The timestamp for the last block in which an exchange occurred, used to track exchange rates across time.</p><p class="chakra-text css-1bpgf5e">One of the biggest gas expenses of Ethereum contracts is storage, which persists from one call of the contract to the next. Each storage cell is 256 bits long. So three variables, <code>reserve0</code>, <code>reserve1</code>, and <code>blockTimestampLast</code>, are allocated in such a way a single storage value can include all three of them (112+112+32=256).</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">uint</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> price0CumulativeLast</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">uint</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> price1CumulativeLast</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">These variables hold the cumulative costs for each token (each in term of the other). They can be used to calculate the average exchange rate over a period of time.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">uint</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> kLast</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// reserve0 * reserve1, as of immediately after the most recent liquidity event</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The way the pair exchange decides on the exchange rate between token0 and token1 is to keep the multiple of the two reserves constant during trades. <code>kLast</code> is this value. It changes when a liquidity provider deposits or withdraws tokens, and it increases slightly because of the 0.3% market fee.</p><p class="chakra-text css-1bpgf5e">Here is a simple example. Note that for the sake of simplicity the table only has three digits after the decimal point, and we ignore the 0.3% trading fee so the numbers are not accurate.</p><div class="chakra-table__container css-k002eo"><table class="chakra-table css-1u5689g"><thead class="css-rz7efy"><tr class="css-czbvy"><th class="css-jejxkf">Event</th><th class="css-9snn25">reserve0</th><th class="css-9snn25">reserve1</th><th class="css-9snn25">reserve0 <!-- -->*<!-- --> reserve1</th><th class="css-jejxkf">Average exchange rate (token1 / token0)</th></tr></thead><tbody class="css-gabqlo"><tr class="css-czbvy"><td class="css-1ijcw7e">Initial setup</td><td class="css-1qt9prs">1,000.000</td><td class="css-1qt9prs">1,000.000</td><td class="css-1qt9prs">1,000,000</td><td class="css-1ijcw7e"></td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">Trader A swaps 50 token0 for 47.619 token1</td><td class="css-1qt9prs">1,050.000</td><td class="css-1qt9prs">952.381</td><td class="css-1qt9prs">1,000,000</td><td class="css-1ijcw7e">0.952</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">Trader B swaps 10 token0 for 8.984 token1</td><td class="css-1qt9prs">1,060.000</td><td class="css-1qt9prs">943.396</td><td class="css-1qt9prs">1,000,000</td><td class="css-1ijcw7e">0.898</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">Trader C swaps 40 token0 for 34.305 token1</td><td class="css-1qt9prs">1,100.000</td><td class="css-1qt9prs">909.090</td><td class="css-1qt9prs">1,000,000</td><td class="css-1ijcw7e">0.858</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">Trader D swaps 100 token1 for 109.01 token0</td><td class="css-1qt9prs">990.990</td><td class="css-1qt9prs">1,009.090</td><td class="css-1qt9prs">1,000,000</td><td class="css-1ijcw7e">0.917</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">Trader E swaps 10 token0 for 10.079 token1</td><td class="css-1qt9prs">1,000.990</td><td class="css-1qt9prs">999.010</td><td class="css-1qt9prs">1,000,000</td><td class="css-1ijcw7e">1.008</td></tr></tbody></table></div><p class="chakra-text css-1bpgf5e">As traders provide more of token0, the relative value of token1 increases, and vice versa, based on supply and demand.</p><h4 class="chakra-heading css-1w8u43l" id="pair-lock" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="pair lock permalink" href="#pair-lock"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Lock</h4><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">uint</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">private</span><span class="token plain"> unlocked </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">There is a class of security vulnerabilities that are based on <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://medium.com/coinmonks/ethernaut-lvl-10-re-entrancy-walkthrough-how-to-abuse-execution-ordering-and-reproduce-the-dao-7ec88b912c14">reentrancy abuse<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>. Uniswap needs to transfer arbitrary ERC-20 tokens, which means calling ERC-20 contracts that may attempt to abuse the Uniswap market that calls them.
By having an <code>unlocked</code> variable as part of the contract, we can prevent functions from being called while they are running (within the same transaction).</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">modifier</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">lock</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function is a <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://docs.soliditylang.org/en/v0.8.3/contracts.html#function-modifiers">modifier<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>, a function that wraps around a normal function to change its behavior is some way.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">unlocked </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: LOCKED'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        unlocked </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">If <code>unlocked</code> is equal to one, set it to zero. If it is already zero revert the call, make it fail.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">_</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">In a modifier <code>_;</code> is the original function call (with all the parameters). Here it means that the function call only happens if <code>unlocked</code> was one when it was called, and while it is running the value of <code>unlocked</code> is zero.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        unlocked </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">After the main function returns, release the lock.</p><h4 class="chakra-heading css-1w8u43l" id="pair-misc" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="pair misc permalink" href="#pair-misc"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Misc. functions</h4><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getReserves</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">view</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint112</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint112</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint32</span><span class="token plain"> _blockTimestampLast</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        _reserve0 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> reserve0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        _reserve1 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> reserve1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        _blockTimestampLast </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> blockTimestampLast</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function provides callers with the current state of the exchange. Notice that Solidity functions <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://docs.soliditylang.org/en/v0.8.3/contracts.html#returning-multiple-values">can return multiple values<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">_safeTransfer</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> value</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">private</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">bool</span><span class="token plain"> success</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">bytes</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> data</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">call</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">abi</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">encodeWithSelector</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">SELECTOR</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This internal function transfers an amount of ERC20 tokens from the exchange to somebody else. <code>SELECTOR</code> specifies that the function we are calling is <code>transfer(address,uint)</code> (see definition above).</p><p class="chakra-text css-1bpgf5e">To avoid having to import an interface for the token function, we "manually" create the call using one of the <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://docs.soliditylang.org/en/v0.8.3/units-and-global-variables.html#abi-encoding-and-decoding-functions">ABI functions<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">success </span><span class="token operator" style="color:#e09142">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">||</span><span class="token plain"> abi</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">decode</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">bool</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: TRANSFER_FAILED'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">There are two ways in which an ERC-20 transfer call can report failure:</p><ol role="list" class="css-1dg6mvm"><li class="css-0">Revert. If a call to an external contract reverts, then the boolean return value is <code>false</code></li><li class="css-0">End normally but report a failure. In that case the return value buffer has a non-zero length, and when decoded as a boolean value it is <code>false</code></li></ol><p class="chakra-text css-1bpgf5e">If either of these conditions happen, revert.</p><h4 class="chakra-heading css-1w8u43l" id="pair-events" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="pair events permalink" href="#pair-events"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Events</h4><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">event</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">Mint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">indexed</span><span class="token plain"> sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amount0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">event</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">Burn</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">indexed</span><span class="token plain"> sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amount0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">indexed</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">These two events are emitted when a liquidity provider either deposits liquidity (<code>Mint</code>) or withdraws it (<code>Burn</code>). In either case, the amounts of token0 and token1 that are deposited or withdrawn are part of the event, as well as the identity of the account that called us (<code>sender</code>). In the case of a withdrawal, the event also includes the target that received the tokens (<code>to</code>), which may not be the same as the sender.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">event</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">Swap</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">indexed</span><span class="token plain"> sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amount0In</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amount1In</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amount0Out</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">indexed</span><span class="token plain"> to</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This event is emitted when a trader swaps one token for the other. Again, the sender and the destination may not be the same.
Each token may be either sent to the exchange, or received from it.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">event</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">Sync</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint112</span><span class="token plain"> reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint112</span><span class="token plain"> reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Finally, <code>Sync</code> is emitted every time tokens are added or withdrawn, regardless of the reason, to provide the latest reserve information (and therefore the exchange rate).</p><h4 class="chakra-heading css-1w8u43l" id="pair-setup" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="pair setup permalink" href="#pair-setup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Setup Functions</h4><p class="chakra-text css-1bpgf5e">These functions are supposed to be called once when the new pair exchange is set up.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">constructor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        factory </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The constructor makes sure we'll keep track of the address of the factory that created the pair. This information is required for <code>initialize</code> and for the factory fee (if one exists)</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// called once by the factory at time of deployment</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">initialize</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> _token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> _token1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: FORBIDDEN'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// sufficient check</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        token0 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> _token0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        token1 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> _token1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function allows the factory (and only the factory) to specify the two ERC-20 tokens that this pair will exchange.</p><h4 class="chakra-heading css-1w8u43l" id="pair-update-internal" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="pair update internal permalink" href="#pair-update-internal"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Internal Update Functions</h4><h5 id="_update">_<!-- -->update</h5><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// update reserves and, on the first call per block, price accumulators</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">_update</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> balance0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint112</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint112</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">private</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function is called every time tokens are deposited or withdrawn.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">balance0 </span><span class="token operator" style="color:#e09142">&lt;=</span><span class="token plain"> </span><span class="token builtin">uint112</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">-</span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&amp;&amp;</span><span class="token plain"> balance1 </span><span class="token operator" style="color:#e09142">&lt;=</span><span class="token plain"> </span><span class="token builtin">uint112</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">-</span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: OVERFLOW'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">If either balance0 or balance1 (uint256) is higher than uint112(-1) (=2^112-1) (so it overflows &amp; wraps back to 0 when converted to uint112) refuse to continue the <!-- -->_<!-- -->update to prevent overflows. With a normal token that can be subdivided into 10^18 units, this means each exchange is limited to about 5.1<!-- -->*<!-- -->10^15 of each tokens. So far that has not been a problem.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint32</span><span class="token plain"> blockTimestamp </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token builtin">uint32</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">block</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">timestamp </span><span class="token operator" style="color:#e09142">%</span><span class="token plain"> </span><span class="token number" style="color:#e09142">2</span><span class="token operator" style="color:#e09142">**</span><span class="token number" style="color:#e09142">32</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint32</span><span class="token plain"> timeElapsed </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> blockTimestamp </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> blockTimestampLast</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// overflow is desired</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">timeElapsed </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&amp;&amp;</span><span class="token plain"> _reserve0 </span><span class="token operator" style="color:#e09142">!=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&amp;&amp;</span><span class="token plain"> _reserve1 </span><span class="token operator" style="color:#e09142">!=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">If the time elapsed is not zero, it means we are the first exchange transaction on this block. In that case, we need to update the cost accumulators.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token comment" style="color:#6c6783">// * never overflows, and + overflow is desired</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">            price0CumulativeLast </span><span class="token operator" style="color:#e09142">+=</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">UQ112x112</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">encode</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">uqdiv</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">*</span><span class="token plain"> timeElapsed</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">            price1CumulativeLast </span><span class="token operator" style="color:#e09142">+=</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">UQ112x112</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">encode</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">uqdiv</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">*</span><span class="token plain"> timeElapsed</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Each cost accumulator is updated with the latest cost (reserve of the other token/reserve of this token) times the elapsed time in seconds. To get an average price, you read the cumulative price in two points in time and divide by the time difference between them. For example, assume this sequence of events:</p><div class="chakra-table__container css-k002eo"><table class="chakra-table css-1u5689g"><thead class="css-rz7efy"><tr class="css-czbvy"><th class="css-jejxkf">Event</th><th class="css-9snn25">reserve0</th><th class="css-9snn25">reserve1</th><th class="css-jejxkf">timestamp</th><th class="css-9snn25">Marginal exchange rate (reserve1 / reserve0)</th><th class="css-9snn25">price0CumulativeLast</th></tr></thead><tbody class="css-gabqlo"><tr class="css-czbvy"><td class="css-1ijcw7e">Initial setup</td><td class="css-1qt9prs">1,000.000</td><td class="css-1qt9prs">1,000.000</td><td class="css-1ijcw7e">5,000</td><td class="css-1qt9prs">1.000</td><td class="css-1qt9prs">0</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">Trader A deposits 50 token0 and gets 47.619 token1 back</td><td class="css-1qt9prs">1,050.000</td><td class="css-1qt9prs">952.381</td><td class="css-1ijcw7e">5,020</td><td class="css-1qt9prs">0.907</td><td class="css-1qt9prs">20</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">Trader B deposits 10 token0 and gets 8.984 token1 back</td><td class="css-1qt9prs">1,060.000</td><td class="css-1qt9prs">943.396</td><td class="css-1ijcw7e">5,030</td><td class="css-1qt9prs">0.890</td><td class="css-1qt9prs">20+10<!-- -->*<!-- -->0.907 = 29.07</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">Trader C deposits 40 token0 and gets 34.305 token1 back</td><td class="css-1qt9prs">1,100.000</td><td class="css-1qt9prs">909.090</td><td class="css-1ijcw7e">5,100</td><td class="css-1qt9prs">0.826</td><td class="css-1qt9prs">29.07+70<!-- -->*<!-- -->0.890 = 91.37</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">Trader D deposits 100 token1 and gets 109.01 token0 back</td><td class="css-1qt9prs">990.990</td><td class="css-1qt9prs">1,009.090</td><td class="css-1ijcw7e">5,110</td><td class="css-1qt9prs">1.018</td><td class="css-1qt9prs">91.37+10<!-- -->*<!-- -->0.826 = 99.63</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">Trader E deposits 10 token0 and gets 10.079 token1 back</td><td class="css-1qt9prs">1,000.990</td><td class="css-1qt9prs">999.010</td><td class="css-1ijcw7e">5,150</td><td class="css-1qt9prs">0.998</td><td class="css-1qt9prs">99.63+40<!-- -->*<!-- -->1.1018 = 143.702</td></tr></tbody></table></div><p class="chakra-text css-1bpgf5e">Let's say we want to calculate the average price of <strong>Token0</strong> between the timestamps 5,030 and 5,150. The difference in the value of <code>price0Cumulative</code> is 143.702-29.07=114.632. This is the average across two minutes (120 seconds). So the average price is 114.632/120 = 0.955.</p><p class="chakra-text css-1bpgf5e">This price calculation is the reason we need to know the old reserve sizes.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        reserve0 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token builtin">uint112</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">balance0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        reserve1 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token builtin">uint112</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">balance1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        blockTimestampLast </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> blockTimestamp</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">emit</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">Sync</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Finally, update the global variables and emit a <code>Sync</code> event.</p><h5 id="_mintfee">_<!-- -->mintFee</h5><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// if fee is on, mint liquidity equivalent to 1/6th of the growth in sqrt(k)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">_mintFee</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint112</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint112</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">private</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">bool</span><span class="token plain"> feeOn</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">In Uniswap 2.0 traders pay a 0.30% fee to use the market. Most of that fee (0.25% of the trade) always goes to the liquidity providers. The remaining 0.05% can go either to the liquidity providers or to an address specified by the factory as a protocol fee, which pays Uniswap for their development effort.</p><p class="chakra-text css-1bpgf5e">To reduce calculations (and therefore gas costs), this fee is only calculated when liquidity is added or removed from the pool, rather than at each transaction.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> feeTo </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IUniswapV2Factory</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">feeTo</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        feeOn </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> feeTo </span><span class="token operator" style="color:#e09142">!=</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Read the fee destination of the factory. If it is zero then there is no protocol fee and no need to calculate it that fee.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> _kLast </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> kLast</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// gas savings</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The <code>kLast</code> state variable is located in storage, so it will have a value between different calls to the contract.
Access to storage is a lot more expensive than access to the volatile memory that is released when the function call to the contract ends, so we use an internal variable to save on gas.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">feeOn</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_kLast </span><span class="token operator" style="color:#e09142">!=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The liquidity providers get their cut simply by the appreciation of their liquidity tokens. But the protocol fee requires new liquidity tokens to be minted and provided to the <code>feeTo</code> address.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token builtin">uint</span><span class="token plain"> rootK </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> Math</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sqrt</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token builtin">uint</span><span class="token plain"> rootKLast </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> Math</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sqrt</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_kLast</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">rootK </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> rootKLast</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">If there is new liquidity on which to collect a protocol fee. You can see the square root function <a class="chakra-link css-1f04442" data-inline-link="true" href="#Math">later in this article</a></p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">                    </span><span class="token builtin">uint</span><span class="token plain"> numerator </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> totalSupply</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">rootK</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sub</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">rootKLast</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">                    </span><span class="token builtin">uint</span><span class="token plain"> denominator </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> rootK</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">5</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">add</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">rootKLast</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">                    </span><span class="token builtin">uint</span><span class="token plain"> liquidity </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> numerator </span><span class="token operator" style="color:#e09142">/</span><span class="token plain"> denominator</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This complicated calculation of fees is explained in <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://uniswap.org/whitepaper.pdf">the whitepaper<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a> on page 5. We know that between the time <code>kLast</code> was calculated and the present no liquidity was added or removed (because we run this calculation every time liquidity is added or removed, before it actually changes), so any change in <code>reserve0 * reserve1</code> has to come from transaction fees (without them we'd keep <code>reserve0 * reserve1</code> constant).</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">                    </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">liquidity </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">_mint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">feeTo</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Use the <code>UniswapV2ERC20._mint</code> function to actually create the additional liquidity tokens and assign them to <code>feeTo</code>.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">else</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_kLast </span><span class="token operator" style="color:#e09142">!=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">            kLast </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">If there is no fee set <code>kLast</code> to zero (if it isn't that already). When this contract was written there was a <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://eips.ethereum.org/EIPS/eip-3298">gas refund feature<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a> that encouraged contracts to reduce the overall size of the Ethereum state by zeroing out storage they did not need.
This code gets that refund when possible.</p><h4 class="chakra-heading css-1w8u43l" id="pair-external" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="pair external permalink" href="#pair-external"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Externally Accessible Functions</h4><p class="chakra-text css-1bpgf5e">Note that while any transaction or contract <em>can</em> call these functions, they are designed to be called from the periphery contract. If you call them directly you won't be able to cheat the pair exchange, but you might lose value through a mistake.</p><h5 id="mint">mint</h5><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// this low-level function should be called from a contract which performs important safety checks</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">mint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> lock </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function is called when a liquidity provider adds liquidity to the pool. It mints additional liquidity tokens as a reward. It should be called from <a class="chakra-link css-1f04442" data-inline-link="true" href="#UniswapV2Router02">a periphery contract</a> that calls it after adding the liquidity in the same transaction (so nobody else would be able to submit a transaction that claims the new liquidity before the legitimate owner).</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint112</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint112</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getReserves</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// gas savings</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This is the way to read the results of a Solidity function that returns multiple values. We discard the last returned values, the block timestamp, because we don't need it.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> balance0 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> balance1 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amount0 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> balance0</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sub</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amount1 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sub</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Get the current balances and see how much was added of each token type.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">bool</span><span class="token plain"> feeOn </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">_mintFee</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Calculate the protocol fees to collect, if any, and mint liquidity tokens accordingly. Because the parameters to <code>_mintFee</code> are the old reserve values, the fee is calculated accurately based only on pool changes due to fees.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> _totalSupply </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> totalSupply</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// gas savings, must be defined here since totalSupply can update in _mintFee</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_totalSupply </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">            liquidity </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> Math</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sqrt</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amount0</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amount1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sub</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">MINIMUM_LIQUIDITY</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">           </span><span class="token function" style="color:#ff7324">_mint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> MINIMUM_LIQUIDITY</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// permanently lock the first MINIMUM_LIQUIDITY tokens</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">If this is the first deposit, create <code>MINIMUM_LIQUIDITY</code> tokens and send them to address zero to lock them. They can never be redeemed, which means the pool will never be emptied completely (this saves us from division by zero in some places). The value of <code>MINIMUM_LIQUIDITY</code> is a thousand, which considering most ERC-20 are subdivided into units of 10^-18'th of a token, as ETH is divided into wei, is 10^-15 to the value of a single token. Not a high cost.</p><p class="chakra-text css-1bpgf5e">In the time of the first deposit we don't know the relative value of the two tokens, so we just multiply the amounts and take a square root, assuming that the deposit provides us with equal value in both tokens.</p><p class="chakra-text css-1bpgf5e">We can trust this because it is in the depositor's interest to provide equal value, to avoid losing value to arbitrage.
Let's say that the value of the two tokens is identical, but our depositor deposited four times as many of <strong>Token1</strong> as of <strong>Token0</strong>. A trader can use the fact the pair exchange thinks that <strong>Token0</strong> is more valuable to extract value out of it.</p><div class="chakra-table__container css-k002eo"><table class="chakra-table css-1u5689g"><thead class="css-rz7efy"><tr class="css-czbvy"><th class="css-jejxkf">Event</th><th class="css-9snn25">reserve0</th><th class="css-9snn25">reserve1</th><th class="css-9snn25">reserve0 <!-- -->*<!-- --> reserve1</th><th class="css-9snn25">Value of the pool (reserve0 + reserve1)</th></tr></thead><tbody class="css-gabqlo"><tr class="css-czbvy"><td class="css-1ijcw7e">Initial setup</td><td class="css-1qt9prs">8</td><td class="css-1qt9prs">32</td><td class="css-1qt9prs">256</td><td class="css-1qt9prs">40</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">Trader deposits 8 <strong>Token0</strong> tokens, gets back 16 <strong>Token1</strong></td><td class="css-1qt9prs">16</td><td class="css-1qt9prs">16</td><td class="css-1qt9prs">256</td><td class="css-1qt9prs">32</td></tr></tbody></table></div><p class="chakra-text css-1bpgf5e">As you can see, the trader earned an extra 8 tokens, which come from a reduction in the value of the pool, hurting the depositor that owns it.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">            liquidity </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> Math</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">min</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amount0</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_totalSupply</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">/</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_totalSupply</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">/</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">With every subsequent deposit we already know the exchange rate between the two assets, and we expect liquidity providers to provide equal value in both. If they don't, we give them liquidity tokens based on the lesser value they provided as a punishment.</p><p class="chakra-text css-1bpgf5e">Whether it is the initial deposit or a subsequent one, the number of liquidity tokens we provide is equal to the square root of the change in <code>reserve0*reserve1</code> and the value of the liquidity token doesn't change (unless we get a deposit that doesn't have equal values of both types, in which case the "fine" gets distributed). Here is another example with two tokens that have the same value, with three good deposits and one bad one (deposit of only one token type, so it doesn't produce any liquidity tokens).</p><div class="chakra-table__container css-k002eo"><table class="chakra-table css-1u5689g"><thead class="css-rz7efy"><tr class="css-czbvy"><th class="css-jejxkf">Event</th><th class="css-9snn25">reserve0</th><th class="css-9snn25">reserve1</th><th class="css-9snn25">reserve0 <!-- -->*<!-- --> reserve1</th><th class="css-9snn25">Pool value (reserve0 + reserve1)</th><th class="css-9snn25">Liquidity tokens minted for this deposit</th><th class="css-9snn25">Total liquidity tokens</th><th class="css-9snn25">value of each liquidity token</th></tr></thead><tbody class="css-gabqlo"><tr class="css-czbvy"><td class="css-1ijcw7e">Initial setup</td><td class="css-1qt9prs">8.000</td><td class="css-1qt9prs">8.000</td><td class="css-1qt9prs">64</td><td class="css-1qt9prs">16.000</td><td class="css-1qt9prs">8</td><td class="css-1qt9prs">8</td><td class="css-1qt9prs">2.000</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">Deposit four of each type</td><td class="css-1qt9prs">12.000</td><td class="css-1qt9prs">12.000</td><td class="css-1qt9prs">144</td><td class="css-1qt9prs">24.000</td><td class="css-1qt9prs">4</td><td class="css-1qt9prs">12</td><td class="css-1qt9prs">2.000</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">Deposit two of each type</td><td class="css-1qt9prs">14.000</td><td class="css-1qt9prs">14.000</td><td class="css-1qt9prs">196</td><td class="css-1qt9prs">28.000</td><td class="css-1qt9prs">2</td><td class="css-1qt9prs">14</td><td class="css-1qt9prs">2.000</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">Unequal value deposit</td><td class="css-1qt9prs">18.000</td><td class="css-1qt9prs">14.000</td><td class="css-1qt9prs">252</td><td class="css-1qt9prs">32.000</td><td class="css-1qt9prs">0</td><td class="css-1qt9prs">14</td><td class="css-1qt9prs">~2.286</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">After arbitrage</td><td class="css-1qt9prs">~15.874</td><td class="css-1qt9prs">~15.874</td><td class="css-1qt9prs">252</td><td class="css-1qt9prs">~31.748</td><td class="css-1qt9prs">0</td><td class="css-1qt9prs">14</td><td class="css-1qt9prs">~2.267</td></tr></tbody></table></div><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">liquidity </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: INSUFFICIENT_LIQUIDITY_MINTED'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_mint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Use the <code>UniswapV2ERC20._mint</code> function to actually create the additional liquidity tokens and give them to the correct account.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_update</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">balance0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">feeOn</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> kLast </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserve0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// reserve0 and reserve1 are up-to-date</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">emit</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">Mint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Update the state variables (<code>reserve0</code>, <code>reserve1</code>, and if needed <code>kLast</code>) and emit the appropriate event.</p><h5 id="burn">burn</h5><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// this low-level function should be called from a contract which performs important safety checks</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">burn</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> lock </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amount0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function is called when liquidity is withdrawn and the appropriate liquidity tokens need to be burned.
It should also be called <a class="chakra-link css-1f04442" data-inline-link="true" href="#UniswapV2Router02">from a periphery account</a>.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint112</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint112</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getReserves</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// gas savings</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> _token0 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain">                                </span><span class="token comment" style="color:#6c6783">// gas savings</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> _token1 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain">                                </span><span class="token comment" style="color:#6c6783">// gas savings</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> balance0 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> balance1 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> liquidity </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> balanceOf</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The periphery contract transferred the liquidity to be burned to this contract before the call. That way we know how much liquidity to burn, and we can make sure that it gets burned.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">bool</span><span class="token plain"> feeOn </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">_mintFee</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> _totalSupply </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> totalSupply</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// gas savings, must be defined here since totalSupply can update in _mintFee</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        amount0 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">balance0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">/</span><span class="token plain"> _totalSupply</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// using balances ensures pro-rata distribution</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        amount1 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">balance1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">/</span><span class="token plain"> _totalSupply</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// using balances ensures pro-rata distribution</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amount0 </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&amp;&amp;</span><span class="token plain"> amount1 </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: INSUFFICIENT_LIQUIDITY_BURNED'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The liquidity provider receives equal value of both tokens. This way we don't change the exchange rate.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_burn</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_safeTransfer</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_safeTransfer</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        balance0 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        balance1 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_update</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">balance0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">feeOn</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> kLast </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserve0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// reserve0 and reserve1 are up-to-date</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">emit</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">Burn</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The rest of the <code>burn</code> function is the mirror image of the <code>mint</code> function above.</p><h5 id="swap">swap</h5><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// this low-level function should be called from a contract which performs important safety checks</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">swap</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amount0Out</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">bytes</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">calldata</span><span class="token plain"> data</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> lock </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function is also supposed to be called from <a class="chakra-link css-1f04442" data-inline-link="true" href="#UniswapV2Router02">a periphery contract</a>.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amount0Out </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">||</span><span class="token plain"> amount1Out </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: INSUFFICIENT_OUTPUT_AMOUNT'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint112</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint112</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getReserves</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// gas savings</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amount0Out </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> _reserve0 </span><span class="token operator" style="color:#e09142">&amp;&amp;</span><span class="token plain"> amount1Out </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: INSUFFICIENT_LIQUIDITY'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> balance0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// scope for _token{0,1}, avoids stack too deep errors</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Local variables can be stored either in memory or, if there aren't too many of them, directly on the stack.
If we can limit the number so we'll use the stack we use less gas. For more details see <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://ethereum.github.io/yellowpaper/paper.pdf">the yellow paper, the formal Ethereum specifications<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>, p. 26, equation 298.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token builtin">address</span><span class="token plain"> _token0 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token builtin">address</span><span class="token plain"> _token1 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">to </span><span class="token operator" style="color:#e09142">!=</span><span class="token plain"> _token0 </span><span class="token operator" style="color:#e09142">&amp;&amp;</span><span class="token plain"> to </span><span class="token operator" style="color:#e09142">!=</span><span class="token plain"> _token1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: INVALID_TO'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amount0Out </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">_safeTransfer</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount0Out</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// optimistically transfer tokens</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amount1Out </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">_safeTransfer</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// optimistically transfer tokens</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This transfer is optimistic, because we transfer before we are sure all the conditions are met. This is OK in Ethereum because if the conditions aren't met later in the call we revert out of it and any changes it created.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IUniswapV2Callee</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">uniswapV2Call</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount0Out</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Inform the receiver about the swap if requested.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">            balance0 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">            balance1 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Get the current balances. The periphery contract sends us the tokens before calling us for the swap. This makes it easy for the contract to check that it is not being cheated, a check that <em>has</em> to happen in the core contract (because we can be called by other entities than our periphery contract).</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amount0In </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> balance0 </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> _reserve0 </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> amount0Out </span><span class="token operator" style="color:#e09142">?</span><span class="token plain"> balance0 </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_reserve0 </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> amount0Out</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amount1In </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> balance1 </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> _reserve1 </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> amount1Out </span><span class="token operator" style="color:#e09142">?</span><span class="token plain"> balance1 </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_reserve1 </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amount0In </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">||</span><span class="token plain"> amount1In </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: INSUFFICIENT_INPUT_AMOUNT'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// scope for reserve{0,1}Adjusted, avoids stack too deep errors</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token builtin">uint</span><span class="token plain"> balance0Adjusted </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> balance0</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">1000</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sub</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amount0In</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">3</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token builtin">uint</span><span class="token plain"> balance1Adjusted </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">1000</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sub</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amount1In</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">3</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">balance0Adjusted</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">balance1Adjusted</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">1000</span><span class="token operator" style="color:#e09142">**</span><span class="token number" style="color:#e09142">2</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: K'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This is a sanity check to make sure we don't lose from the swap. There is no circumstance in which a swap should reduce <code>reserve0*reserve1</code>. This is also where we ensure a fee of 0.3% is being sent on the swap; before sanity checking the value of K, we multiply both balances by 1000 subtracted by the amounts multiplied by 3, this means 0.3% (3/1000 = 0.003 = 0.3%) is being deducted from the balance before comparing its K value with the current reserves K value.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_update</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">balance0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">emit</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">Swap</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount0In</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount1In</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount0Out</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Update <code>reserve0</code> and <code>reserve1</code>, and if necessary the price accumulators and the timestamp and emit an event.</p><h5 id="sync-or-skim">Sync or Skim</h5><p class="chakra-text css-1bpgf5e">It is possible for the real balances to get out of sync with the reserves that the pair exchange thinks it has.
There is no way to withdraw tokens without the contract's consent, but deposits are a different matter. An account can transfer tokens to the exchange without calling either <code>mint</code> or <code>swap</code>.</p><p class="chakra-text css-1bpgf5e">In that case there are two solutions:</p><ul role="list" class="css-tu0njr"><li class="css-0"><code>sync</code>, update the reserves to the current balances</li><li class="css-0"><code>skim</code>, withdraw the extra amount. Note that any account is allowed to call <code>skim</code> because we don't know who deposited the tokens. This information is emitted in an event, but events are not accessible from the blockchain.</li></ul><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// force balances to match reserves</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">skim</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> lock </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> _token0 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// gas savings</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> _token1 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// gas savings</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_safeTransfer</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sub</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserve0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_safeTransfer</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sub</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// force reserves to match balances</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">12</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">sync</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> lock </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">13</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_update</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">14</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">15</span><span class="css-2qghsv"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><h3 class="chakra-heading css-1a19hgi" id="uniswapv2factory" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="uniswapv2factory permalink" href="#uniswapv2factory"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>UniswapV2Factory.sol</h3><p class="chakra-text css-1bpgf5e"><a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://github.com/Uniswap/uniswap-v2-core/blob/master/contracts/UniswapV2Factory.sol">This contract<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a> creates the pair exchanges.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token keyword" style="color:#498bb5">pragma</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">solidity</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token number" style="color:#e09142">0.5</span><span class="token number" style="color:#e09142">.16</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'./interfaces/IUniswapV2Factory.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'./UniswapV2Pair.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">contract</span><span class="token plain"> </span><span class="token class-name">UniswapV2Factory</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">is</span><span class="token plain"> IUniswapV2Factory </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">address</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> feeTo</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">address</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> feeToSetter</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">These state variables are necessary to implement the protocol fee (see <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://uniswap.org/whitepaper.pdf">the whitepaper<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>, p. 5).
The <code>feeTo</code> address accumulates the liquidity tokens for the protocol fee, and <code>feeToSetter</code> is the address allowed to change <code>feeTo</code> to a different address.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">mapping</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">mapping</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=&gt;</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> getPair</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> allPairs</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">These variables keep track of the pairs, the exchanges between two token types.</p><p class="chakra-text css-1bpgf5e">The first one, <code>getPair</code>, is a mapping that identifies a pair exchange contract based on the two ERC-20 tokens it exchanges. ERC-20 tokens are identified by the addresses of the contracts that implement them, so the keys and the value are all addresses. To get the address of the pair exchange that lets you convert from <code>tokenA</code> to <code>tokenB</code>, you use <code>getPair[&lt;tokenA address&gt;][&lt;tokenB address&gt;]</code> (or the other way around).</p><p class="chakra-text css-1bpgf5e">The second variable, <code>allPairs</code>, is an array that includes all the addresses of pair exchanges created by this factory. In Ethereum you cannot iterate over the content of a mapping, or get a list of all the keys, so this variable is the only way to know which exchanges this factory manages.</p><p class="chakra-text css-1bpgf5e">Note: The reason you cannot iterate over all the keys of a mapping is that contract data storage is <em>expensive</em>, so the less of it we use the better, and the less often we change
it the better. You can create <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://github.com/ethereum/dapp-bin/blob/master/library/iterable_mapping.sol">mappings that support iteration<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>, but they require extra storage for a list of keys. In most applications you do not need that.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">event</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">PairCreated</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">indexed</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">indexed</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> pair</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This event is emitted when a new pair exchange is created. It includes the tokens' addresses, the pair exchange's address, and the total number of exchanges managed by the factory.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">constructor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> _feeToSetter</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        feeToSetter </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> _feeToSetter</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The only thing the constructor does is specify the <code>feeToSetter</code>. Factories start without a fee, and only <code>feeSetter</code> can change that.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">allPairsLength</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">view</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">return</span><span class="token plain"> allPairs</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function returns the number of exchange pairs.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">createPair</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> pair</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This is the main function of the factory, to create a pair exchange between two ERC-20 tokens. Note that anybody can call this function. You do not need permission from Uniswap to create a new pair exchange.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">tokenA </span><span class="token operator" style="color:#e09142">!=</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: IDENTICAL_ADDRESSES'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> tokenA </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> tokenB </span><span class="token operator" style="color:#e09142">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">tokenB</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">We want the address of the new exchange to be deterministic, so it can be calculated in advance off chain (this can be useful for <a class="chakra-link css-1f04442" data-inline-link="true" href="/en/developers/docs/scaling/">layer 2 transactions</a>).
To do this we need to have a consistent order of the token addresses, regardless of the order in which we have received them, so we sort them here.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token0 </span><span class="token operator" style="color:#e09142">!=</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: ZERO_ADDRESS'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">getPair</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">token0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">token1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: PAIR_EXISTS'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// single check is sufficient</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Large liquidity pools are better than small ones, because they have more stable prices. We don't want to have more than a single liquidity pool per pair of tokens. If there is already an exchange, there's no need to create another one for the same pair.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">bytes</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> bytecode </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">type</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">UniswapV2Pair</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">creationCode</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">To create a new contract we need the code that creates it (both the constructor function and code that writes to memory the EVM bytecode of the actual contract). Normally in Solidity we just use <code>addr = new &lt;name of contract&gt;(&lt;constructor parameters&gt;)</code> and the compiler takes care of everything for us, but to have a deterministic contract address we need to use <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://eips.ethereum.org/EIPS/eip-1014">the CREATE2 opcode<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>.
When this code was written that opcode was not yet supported by Solidity, so it was necessary to manually get the code. This is no longer an issue, because <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://docs.soliditylang.org/en/v0.8.3/control-structures.html#salted-contract-creations-create2">Solidity now supports CREATE2<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">bytes32</span><span class="token plain"> salt </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">keccak256</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">abi</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">encodePacked</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">assembly</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">            pair </span><span class="token operator" style="color:#e09142">:=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">create2</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">add</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">bytecode</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token number" style="color:#e09142">32</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">mload</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">bytecode</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> salt</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">When an opcode is not supported by Solidity yet we can call it using <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://docs.soliditylang.org/en/v0.8.3/assembly.html">inline assembly<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">IUniswapV2Pair</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">pair</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">initialize</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Call the <code>initialize</code> function to tell the new exchange what two tokens it exchanges.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        getPair</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">token0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">token1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> pair</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        getPair</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">token1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">token0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> pair</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// populate mapping in the reverse direction</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        allPairs</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">push</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">pair</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">emit</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">PairCreated</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> pair</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> allPairs</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Save the new pair information in the state variables and emit an event to inform the world of the new pair exchange.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">setFeeTo</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> _feeTo</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> feeToSetter</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: FORBIDDEN'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        feeTo </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> _feeTo</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">setFeeToSetter</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> _feeToSetter</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> feeToSetter</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: FORBIDDEN'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">        feeToSetter </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> _feeToSetter</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">These two functions allow <code>feeSetter</code> to control the fee recipient (if any), and to change <code>feeSetter</code> to a new address.</p><h3 class="chakra-heading css-1a19hgi" id="uniswapv2erc20" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="uniswapv2erc20 permalink" href="#uniswapv2erc20"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>UniswapV2ERC20.sol</h3><p class="chakra-text css-1bpgf5e"><a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://github.com/Uniswap/uniswap-v2-core/blob/master/contracts/UniswapV2ERC20.sol">This contract<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a> implements the ERC-20 liquidity token. It is similar to the <a class="chakra-link css-1f04442" data-inline-link="true" href="/en/developers/tutorials/erc20-annotated-code/">OpenZeppelin ERC-20 contract</a>, so I will only explain the part that is different, the <code>permit</code> functionality.</p><p class="chakra-text css-1bpgf5e">Transactions on Ethereum cost ether (ETH), which is equivalent to real money. If you have ERC-20 tokens but not ETH, you can't send transactions, so you can't do anything with them. One solution to avoid this problem is <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://docs.uniswap.org/contracts/v2/guides/smart-contract-integration/supporting-meta-transactions">meta-transactions<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>.
The owner of the tokens signs a transaction that allows somebody else to withdraw tokens off chain and sends it using the Internet to the recipient. The recipient, which does have ETH, then submits the permit on behalf of the owner.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">bytes32</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> DOMAIN_SEPARATOR</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// keccak256("Permit(address owner,address spender,uint256 value,uint256 nonce,uint256 deadline)");</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">bytes32</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">constant</span><span class="token plain"> PERMIT_TYPEHASH </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0x6e71edae12b1b97f4d1f60370fef10105fa2faae0126114a169c64845d6126c9</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This hash is the <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://eips.ethereum.org/EIPS/eip-712#rationale-for-typehash">identifier for the transaction type<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>. The only one we support here is <code>Permit</code> with these parameters.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">mapping</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=&gt;</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> nonces</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">It is not feasible for a recipient to fake a digital signature. However, it is trivial to send the same transaction twice (this is a form of <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://wikipedia.org/wiki/Replay_attack">replay attack<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>). To prevent this, we use a <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://wikipedia.org/wiki/Cryptographic_nonce">nonce<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>. If the nonce of a new <code>Permit</code> is not one more than the last one used, we assume it is invalid.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">constructor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> chainId</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">assembly</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">            chainId </span><span class="token operator" style="color:#e09142">:=</span><span class="token plain"> chainid</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This is the code to retrieve the <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://chainid.network/">chain identifier<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>. It uses an EVM assembly dialect called <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://docs.soliditylang.org/en/v0.8.4/yul.html">Yul<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>. Note that in the current version of Yul you have to use <code>chainid()</code>, not <code>chainid</code>.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        DOMAIN_SEPARATOR </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">keccak256</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">            abi</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">encode</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token function" style="color:#ff7324">keccak256</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#498bb5">'EIP712Domain(string name,string version,uint256 chainId,address verifyingContract)'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token function" style="color:#ff7324">keccak256</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">bytes</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token function" style="color:#ff7324">keccak256</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">bytes</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#498bb5">'1'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">                chainId</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Calculate the <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://eips.ethereum.org/EIPS/eip-712#rationale-for-domainseparator">domain separator<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a> for EIP-712.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">permit</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> owner</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> spender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> value</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint8</span><span class="token plain"> v</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">bytes32</span><span class="token plain"> r</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">bytes32</span><span class="token plain"> s</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This is the function that implements the permissions. It receives as parameters the relevant fields, and the three scalar values for <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://yos.io/2018/11/16/ethereum-signatures/">the signature<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a> (v, r, and s).</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">deadline </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token plain"> block</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: EXPIRED'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Don't accept transactions after the deadline.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">bytes32</span><span class="token plain"> digest </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">keccak256</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">            abi</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">encodePacked</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token string" style="color:#498bb5">'\x19\x01'</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">                DOMAIN_SEPARATOR</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token function" style="color:#ff7324">keccak256</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">abi</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">encode</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">PERMIT_TYPEHASH</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> owner</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> spender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> nonces</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">owner</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token operator" style="color:#e09142">++</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e"><code>abi.encodePacked(...)</code> is the message we expect to get. We know what the nonce should be, so there is no need for us to get it as a parameter.</p><p class="chakra-text css-1bpgf5e">The Ethereum signature algorithm expects to get 256 bits to sign, so we use the <code>keccak256</code> hash function.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> recoveredAddress </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">ecrecover</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">digest</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> r</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">From the digest and the signature we can get the address that signed it using <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://coders-errand.com/ecrecover-signature-verification-ethereum/">ecrecover<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">recoveredAddress </span><span class="token operator" style="color:#e09142">!=</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&amp;&amp;</span><span class="token plain"> recoveredAddress </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> owner</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2: INVALID_SIGNATURE'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_approve</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">owner</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> spender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">If everything is OK, treat this as <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://eips.ethereum.org/EIPS/eip-20#approve">an ERC-20 approve<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>.</p><h2 class="chakra-heading css-4y8d04" id="periphery-contracts" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="periphery contracts permalink" href="#periphery-contracts"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>The Periphery Contracts</h2><p class="chakra-text css-1bpgf5e">The periphery contracts are the API (application program interface) for Uniswap. They are available for external calls, either from other contracts or decentralized applications. You could call the core contracts directly, but that's more complicated and you might lose value if you make a mistake. The core contracts only contain tests to make sure they aren't cheated, not sanity checks for anybody else. Those are in the periphery so they can be updated as needed.</p><h3 class="chakra-heading css-1a19hgi" id="uniswapv2router01" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="uniswapv2router01 permalink" href="#uniswapv2router01"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>UniswapV2Router01.sol</h3><p class="chakra-text css-1bpgf5e"><a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://github.com/Uniswap/uniswap-v2-periphery/blob/master/contracts/UniswapV2Router01.sol">This contract<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a> has problems, and <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-01">should no longer be used<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>. Luckily, the periphery contracts are stateless and don't hold any assets, so it is easy to deprecate it and suggest people use the replacement, <code>UniswapV2Router02</code>, instead.</p><h3 class="chakra-heading css-1a19hgi" id="uniswapv2router02" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="uniswapv2router02 permalink" href="#uniswapv2router02"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>UniswapV2Router02.sol</h3><p class="chakra-text css-1bpgf5e">In most cases you would use Uniswap through <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://github.com/Uniswap/uniswap-v2-periphery/blob/master/contracts/UniswapV2Router02.sol">this contract<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>.
You can see how to use it <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02">here<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token keyword" style="color:#498bb5">pragma</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">solidity</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token number" style="color:#e09142">0.6</span><span class="token number" style="color:#e09142">.6</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'@uniswap/v2-core/contracts/interfaces/IUniswapV2Factory.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'@uniswap/lib/contracts/libraries/TransferHelper.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'./interfaces/IUniswapV2Router02.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'./libraries/UniswapV2Library.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'./libraries/SafeMath.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'./interfaces/IERC20.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'./interfaces/IWETH.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Most of these we either encountered before, or are fairly obvious. The one exception is <code>IWETH.sol</code>. Uniswap v2 allows exchanges for any pair of ERC-20 tokens, but ether (ETH) itself isn't an ERC-20 token. It predates the standard and is transferred by unique mechanisms. To enable the use of ETH in contracts that apply to ERC-20 tokens people came up with the <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://weth.tkn.eth.limo/">wrapped ether (WETH)<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a> contract. You send this contract ETH, and it mints you an equivalent amount of WETH. Or you can burn WETH, and get ETH back.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token keyword" style="color:#498bb5">contract</span><span class="token plain"> </span><span class="token class-name">UniswapV2Router02</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">is</span><span class="token plain"> IUniswapV2Router02 </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">using</span><span class="token plain"> </span><span class="token class-name">SafeMath</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">for</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">address</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> immutable override factory</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">address</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> immutable override WETH</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The router needs to know what factory to use, and for transactions that require WETH what WETH contract to use. These values are <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://docs.soliditylang.org/en/v0.8.3/contracts.html#constant-and-immutable-state-variables">immutable<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>, meaning they can only be set in the constructor. This gives users the confidence that nobody would be able to change them to point to less honest contracts.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">modifier</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">ensure</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">deadline </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token plain"> block</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: EXPIRED'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">_</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This modifier makes sure that time limited transactions ("do X before time Y if you can") don't happen after their time limit.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">constructor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> _factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> _WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        factory </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> _factory</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        WETH </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> _WETH</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The constructor just sets the immutable state variables.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token function" style="color:#ff7324">receive</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">payable</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">assert</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// only accept ETH via fallback from the WETH contract</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function is called when we redeem tokens from the WETH contract back into ETH. Only the WETH contract we use is authorized to do that.</p><h4 class="chakra-heading css-1w8u43l" id="add-liquidity" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="add liquidity permalink" href="#add-liquidity"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Add Liquidity</h4><p class="chakra-text css-1bpgf5e">These functions add tokens to the pair exchange, which increases the liquidity pool.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// **** ADD LIQUIDITY ****</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">_addLiquidity</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function is used to calculate the amount of A and B tokens that should be deposited into the pair exchange.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">These are the addresses of the ERC-20 token contracts.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountADesired</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountBDesired</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">These are the amounts the liquidity provider wants to deposit. They are also the maximum amounts of A and B to be deposited.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountAMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountBMin</span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">These are the minimum acceptable amounts to deposit. If the transaction cannot take place with these amounts or more, revert out of it. If you don't want this feature, just specify zero.</p><p class="chakra-text css-1bpgf5e">Liquidity providers specify a minimum, typically, because they want to limit the transaction to an exchange rate that is close to the current one. If the exchange rate fluctuates too much it might mean news that change the underlying values, and they want to decide manually what to do.</p><p class="chakra-text css-1bpgf5e">For example, imagine a case where the exchange rate is one to one and the liquidity provider specifies these values:</p><div class="chakra-table__container css-k002eo"><table class="chakra-table css-1u5689g"><thead class="css-rz7efy"><tr class="css-czbvy"><th class="css-jejxkf">Parameter</th><th class="css-9snn25">Value</th></tr></thead><tbody class="css-gabqlo"><tr class="css-czbvy"><td class="css-1ijcw7e">amountADesired</td><td class="css-1qt9prs">1000</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">amountBDesired</td><td class="css-1qt9prs">1000</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">amountAMin</td><td class="css-1qt9prs">900</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">amountBMin</td><td class="css-1qt9prs">800</td></tr></tbody></table></div><p class="chakra-text css-1bpgf5e">As long as the exchange rate stays between 0.9 and 1.25, the transaction takes place. If the exchange rate gets out of that range, the transaction gets cancelled.</p><p class="chakra-text css-1bpgf5e">The reason for this precaution is that transactions are not immediate, you submit them and eventually a validator is going to include them in a block (unless your gas price is very low, in which case you'll need to submit another transaction with the same nonce and a higher gas price to overwrite it). You cannot control what happens during the interval between submission and inclusion.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> virtual </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amountB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The function returns the amounts the liquidity provider should deposit to have a ratio equal to the current ratio between reserves.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// create the pair if it doesn't exist yet</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#ff7324">IUniswapV2Factory</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">getPair</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token function" style="color:#ff7324">IUniswapV2Factory</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">createPair</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">If there is no exchange for this token pair yet, create it.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> reserveA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">getReserves</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Get the current reserves in the pair.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserveA </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&amp;&amp;</span><span class="token plain"> reserveB </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountADesired</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountBDesired</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">If the current reserves are empty then this is a new pair exchange. The amounts to be deposited should be exactly the same as those the liquidity provider wants to provide.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token builtin">uint</span><span class="token plain"> amountBOptimal </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">quote</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountADesired</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">If we need to see what amounts will be, we get the optimal amount using <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://github.com/Uniswap/uniswap-v2-periphery/blob/master/contracts/libraries/UniswapV2Library.sol#L35">this function<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>. We want the same ratio as the current reserves.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountBOptimal </span><span class="token operator" style="color:#e09142">&lt;=</span><span class="token plain"> amountBDesired</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountBOptimal </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token plain"> amountBMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: INSUFFICIENT_B_AMOUNT'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountADesired</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountBOptimal</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">If <code>amountBOptimal</code> is smaller than the amount the liquidity provider wants to deposit it means that token B is more valuable currently than the liquidity depositor thinks, so a smaller amount is required.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token builtin">uint</span><span class="token plain"> amountAOptimal </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">quote</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountBDesired</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveB</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveA</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token keyword" style="color:#498bb5">assert</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountAOptimal </span><span class="token operator" style="color:#e09142">&lt;=</span><span class="token plain"> amountADesired</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountAOptimal </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token plain"> amountAMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: INSUFFICIENT_A_AMOUNT'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountAOptimal</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountBDesired</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">If the optimal B amount is more than the desired B amount it means B tokens are less valuable currently than the liquidity depositor thinks, so a higher amount is required. However, the desired amount is a maximum, so we cannot do that. Instead we calculate the optimal number of A tokens for the desired amount of B tokens.</p><p class="chakra-text css-1bpgf5e">Putting it all together we get this graph. Assume you're trying to deposit a thousand A tokens (blue line) and a thousand B tokens (red line). The x axis is the exchange rate, A/B. If x=1, they are equal in value and you deposit a thousand of each. If x=2, A is twice the value of B (you get two B tokens for each A token) so you deposit a thousand B tokens, but only 500 A tokens. If x=0.5, the situation is reversed, a thousand A tokens and five hundred B tokens.</p><p class="chakra-text css-1bpgf5e"><span class="css-1l4w6pd"><a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="/content/developers/tutorials/uniswap-v2-annotated-code/liquidityProviderDeposit.png"><img alt="Graph" loading="lazy" width="800" height="519.309262166405" decoding="async" data-nimg="1" class="css-1tgbn0p" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 519.309262166405'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3CfeColorMatrix values='1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1' result='s'/%3E%3CfeFlood x='0' y='0' width='100%25' height='100%25'/%3E%3CfeComposite operator='out' in='s'/%3E%3CfeComposite in2='SourceGraphic'/%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3C/filter%3E%3Cimage width='100%25' height='100%25' x='0' y='0' preserveAspectRatio='none' style='filter: url(%23b);' href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAKCAIAAAAy3EnLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA40lEQVR4nGMQFxd/9+7df6IBQ2x8wsYtOxYsWbZ4+So3F/cZkycvX7QID2JoamoG6nv//sO506fbmpqnz5oH5ALt/PzpE1bE0NjYCFTx79/f6ZMmAvk7d+9btXYDPidBNOzbvXvz+vUQIaAeoAtxeYxhwoQJQArodKDxcNHbd+4C9QB13r//AIuG29evw42Hg99//ly/cWvFqjVAFwIR0IhXr18DEUjDmqVLHz96hMvRQEuAqoE6IYghMS4OGD54fInuJEFu7nPnzgHt2bdv3/z58yHkOhiAsIEkMH7Z2Ng8PDwAzk+Ml89AhSAAAAAASUVORK5CYII='/%3E%3C/svg%3E&quot;)" srcset="/_next/image/?url=%2Fcontent%2Fdevelopers%2Ftutorials%2Funiswap-v2-annotated-code%2FliquidityProviderDeposit.png&amp;w=828&amp;q=75 1x, /_next/image/?url=%2Fcontent%2Fdevelopers%2Ftutorials%2Funiswap-v2-annotated-code%2FliquidityProviderDeposit.png&amp;w=1920&amp;q=75 2x" src="/_next/image/?url=%2Fcontent%2Fdevelopers%2Ftutorials%2Funiswap-v2-annotated-code%2FliquidityProviderDeposit.png&amp;w=1920&amp;q=75"></a></span></p><p class="chakra-text css-1bpgf5e">You could deposit liquidity directly into the core contract (using <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://github.com/Uniswap/uniswap-v2-core/blob/master/contracts/UniswapV2Pair.sol#L110">UniswapV2Pair::mint<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>), but the core contract only checks that it is not getting cheated itself, so you run the risk of losing value if the exchange rate changes between the time you submit your transaction and the time it is executed. If you use the periphery contract, it figures the amount you should deposit and deposits it immediately, so the exchange rate doesn't change and you don't lose anything.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">addLiquidity</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountADesired</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountBDesired</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountAMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountBMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> deadline</span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function can be called by a transaction to deposit liquidity. Most parameters are the same as in <code>_addLiquidity</code> above, with two exceptions:</p><p class="chakra-text css-1bpgf5e">. <code>to</code> is the address that gets the new liquidity tokens minted to show the liquidity provider's portion of the pool
. <code>deadline</code> is a time limit on the transaction</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> virtual override </span><span class="token function" style="color:#ff7324">ensure</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amountB</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">_addLiquidity</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountADesired</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountBDesired</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountAMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountBMin</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> pair </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">We calculate the amounts to actually deposit and then find the address of the liquidity pool. To save gas we don't do this by asking the factory, but using the library function <code>pairFor</code> (see below in libraries)</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransferFrom</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> pair</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountA</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransferFrom</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">tokenB</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> pair</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Transfer the correct amounts of tokens from the user into the pair exchange.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        liquidity </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IUniswapV2Pair</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">pair</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">In return give the <code>to</code> address liquidity tokens for partial ownership of the pool. The <code>mint</code> function of the core contract sees how many extra tokens it has (compared to what it had the last time liquidity changed) and mints liquidity accordingly.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">addLiquidityETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountTokenDesired</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">When a liquidity provider wants to provide liquidity to a Token/ETH pair exchange, there are a few differences. The contract handles wrapping the ETH for the liquidity provider. There is no need to specify how many ETH the user wants to deposit, because the user just sends them with the transaction (the amount is available in <code>msg.value</code>).</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountTokenMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountETHMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> deadline</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> virtual override </span><span class="token keyword" style="color:#498bb5">payable</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">ensure</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountToken</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amountETH</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountToken</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">_addLiquidity</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">            token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">            WETH</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">            amountTokenDesired</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">            msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">            amountTokenMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">12</span><span class="css-2qghsv"><span class="token plain">            amountETHMin</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">13</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">14</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> pair </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">15</span><span class="css-2qghsv"><span class="token plain">        TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransferFrom</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> pair</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountToken</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">16</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">IWETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">deposit</span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain">value</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> amountETH</span><span class="token punctuation" style="color:#6c6783">}</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">17</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">assert</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#ff7324">IWETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">transfer</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">pair</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">To deposit the ETH the contract first wraps it into WETH and then transfers the WETH into the pair. Notice that the transfer is wrapped in an <code>assert</code>. This means that if the transfer fails this contract call also fails, and therefore the wrapping doesn't really happen.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        liquidity </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IUniswapV2Pair</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">pair</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// refund dust eth, if any</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">value </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> amountETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransferETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">value </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> amountETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The user has already sent us the ETH, so if there is any extra left over (because the other token is less valuable than the user thought), we need to issue a refund.</p><h4 class="chakra-heading css-1w8u43l" id="remove-liquidity" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="remove liquidity permalink" href="#remove-liquidity"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Remove Liquidity</h4><p class="chakra-text css-1bpgf5e">These functions will remove liquidity and pay back the liquidity provider.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// **** REMOVE LIQUIDITY ****</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">removeLiquidity</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountAMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountBMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> deadline</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> virtual override </span><span class="token function" style="color:#ff7324">ensure</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amountB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The simplest case of removing liquidity. There is a minimum amount of each token the liquidity provider agrees to accept, and it must happen before the deadline.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> pair </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">IUniswapV2Pair</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">pair</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">transferFrom</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> pair</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// send liquidity to pair</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amount0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IUniswapV2Pair</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">pair</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">burn</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The core contract's <code>burn</code> function handles paying the user back the tokens.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sortTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">When a function returns multiple values, but we are only interested in some of them, this is how we only get those values. It is somewhat cheaper in gas terms than reading a value and never using it.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> tokenA </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> token0 </span><span class="token operator" style="color:#e09142">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amount0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amount1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Translate the amounts from the way the core contract returns them (lower address token first) to the way the user expects them (corresponding to <code>tokenA</code> and <code>tokenB</code>).</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountA </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token plain"> amountAMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: INSUFFICIENT_A_AMOUNT'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountB </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token plain"> amountBMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: INSUFFICIENT_B_AMOUNT'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">It is OK to do the transfer first and then verify it is legitimate, because if it isn't we'll revert out of all the state changes.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">removeLiquidityETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountTokenMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountETHMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> deadline</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> virtual override </span><span class="token function" style="color:#ff7324">ensure</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountToken</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amountETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountToken</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">removeLiquidity</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">            token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">            WETH</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">12</span><span class="css-2qghsv"><span class="token plain">            liquidity</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">13</span><span class="css-2qghsv"><span class="token plain">            amountTokenMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">14</span><span class="css-2qghsv"><span class="token plain">            amountETHMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">15</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">16</span><span class="css-2qghsv"><span class="token plain">            deadline</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">17</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">18</span><span class="css-2qghsv"><span class="token plain">        TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransfer</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountToken</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">19</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">IWETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">withdraw</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">20</span><span class="css-2qghsv"><span class="token plain">        TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransferETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">21</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Remove liquidity for ETH is almost the same, except that we receive the WETH tokens and then redeem them for ETH to give back to the liquidity provider.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">removeLiquidityWithPermit</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountAMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountBMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">bool</span><span class="token plain"> approveMax</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint8</span><span class="token plain"> v</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">bytes32</span><span class="token plain"> r</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">bytes32</span><span class="token plain"> s</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> virtual override </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amountB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> pair </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">12</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> value </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> approveMax </span><span class="token operator" style="color:#e09142">?</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">-</span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">13</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">IUniswapV2Pair</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">pair</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">permit</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> r</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">14</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">removeLiquidity</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountAMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountBMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">15</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">16</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">17</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">18</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">removeLiquidityETHWithPermit</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">19</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">20</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">21</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountTokenMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">22</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountETHMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">23</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">24</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">25</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">bool</span><span class="token plain"> approveMax</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint8</span><span class="token plain"> v</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">bytes32</span><span class="token plain"> r</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">bytes32</span><span class="token plain"> s</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">26</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> virtual override </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountToken</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amountETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">27</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> pair </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">28</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> value </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> approveMax </span><span class="token operator" style="color:#e09142">?</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">-</span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">29</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">IUniswapV2Pair</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">pair</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">permit</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> r</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">30</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountToken</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">removeLiquidityETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountTokenMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountETHMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">31</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">These functions relay meta-transactions to allow users without ether to withdraw from the pool, using <a class="chakra-link css-1f04442" data-inline-link="true" href="#UniswapV2ERC20">the permit mechanism</a>.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// **** REMOVE LIQUIDITY (supporting fee-on-transfer tokens) ****</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">removeLiquidityETHSupportingFeeOnTransferTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountTokenMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountETHMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> deadline</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> virtual override </span><span class="token function" style="color:#ff7324">ensure</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">removeLiquidity</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">12</span><span class="css-2qghsv"><span class="token plain">            token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">13</span><span class="css-2qghsv"><span class="token plain">            WETH</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">14</span><span class="css-2qghsv"><span class="token plain">            liquidity</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">15</span><span class="css-2qghsv"><span class="token plain">            amountTokenMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">16</span><span class="css-2qghsv"><span class="token plain">            amountETHMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">17</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">18</span><span class="css-2qghsv"><span class="token plain">            deadline</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">19</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">20</span><span class="css-2qghsv"><span class="token plain">        TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransfer</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">21</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">IWETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">withdraw</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">22</span><span class="css-2qghsv"><span class="token plain">        TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransferETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">23</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">24</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function can be used for tokens that have transfer or storage fees. When a token has such fees we cannot rely on the <code>removeLiquidity</code> function to tell us how much of the token we get back, so we need to withdraw first and then get the balance.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">removeLiquidityETHWithPermitSupportingFeeOnTransferTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountTokenMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountETHMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">bool</span><span class="token plain"> approveMax</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint8</span><span class="token plain"> v</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">bytes32</span><span class="token plain"> r</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">bytes32</span><span class="token plain"> s</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> virtual override </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">12</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> pair </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">13</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> value </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> approveMax </span><span class="token operator" style="color:#e09142">?</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">-</span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">14</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">IUniswapV2Pair</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">pair</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">permit</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> r</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">15</span><span class="css-2qghsv"><span class="token plain">        amountETH </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">removeLiquidityETHSupportingFeeOnTransferTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">16</span><span class="css-2qghsv"><span class="token plain">            token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountTokenMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountETHMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> deadline</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">17</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">18</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The final function combines storage fees with meta-transactions.</p><h4 class="chakra-heading css-1w8u43l" id="trade" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="trade permalink" href="#trade"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Trade</h4><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// **** SWAP ****</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// requires the initial amount to have already been sent to the first pair</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">_swap</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> _to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> virtual </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function performs internal processing that is required for the functions that are exposed to traders.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> i</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> i </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> i</span><span class="token operator" style="color:#e09142">++</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">As I'm writing this there are <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://etherscan.io/tokens">388,160 ERC-20 tokens<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>. If there was a pair exchange for each token pair, it would be over a 150 billion pair exchanges. The entire chain, at the moment, <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://etherscan.io/chart/address">only has 0.1% that number of accounts<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>. Instead, the swap functions support the concept of a path. A trader can exchange A for B, B for C, and C for D, so there is no need for a direct A-D pair exchange.</p><p class="chakra-text css-1bpgf5e">The prices on these markets tend to be synchronized, because when they are out of sync it creates an opportunity for arbitrage. Imagine, for example, three tokens, A, B, and C. There are three pair exchanges, one for each pair.</p><ol role="list" class="css-1dg6mvm"><li class="css-0">The initial situation</li><li class="css-0">A trader sells 24.695 A tokens and gets 25.305 B tokens.</li><li class="css-0">The trader sells 24.695 B tokens for 25.305 C tokens, keeping approximately 0.61 B tokens as profit.</li><li class="css-0">Then the trader sells 24.695 C tokens for 25.305 A tokens, keeping approximately 0.61 C tokens as profit. The trader also has 0.61 extra A tokens (the 25.305 the trader ends up with, minus the original investment of 24.695).</li></ol><div class="chakra-table__container css-k002eo"><table class="chakra-table css-1u5689g"><thead class="css-rz7efy"><tr class="css-czbvy"><th class="css-jejxkf">Step</th><th class="css-jejxkf">A-B Exchange</th><th class="css-jejxkf">B-C Exchange</th><th class="css-jejxkf">A-C Exchange</th></tr></thead><tbody class="css-gabqlo"><tr class="css-czbvy"><td class="css-1ijcw7e">1</td><td class="css-1ijcw7e">A:1000 B:1050 A/B=1.05</td><td class="css-1ijcw7e">B:1000 C:1050 B/C=1.05</td><td class="css-1ijcw7e">A:1050 C:1000 C/A=1.05</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">2</td><td class="css-1ijcw7e">A:1024.695 B:1024.695 A/B=1</td><td class="css-1ijcw7e">B:1000 C:1050 B/C=1.05</td><td class="css-1ijcw7e">A:1050 C:1000 C/A=1.05</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">3</td><td class="css-1ijcw7e">A:1024.695 B:1024.695 A/B=1</td><td class="css-1ijcw7e">B:1024.695 C:1024.695 B/C=1</td><td class="css-1ijcw7e">A:1050 C:1000 C/A=1.05</td></tr><tr class="css-czbvy"><td class="css-1ijcw7e">4</td><td class="css-1ijcw7e">A:1024.695 B:1024.695 A/B=1</td><td class="css-1ijcw7e">B:1024.695 C:1024.695 B/C=1</td><td class="css-1ijcw7e">A:1024.695 C:1024.695 C/A=1</td></tr></tbody></table></div><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> input</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> output</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">i </span><span class="token operator" style="color:#e09142">+</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sortTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> output</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token builtin">uint</span><span class="token plain"> amountOut </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">i </span><span class="token operator" style="color:#e09142">+</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Get the pair we are currently handling, sort it (for use with the pair) and get the expected output amount.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amount0Out</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> input </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> token0 </span><span class="token operator" style="color:#e09142">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountOut</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Get the expected out amounts, sorted the way the pair exchange expects them to be.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token builtin">address</span><span class="token plain"> to </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> i </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">2</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">?</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> output</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">i </span><span class="token operator" style="color:#e09142">+</span><span class="token plain"> </span><span class="token number" style="color:#e09142">2</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> _to</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Is this the last exchange? If so, send the tokens received for the trade to the destination. If not, send it to the next pair exchange.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token function" style="color:#ff7324">IUniswapV2Pair</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> input</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> output</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">swap</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">                amount0Out</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">new</span><span class="token plain"> </span><span class="token class-name">bytes</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Actually call the pair exchange to swap the tokens. We don't need a callback to be told about the exchange, so we don't send any bytes in that field.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">swapExactTokensForTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function is used directly by traders to swap one token for another.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountOutMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">calldata</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This parameter contains the addresses of the ERC-20 contracts. As explained above, this is an array because you might need to go through several pair exchanges to get from the asset you have to the asset you want.</p><p class="chakra-text css-1bpgf5e">A function parameter in solidity can be stored either in <code>memory</code> or the <code>calldata</code>. If the function is an entry point to the contract, called directly from a user (using a transaction) or from a different contract, then the parameter's value can be taken directly from the call data. If the function is called internally, as <code>_swap</code> above, then the parameters have to be stored in <code>memory</code>. From the perspective of the called contract <code>calldata</code> is read only.</p><p class="chakra-text css-1bpgf5e">With scalar types such as <code>uint</code> or <code>address</code> the compiler handles the choice of storage for us, but with arrays, which are longer and more expensive, we specify the type of storage to be used.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> deadline</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> virtual override </span><span class="token function" style="color:#ff7324">ensure</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Return values are always returned in memory.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        amounts </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">getAmountsOut</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token plain"> amountOutMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Calculate the amount to be purchased in each swap. If the result is less than the minimum the trader is willing to accept, revert out of the transaction.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransferFrom</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">            path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_swap</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Finally, transfer the initial ERC-20 token to the account for the first pair exchange and call <code>_swap</code>. This is all happening in the same transaction, so the pair exchange knows that any unexpected tokens are part of this transfer.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">swapTokensForExactTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountOut</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountInMax</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">calldata</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> deadline</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> virtual override </span><span class="token function" style="color:#ff7324">ensure</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">        amounts </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">getAmountsIn</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountOut</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&lt;=</span><span class="token plain"> amountInMax</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: EXCESSIVE_INPUT_AMOUNT'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">        TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransferFrom</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">            path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">12</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">13</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_swap</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">14</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The previous function, <code>swapTokensForTokens</code>, allows a trader to specify an exact number of input tokens he is willing to give and the minimum number of output tokens he is willing to receive in return. This function does the reverse swap, it lets a trader specify the number of output tokens he wants, and the maximum number of input tokens he is willing to pay for them.</p><p class="chakra-text css-1bpgf5e">In both cases, the trader has to give this periphery contract first an allowance to allow it to transfer them.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">swapExactETHForTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountOutMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">calldata</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        virtual</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        override</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">payable</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">ensure</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> WETH</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: INVALID_PATH'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">        amounts </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">getAmountsOut</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token plain"> amountOutMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">12</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">IWETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">deposit</span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain">value</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">}</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">13</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">assert</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#ff7324">IWETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">transfer</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">14</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_swap</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">15</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">16</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">17</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">18</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">swapTokensForExactETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountOut</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amountInMax</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">calldata</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">19</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">20</span><span class="css-2qghsv"><span class="token plain">        virtual</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">21</span><span class="css-2qghsv"><span class="token plain">        override</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">22</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">ensure</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">23</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">24</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">25</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> WETH</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: INVALID_PATH'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">26</span><span class="css-2qghsv"><span class="token plain">        amounts </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">getAmountsIn</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountOut</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">27</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&lt;=</span><span class="token plain"> amountInMax</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: EXCESSIVE_INPUT_AMOUNT'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">28</span><span class="css-2qghsv"><span class="token plain">        TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransferFrom</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">29</span><span class="css-2qghsv"><span class="token plain">            path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">30</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">31</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_swap</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">32</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">IWETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">withdraw</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">33</span><span class="css-2qghsv"><span class="token plain">        TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransferETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">34</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">35</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">36</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">37</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">38</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">swapExactTokensForETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amountOutMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">calldata</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">39</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">40</span><span class="css-2qghsv"><span class="token plain">        virtual</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">41</span><span class="css-2qghsv"><span class="token plain">        override</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">42</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">ensure</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">43</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">44</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">45</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> WETH</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: INVALID_PATH'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">46</span><span class="css-2qghsv"><span class="token plain">        amounts </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">getAmountsOut</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">47</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token plain"> amountOutMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">48</span><span class="css-2qghsv"><span class="token plain">        TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransferFrom</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">49</span><span class="css-2qghsv"><span class="token plain">            path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">50</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">51</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_swap</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">52</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">IWETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">withdraw</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">53</span><span class="css-2qghsv"><span class="token plain">        TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransferETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">54</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">55</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">56</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">57</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">swapETHForExactTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountOut</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">calldata</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">58</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">59</span><span class="css-2qghsv"><span class="token plain">        virtual</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">60</span><span class="css-2qghsv"><span class="token plain">        override</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">61</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">payable</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">62</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">ensure</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">63</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">64</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">65</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> WETH</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: INVALID_PATH'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">66</span><span class="css-2qghsv"><span class="token plain">        amounts </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">getAmountsIn</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountOut</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">67</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&lt;=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: EXCESSIVE_INPUT_AMOUNT'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">68</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">IWETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">deposit</span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain">value</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">}</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">69</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">assert</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#ff7324">IWETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">transfer</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">70</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_swap</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">71</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// refund dust eth, if any</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">72</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">value </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransferETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">value </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">73</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">These four variants all involve trading between ETH and tokens. The only difference is that we either receive ETH from the trader and use it to mint WETH, or we receive WETH from the last exchange in the path and burn it, sending the trader back the resulting ETH.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// **** SWAP (supporting fee-on-transfer tokens) ****</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// requires the initial amount to have already been sent to the first pair</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">_swapSupportingFeeOnTransferTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> _to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> virtual </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This is the internal function to swap tokens that have transfer or storage fees to solve (<a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://github.com/Uniswap/uniswap-interface/issues/835">this issue<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>).</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> i</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> i </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> i</span><span class="token operator" style="color:#e09142">++</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> input</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> output</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">i </span><span class="token operator" style="color:#e09142">+</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sortTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> output</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">            IUniswapV2Pair pair </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IUniswapV2Pair</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> input</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> output</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token builtin">uint</span><span class="token plain"> amountInput</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token builtin">uint</span><span class="token plain"> amountOutput</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// scope to avoid stack too deep errors</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserve1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> pair</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">getReserves</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> reserveInput</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveOutput</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> input </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> token0 </span><span class="token operator" style="color:#e09142">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserve1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserve0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">            amountInput </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">pair</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sub</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserveInput</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">            amountOutput </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">getAmountOut</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountInput</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveInput</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveOutput</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Because of the transfer fees we cannot rely on the <code>getAmountsOut</code> function to tell us how much we get out of each transfer (the way we do before calling the original <code>_swap</code>). Instead we have to transfer first and then see how many tokens we got back.</p><p class="chakra-text css-1bpgf5e">Note: In theory we could just use this function instead of <code>_swap</code>, but in certain cases (for example, if the transfer ends up being reverted because there isn't enough at the end to meet the required minimum) that would end up costing more gas. Transfer fee tokens are pretty rare, so while we need to accommodate them there's no need to all swaps to assume they go through at least one of them.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amount0Out</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> input </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> token0 </span><span class="token operator" style="color:#e09142">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountOutput</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountOutput</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token builtin">address</span><span class="token plain"> to </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> i </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">2</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">?</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> output</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">i </span><span class="token operator" style="color:#e09142">+</span><span class="token plain"> </span><span class="token number" style="color:#e09142">2</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> _to</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">            pair</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">swap</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amount0Out</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">new</span><span class="token plain"> </span><span class="token class-name">bytes</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">swapExactTokensForTokensSupportingFeeOnTransferTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountOutMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">12</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">calldata</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">13</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">14</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> deadline</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">15</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"> virtual override </span><span class="token function" style="color:#ff7324">ensure</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">16</span><span class="css-2qghsv"><span class="token plain">        TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransferFrom</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">17</span><span class="css-2qghsv"><span class="token plain">            path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountIn</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">18</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">19</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> balanceBefore </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">20</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_swapSupportingFeeOnTransferTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">21</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">22</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sub</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">balanceBefore</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token plain"> amountOutMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">23</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token string" style="color:#498bb5">'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT'</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">24</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">25</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">26</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">27</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">28</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">swapExactETHForTokensSupportingFeeOnTransferTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">29</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountOutMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">30</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">calldata</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">31</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">32</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> deadline</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">33</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">34</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">35</span><span class="css-2qghsv"><span class="token plain">        virtual</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">36</span><span class="css-2qghsv"><span class="token plain">        override</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">37</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">payable</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">38</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">ensure</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">39</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">40</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> WETH</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: INVALID_PATH'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">41</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountIn </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">42</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">IWETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">deposit</span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain">value</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">}</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">43</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">assert</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#ff7324">IWETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">transfer</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">44</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> balanceBefore </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">45</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_swapSupportingFeeOnTransferTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">46</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">47</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sub</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">balanceBefore</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token plain"> amountOutMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">48</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token string" style="color:#498bb5">'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT'</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">49</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">50</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">51</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">52</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">53</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">swapExactTokensForETHSupportingFeeOnTransferTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">54</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">55</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountOutMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">56</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">calldata</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">57</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">58</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> deadline</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">59</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">60</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">external</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">61</span><span class="css-2qghsv"><span class="token plain">        virtual</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">62</span><span class="css-2qghsv"><span class="token plain">        override</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">63</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">ensure</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">deadline</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">64</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">65</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> WETH</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: INVALID_PATH'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">66</span><span class="css-2qghsv"><span class="token plain">        TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransferFrom</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">67</span><span class="css-2qghsv"><span class="token plain">            path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountIn</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">68</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">69</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">_swapSupportingFeeOnTransferTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">70</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountOut </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IERC20</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">balanceOf</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">this</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">71</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountOut </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token plain"> amountOutMin</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">72</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token function" style="color:#ff7324">IWETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">WETH</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">withdraw</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">73</span><span class="css-2qghsv"><span class="token plain">        TransferHelper</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">safeTransferETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">74</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">These are the same variants used for normal tokens, but they call <code>_swapSupportingFeeOnTransferTokens</code> instead.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// **** LIBRARY FUNCTIONS ****</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">quote</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">pure</span><span class="token plain"> virtual override </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">return</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">quote</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getAmountOut</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">pure</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">        virtual</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">        override</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">12</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">13</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">return</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">getAmountOut</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">14</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">15</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">16</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getAmountIn</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountOut</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">17</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">18</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">pure</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">19</span><span class="css-2qghsv"><span class="token plain">        virtual</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">20</span><span class="css-2qghsv"><span class="token plain">        override</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">21</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">22</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">23</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">return</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">getAmountIn</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountOut</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">24</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">25</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">26</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getAmountsOut</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">27</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">28</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">view</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">29</span><span class="css-2qghsv"><span class="token plain">        virtual</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">30</span><span class="css-2qghsv"><span class="token plain">        override</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">31</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">32</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">33</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">return</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">getAmountsOut</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">34</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">35</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">36</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getAmountsIn</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountOut</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">37</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">public</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">38</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">view</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">39</span><span class="css-2qghsv"><span class="token plain">        virtual</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">40</span><span class="css-2qghsv"><span class="token plain">        override</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">41</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">42</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">43</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">return</span><span class="token plain"> UniswapV2Library</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">getAmountsIn</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> amountOut</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">44</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">45</span><span class="css-2qghsv"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">These functions are just proxies that call the <a class="chakra-link css-1f04442" data-inline-link="true" href="#uniswapV2library">UniswapV2Library functions</a>.</p><h3 class="chakra-heading css-1a19hgi" id="uniswapv2migrator" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="uniswapv2migrator permalink" href="#uniswapv2migrator"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>UniswapV2Migrator.sol</h3><p class="chakra-text css-1bpgf5e">This contract was used to migrate exchanges from the old v1 to v2. Now that they have been migrated, it is no longer relevant.</p><h2 class="chakra-heading css-4y8d04" id="libraries" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="libraries permalink" href="#libraries"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>The Libraries</h2><p class="chakra-text css-1bpgf5e">The <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://docs.openzeppelin.com/contracts/2.x/api/math">SafeMath library<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a> is well documented, so there's no need to document it here.</p><h3 class="chakra-heading css-1a19hgi" id="math" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="math permalink" href="#math"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Math</h3><p class="chakra-text css-1bpgf5e">This library contains some math functions that are not normally needed in Solidity code, so they aren't part of the language.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token keyword" style="color:#498bb5">pragma</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">solidity</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token number" style="color:#e09142">0.5</span><span class="token number" style="color:#e09142">.16</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// a library for performing various math operations</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">library</span><span class="token plain"> </span><span class="token class-name">Math</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">min</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> x</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> y</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">pure</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> z</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        z </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> x </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> y </span><span class="token operator" style="color:#e09142">?</span><span class="token plain"> x </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> y</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// babylonian method (https://wikipedia.org/wiki/Methods_of_computing_square_roots#Babylonian_method)</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">sqrt</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> y</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">pure</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> z</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">12</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">y </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">3</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">13</span><span class="css-2qghsv"><span class="token plain">            z </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> y</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">14</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token builtin">uint</span><span class="token plain"> x </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> y </span><span class="token operator" style="color:#e09142">/</span><span class="token plain"> </span><span class="token number" style="color:#e09142">2</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">+</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Start with x as an estimate that is higher than the square root (that is the reason we need to treat 1-3 as special cases).</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token keyword" style="color:#498bb5">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">x </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> z</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">                z </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> x</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">                x </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">y </span><span class="token operator" style="color:#e09142">/</span><span class="token plain"> x </span><span class="token operator" style="color:#e09142">+</span><span class="token plain"> x</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">/</span><span class="token plain"> </span><span class="token number" style="color:#e09142">2</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Get a closer estimate, the average of the previous estimate and the number whose square root we're trying to find divided by the previous estimate. Repeat until the new estimate isn't lower than the existing one. For more details, <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://wikipedia.org/wiki/Methods_of_computing_square_roots#Babylonian_method">see here<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">else</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">y </span><span class="token operator" style="color:#e09142">!=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">            z </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">We should never need the square root of zero. The square roots of one, two, and three are roughly one (we use integers, so we ignore the fraction).</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><h3 class="chakra-heading css-1a19hgi" id="fixedpoint" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="fixedpoint permalink" href="#fixedpoint"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Fixed Point Fractions (UQ112x112)</h3><p class="chakra-text css-1bpgf5e">This library handles fractions, which are normally not part of Ethereum arithmetic. It does this by encoding the number <em>x</em> as <em>x<!-- -->*<!-- -->2^112</em>. This lets us use the original addition and subtraction opcodes without a change.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token keyword" style="color:#498bb5">pragma</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">solidity</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token number" style="color:#e09142">0.5</span><span class="token number" style="color:#e09142">.16</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// a library for handling binary fixed point numbers (https://wikipedia.org/wiki/Q_(number_format))</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// range: [0, 2**112 - 1]</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// resolution: 1 / 2**112</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">library</span><span class="token plain"> </span><span class="token class-name">UQ112x112</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token builtin">uint224</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">constant</span><span class="token plain"> Q112 </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">2</span><span class="token operator" style="color:#e09142">**</span><span class="token number" style="color:#e09142">112</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e"><code>Q112</code> is the encoding for one.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// encode a uint112 as a UQ112x112</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">encode</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint112</span><span class="token plain"> y</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">pure</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint224</span><span class="token plain"> z</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        z </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token builtin">uint224</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">y</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">*</span><span class="token plain"> Q112</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// never overflows</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Because y is <code>uint112</code>, the most it can be is 2^112-1. That number can still be encoded as a <code>UQ112x112</code>.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// divide a UQ112x112 by a uint112, returning a UQ112x112</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">uqdiv</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint224</span><span class="token plain"> x</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint112</span><span class="token plain"> y</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">pure</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint224</span><span class="token plain"> z</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        z </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> x </span><span class="token operator" style="color:#e09142">/</span><span class="token plain"> </span><span class="token builtin">uint224</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">y</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">If we divide two <code>UQ112x112</code> values, the result is no longer multiplied by 2^112. So instead we take an integer for the denominator. We would have needed to use a similar trick to do multiplication, but we don't need to do multiplication of <code>UQ112x112</code> values.</p><h3 class="chakra-heading css-1a19hgi" id="uniswapv2library" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="uniswapv2library permalink" href="#uniswapv2library"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>UniswapV2Library</h3><p class="chakra-text css-1bpgf5e">This library is used only by the periphery contracts</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token keyword" style="color:#498bb5">pragma</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">solidity</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token version number" style="color:#e09142">0.5.0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'@uniswap/v2-core/contracts/interfaces/IUniswapV2Pair.sol'</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">import</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">"./SafeMath.sol"</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">library</span><span class="token plain"> </span><span class="token class-name">UniswapV2Library</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">using</span><span class="token plain"> </span><span class="token class-name">SafeMath</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">for</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// returns sorted token addresses, used to handle return values from pairs sorted in this order</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">sortTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">pure</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">12</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">tokenA </span><span class="token operator" style="color:#e09142">!=</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Library: IDENTICAL_ADDRESSES'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">13</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> tokenA </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> tokenB </span><span class="token operator" style="color:#e09142">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">tokenB</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">14</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token0 </span><span class="token operator" style="color:#e09142">!=</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Library: ZERO_ADDRESS'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">15</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Sort the two tokens by address, so we'll be able to get the address of the pair exchange for them. This is necessary because otherwise we'd have two possibilities, one for the parameters A,B and another for the parameters B,A, leading to two exchanges instead of one.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// calculates the CREATE2 address for a pair without making any external calls</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">pure</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> pair</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">sortTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        pair </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#ff7324">keccak256</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">abi</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">encodePacked</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">                hex</span><span class="token string" style="color:#498bb5">'ff'</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">                factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">                </span><span class="token function" style="color:#ff7324">keccak256</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">abi</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">encodePacked</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">                hex</span><span class="token string" style="color:#498bb5">'96e8ac4277198ff8b6f785478aa9a39f403cb768dd02cbee326c3e7da348845f'</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// init code hash</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function calculates the address of the pair exchange for the two tokens. This contract is created using <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://eips.ethereum.org/EIPS/eip-1014">the CREATE2 opcode<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>, so we can calculate the address using the same algorithm if we know the parameters it uses. This is a lot cheaper than asking the factory, and</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// fetches and sorts the reserves for a pair</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getReserves</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">view</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> reserveA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">sortTokens</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserve1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">IUniswapV2Pair</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#ff7324">pairFor</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">getReserves</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserveA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> tokenA </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> token0 </span><span class="token operator" style="color:#e09142">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserve0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserve1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserve1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserve0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function returns the reserves of the two tokens that the pair exchange has. Note that it can receive the tokens in either order, and sorts them for internal use.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// given some amount of an asset and pair reserves, returns an equivalent amount of the other asset</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">quote</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveA</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">pure</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountA </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Library: INSUFFICIENT_AMOUNT'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserveA </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&amp;&amp;</span><span class="token plain"> reserveB </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Library: INSUFFICIENT_LIQUIDITY'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        amountB </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> amountA</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserveB</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">/</span><span class="token plain"> reserveA</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function gives you the amount of token B you'll get in return for token A if there is no fee involved. This calculation takes into account that the transfer changes the exchange rate.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// given an input amount of an asset and pair reserves, returns the maximum output amount of the other asset</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getAmountOut</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">pure</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">The <code>quote</code> function above works great if there is no fee to use the pair exchange. However, if there is a 0.3% exchange fee the amount you actually get is lower. This function calculates the amount after the exchange fee.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountIn </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Library: INSUFFICIENT_INPUT_AMOUNT'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserveIn </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&amp;&amp;</span><span class="token plain"> reserveOut </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Library: INSUFFICIENT_LIQUIDITY'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> amountInWithFee </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">997</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> numerator </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> amountInWithFee</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserveOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> denominator </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> reserveIn</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">1000</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">add</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountInWithFee</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        amountOut </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> numerator </span><span class="token operator" style="color:#e09142">/</span><span class="token plain"> denominator</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">Solidity does not handle fractions natively, so we can't just multiply the amount out by 0.997. Instead, we multiply the numerator by 997 and the denominator by 1000, achieving the same effect.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// given an output amount of an asset and pair reserves, returns a required input amount of the other asset</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getAmountIn</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountOut</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">pure</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountOut </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Library: INSUFFICIENT_OUTPUT_AMOUNT'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">reserveIn </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&amp;&amp;</span><span class="token plain"> reserveOut </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Library: INSUFFICIENT_LIQUIDITY'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> numerator </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> reserveIn</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">1000</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token plain"> denominator </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> reserveOut</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">sub</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amountOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">mul</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">997</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        amountIn </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">numerator </span><span class="token operator" style="color:#e09142">/</span><span class="token plain"> denominator</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">add</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function does roughly the same thing, but it gets the output amount and provides the input.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// performs chained getAmountOut calculations on any number of pairs</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getAmountsOut</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">view</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">2</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Library: INVALID_PATH'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        amounts </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">new</span><span class="token plain"> </span><span class="token class-name">uint</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> amountIn</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> i</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> i </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> i</span><span class="token operator" style="color:#e09142">++</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> reserveIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getReserves</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">i </span><span class="token operator" style="color:#e09142">+</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">            amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">i </span><span class="token operator" style="color:#e09142">+</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getAmountOut</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">12</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">13</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// performs chained getAmountIn calculations on any number of pairs</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">14</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getAmountsIn</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> amountOut</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">view</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">15</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">2</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'UniswapV2Library: INVALID_PATH'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">16</span><span class="css-2qghsv"><span class="token plain">        amounts </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">new</span><span class="token plain"> </span><span class="token class-name">uint</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">17</span><span class="css-2qghsv"><span class="token plain">        amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> amountOut</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">18</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> i </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> i </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> i</span><span class="token operator" style="color:#e09142">--</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">19</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">uint</span><span class="token plain"> reserveIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint</span><span class="token plain"> reserveOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getReserves</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">i </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">20</span><span class="css-2qghsv"><span class="token plain">            amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">i </span><span class="token operator" style="color:#e09142">-</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">getAmountIn</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amounts</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveIn</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> reserveOut</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">21</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">22</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">23</span><span class="css-2qghsv"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">These two functions handle identifying the values when it is necessary to go through several pair exchanges.</p><h3 class="chakra-heading css-1a19hgi" id="transfer-helper" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="transfer helper permalink" href="#transfer-helper"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Transfer Helper</h3><p class="chakra-text css-1bpgf5e"><a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://github.com/Uniswap/uniswap-lib/blob/master/contracts/libraries/TransferHelper.sol">This library<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a> adds success checks around ERC-20 and Ethereum transfers to treat a revert and a <code>false</code> value return the same way.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token comment" style="color:#6c6783">// SPDX-License-Identifier: GPL-3.0-or-later</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">pragma</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">solidity</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token version number" style="color:#e09142">0.6.0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// helper methods for interacting with ERC20 tokens and sending ETH that do not consistently return true/false</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain"></span><span class="token keyword" style="color:#498bb5">library</span><span class="token plain"> </span><span class="token class-name">TransferHelper</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">safeApprove</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint256</span><span class="token plain"> value</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">12</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// bytes4(keccak256(bytes('approve(address,uint256)')));</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">13</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">bool</span><span class="token plain"> success</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">bytes</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> data</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">call</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">abi</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">encodeWithSelector</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0x095ea7b3</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">14</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">We can call a different contract in one of two ways:</p><ul role="list" class="css-tu0njr"><li class="css-0">Use an interface definition to create a function call</li><li class="css-0">Use the <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://docs.soliditylang.org/en/v0.8.3/abi-spec.html">application binary interface (ABI)<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a> "manually" to create the call. This is what the author of the code decided to do it.</li></ul><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">            success </span><span class="token operator" style="color:#e09142">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">||</span><span class="token plain"> abi</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">decode</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">bool</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token string" style="color:#498bb5">'TransferHelper::safeApprove: approve failed'</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">For the sake of backwards compatibility with token that were created prior to the ERC-20 standard, an ERC-20 call can fail either by reverting (in which case <code>success</code> is <code>false</code>) or by being successful and returning a <code>false</code> value (in which case there is output data, and if you decode it as a boolean you get <code>false</code>).</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">safeTransfer</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint256</span><span class="token plain"> value</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// bytes4(keccak256(bytes('transfer(address,uint256)')));</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">bool</span><span class="token plain"> success</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">bytes</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> data</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">call</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">abi</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">encodeWithSelector</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0xa9059cbb</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">            success </span><span class="token operator" style="color:#e09142">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">||</span><span class="token plain"> abi</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">decode</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">bool</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">12</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token string" style="color:#498bb5">'TransferHelper::safeTransfer: transfer failed'</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">13</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">14</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function implements <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://eips.ethereum.org/EIPS/eip-20#transfer">ERC-20's transfer functionality<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>, which allows an account to spend out the allowance provided by a different account.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">safeTransferFrom</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">from</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token builtin">uint256</span><span class="token plain"> value</span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">7</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">8</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// bytes4(keccak256(bytes('transferFrom(address,address,uint256)')));</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">9</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">bool</span><span class="token plain"> success</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">bytes</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">memory</span><span class="token plain"> data</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">call</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">abi</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">encodeWithSelector</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0x23b872dd</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">from</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">10</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">11</span><span class="css-2qghsv"><span class="token plain">            success </span><span class="token operator" style="color:#e09142">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">length </span><span class="token operator" style="color:#e09142">==</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">||</span><span class="token plain"> abi</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#ff7324">decode</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">bool</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">12</span><span class="css-2qghsv"><span class="token plain">            </span><span class="token string" style="color:#498bb5">'TransferHelper::transferFrom: transferFrom failed'</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">13</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">14</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-wzpu9d">Show all</div><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function implements <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://eips.ethereum.org/EIPS/eip-20#transferfrom">ERC-20's transferFrom functionality<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>, which allows an account to spend out the allowance provided by a different account.</p><div dir="ltr" class="css-79elbk"><div class="css-y3pvpz"><pre style="background-color:#fafafa;color:#333333" class="prism-code language-solidity css-raz5zi"><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">1</span><span class="css-2qghsv"><span class="token plain" style="display:inline-block"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">2</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token keyword" style="color:#498bb5">function</span><span class="token plain"> </span><span class="token function" style="color:#ff7324">safeTransferETH</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">address</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token builtin">uint256</span><span class="token plain"> value</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token keyword" style="color:#498bb5">internal</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">3</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token builtin">bool</span><span class="token plain"> success</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> to</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">call</span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain">value</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> value</span><span class="token punctuation" style="color:#6c6783">}</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#498bb5">new</span><span class="token plain"> </span><span class="token class-name">bytes</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">4</span><span class="css-2qghsv"><span class="token plain">        </span><span class="token keyword" style="color:#498bb5">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">success</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#498bb5">'TransferHelper::safeTransferETH: ETH transfer failed'</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">5</span><span class="css-2qghsv"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="token-line css-ds3kc" style="color:#333333"><span class="css-90nu49">6</span><span class="css-2qghsv"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span></div><div class="prism-code language-solidity css-1wk40fs"><div class="css-501625"><div class="css-wzpu9d"><span class="css-1o4u1zp undefined"><img alt="" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4cb.svg" style="width: 1em; height: 1em; margin: 0px 0.05em 0px 0.1em; vertical-align: -0.1em;"></span> <!-- -->Copy</div></div></div></pre></div></div><p class="chakra-text css-1bpgf5e">This function transfers ether to an account. Any call to a different contract can attempt to send ether. Because we don't need to actually call any function, we don't send any data with the call.</p><h2 class="chakra-heading css-4y8d04" id="conclusion" data-group="true"><a class="chakra-link css-1qbzvaj" data-inline-link="true" aria-label="conclusion permalink" href="#conclusion"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ff30mc" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g id="Link"><g><path d="M10.9,8a4.055,4.055,0,0,1,1.352.135,2.511,2.511,0,0,1-.7,4.863.5.5,0,0,0,0,1,3.508,3.508,0,0,0,2.944-5.2A3.557,3.557,0,0,0,11.434,7H5.59A3.5,3.5,0,0,0,5.4,14c.724.041,1.458,0,2.183,0a.5.5,0,0,0,0-1h0c-1.323,0-2.915.262-3.891-.843A2.522,2.522,0,0,1,5.59,8Z"></path><path d="M18.41,17a3.5,3.5,0,0,0,.192-6.994c-.724-.041-1.458,0-2.183,0a.5.5,0,0,0,0,1h0c1.323,0,2.915-.262,3.891.843A2.522,2.522,0,0,1,18.41,16H13.1a4.055,4.055,0,0,1-1.352-.135,2.511,2.511,0,0,1,.7-4.863.5.5,0,0,0,0-1,3.508,3.508,0,0,0-2.944,5.2A3.557,3.557,0,0,0,12.566,17Z"></path></g></g></svg></a>Conclusion</h2><p class="chakra-text css-1bpgf5e">This is a long article of about 50 pages. If you made it here, congratulations! Hopefully by now you've understood the considerations in writing a real-life application (as opposed to short sample programs) and are better to be able to write contracts for your own use cases.</p><p class="chakra-text css-1bpgf5e">Now go and write something useful and amaze us.</p><div class="css-1ac81qj"><div class="css-1scb1kk"><span class="chakra-avatar css-cm1z1v"><div role="img" aria-label="wackerow" class="chakra-avatar__initials css-0">w</div></span><p class="chakra-text css-4v8a79">Last edit<!-- -->:<!-- --> <a target="_blank" rel="noopener" class="chakra-link css-1f04442" data-inline-link="true" href="https://github.com/wackerow">@<!-- -->wackerow<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a>, <!-- -->April 2, 2024</p></div><div class="chakra-stack css-1lby19v"><button type="button" class="chakra-button css-l8may3">See contributors</button></div></div><div dir="ltr" class="css-13i3mb1"><div class="css-tn44ti"><h3 class="chakra-heading css-vh68c1">Was this tutorial helpful?</h3><div class="css-11f4u18"><button type="button" class="chakra-button css-uy7vvo"><span class="chakra-button__icon css-1wh2kri"><svg viewBox="0 0 25 25" focusable="false" class="chakra-icon css-8889cn" aria-hidden="true"><path d="M5.85334 8.04297H3.27591C2.92157 8.04297 2.63153 8.33154 2.63153 8.68731L2.63153 20.2858C2.63153 20.6414 2.9203 20.9301 3.27591 20.9301H5.85334C6.20894 20.9301 6.49771 20.6414 6.49771 20.2858L6.49771 8.68731C6.49771 8.33154 6.20763 8.04297 5.85334 8.04297Z" fill="currentColor"></path><path d="M20.7596 8.04527C20.6558 8.02769 15.7969 8.04527 15.7969 8.04527L16.4756 6.19371C16.9439 4.9149 16.6407 2.96231 15.3413 2.26812C14.9183 2.04208 14.3272 1.92855 13.8506 2.04851C13.5773 2.11728 13.3371 2.29823 13.1939 2.54066C13.0293 2.81948 13.0463 3.14495 12.9877 3.45411C12.839 4.23826 12.4684 4.98383 11.8947 5.54344C10.8942 6.51914 7.7865 9.33395 7.7865 9.33395L7.7865 19.6437L18.5258 19.6437C19.975 19.6446 20.9246 18.0263 20.2099 16.7623C21.0619 16.2166 21.3533 15.0673 20.8543 14.1848C21.7063 13.6392 21.9976 12.4899 21.4987 11.6074C22.9687 10.6659 22.4772 8.33577 20.7596 8.04527Z" fill="currentColor"></path></svg></span>Yes</button><button type="button" class="chakra-button css-uy7vvo"><span class="chakra-button__icon css-1wh2kri"><svg viewBox="0 0 25 25" focusable="false" class="chakra-icon css-1rf6jrc" aria-hidden="true"><path d="M5.85334 8.04297H3.27591C2.92157 8.04297 2.63153 8.33154 2.63153 8.68731L2.63153 20.2858C2.63153 20.6414 2.9203 20.9301 3.27591 20.9301H5.85334C6.20894 20.9301 6.49771 20.6414 6.49771 20.2858L6.49771 8.68731C6.49771 8.33154 6.20763 8.04297 5.85334 8.04297Z" fill="currentColor"></path><path d="M20.7596 8.04527C20.6558 8.02769 15.7969 8.04527 15.7969 8.04527L16.4756 6.19371C16.9439 4.9149 16.6407 2.96231 15.3413 2.26812C14.9183 2.04208 14.3272 1.92855 13.8506 2.04851C13.5773 2.11728 13.3371 2.29823 13.1939 2.54066C13.0293 2.81948 13.0463 3.14495 12.9877 3.45411C12.839 4.23826 12.4684 4.98383 11.8947 5.54344C10.8942 6.51914 7.7865 9.33395 7.7865 9.33395L7.7865 19.6437L18.5258 19.6437C19.975 19.6446 20.9246 18.0263 20.2099 16.7623C21.0619 16.2166 21.3533 15.0673 20.8543 14.1848C21.7063 13.6392 21.9976 12.4899 21.4987 11.6074C22.9687 10.6659 22.4772 8.33577 20.7596 8.04527Z" fill="currentColor"></path></svg></span>No</button></div></div></div></article><aside class="css-1eoeohq"><ul role="list" class="css-1plxn13"><li class="css-1h4oxa0"><a target="_blank" rel="noopener" class="chakra-link chakra-button css-1bjm1n1" href="https://github.com/ethereum/ethereum-org-website/tree/dev/public/content/developers/tutorials/uniswap-v2-annotated-code/index.md"><span class="chakra-button__icon css-1wh2kri"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" focusable="false" class="chakra-icon css-13otjrl" aria-hidden="true" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></span>Edit page<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a></li><li class="css-0"><div class="css-19pws62">On this page</div><ul role="list" class="css-11lhp75"><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#introduction">Introduction</a><ul role="list" class="css-ycb9ue"><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#what-does-uniswap-do">What Does Uniswap Do?</a></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#why-v2">Why v2? Why not v3?</a></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#contract-types">Core Contracts vs Periphery Contracts</a></li></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#flows">Data and Control Flows</a><ul role="list" class="css-ycb9ue"><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#swap-flow">Swap</a><ul role="list" class="css-ycb9ue"></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#add-liquidity-flow">Add Liquidity</a><ul role="list" class="css-ycb9ue"></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#remove-liquidity-flow">Remove Liquidity</a><ul role="list" class="css-ycb9ue"></ul></li></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#core-contracts">The Core Contracts</a><ul role="list" class="css-ycb9ue"><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#uniswapv2pair">UniswapV2Pair.sol</a><ul role="list" class="css-ycb9ue"></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#uniswapv2factory">UniswapV2Factory.sol</a></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#uniswapv2erc20">UniswapV2ERC20.sol</a></li></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#periphery-contracts">The Periphery Contracts</a><ul role="list" class="css-ycb9ue"><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#uniswapv2router01">UniswapV2Router01.sol</a></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#uniswapv2router02">UniswapV2Router02.sol</a><ul role="list" class="css-ycb9ue"></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#uniswapv2migrator">UniswapV2Migrator.sol</a></li></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#libraries">The Libraries</a><ul role="list" class="css-ycb9ue"><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#math">Math</a></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#fixedpoint">Fixed Point Fractions (UQ112x112)</a></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#uniswapv2library">UniswapV2Library</a></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#transfer-helper">Transfer Helper</a></li></ul></li><li class="css-dpoqzr"><a class="chakra-link css-1a78bay" href="#conclusion">Conclusion</a></li></ul></li></ul></aside></div><footer class="css-g8mt53"><div class="css-19szh4y"><p class="chakra-text css-0">Website last updated<!-- -->:<!-- --> <!-- -->May 22, 2024</p><div class="css-9p2ato"><a target="_blank" rel="noopener" class="chakra-link css-g3hlzg" aria-label="GitHub" href="https://github.com/ethereum/ethereum-org-website"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" focusable="false" class="chakra-icon css-1n2168i" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><span class="css-idkz9h">(opens in a new tab)</span></a><a target="_blank" rel="noopener" class="chakra-link css-g3hlzg" aria-label="Twitter" href="https://twitter.com/ethdotorg"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" focusable="false" class="chakra-icon css-1n2168i" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg><span class="css-idkz9h">(opens in a new tab)</span></a><a target="_blank" rel="noopener" class="chakra-link css-g3hlzg" aria-label="Discord" href="https://discord.gg/ethereum-org"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" focusable="false" class="chakra-icon css-1n2168i" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"></path></svg><span class="css-idkz9h">(opens in a new tab)</span></a></div></div><div class="css-1gzw5ei"><div class="css-0"><h3 class="chakra-heading css-1nql6gs">Learn</h3><ul role="list" class="css-n65e7v"><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/learn/">Learn Hub</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/what-is-ethereum/">What is Ethereum?</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/eth/">What is ether (ETH)?</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/wallets/">Ethereum wallets</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/web3/">What is Web3?</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/smart-contracts/">Smart contracts</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/gas/">Gas fees</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/run-a-node/">Run a node</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/security/">Ethereum security and scam prevention</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/quizzes/">Quiz Hub</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/glossary/">Ethereum glossary</a></li></ul></div><div class="css-0"><h3 class="chakra-heading css-1nql6gs">Use</h3><ul role="list" class="css-n65e7v"><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/guides/">Guides</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/wallets/find-wallet/">Choose your wallet</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/get-eth/">Get ETH</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/dapps/">Dapps - Decentralized applications</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/stablecoins/">Stablecoins</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/nft/">NFTs - Non-fungible tokens</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/defi/">DeFi - Decentralized finance</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/dao/">DAOs - Decentralized autonomous organizations</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/decentralized-identity/">Decentralized identity</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/staking/">Stake ETH</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/layer-2/">Layer 2</a></li></ul></div><div class="css-0"><h3 class="chakra-heading css-1nql6gs">Build</h3><ul role="list" class="css-n65e7v"><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/developers/">Builder's home</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/developers/tutorials/">Tutorials</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/developers/docs/">Documentation</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/developers/learning-tools/">Learn by coding</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/developers/local-environment/">Set up local environment</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/community/grants/">Grants</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/developers/docs/intro-to-ethereum/">Foundational topics</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/developers/docs/design-and-ux/">UX/UI design fundamentals</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/enterprise/">Enterprise - Mainnet Ethereum</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/enterprise/private-ethereum/">Enterprise - Private Ethereum</a></li></ul></div><div class="css-0"><h3 class="chakra-heading css-1nql6gs">Participate</h3><ul role="list" class="css-n65e7v"><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/community/">Community hub</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/community/online/">Online communities</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/community/events/">Ethereum events</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/contributing/">Contributing to ethereum.org</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/contributing/translation-program/">Translation Program</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/bug-bounty/">Ethereum bug bounty program</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/foundation/">Ethereum Foundation</a></li><li class="css-679ng4"><a target="_blank" rel="noopener" class="chakra-link css-u2dix7" href="https://blog.ethereum.org/">Ethereum Foundation Blog<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a></li><li class="css-679ng4"><a target="_blank" rel="noopener" class="chakra-link css-u2dix7" href="https://esp.ethereum.foundation">Ecosystem Support Program<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a></li><li class="css-679ng4"><a target="_blank" rel="noopener" class="chakra-link css-u2dix7" href="https://devcon.org/">Devcon<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a></li></ul></div><div class="css-0"><h3 class="chakra-heading css-1nql6gs">Research</h3><ul role="list" class="css-n65e7v"><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/whitepaper/">Ethereum Whitepaper</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/roadmap/">Ethereum roadmap</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/roadmap/security/">Improved security</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/history/">Technical history of Ethereum</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/community/research/">Open research</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/eips/">Ethereum Improvement Proposals</a></li><li class="css-679ng4"><a class="chakra-link css-u2dix7" href="/en/governance/">Ethereum governance</a></li></ul></div></div><ul role="list" class="css-v5mvu7"><li class="css-4qpsz7"><a class="chakra-link css-u2dix7" href="/en/about/">About us</a></li><li class="css-4qpsz7"><a class="chakra-link css-u2dix7" href="/en/assets/">Ethereum brand assets</a></li><li class="css-4qpsz7"><a class="chakra-link css-u2dix7" href="/en/community/code-of-conduct/">Code of conduct</a></li><li class="css-4qpsz7"><a class="chakra-link css-u2dix7" href="/en/about/#open-jobs">Jobs</a></li><li class="css-4qpsz7"><a class="chakra-link css-u2dix7" href="/en/privacy-policy/">Privacy policy</a></li><li class="css-4qpsz7"><a class="chakra-link css-u2dix7" href="/en/terms-of-use/">Terms of use</a></li><li class="css-4qpsz7"><a class="chakra-link css-u2dix7" href="/en/cookie-policy/">Cookie policy</a></li><li class="css-4qpsz7"><a target="_blank" rel="noopener" class="chakra-link css-u2dix7" href="mailto:press@ethereum.org">Press Contact<span class="css-idkz9h">(opens in a new tab)</span><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" focusable="false" class="chakra-icon css-1bbj57d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z" fill="currentColor"></path></svg></a></li></ul></footer><button type="button" class="chakra-button css-6qp3mu" aria-label="Feedback" aria-expanded="false" aria-controls="disclosure-:R2pt6:"><span class="chakra-button__icon css-1vrwnyo"><svg viewBox="0 0 26 32" focusable="false" class="chakra-icon css-lxjpd2" aria-hidden="true"><path d="M0.644377 6.04297H3.2218C3.5761 6.04297 3.86618 6.33203 3.86618 6.6875L3.86618 18.2852C3.86618 18.5 3.76259 18.6875 3.6031 18.8047C3.4963 18.8828 3.36442 18.9297 3.2218 18.9297H0.644377C0.288763 18.9297 -1.90735e-06 18.6406 -1.90735e-06 18.2852L-1.90735e-06 6.6875C-1.90735e-06 6.33203 0.290037 6.04297 0.644377 6.04297Z" fill="currentColor"></path><path d="M13.1654 6.04688C13.1654 6.04688 18.0243 6.02734 18.1281 6.04688C19.8457 6.33594 20.3371 8.66406 18.8671 9.60547C19.3661 10.4883 19.0748 11.6406 18.2228 12.1836C18.7217 13.0664 18.4303 14.2148 17.5784 14.7617C18.2931 16.0273 17.3434 17.6445 15.8943 17.6445H5.15497L5.15497 7.33203C5.15497 7.33203 8.26271 4.51953 9.26312 3.54297C9.83691 2.98437 10.2074 2.23828 10.3561 1.45312L10.3947 1.18359C10.4204 0.960937 10.446 0.738281 10.5624 0.539062C10.7056 0.296875 10.9458 0.117187 11.2191 0.046875C11.6956 -0.0703125 12.2867 0.0429688 12.7098 0.269531C14.0092 0.960938 14.3124 2.91406 13.8441 4.19531L13.1654 6.04688Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M7.87193 25.1172C7.97569 25.1368 12.8346 25.1172 12.8346 25.1172L12.1559 26.9688C11.6876 28.25 11.9908 30.2032 13.2902 30.8946C13.7132 31.1211 14.3044 31.2344 14.7809 31.1172C15.0542 31.0469 15.2944 30.8672 15.4376 30.625C15.5538 30.426 15.5795 30.2036 15.6052 29.9812L15.6439 29.711C15.7926 28.9258 16.1631 28.1797 16.7369 27.6211C17.7373 26.6446 20.845 23.8321 20.845 23.8321V13.5196H19.4396C19.3628 14.0799 19.1268 14.6156 18.7527 15.0516C19.1515 16.8035 17.8156 18.6447 15.8943 18.6447H7.6287C7.66657 18.7596 7.71594 18.8721 7.77724 18.9805C6.92525 19.5235 6.6339 20.6758 7.13287 21.5586C5.66286 22.5 6.15432 24.8282 7.87193 25.1172ZM22.7782 25.1211H25.3556C25.71 25.1211 26 24.8321 26 24.4766L26 12.879C26 12.5235 25.7112 12.2344 25.3556 12.2344H22.7782C22.6356 12.2344 22.5037 12.2813 22.3969 12.3594C22.2374 12.4766 22.1338 12.6641 22.1338 12.879L22.1338 24.4766C22.1338 24.8321 22.4239 25.1211 22.7782 25.1211Z" fill="currentColor"></path></svg></span><div class="chakra-offset-slide" style="opacity:0;transform:scale(0.95) translateZ(0)"><span class="chakra-text css-ki11z">Is this page helpful?</span></div></button></div><span id="__chakra_env" hidden=""></span></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"_nextI18Next":{"initialI18nStore":{"en":{"common":{"about-ethereum-org":"About ethereum.org","about-us":"About us","account-abstraction":"Account abstraction","acknowledgements":"Acknowledgements","adding-desci-projects":"Adding Desci Projects","adding-developer-tools":"Adding Developer Tools","adding-exchanges":"Adding Exchanges","adding-glossary-terms":"Adding Glossary Terms","adding-layer-2s":"Adding Layer 2s","adding-products":"Adding Products","adding-staking-products":"Adding Staking Products","adding-wallets":"Adding Wallets","aria-toggle-menu-button":"Toggle menu button","aria-toggle-search-button":"Toggle search button","beacon-chain":"Beacon Chain","bridges":"Blockchain bridges","bug-bounty":"Bug bounty","build":"Build","build-menu":"Build menu","clear":"Clear","close":"Close","community":"Community","community-hub":"Community hub","community-menu":"Community Menu","consensus-when-shipping":"When's it shipping?","contact":"Press Contact","content-buckets":"Content Buckets","content-resources":"Content Resources","content-standardization":"Content standardization","contributing":"Contributing","contributors":"Contributors","contributors-thanks":"Everyone who has contributed to this page  thank you!","cookie-policy":"Cookie policy","copied":"Copied","copy":"Copy","danksharding":"Danksharding","dao-page":"DAOs - Decentralized autonomous organizations","dark-mode":"Dark","data-provided-by":"Data source:","decentralized-applications-dapps":"Dapps - Decentralized applications","decentralized-identity":"Decentralized identity","decentralized-science":"DeSci - Decentralized science","decentralized-social-networks":"Decentralized social networks","defi-page":"DeFi - Decentralized finance","description":"Description for nav item","design":"Design","design-principles":"Design Principles","devcon":"Devcon","developers":"Developers","developers-home":"Developers' home","docs":"Docs","docsearch-error-help":"You might want to check your network connection.","docsearch-error-title":"Unable to fetch results","docsearch-no-results-missing":"Believe this query should return results?","docsearch-no-results-missing-link":"Let us know.","docsearch-no-results-suggested-query":"Try searching for","docsearch-no-results-text":"No results for","docsearch-search-by":"Search by","docsearch-start-favorite-searches":"Favorite","docsearch-start-no-recent-searches":"No recent searches","docsearch-start-recent-searches-title":"Recent","docsearch-start-remove-favorite-search":"Remove this search from favorites","docsearch-start-remove-recent-search":"Remove this search from history","docsearch-start-save-recent-search":"Save this search","docsearch-to-close":"To close","docsearch-to-navigate":"To navigate","docsearch-to-select":"To select","documentation":"Documentation","down":"Down","ecosystem":"Ecosystem","edit-page":"Edit page","ef-blog":"Ethereum Foundation Blog","eips":"Ethereum Improvement Proposals","energy-consumption":"Ethereum energy consumption","enterprise":"Enterprise","enterprise-mainnet":"Enterprise - Mainnet Ethereum","enterprise-menu":"Enterprise Menu","enterprise-private":"Enterprise - Private Ethereum","esp":"Ecosystem Support Program","eth-current-price":"Current ETH price (USD)","ethereum-basics":"Ethereum basics","ethereum-brand-assets":"Ethereum brand assets","ethereum-bug-bounty":"Ethereum bug bounty program","ethereum-events":"Ethereum events","ethereum-foundation":"Ethereum Foundation","ethereum-foundation-logo":"Ethereum Foundation logo","ethereum-glossary":"Ethereum glossary","ethereum-governance":"Ethereum governance","ethereum-logo":"Ethereum logo","ethereum-online":"Online communities","ethereum-protocol":"Ethereum protocol","ethereum-roadmap":"Ethereum roadmap","ethereum-security":"Ethereum security and scam prevention","ethereum-support":"Ethereum support","ethereum-upgrades":"Ethereum upgrades","ethereum-wallets":"Ethereum wallets","ethereum-whitepaper":"Ethereum Whitepaper","feedback-card-prompt-article":"Was this article helpful?","feedback-card-prompt-page":"Was this page helpful?","feedback-card-prompt-tutorial":"Was this tutorial helpful?","feedback-widget":"Feedback","feedback-widget-prompt":"Is this page helpful?","feedback-widget-thank-you-cta":"Open short survey","feedback-widget-thank-you-subtitle":"Make this page even better by answering a few questions.","feedback-widget-thank-you-subtitle-ext":"If you need help, you can reach out to the community on our \u003ca href=\"https://discord.gg/ethereum-org\" target=\"_blank\"\u003eDiscord\u003c/a\u003e.","feedback-widget-thank-you-timing":"23min","feedback-widget-thank-you-title":"Thank you for your feedback!","find-wallet":"Find wallet","future-proofing":"Future-proofing","get-eth":"Get ETH","get-involved":"Get involved","get-started":"Get started","grant-programs":"Ecosystem Grant Programs","grants":"Grants","guides":"Guides","guides-hub":"How-to guides","history-of-ethereum":"History of Ethereum","home":"Home","how-ethereum-works":"How Ethereum works","how-to-create-an-ethereum-account":"How to \"create\" an Ethereum account","how-to-revoke-token-access":"How to revoke smart contract access to your crypto funds","how-to-swap-tokens":"How to swap tokens","how-to-use-a-bridge":"How to bridge tokens to layer 2","how-to-use-a-wallet":"How to use a wallet","image":"image","in-this-section":"In this section","individuals":"Individuals","jobs":"Jobs","kraken-logo":"Kraken logo","language-am":"Amharic","language-be":"Belarusian","language-ar":"Arabic","language-az":"Azerbaijani","language-bg":"Bulgarian","language-bn":"Bengali","language-bs":"Bosnian","language-ca":"Catalan","language-cs":"Czech","language-da":"Danish","language-de":"German","language-el":"Greek","language-en":"English","language-es":"Spanish","language-fa":"Farsi","language-fi":"Finnish","language-fil":"Filipino","language-fr":"French","language-gl":"Galician","language-gu":"Gujarati","language-he":"Hebrew","language-hi":"Hindi","language-hr":"Croatian","language-hu":"Hungarian","language-hy-am":"Armenian","language-id":"Indonesian","language-ig":"Igbo","language-it":"Italian","language-ja":"Japanese","language-ka":"Georgian","language-kk":"Kazakh","language-km":"Khmer","language-kn":"Kannada","language-ko":"Korean","language-lt":"Lithuanian","language-ml":"Malayalam","language-mr":"Marathi","language-ms":"Malay","language-nb":"Norwegian","language-ne-np":"Nepali","language-nl":"Dutch","language-pcm":"Nigerian Pidgin","language-pl":"Polish","language-pt":"Portuguese","language-pt-br":"Portuguese (Brazilian)","language-resources":"Language resources","language-ro":"Romanian","language-ru":"Russian","language-se":"Swedish","language-sk":"Slovak","language-sl":"Slovenian","language-sr":"Serbian","language-support":"Language support","language-sw":"Swahili","language-ta":"Tamil","language-te":"Telugu","language-th":"Thai","language-tk":"Turkmen","language-tr":"Turkish","language-uk":"Ukrainian","language-ur":"Urdu","language-uz":"Uzbek","language-vi":"Vietnamese","language-zh":"Chinese Simplified","language-zh-tw":"Chinese Traditional","languages":"Languages","last-24-hrs":"Last 24 hours","last-edit":"Last edit","layer-2":"Layer 2","learn":"Learn","learn-by-coding":"Learn by coding","learn-hub":"Learn Hub","learn-menu":"Learn menu","learn-more":"Learn more","less":"Less","light-mode":"Light","listing-policy-disclaimer":"All products listed on this page are not official endorsements, and are provided for informational purposes only. If you want to add a product or provide feedback on the policy raise an issue in GitHub.","loading":"Loading...","loading-error":"Loading error.","loading-error-refresh":"Error, please refresh.","loading-error-try-again-later":"Unable to load data. Try again later.","logo":"logo","mainnet-ethereum":"Mainnet Ethereum","merge":"Merge","more":"More","nav-about-description":"A public, open-source project for the Ethereum community","nav-advanced-description":"Learn the more complex topics","nav-advanced-label":"Advanced","nav-basics-description":"Understand the fundamentals of Ethereum","nav-basics-label":"Basics","nav-bridges-description":"Web3 has evolved into an ecosystem of primary L1 blockchains and L2 scaling solutions","nav-builders-home-description":"A builder's manual for Ethereumby builders, for builders","nav-builders-home-label":"Builder's home","nav-code-of-conduct":"Code of conduct","nav-contribute-description":"If you want to help, this will guide you","nav-contribute-label":"Contributing to ethereum.org","nav-dao-description":"Member-owned communities without centralized authority","nav-dapps-description":"Explore a rich ecosystem of apps using Ethereum","nav-defi-description":"A global, open alternative to the traditional financial market","nav-desci-description":"A global, open alternative to the current scientific system","nav-desoc-description":"Blockchain-based platforms for social interaction and content creation","nav-developers":"Developers","nav-developers-docs":"Developers docs","nav-did-description":"Issue and own your unique decentralized identifiers","nav-docs-description":"Docs to help you understand and build with Ethereum","nav-docs-design-description":"Description of unique web3 design challenges, best practices and user research insights","nav-docs-design-label":"UX/UI design fundamentals","nav-docs-foundation-description":"Core fundamentals to develop on Ethereum","nav-docs-foundation-label":"Foundational topics","nav-docs-overview-description":"Your home for developer docs","nav-docs-stack-description":"Understand all the details of the Ethereum stack","nav-docs-stack-label":"Ethereum stack","nav-eip-description":"Standards that specify new features or processes","nav-eip-label":"EIPs - Ethereum improvement proposals","nav-emerging-description":"Get to know other newer use cases for Ethereum","nav-emerging-label":"Emerging use cases","nav-enterprise-description":"Business applications for Ethereum","nav-ethereum-org-description":"This website is community drivenjoin us and contribute too","nav-ethereum-wallets-description":"An app to interact with your Ethereum account","nav-events-description":"Decentralization and freedom to participate for anyone","nav-events-irl-description":"Every month there are major Ethereum events in-person and online","nav-events-label":"Communities and events","nav-events-online-description":"Hundreds of thousands of Ethereum enthusiasts gather in these online communities","nav-find-wallet-description":"Wallets allow you to use crypto","nav-find-wallet-label":"Choose your wallet","nav-gas-fees-description":"How are ETH transaction fees calculated","nav-gas-fees-label":"Gas fees","nav-get-eth-description":"You need ether (ETH) to use Ethereum applications","nav-get-started-description":"Your first steps to use Ethereum","nav-governance-description":"The process involved in upgrading the Ethereum protocol","nav-governance-label":"Governance","nav-grants-description":"A curated list by our community on projects that provide grant funding programs","nav-guide-create-account-description":"Anyone can create an Ethereum account at any time, for free with a wallet app","nav-guide-create-account-label":"How to create an Ethereum account","nav-guide-overview-description":"List of all guides in one place","nav-guide-revoke-access-description":"Stay safe when interacting with smart contracts and applications in the Ethereum ecosystem","nav-guide-revoke-access-label":"How to revoke smart contract access","nav-guide-use-wallet-description":"Learn how to operate all the basic functions of a wallet","nav-guide-use-wallet-label":"How to use a wallet","nav-guides-description":"Practical step-by-step guides to help you get started","nav-guides-label":"How to guides","nav-history-description":"A timeline of all the major forks and updates","nav-history-label":"Technical history of Ethereum","nav-layer-2-description":"Cheaper and faster transactions for Ethereum","nav-learn-by-coding-description":"Tools that help you experiment with Ethereum","nav-local-env-description":"Choose and set up your Ethereum development stack","nav-mainnet-description":"Enterprise blockchain applications can be built on the public Ethereum Mainnet","nav-nft-description":"A way to represent anything unique as an Ethereum-based asset","nav-open-research-description":"One of the primary strengths of Ethereum is its active research community","nav-open-research-label":"Open research","nav-overview-description":"All things Ethereum education","nav-overview-label":"Overview","nav-participate-overview-description":"Overview on how to participate","nav-primary":"Primary","nav-private-description":"Developer resources for private enterprise Ethereum","nav-quizzes-description":"Find out how well you understand Ethereum and cryptocurrencies","nav-quizzes-label":"Test your knowledge","nav-refi-description":"An alternative economic system built on regenerative principles","nav-research-description":"Processes used to improve Ethereum","nav-research-label":"Research and development","nav-roadmap-description":"The path to more scalability, security and sustainability for Ethereum","nav-roadmap-future-description":"Solidifying Ethereum as a robust and decentralized network","nav-roadmap-future-label":"Future-proofing","nav-roadmap-future-proofing":"Future-proofing","nav-roadmap-home":"Roadmap home","nav-roadmap-label":"Roadmap","nav-roadmap-options":"Roadmap Options","nav-roadmap-options-alt":"Roadmap options dropdown menu","nav-roadmap-overview-description":"The future of Ethereum","nav-roadmap-scaling":"Scaling","nav-roadmap-scaling-description":"Network updates to further reduce transaction costs and speed","nav-roadmap-scaling-label":"Cheaper transactions","nav-roadmap-security":"Better security","nav-roadmap-security-description":"Making sure Ethereum stays resilient to all kinds of attacks into the future","nav-roadmap-security-label":"Improved security","nav-roadmap-user-experience":"Better user experience","nav-roadmap-ux-description":"Using Ethereum needs to be simplified","nav-roadmap-ux-label":"Better user experience","nav-run-a-node-description":"Become fully sovereign while helping secure the network","nav-security-description":"Learn best practices when using cryptocurrency","nav-smart-contracts-description":"The fundamental buliding blocks of the Ethereum ecosystem","nav-stablecoins-description":"Stablecoins are Ethereum tokens designed to stay at a fixed value","nav-stake-description":"Earn rewards for securing Ethereum","nav-stake-label":"Stake","nav-staking-home-description":"An overview of different options for staking","nav-staking-home-label":"Staking home","nav-staking-pool-description":"Stake and earn rewards with any amount of ETH by joining with others","nav-staking-pool-label":"Pooled staking","nav-staking-saas-description":"Third-party node operators handle the operation of your validator client","nav-staking-saas-label":"Staking with a service","nav-staking-solo-description":"Run home hardware and personally add to the security and decentralization of the Ethereum network","nav-staking-solo-label":"Solo staking","nav-start-building-description":"Useful information for newcomers","nav-translation-program-description":"A collaborative effort to translate ethereum.org to all languages","nav-tutorials-description":"Curated list of community tutorials","nav-use-cases-description":"Discover different ideas for Ethereum usage","nav-use-cases-label":"Use cases","nav-what-is-ether-description":"The currency of Ethereum apps","nav-what-is-ethereum-description":"Understand what makes Ethereum special","nav-what-is-web3-description":"An alternative to centralized monopolies dictating the rules","nav-what-is-web3-label":"What is Web3?","nav-whitepaper-description":"The original Ethereum whitepaper written by Vitalik Buterin in 2014","nav-zkp-description":"A way to prove the validity of a statement without revealing the statement itself","nft-page":"NFTs - Non-fungible tokens","nfts":"NFTs","no":"No","on-this-page":"On this page","open-research":"Open research","page-developers-aria-label":"Developers' Menu","page-index-meta-title":"Home","page-languages-browser-default":"Browser default","page-languages-filter-label":"Filter list","page-languages-filter-placeholder":"Type to filter","page-languages-interested":"Interested in contributing?","page-languages-learn-more":"Learn more about our Translation Program","page-languages-recruit-community":"Help us translate ethereum.org.","page-languages-translated":"translated","page-languages-want-more-header":"Want to see ethereum.org in a different language?","page-languages-want-more-link":"Translation Program","page-languages-want-more-paragraph":"ethereum.org translators are always translating pages in as many languages as possible. To see what they're working on right now or to sign up to join them, read about our","page-languages-words":"words","page-last-updated":"Page last updated","participate":"Participate","participate-menu":"Participate menu","pbs":"Proposer-builder separation","pools":"Pooled staking","privacy-policy":"Privacy policy","private-ethereum":"Private Ethereum","product-disclaimer":"Products and services are listed as a convenience for the Ethereum community. Inclusion of a product or service \u003cstrong\u003edoes not represent an endorsement\u003c/strong\u003e from the ethereum.org website team, or the Ethereum Foundation.","quizzes":"Quizzes","quizzes-title":"Quiz Hub","refresh":"Please refresh the page.","regenerative-finance":"ReFi - Regenerative finance","research":"Research","research-menu":"Research menu","resources":"Translation resources","return-home":"return home","roadmap":"Ethereum roadmap","rollup-component-developer-docs":"Developer docs","rollup-component-technology-and-risk-summary":"Technology and risk summary","rollup-component-website":"Website","run-a-node":"Run a node","saas":"Staking as a service","scaling":"Scaling","search":"Search","search-box-blank-state-text":"Search away!","search-eth-address":"This looks like an Ethereum address. We don't provide data specific to addresses. Try searching for it on a block explorer like","search-ethereum-org":"Search ethereum.org","search-no-results":"No results for your search","secret-leader-election":"Secret leader election","security":"Security","see-contributors":"See contributors","set-up-local-env":"Set up local environment","sharding":"Sharding","show-all":"Show all","show-less":"Show less","single-slot-finality":"Single-slot finality","site-description":"Ethereum is a global, decentralized platform for money and new kinds of applications. On Ethereum, you can write code that controls money, and build applications accessible anywhere in the world.","site-title":"ethereum.org","skip-to-main-content":"Skip to main content","smart-contracts":"Smart contracts","solo":"Solo staking","stablecoins":"Stablecoins","stake-eth":"Stake ETH","staking":"Staking","start-here":"Start here","statelessness":"Statelessness","style-guide":"Style guide","support":"Support","terms-of-use":"Terms of use","translation-banner-body-new":"Youre viewing this page in English because we havent translated it yet. Help us translate this content.","translation-banner-body-update":"Theres a new version of this page but its only in English right now. Help us translate the latest version.","translation-banner-button-see-english":"See English","translation-banner-button-translate-page":"Translate page","translation-banner-no-bugs-content":"This page is not being translated. We've intentionally left this page in English for now.","translation-banner-no-bugs-dont-show-again":"Don't show again","translation-banner-no-bugs-title":"No bugs here!","translation-banner-title-new":"Help translate this page","translation-banner-title-update":"Help update this page","translation-program":"Translation Program","try-using-search":"Try using search to find what you're looking for or","tutorials":"Tutorials","up":"Up","use":"Use","use-ethereum":"Use Ethereum","use-ethereum-menu":"Use Ethereum menu","use-menu":"Use menu","user-experience":"User experience","verkle-trees":"Verkle trees","wallets":"Wallets","we-couldnt-find-that-page":"We couldn't find that page","web3":"What is Web3?","web3-title":"Web3","website-last-updated":"Website last updated","what-is-ether":"What is ether (ETH)?","what-is-ethereum":"What is Ethereum?","withdrawals":"Staking withdrawals","wrapped-ether":"Wrapped Ether","yes":"Yes","zero-knowledge-proofs":"Zero-knowledge proofs"},"page-developers-tutorials":{"comp-tutorial-metadata-minute-read":"minute read","page-tutorial-listing-policy-intro":"Before you submit a tutorial please read our listing policy.","comp-tutorial-metadata-tip-author":"Tip author","page-tutorial-listing-policy":"article listing policy","page-tutorial-new-github":"New to GitHub?","page-tutorial-new-github-desc":"Raise an issue  just fill in the requested information and paste your tutorial.","page-tutorial-pull-request":"Create a pull request","page-tutorial-pull-request-btn":"Create pull request","page-tutorial-pull-request-desc-1":"Please follow the","page-tutorial-pull-request-desc-2":"tutorials/your-tutorial-name/index.md","page-tutorial-pull-request-desc-3":"naming structure.","page-tutorial-raise-issue-btn":"Raise issue","page-tutorial-read-time":"min","page-tutorial-submit-btn":"Submit a tutorial","page-tutorial-submit-tutorial":"To submit a tutorial, you'll need to use GitHub. We welcome you to create an issue or a pull request.","page-tutorial-subtitle":"Welcome to our curated list of community tutorials.","page-tutorial-tags-error":"There are no tutorials with all your chosen tags yet","page-tutorial-title":"Ethereum Development Tutorials","page-tutorials-meta-description":"Browse and filter vetted Ethereum community tutorials by topic.","page-tutorial-external-link":"External","page-tutorials-meta-title":"Ethereum Development Tutorials","page-tutorial-beginner":"Beginner","page-tutorial-intermediate":"Intermediate","page-tutorial-advanced":"Advanced","page-find-wallet-try-removing":"Try removing a feature or two","page-find-wallet-clear":"Clear filters","page-tutorials-env-banner":"Don't commit \u003ccode\u003e.env\u003c/code\u003e! Please make sure never to share or expose your \u003ccode\u003e.env\u003c/code\u003e file with anyone, as you are compromising your secrets in doing so. If you are using version control, add your \u003ccode\u003e.env\u003c/code\u003e to a \u003ca href=\"https://git-scm.com/docs/gitignore\"\u003egitignore\u003c/a\u003e file."},"glossary-tooltip":{"51%-attack-term":"51% attack","51%-attack-definition":"A type of attack where a group gains control of the majority of \u003ca href=\"/glossary/#node\"\u003enodes\u003c/a\u003e. This would allow them to defraud the blockchain by reversing \u003ca href=\"/glossary/#transaction\"\u003etransactions\u003c/a\u003e and double spending \u003ca href=\"ether\"\u003eether\u003c/a\u003e and other tokens.","abi-term":"Application Binary Interface (ABI)","abi-definition":"A JSON file that defines the functions and variables included in a smart contract. The ABI allows bytecode to be mapped into human-readable formats.","account-term":"Account","account-definition":"An Ethereum account is a digital identity on the Ethereum blockchain, allowing users to send, receive Ether or other digital assets, and interact with smart contracts.","address-term":"Address","address-definition":"An Ethereum address is a unique identifier used for receiving tokens, functions similar to a bank account number for cryptocurrencies. Its used to identify your Ethereum account.","anti-sybil-term":"Anti-Sybil","anti-sybil-definition":"Are ways to stop people from pretending to be many users at once on the internet, ensuring each user is a real, separate person. This helps keep online interactions fair and honest.","apr-term":"APR","apr-definition":"APR, or Annual Percentage Rate, reflects the yearly cost of borrowing money, including interest and fees, as a percentage.","attestation-term":"Attestation","attestation-definition":"A claim made by an entity that something is true. In context of Ethereum, consensus validators must make a claim as to what they believe the state of the chain to be. At designated times, each validator is responsible for publishing different attestations that formally declare this validator's view of the chain, including the last finalized checkpoint and the current head of the chain. \u003ca href=\"/developers/docs/consensus-mechanisms/pos/attestations/\"\u003eMore on attestations\u003c/a\u003e.","block-term":"Block","block-definition":"A block is where transactions or digital actions are stored. Once a block is full, it gets linked to the previous one, creating a chain of blocks or a \"blockchain\". \u003ca href=\"/developers/docs/blocks/\"\u003eMore on blocks\u003c/a\u003e.","blockchain-term":"Blockchain","blockchain-definition":"A blockchain is a database of transactions, duplicated and shared on all computers in the network, ensuring data cannot be altered retroactively.","bridge-term":"Bridge","bridge-definition":"A blockchain bridge is used to transfer assets from one blockchain network to another.","consensus-term":"Consensus","consensus-definition":"When more than 2/3 of the computers in a network agree that they have the same set of records, making sure everyone is on the same page. This isn't about the rules they follow, but making sure they all have the same information.","consensus-client-term":"Consensus client","consensus-client-definition":"Consensus clients (such as Prysm, Teku, Nimbus, Lighthouse, Lodestar) run Ethereum's \u003ca href=\"/glossary/#pos\"\u003eproof-of-stake\u003c/a\u003e consensus algorithm allowing the network to reach agreement about the head of the Beacon Chain. Consensus clients do not participate in validating/broadcasting transactions or executing state transitions. This is done by \u003ca href=\"/glossary/#execution-client\"\u003eexecution clients\u003c/a\u003e. Consensus clients do not attest to, or propose new blocks. This is done by the \u003ca href=\"/glossary/#validator\"\u003evalidator client\u003c/a\u003e which is an optional add-on to the consensus client.","consensus-layer-term":"Consensus layer","consensus-layer-definition":"Ethereum's consensus layer is the network of \u003ca href=\"/glossary/#consensus-client\"\u003econsensus clients\u003c/a\u003e.","cryptoeconomics-term":"Cryptoeconomics","cryptoeconomics-definition":"The study of mathematical and economic principles to design secure and trustworthy digital platforms. The goal is to  ensure that all participants follow the rules and are rewarded for contributing to the network's security and operation. ","cryptography-term":"Cryptography","cryptography-definition":"It is the practice of making communication private and secure so that only those for whom the information is intended can read it.","dao-term":"Decentralized autonomous organization (DAO)","dao-definition":"A DAO is a digital organization run by rules coded on a blockchain, where decisions are made by member votes, not a central authority. \u003ca href=\"/dao/\"\u003eMore on decentralized autonomous organizations (DAOs)\u003c/a\u003e.","dapp-term":"Dapp","dapp-definition":"A dApp is a decentralized application that runs on a blockchain network, offering services without a central controlling authority. \u003ca href=\"/dapps/\"\u003eMore on decentralized applications\u003c/a\u003e.","data-availability-term":"Data availability","data-availability-definition":"Any node can independently verify transactions on a blockchain in order to maintain transparency and trust in the system.","defi-term":"DeFi","defi-definition":"A broad category of Ethereum apps aiming to provide financial services backed by the blockchain, without any intermediaries. \u003ca href=\"/defi/\"\u003eMore on decentralized finance (DeFi)\u003c/a\u003e","dex-term":"Decentralized exchange (DEX)","dex-definition":"A type of Ethereum app that lets you swap tokens with peers on the network. DEXes are not subject to geographical restrictions like centralized exchanges  anyone can participate.","difficulty-bomb-term":"Difficulty bomb","difficulty-bomb-definition":"Planned exponential increase in \u003ca href=\"/glossary/#pow\"\u003eproof-of-work\u003c/a\u003e \u003ca href=\"/glossary/#difficulty\"\u003edifficulty\u003c/a\u003e setting that was designed to motivate the transition to \u003ca href=\"/glossary/#pos\"\u003eproof-of-stake\u003c/a\u003e, reducing the chances of a \u003ca href=\"/glossary/#hard-fork\"\u003efork\u003c/a\u003e. The difficulty bomb was deprecated with \u003ca href=\"/roadmap/merge\"\u003ethe Merge\u003c/a\u003e.","ecdsa-term":"Elliptic Curve Digital Signature Algorithm (ECDSA)","ecdsa-definition":"A cryptographic algorithm used by Ethereum to ensure that funds can only be spent by their owners. It's the preferred method for creating public and private keys. Relevant for account \u003ca href=\"/glossary/#address\"\u003eaddress\u003c/a\u003e generation and \u003ca href=\"/glossary/#transaction\"\u003etransaction\u003c/a\u003e verification.","ens-term":"Ethereum Name Service (ENS)","ens-definition":"Ethereum Name Service is like an internet phonebook for Ethereum addresses. Instead of using long  wallet addresses, ENS lets you use simple names like \"john.eth\" to send and receive digital money and assets.","epoch-term":"Epoch","epoch-definition":"A period of 32 \u003ca href=\"/glossary/#slot\"\u003eslots\u003c/a\u003e, each slot being 12 seconds, totalling 6.4 minutes. Validator \u003ca href=\"/glossary/#committee\"\u003ecommittees\u003c/a\u003e are shuffled every epoch for security reasons. Each epoch has an opportunity for the chain to be \u003ca href=\"/glossary/#finality\"\u003efinalized\u003c/a\u003e. Each validator is assigned new responsibilities at the start of each epoch. \u003ca href=\"/developers/docs/consensus-mechanisms/pos/#how-does-validation-work\"\u003eMore on proof-of-stake\u003c/a\u003e","eoa-term":"Externally owned account (EOA)","eoa-definition":"Externally Owned Accounts (EOAs) are the most common type of Ethereum account. They are controlled by a person through private keys/recovery phrase. \u003ca href=\"/wallets/\"\u003eMore on Ethereum wallets\u003c/a\u003e.","erc-term":"Ethereum Request for Comments (ERC)","erc-definition":"ERC (\u003cstrong\u003eEthereum Request for Comments\u003c/strong\u003e) is a type of technical documentation used in the Ethereum community to propose new standards of usage for the Ethereum network.","erc-1155-term":"ERC-1155","erc-1155-definition":"A type of Ethereum token standard similar to NFT (like unique collectible items) that also allows to create interchangeable items (like currency) within a single smart contract.","erc-20-term":"ERC-20","erc-20-definition":"Is the standard set of rules that most tokens on Ethereum network are created with.","erc-721-term":"ERC-721","erc-721-definition":"A standard set of rules used to create NFTs (non fungible tokens).","ether-term":"Ether","ether-definition":"The native cryptocurrency of Ethereum, commonly referred to as ETH. It is used to cover transaction fees when using Ethereum ecosystem and applications. \u003ca href=\"/eth/\"\u003eMore on ether\u003c/a\u003e.","events-term":"Events","events-definition":"Allows the use of \u003ca href=\"/glossary/#evm\"\u003eEVM\u003c/a\u003e logging facilities. \u003ca href=\"/glossary/#dapp\"\u003eDapps\u003c/a\u003e can listen for events and use them to trigger JavaScript callbacks in the user interface. \u003ca href=\"/developers/docs/smart-contracts/anatomy/#events-and-logs\"\u003eMore on events and logs\u003c/a\u003e","execution-client-term":"Execution client","execution-client-definition":"Execution clients (formerly known as \"Eth1 clients\"), such as Besu, Erigon, Go-Ethereum (Geth), Nethermind, are tasked with processing and broadcasting transactions and managing Ethereum's state. They run the computations for each transaction using the \u003ca href=\"/glossary/#evm\"\u003eEthereum Virtual Machine\u003c/a\u003e to ensure that the rules of the protocol are followed.","execution-layer-term":"Execution layer","execution-layer-definition":"Ethereum's execution layer is the network of \u003ca href=\"/glossary/#execution-client\"\u003eexecution clients\u003c/a\u003e.","finality-term":"Finality","finality-definition":"Finality is the guarantee that a set of transactions cannot be changed without a huge amount of ETH being lost.","fork-term":"Fork","fork-definition":"A change in protocol causing the creation of an alternative chain.","fraud-proof-term":"Fraud proof","fraud-proof-definition":"A security model for certain \u003ca href=\"/glossary/#layer-2\"\u003elayer 2\u003c/a\u003e solutions where, to increase speed, transactions are \u003ca href=\"/glossary/#rollups\"\u003erolled up\u003c/a\u003e into batches and submitted to Ethereum in a single transaction. Other network participants can re-execute the transactions to check that they were executed honestly. If they uncover a discrepancy between the posted data and their own version they can post a cryptographic proof that demonstrates where some fraud took place. Some \u003ca href=\"/glossary/#rollups\"\u003erollups\u003c/a\u003e use \u003ca href=\"/glossary/#validity-proof\"\u003evalidity proofs\u003c/a\u003e.","gas-term":"Gas","gas-definition":"Gas is the fee paid for transactions and smart contracts on a blockchain, like Ethereum. \u003ca href=\"/gas/\"\u003eMore on gas and fees\u003c/a\u003e.","genesis-block-term":"Genesis block","genesis-block-definition":"The first block in a \u003ca href=\"/glossary/#blockchain\"\u003eblockchain\u003c/a\u003e, used to initialize a particular network and its cryptocurrency.","gwei-term":"Gwei","gwei-definition":"Short for gigawei, a denomination of \u003ca href=\"/glossary/#ether\"\u003eether\u003c/a\u003e, commonly utilized to price \u003ca href=\"/glossary/#gas\"\u003egas\u003c/a\u003e. 1 gwei = 10\u003csup\u003e9\u003c/sup\u003e \u003ca href=\"/glossary/#wei\"\u003ewei\u003c/a\u003e. 10\u003csup\u003e9\u003c/sup\u003e gwei = 1 ether.","hash-term":"Hash","hash-definition":"A fixed-length fingerprint of variable-size input, produced by a hash function. (See \u003ca href=\"/glossary/#keccak-256\"\u003ekeccak-256\u003c/a\u003e).","holographic-consensus-term":"Holographic consensus","holographic-consensus-definition":"Refers to how a big group decision is made by letting a smaller group of representative people vote. Then everyone else agrees to go along with it, as long as they trust the small group did a good job.","index-term":"Index","index-definition":"A network structure meant to optimize the querying of information from across the \u003ca href=\"/glossary/#blockchain\"\u003eblockchain\u003c/a\u003e by providing an efficient path to its storage source.","key-term":"Key","key-definition":"In the context of Ethereum, keys are digital codes: a public key for receiving transactions and a private key for accessing and sending funds.","layer-2-term":"Layer 2","layer-2-definition":"Layer 2s are another networks built on top of Ethereum main network to make transactions faster and cheaper. \u003ca href=\"/layer-2/\"\u003eMore on layer 2\u003c/a\u003e.","liquidity-tokens-term":"Liquidity tokens","liquidity-tokens-definition":"Liquidity tokens (LT) are digital tokens issued to participants who deposit assets into a liquidity pool, which is a collection of funds locked in a smart contract and used to facilitate trading on a decentralized exchange (DEX).","mainnet-term":"Mainnet","mainnet-definition":"Short for \"main network,\" this is the main public Ethereum \u003ca href=\"/glossary/#blockchain\"\u003eblockchain\u003c/a\u003e.","mev-term":"MEV","mev-definition":"A mechanism prioritizing certain actions on a blockchain for a fee, influencing outcomes and the order of transactions.","multisig-term":"Multisig","multisig-definition":"Multisig (multi signature) refers to a digital wallet or account that requires multiple signatures or approvals to execute transactions, enhancing security.","nft-term":"Non-fungible token (NFT)","nft-definition":"Non-fungible-token (NFT ) is a unique digital item you can own, like art or collectibles, verified by blockchain technology. \u003ca href=\"/nft/\"\u003eMore on Non-Fungible Tokens (NFTs)\u003c/a\u003e.","node-term":"Node","node-definition":"A software client that participates in the network. \u003ca href=\"/developers/docs/nodes-and-clients/\"\u003eMore on nodes and clients\u003c/a\u003e.","ommer-term":"Ommer (uncle) block","ommer-definition":"When a proof-of-work \u003ca href=\"/glossary/#miner\"\u003eminer\u003c/a\u003e finds a valid \u003ca href=\"/glossary/#block\"\u003eblock\u003c/a\u003e, another miner may have published a competing block which is added to the tip of the blockchain first. This valid, but stale, block can be included by newer blocks as \u003cem\u003eommers\u003c/em\u003e and receive a partial block reward. The term \"ommer\" is the preferred gender-neutral term for the sibling of a parent block, but this is also sometimes referred to as an \"uncle\". This was common for Ethereum when it was a \u003ca href=\"/glossary/#pow\"\u003eproof-of-work\u003c/a\u003e network. Now that Ethereum uses \u003ca href=\"/glossary/#pos\"\u003eproof-of-stake\u003c/a\u003e, only one block proposer is selected per slot.","on-chain-term":"On-chain","on-chain-definition":"Refers to actions or transactions that happen on the blockchain and are publicly available.","optimistic-rollup-term":"Optimistic rollup","optimistic-rollup-definition":"Optimistic Rollup is a Layer 2 solution that speeds up transactions on Ethereum, assuming they're valid by default unless challenged. \u003ca href=\"/developers/docs/scaling/optimistic-rollups/\"\u003eMore on Optimistic rollups\u003c/a\u003e.","peer-to-peer-network-term":"Peer-to-peer network","peer-to-peer-network-definition":"A network of computers (peers) that are collectively able to perform functionalities without the need for centralized, server-based services.","permissionless-term":"Permissionless","permissionless-definition":"No permission or approval is needed to use a system like Ethereum and nobody can stop you from using it. It's open 24/7 for everyone to participate.","private-key-term":"Private key","private-key-definition":"A private key is a secret code that proves you own your digital money and lets you spend it, like a PIN for your account. \u003cstrong\u003eDO NOT SHARE IT\u003c/strong\u003e.","poap-term":"POAP","poap-definition":"Proof of Attendance Protocol is used to create a digital collectible (NFT) that proves you attended a specific event or activity.","pos-term":"Proof-of-stake (PoS)","pos-definition":"A method by which a cryptocurrency blockchain protocol aims to achieve distributed \u003ca href=\"/glossary/#consensus\"\u003econsensus\u003c/a\u003e. PoS asks users to prove ownership of a certain amount of cryptocurrency (their \"stake\" in the network) in order to be able to participate in the validation of transactions. \u003ca href=\"/developers/docs/consensus-mechanisms/pos/\"\u003eMore on proof-of-stake\u003c/a\u003e.","pow-term":"Proof-of-work (PoW)","pow-definition":"A security mechanism for blockchains that requires nodes to expend energy in the form of computation to find a certain value.","public-goods-term":"Public goods","public-goods-definition":"Public goods are things everyone can use for free, like parks or clean air, and using them doesnt stop others from using them too. Governments often provide these because businesses usually wont, since they cant easily charge people for using them.","public-key-term":"Public key","public-key-definition":"A public key is a set of characters that lets others send you digital currency securely, like an email address for money.","quadratic-voting-term":"Quadratic voting","quadratic-voting-definition":"Is a voting method where voters express how strongly they feel about issues. It allows voters to show not just preference, but also the intensity of their preference.","recovery-phrase-term":"Seed phrase/recovery phrase","recovery-phrase-definition":"A list of words given to you when you create a digital wallet. It acts like a  password that can help you get back into your wallet if you lose access, making sure you don't lose your digital money or tokens.","rollups-term":"Rollups","rollups-definition":"A type of \u003ca href=\"/glossary/#layer-2\"\u003elayer 2\u003c/a\u003e scaling solution that batches multiple transactions and submits them to \u003ca href=\"/glossary/#mainnet\"\u003ethe Ethereum main chain\u003c/a\u003e in a single transaction. This allows for reductions in \u003ca href=\"/glossary/#gas\"\u003egas\u003c/a\u003e costs and increases in \u003ca href=\"/glossary/#transaction\"\u003etransaction\u003c/a\u003e throughput. There are Optimistic and Zero-knowledge rollups which use different security methods to offer these scalability gains. \u003ca href=\"/developers/docs/scaling/#rollups\"\u003eMore on rollups\u003c/a\u003e.","rpc-term":"Remote procedure call (RPC)","rpc-definition":"RPC lets one computer request data or action from another over a network, like asking for info with a remote control.","sequencer-term":"Sequencer","sequencer-definition":"A sequencer is a program responsible for ordering transactions in a blockchain network.","smart-contract-term":"Smart contract","smart-contract-definition":"A smart contract is a program that automatically executes agreements on a blockchain, like a self-enforcing digital contract. \u003ca href=\"/smart-contracts/\"\u003eIntroduction to smart contracts\u003c/a\u003e.","stablecoin-term":"Stablecoin","stablecoin-definition":"A stablecoin is a type of cryptocurrency designed to have a stable value, often pegged to a currency or commodity (like US dollar), to minimize price volatility. \u003ca href=\"/stablecoins/\"\u003eMore on stablecoins\u003c/a\u003e.","staking-term":"Staking","staking-definition":"Depositing a quantity of \u003ca href=\"/glossary/#ether\"\u003eether\u003c/a\u003e (your stake) to become a validator and secure the \u003ca href=\"/glossary/#network\"\u003enetwork\u003c/a\u003e. A validator checks \u003ca href=\"/glossary/#transaction\"\u003etransactions\u003c/a\u003e and proposes \u003ca href=\"/glossary/#block\"\u003eblocks\u003c/a\u003e under a \u003ca href=\"/glossary/#pos\"\u003eproof-of-stake\u003c/a\u003e consensus model. Staking gives you an economic incentive to act in the best interests of the network. You'll get rewards for carrying out your \u003ca href=\"/glossary/#validator\"\u003evalidator\u003c/a\u003e duties, but lose varying amounts of ETH if you don't. \u003ca href=\"/staking/\"\u003eMore on Ethereum staking\u003c/a\u003e.","staking-pool-term":"Staking pool","staking-pool-definition":"The combined ETH of more than one Ethereum staker, used to reach the 32 ETH required to activate a set of validator keys. A node operator uses these keys to participate in consensus and the \u003ca href=\"/glossary/#block-reward\"\u003eblock rewards\u003c/a\u003e are split amongst contributing stakers. Staking pools or delegating staking are not native to the Ethereum protocol, but many solutions have been built by the community. \u003ca href=\"/staking/pools/\"\u003eMore on pooled staking\u003c/a\u003e.","terminal-total-difficulty-term":"Terminal total difficulty (TTD)","terminal-total-difficulty-definition":"The total difficulty is the sum of the Ethash mining difficulty for all blocks up to some specific point in the blockchain. The terminal total difficulty is a specific value for the total difficulty that was used as the trigger for execution clients to switch off their mining and block gossip functions enabling the network to transition to proof-of-stake. It is no longer relevant because Ethereum moved to \u003ca href=\"/glossary/#pos\"\u003eproof-of-stake\u003c/a\u003e.","transaction-fee-term":"Transaction fee","transaction-fee-definition":"A fee you need to pay whenever you use the Ethereum network. Examples include sending funds from your \u003ca href=\"/glossary/#wallet\"\u003ewallet\u003c/a\u003e or a \u003ca href=\"/glossary/#dapp\"\u003edapp\u003c/a\u003e interaction, like swapping tokens or buying a collectable. You can think of this like a service charge. This fee will change based on how busy the network is. This is because \u003ca href=\"/glossary/#validator\"\u003evalidators\u003c/a\u003e, the people responsible for processing your transaction, are likely to prioritize transactions with higher fees  so congestion forces the price up.\u003cbr/\u003e\u003cbr/\u003eAt a technical level, your transaction fee relates to how much \u003ca href=\"/glossary/#gas\"\u003egas\u003c/a\u003e your transaction requires.\u003cbr/\u003e\u003cbr/\u003eReducing transaction fees is a subject of intense interest right now. See \u003ca href=\"/glossary/#layer-2\"\u003eLayer 2\u003c/a\u003e.","trust-assumptions-term":"Trust assumptions","trust-assumptions-definition":"Trust assumptions are basic beliefs about a system's safety and dependability, guiding what we trust for the system to function.","validator-term":"Validator","validator-definition":"A \u003ca href=\"/glossary/#node\"\u003enode\u003c/a\u003e in a \u003ca href=\"/glossary/#pos\"\u003eproof-of-stake\u003c/a\u003e system responsible for storing data, processing transactions, and adding new blocks to the blockchain. To activate validator software, you need to be able to \u003ca href=\"/glossary/#staking\"\u003estake\u003c/a\u003e 32 ETH. \u003ca href=\"/staking/\"\u003eMore on staking in Ethereum\u003c/a\u003e.","validity-proof-term":"Validity proof","validity-proof-definition":"A security model for certain \u003ca href=\"/glossary/#layer-2\"\u003elayer 2\u003c/a\u003e solutions where, to increase speed, transactions are rolled up into batches and submitted to Ethereum in a single transaction. The transaction computation is done off-chain and then supplied to the main chain with a proof of their validity. This method increases the amount of transactions possible while maintaining security. Some \u003ca href=\"/glossary/#rollups\"\u003erollups\u003c/a\u003e use \u003ca href=\"/glossary/#fraud-proof\"\u003efraud proof\u003c/a\u003e. \u003ca href=\"/developers/docs/scaling/zk-rollups/\"\u003eMore on zero-knowledge rollups\u003c/a\u003e.","wallet-term":"Wallet","wallet-definition":"A wallet is a digital tool to store, send, and receive digital currency, like a virtual purse for your online money. \u003ca href=\"/wallets/\"\u003eMore on Ethereum wallets\u003c/a\u003e.","web2-term":"Web2","web2-definition":"Is the current internet, focused on user-generated content and social media that are controlled by few companies. Web3 is a crypto belief that users should control their data and transactions instead.","web3-term":"Web3","web3-definition":"Web3 is the new internet with blockchain, where users control their data and transactions, not companies. No need to share any personal information. \u003ca href=\"/web3/\"\u003eMore on web3\u003c/a\u003e.","wei-term":"Wei","wei-definition":"The smallest denomination of ether. 10\u003csup\u003e18\u003c/sup\u003e wei = 1 ether.","zk-proof-term":"Zero-knowledge proof","zk-proof-definition":"A zero-knowledge proof is a cryptographic method that allows an individual to prove that a statement is true without conveying any additional information. \u003ca href=\"/developers/docs/scaling/zk-rollups/\"\u003eMore on zero-knowledge rollups\u003c/a\u003e."}}},"initialLocale":"en","ns":["common","page-developers-tutorials","glossary-tooltip","page-developers-tutorials"],"userConfig":{"i18n":{"defaultLocale":"default","locales":["default","en","am","ar","az","be","bg","bn","bs","ca","cs","da","de","el","es","fa","fi","fr","gl","gu","he","hi","hr","hu","hy-am","id","ig","it","ja","ka","kk","km","kn","ko","lt","ml","mr","ms","ne-np","nl","nb","pcm","fil","pl","pt-br","pt","ro","ru","se","sk","sl","sr","sw","ta","te","tk","th","tr","uk","ur","uz","vi","zh-tw","zh"],"localeDetection":false},"localePath":"./src/intl","reloadOnPrerender":true,"load":"currentOnly","cleanCode":true,"lowerCaseLng":true,"default":{"i18n":{"defaultLocale":"default","locales":["default","en","am","ar","az","be","bg","bn","bs","ca","cs","da","de","el","es","fa","fi","fr","gl","gu","he","hi","hr","hu","hy-am","id","ig","it","ja","ka","kk","km","kn","ko","lt","ml","mr","ms","ne-np","nl","nb","pcm","fil","pl","pt-br","pt","ro","ru","se","sk","sl","sr","sw","ta","te","tk","th","tr","uk","ur","uz","vi","zh-tw","zh"],"localeDetection":false},"localePath":"./src/intl","reloadOnPrerender":true,"load":"currentOnly","cleanCode":true,"lowerCaseLng":true}}},"mdxSource":{"compiledSource":"var u=Object.defineProperty,h=Object.defineProperties;var c=Object.getOwnPropertyDescriptors;var i=Object.getOwnPropertySymbols;var o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;var p=(t,a,n)=\u003ea in t?u(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,e=(t,a)=\u003e{for(var n in a||(a={}))o.call(a,n)\u0026\u0026p(t,n,a[n]);if(i)for(var n of i(a))s.call(a,n)\u0026\u0026p(t,n,a[n]);return t},d=(t,a)=\u003eh(t,c(a));var l=(t,a)=\u003e{var n={};for(var r in t)o.call(t,r)\u0026\u0026a.indexOf(r)\u003c0\u0026\u0026(n[r]=t[r]);if(t!=null\u0026\u0026i)for(var r of i(t))a.indexOf(r)\u003c0\u0026\u0026s.call(t,r)\u0026\u0026(n[r]=t[r]);return n};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(n){var r=n,{components:t}=r,a=l(r,[\"components\"]);return mdx(MDXLayout,d(e(e({},layoutProps),a),{components:t,mdxType:\"MDXLayout\"}),mdx(\"h2\",e({},{id:\"introduction\"}),\"Introduction\"),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://uniswap.org/whitepaper.pdf\"}),\"Uniswap v2\"),\" can create an exchange market between any two ERC-20 tokens. In this article we will go over the source code for the contracts that implement this protocol and see why they are written this way.\"),mdx(\"h3\",e({},{id:\"what-does-uniswap-do\"}),\"What Does Uniswap Do?\"),mdx(\"p\",null,\"Basically, there are two types of users: liquidity providers and traders.\"),mdx(\"p\",null,\"The \",mdx(\"em\",{parentName:\"p\"},\"liquidity providers\"),\" provide the pool with the two tokens that can be exchanged (we'll call them \",mdx(\"strong\",{parentName:\"p\"},\"Token0\"),\" and \",mdx(\"strong\",{parentName:\"p\"},\"Token1\"),\"). In return, they receive a third token that represents partial ownership of the pool called a \",mdx(\"em\",{parentName:\"p\"},\"liquidity token\"),\".\"),mdx(\"p\",null,mdx(\"em\",{parentName:\"p\"},\"Traders\"),\" send one type of token to the pool and receive the other (for example, send \",mdx(\"strong\",{parentName:\"p\"},\"Token0\"),\" and receive \",mdx(\"strong\",{parentName:\"p\"},\"Token1\"),\") out of the pool provided by the liquidity providers. The exchange rate is determined by the relative number of \",mdx(\"strong\",{parentName:\"p\"},\"Token0\"),\"s and \",mdx(\"strong\",{parentName:\"p\"},\"Token1\"),\"s that the pool has. In addition, the pool takes a small percent as a reward for the liquidity pool.\"),mdx(\"p\",null,\"When liquidity providers want their assets back they can burn the pool tokens and receive back their tokens, including their share of the rewards.\"),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.uniswap.org/contracts/v2/concepts/core-concepts/swaps/\"}),\"Click here for a fuller description\"),\".\"),mdx(\"h3\",e({},{id:\"why-v2\"}),\"Why v2? Why not v3?\"),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://uniswap.org/whitepaper-v3.pdf\"}),\"Uniswap v3\"),\" is an upgrade that is much more complicated than the v2. It is easier to first learn v2 and then go to v3.\"),mdx(\"h3\",e({},{id:\"contract-types\"}),\"Core Contracts vs Periphery Contracts\"),mdx(\"p\",null,\"Uniswap v2 is divided into two components, a core and a periphery. This division allows the core contracts, which hold the assets and therefore \",mdx(\"em\",{parentName:\"p\"},\"have\"),\" to be secure, to be simpler and easier to audit. All the extra functionality required by traders can then be provided by periphery contracts.\"),mdx(\"h2\",e({},{id:\"flows\"}),\"Data and Control Flows\"),mdx(\"p\",null,\"This is the flow of data and control that happens when you perform the three main actions of Uniswap:\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"Swap between different tokens\"),mdx(\"li\",{parentName:\"ol\"},\"Add liquidity to the market and get rewarded with pair exchange ERC-20 liquidity tokens\"),mdx(\"li\",{parentName:\"ol\"},\"Burn ERC-20 liquidity tokens and get back the ERC-20 tokens that the pair exchange allows traders to exchange\")),mdx(\"h3\",e({},{id:\"swap-flow\"}),\"Swap\"),mdx(\"p\",null,\"This is most common flow, used by traders:\"),mdx(\"h4\",e({},{id:\"caller\"}),\"Caller\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"Provide the periphery account with an allowance in the amount to be swapped.\"),mdx(\"li\",{parentName:\"ol\"},`Call one of the periphery contract's many swap functions (which one depends on whether ETH is involved or not, whether the trader specifies the amount of tokens to deposit or the amount of tokens to get back, etc).\nEvery swap function accepts a `,mdx(\"inlineCode\",{parentName:\"li\"},\"path\"),\", an array of exchanges to go through.\")),mdx(\"h4\",e({},{id:\"in-the-periphery-contract-uniswapv2router02-sol\"}),\"In the periphery contract (UniswapV2Router02.sol)\"),mdx(\"ol\",e({},{start:3}),mdx(\"li\",{parentName:\"ol\"},\"Identify the amounts that need to be traded on each exchange along the path.\"),mdx(\"li\",{parentName:\"ol\"},\"Iterates over the path. For every exchange along the way it sends the input token and then calls the exchange's \",mdx(\"inlineCode\",{parentName:\"li\"},\"swap\"),` function.\nIn most cases the destination address for the tokens is the next pair exchange in the path. In the final exchange it is the address provided by the trader.`)),mdx(\"h4\",e({},{id:\"in-the-core-contract-uniswapv2pairsol-2\"}),\"In the core contract (UniswapV2Pair.sol)\"),mdx(\"ol\",e({},{start:5}),mdx(\"li\",{parentName:\"ol\"},\"Verify that the core contract is not being cheated and can maintain sufficient liquidity after the swap.\"),mdx(\"li\",{parentName:\"ol\"},\"See how many extra tokens we have in addition to the known reserves. That amount is the number of input tokens we received to exchange.\"),mdx(\"li\",{parentName:\"ol\"},\"Send the output tokens to the destination.\"),mdx(\"li\",{parentName:\"ol\"},\"Call \",mdx(\"inlineCode\",{parentName:\"li\"},\"_update\"),\" to update the reserve amounts\")),mdx(\"h4\",e({},{id:\"back-in-the-periphery-contract-uniswapv2router02-sol\"}),\"Back in the periphery contract (UniswapV2Router02.sol)\"),mdx(\"ol\",e({},{start:9}),mdx(\"li\",{parentName:\"ol\"},\"Perform any necessary cleanup (for example, burn WETH tokens to get back ETH to send the trader)\")),mdx(\"h3\",e({},{id:\"add-liquidity-flow\"}),\"Add Liquidity\"),mdx(\"h4\",e({},{id:\"caller-2\"}),\"Caller\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"Provide the periphery account with an allowance in the amounts to be added to the liquidity pool.\"),mdx(\"li\",{parentName:\"ol\"},\"Call one of the periphery contract's \",mdx(\"inlineCode\",{parentName:\"li\"},\"addLiquidity\"),\" functions.\")),mdx(\"h4\",e({},{id:\"in-the-periphery-contract-uniswapv2router02sol-2\"}),\"In the periphery contract (UniswapV2Router02.sol)\"),mdx(\"ol\",e({},{start:3}),mdx(\"li\",{parentName:\"ol\"},\"Create a new pair exchange if necessary\"),mdx(\"li\",{parentName:\"ol\"},\"If there is an existing pair exchange, calculate the amount of tokens to add. This is supposed to be identical value for both tokens, so the same ratio of new tokens to existing tokens.\"),mdx(\"li\",{parentName:\"ol\"},\"Check if the amounts are acceptable (callers can specify a minimum amount below which they'd rather not add liquidity)\"),mdx(\"li\",{parentName:\"ol\"},\"Call the core contract.\")),mdx(\"h4\",e({},{id:\"in-the-core-contract-uniswapv2pairsol-2\"}),\"In the core contract (UniswapV2Pair.sol)\"),mdx(\"ol\",e({},{start:7}),mdx(\"li\",{parentName:\"ol\"},\"Mint liquidity tokens and send them to the caller\"),mdx(\"li\",{parentName:\"ol\"},\"Call \",mdx(\"inlineCode\",{parentName:\"li\"},\"_update\"),\" to update the reserve amounts\")),mdx(\"h3\",e({},{id:\"remove-liquidity-flow\"}),\"Remove Liquidity\"),mdx(\"h4\",e({},{id:\"caller-3\"}),\"Caller\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"Provide the periphery account with an allowance of liquidity tokens to be burned in exchange for the underlying tokens.\"),mdx(\"li\",{parentName:\"ol\"},\"Call one of the periphery contract's \",mdx(\"inlineCode\",{parentName:\"li\"},\"removeLiquidity\"),\" functions.\")),mdx(\"h4\",e({},{id:\"in-the-periphery-contract-uniswapv2router02sol-3\"}),\"In the periphery contract (UniswapV2Router02.sol)\"),mdx(\"ol\",e({},{start:3}),mdx(\"li\",{parentName:\"ol\"},\"Send the liquidity tokens to the pair exchange\")),mdx(\"h4\",e({},{id:\"in-the-core-contract-uniswapv2pairsol-3\"}),\"In the core contract (UniswapV2Pair.sol)\"),mdx(\"ol\",e({},{start:4}),mdx(\"li\",{parentName:\"ol\"},\"Send the destination address the underlying tokens in proportion to the burned tokens. For example if there are 1000 A tokens in the pool, 500 B tokens, and 90 liquidity tokens, and we receive 9 tokens to burn, we're burning 10% of the liquidity tokens so we send back the user 100 A tokens and 50 B tokens.\"),mdx(\"li\",{parentName:\"ol\"},\"Burn the liquidity tokens\"),mdx(\"li\",{parentName:\"ol\"},\"Call \",mdx(\"inlineCode\",{parentName:\"li\"},\"_update\"),\" to update the reserve amounts\")),mdx(\"h2\",e({},{id:\"core-contracts\"}),\"The Core Contracts\"),mdx(\"p\",null,\"These are the secure contracts which hold the liquidity.\"),mdx(\"h3\",e({},{id:\"uniswapv2pair\"}),\"UniswapV2Pair.sol\"),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/Uniswap/uniswap-v2-core/blob/master/contracts/UniswapV2Pair.sol\"}),\"This contract\"),\" implements the actual pool that exchanges tokens. It is the core Uniswap functionality.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`pragma solidity =0.5.16;\n\nimport './interfaces/IUniswapV2Pair.sol';\nimport './UniswapV2ERC20.sol';\nimport './libraries/Math.sol';\nimport './libraries/UQ112x112.sol';\nimport './interfaces/IERC20.sol';\nimport './interfaces/IUniswapV2Factory.sol';\nimport './interfaces/IUniswapV2Callee.sol';\n`)),mdx(\"p\",null,\"These are all the interfaces that the contract needs to know about, either because the contract implements them (\",mdx(\"inlineCode\",{parentName:\"p\"},\"IUniswapV2Pair\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"UniswapV2ERC20\"),\") or because it calls contracts that implement them.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`contract UniswapV2Pair is IUniswapV2Pair, UniswapV2ERC20 {\n`)),mdx(\"p\",null,\"This contract inherits from \",mdx(\"inlineCode\",{parentName:\"p\"},\"UniswapV2ERC20\"),\", which provides the ERC-20 functions for the liquidity tokens.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    using SafeMath  for uint;\n`)),mdx(\"p\",null,\"The \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.openzeppelin.com/contracts/2.x/api/math\"}),\"SafeMath library\"),\" is used to avoid overflows and underflows. This is important because otherwise we might end up with a situation where a value should be \",mdx(\"inlineCode\",{parentName:\"p\"},\"-1\"),\", but is instead \",mdx(\"inlineCode\",{parentName:\"p\"},\"2^256-1\"),\".\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    using UQ112x112 for uint224;\n`)),mdx(\"p\",null,`A lot of calculations in the pool contract require fractions. However, fractions are not supported by the EVM.\nThe solution that Uniswap found is to use 224 bit values, with 112 bits for the integer part, and 112 bits for the fraction. So `,mdx(\"inlineCode\",{parentName:\"p\"},\"1.0\"),\" is represented as \",mdx(\"inlineCode\",{parentName:\"p\"},\"2^112\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"1.5\"),\" is represented as \",mdx(\"inlineCode\",{parentName:\"p\"},\"2^112 + 2^111\"),\", etc.\"),mdx(\"p\",null,\"More details about this library are available \",mdx(\"a\",e({parentName:\"p\"},{href:\"#FixedPoint\"}),\"later in the document\"),\".\"),mdx(\"h4\",e({},{id:\"pair-vars\"}),\"Variables\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    uint public constant MINIMUM_LIQUIDITY = 10**3;\n`)),mdx(\"p\",null,\"To avoid cases of division by zero, there is a minimum number of liquidity tokens that always exist (but are owned by account zero). That number is \",mdx(\"strong\",{parentName:\"p\"},\"MINIMUM_LIQUIDITY\"),\", a thousand.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    bytes4 private constant SELECTOR = bytes4(keccak256(bytes('transfer(address,uint256)')));\n`)),mdx(\"p\",null,\"This is the ABI selector for the ERC-20 transfer function. It is used to transfer ERC-20 tokens in the two token accounts.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    address public factory;\n`)),mdx(\"p\",null,\"This is the factory contract that created this pool. Every pool is an exchange between two ERC-20 tokens, the factory is a central point that connects all of these pools.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    address public token0;\n    address public token1;\n`)),mdx(\"p\",null,\"There are the addresses of the contracts for the two types of ERC-20 tokens that can be exchanged by this pool.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    uint112 private reserve0;           // uses single storage slot, accessible via getReserves\n    uint112 private reserve1;           // uses single storage slot, accessible via getReserves\n`)),mdx(\"p\",null,\"The reserves the pool has for each token type. We assume that the two represent the same amount of value, and therefore each token0 is worth reserve1/reserve0 token1's.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    uint32  private blockTimestampLast; // uses single storage slot, accessible via getReserves\n`)),mdx(\"p\",null,\"The timestamp for the last block in which an exchange occurred, used to track exchange rates across time.\"),mdx(\"p\",null,\"One of the biggest gas expenses of Ethereum contracts is storage, which persists from one call of the contract to the next. Each storage cell is 256 bits long. So three variables, \",mdx(\"inlineCode\",{parentName:\"p\"},\"reserve0\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"reserve1\"),\", and \",mdx(\"inlineCode\",{parentName:\"p\"},\"blockTimestampLast\"),\", are allocated in such a way a single storage value can include all three of them (112+112+32=256).\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    uint public price0CumulativeLast;\n    uint public price1CumulativeLast;\n`)),mdx(\"p\",null,\"These variables hold the cumulative costs for each token (each in term of the other). They can be used to calculate the average exchange rate over a period of time.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    uint public kLast; // reserve0 * reserve1, as of immediately after the most recent liquidity event\n`)),mdx(\"p\",null,\"The way the pair exchange decides on the exchange rate between token0 and token1 is to keep the multiple of the two reserves constant during trades. \",mdx(\"inlineCode\",{parentName:\"p\"},\"kLast\"),\" is this value. It changes when a liquidity provider deposits or withdraws tokens, and it increases slightly because of the 0.3% market fee.\"),mdx(\"p\",null,\"Here is a simple example. Note that for the sake of simplicity the table only has three digits after the decimal point, and we ignore the 0.3% trading fee so the numbers are not accurate.\"),mdx(\"table\",null,mdx(\"thead\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"thead\"},mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"Event\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"reserve0\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"reserve1\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"reserve0 \",\"*\",\" reserve1\"),mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"Average exchange rate (token1 / token0)\"))),mdx(\"tbody\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Initial setup\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,000.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,000.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,000,000\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Trader A swaps 50 token0 for 47.619 token1\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,050.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"952.381\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,000,000\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"0.952\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Trader B swaps 10 token0 for 8.984 token1\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,060.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"943.396\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,000,000\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"0.898\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Trader C swaps 40 token0 for 34.305 token1\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,100.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"909.090\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,000,000\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"0.858\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Trader D swaps 100 token1 for 109.01 token0\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"990.990\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,009.090\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,000,000\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"0.917\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Trader E swaps 10 token0 for 10.079 token1\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,000.990\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"999.010\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,000,000\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"1.008\")))),mdx(\"p\",null,\"As traders provide more of token0, the relative value of token1 increases, and vice versa, based on supply and demand.\"),mdx(\"h4\",e({},{id:\"pair-lock\"}),\"Lock\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    uint private unlocked = 1;\n`)),mdx(\"p\",null,\"There is a class of security vulnerabilities that are based on \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://medium.com/coinmonks/ethernaut-lvl-10-re-entrancy-walkthrough-how-to-abuse-execution-ordering-and-reproduce-the-dao-7ec88b912c14\"}),\"reentrancy abuse\"),`. Uniswap needs to transfer arbitrary ERC-20 tokens, which means calling ERC-20 contracts that may attempt to abuse the Uniswap market that calls them.\nBy having an `,mdx(\"inlineCode\",{parentName:\"p\"},\"unlocked\"),\" variable as part of the contract, we can prevent functions from being called while they are running (within the same transaction).\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    modifier lock() {\n`)),mdx(\"p\",null,\"This function is a \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.soliditylang.org/en/v0.8.3/contracts.html#function-modifiers\"}),\"modifier\"),\", a function that wraps around a normal function to change its behavior is some way.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        require(unlocked == 1, 'UniswapV2: LOCKED');\n        unlocked = 0;\n`)),mdx(\"p\",null,\"If \",mdx(\"inlineCode\",{parentName:\"p\"},\"unlocked\"),\" is equal to one, set it to zero. If it is already zero revert the call, make it fail.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        _;\n`)),mdx(\"p\",null,\"In a modifier \",mdx(\"inlineCode\",{parentName:\"p\"},\"_;\"),\" is the original function call (with all the parameters). Here it means that the function call only happens if \",mdx(\"inlineCode\",{parentName:\"p\"},\"unlocked\"),\" was one when it was called, and while it is running the value of \",mdx(\"inlineCode\",{parentName:\"p\"},\"unlocked\"),\" is zero.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        unlocked = 1;\n    }\n`)),mdx(\"p\",null,\"After the main function returns, release the lock.\"),mdx(\"h4\",e({},{id:\"pair-misc\"}),\"Misc. functions\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    function getReserves() public view returns (uint112 _reserve0, uint112 _reserve1, uint32 _blockTimestampLast) {\n        _reserve0 = reserve0;\n        _reserve1 = reserve1;\n        _blockTimestampLast = blockTimestampLast;\n    }\n`)),mdx(\"p\",null,\"This function provides callers with the current state of the exchange. Notice that Solidity functions \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.soliditylang.org/en/v0.8.3/contracts.html#returning-multiple-values\"}),\"can return multiple values\"),\".\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    function _safeTransfer(address token, address to, uint value) private {\n        (bool success, bytes memory data) = token.call(abi.encodeWithSelector(SELECTOR, to, value));\n`)),mdx(\"p\",null,\"This internal function transfers an amount of ERC20 tokens from the exchange to somebody else. \",mdx(\"inlineCode\",{parentName:\"p\"},\"SELECTOR\"),\" specifies that the function we are calling is \",mdx(\"inlineCode\",{parentName:\"p\"},\"transfer(address,uint)\"),\" (see definition above).\"),mdx(\"p\",null,'To avoid having to import an interface for the token function, we \"manually\" create the call using one of the ',mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.soliditylang.org/en/v0.8.3/units-and-global-variables.html#abi-encoding-and-decoding-functions\"}),\"ABI functions\"),\".\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        require(success \u0026\u0026 (data.length == 0 || abi.decode(data, (bool))), 'UniswapV2: TRANSFER_FAILED');\n    }\n`)),mdx(\"p\",null,\"There are two ways in which an ERC-20 transfer call can report failure:\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"Revert. If a call to an external contract reverts, then the boolean return value is \",mdx(\"inlineCode\",{parentName:\"li\"},\"false\")),mdx(\"li\",{parentName:\"ol\"},\"End normally but report a failure. In that case the return value buffer has a non-zero length, and when decoded as a boolean value it is \",mdx(\"inlineCode\",{parentName:\"li\"},\"false\"))),mdx(\"p\",null,\"If either of these conditions happen, revert.\"),mdx(\"h4\",e({},{id:\"pair-events\"}),\"Events\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    event Mint(address indexed sender, uint amount0, uint amount1);\n    event Burn(address indexed sender, uint amount0, uint amount1, address indexed to);\n`)),mdx(\"p\",null,\"These two events are emitted when a liquidity provider either deposits liquidity (\",mdx(\"inlineCode\",{parentName:\"p\"},\"Mint\"),\") or withdraws it (\",mdx(\"inlineCode\",{parentName:\"p\"},\"Burn\"),\"). In either case, the amounts of token0 and token1 that are deposited or withdrawn are part of the event, as well as the identity of the account that called us (\",mdx(\"inlineCode\",{parentName:\"p\"},\"sender\"),\"). In the case of a withdrawal, the event also includes the target that received the tokens (\",mdx(\"inlineCode\",{parentName:\"p\"},\"to\"),\"), which may not be the same as the sender.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    event Swap(\n        address indexed sender,\n        uint amount0In,\n        uint amount1In,\n        uint amount0Out,\n        uint amount1Out,\n        address indexed to\n    );\n`)),mdx(\"p\",null,`This event is emitted when a trader swaps one token for the other. Again, the sender and the destination may not be the same.\nEach token may be either sent to the exchange, or received from it.`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    event Sync(uint112 reserve0, uint112 reserve1);\n`)),mdx(\"p\",null,\"Finally, \",mdx(\"inlineCode\",{parentName:\"p\"},\"Sync\"),\" is emitted every time tokens are added or withdrawn, regardless of the reason, to provide the latest reserve information (and therefore the exchange rate).\"),mdx(\"h4\",e({},{id:\"pair-setup\"}),\"Setup Functions\"),mdx(\"p\",null,\"These functions are supposed to be called once when the new pair exchange is set up.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    constructor() public {\n        factory = msg.sender;\n    }\n`)),mdx(\"p\",null,\"The constructor makes sure we'll keep track of the address of the factory that created the pair. This information is required for \",mdx(\"inlineCode\",{parentName:\"p\"},\"initialize\"),\" and for the factory fee (if one exists)\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // called once by the factory at time of deployment\n    function initialize(address _token0, address _token1) external {\n        require(msg.sender == factory, 'UniswapV2: FORBIDDEN'); // sufficient check\n        token0 = _token0;\n        token1 = _token1;\n    }\n`)),mdx(\"p\",null,\"This function allows the factory (and only the factory) to specify the two ERC-20 tokens that this pair will exchange.\"),mdx(\"h4\",e({},{id:\"pair-update-internal\"}),\"Internal Update Functions\"),mdx(\"h5\",e({},{id:\"_update\"}),\"_\",\"update\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // update reserves and, on the first call per block, price accumulators\n    function _update(uint balance0, uint balance1, uint112 _reserve0, uint112 _reserve1) private {\n`)),mdx(\"p\",null,\"This function is called every time tokens are deposited or withdrawn.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        require(balance0 \u003c= uint112(-1) \u0026\u0026 balance1 \u003c= uint112(-1), 'UniswapV2: OVERFLOW');\n`)),mdx(\"p\",null,\"If either balance0 or balance1 (uint256) is higher than uint112(-1) (=2^112-1) (so it overflows \u0026 wraps back to 0 when converted to uint112) refuse to continue the \",\"_\",\"update to prevent overflows. With a normal token that can be subdivided into 10^18 units, this means each exchange is limited to about 5.1\",\"*\",\"10^15 of each tokens. So far that has not been a problem.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        uint32 blockTimestamp = uint32(block.timestamp % 2**32);\n        uint32 timeElapsed = blockTimestamp - blockTimestampLast; // overflow is desired\n        if (timeElapsed \u003e 0 \u0026\u0026 _reserve0 != 0 \u0026\u0026 _reserve1 != 0) {\n`)),mdx(\"p\",null,\"If the time elapsed is not zero, it means we are the first exchange transaction on this block. In that case, we need to update the cost accumulators.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`            // * never overflows, and + overflow is desired\n            price0CumulativeLast += uint(UQ112x112.encode(_reserve1).uqdiv(_reserve0)) * timeElapsed;\n            price1CumulativeLast += uint(UQ112x112.encode(_reserve0).uqdiv(_reserve1)) * timeElapsed;\n        }\n`)),mdx(\"p\",null,\"Each cost accumulator is updated with the latest cost (reserve of the other token/reserve of this token) times the elapsed time in seconds. To get an average price, you read the cumulative price in two points in time and divide by the time difference between them. For example, assume this sequence of events:\"),mdx(\"table\",null,mdx(\"thead\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"thead\"},mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"Event\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"reserve0\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"reserve1\"),mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"timestamp\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"Marginal exchange rate (reserve1 / reserve0)\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"price0CumulativeLast\"))),mdx(\"tbody\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Initial setup\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,000.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,000.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"5,000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"0\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Trader A deposits 50 token0 and gets 47.619 token1 back\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,050.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"952.381\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"5,020\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"0.907\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"20\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Trader B deposits 10 token0 and gets 8.984 token1 back\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,060.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"943.396\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"5,030\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"0.890\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"20+10\",\"*\",\"0.907 = 29.07\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Trader C deposits 40 token0 and gets 34.305 token1 back\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,100.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"909.090\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"5,100\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"0.826\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"29.07+70\",\"*\",\"0.890 = 91.37\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Trader D deposits 100 token1 and gets 109.01 token0 back\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"990.990\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,009.090\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"5,110\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1.018\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"91.37+10\",\"*\",\"0.826 = 99.63\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Trader E deposits 10 token0 and gets 10.079 token1 back\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1,000.990\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"999.010\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"5,150\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"0.998\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"99.63+40\",\"*\",\"1.1018 = 143.702\")))),mdx(\"p\",null,\"Let's say we want to calculate the average price of \",mdx(\"strong\",{parentName:\"p\"},\"Token0\"),\" between the timestamps 5,030 and 5,150. The difference in the value of \",mdx(\"inlineCode\",{parentName:\"p\"},\"price0Cumulative\"),\" is 143.702-29.07=114.632. This is the average across two minutes (120 seconds). So the average price is 114.632/120 = 0.955.\"),mdx(\"p\",null,\"This price calculation is the reason we need to know the old reserve sizes.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        reserve0 = uint112(balance0);\n        reserve1 = uint112(balance1);\n        blockTimestampLast = blockTimestamp;\n        emit Sync(reserve0, reserve1);\n    }\n`)),mdx(\"p\",null,\"Finally, update the global variables and emit a \",mdx(\"inlineCode\",{parentName:\"p\"},\"Sync\"),\" event.\"),mdx(\"h5\",e({},{id:\"_mintfee\"}),\"_\",\"mintFee\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // if fee is on, mint liquidity equivalent to 1/6th of the growth in sqrt(k)\n    function _mintFee(uint112 _reserve0, uint112 _reserve1) private returns (bool feeOn) {\n`)),mdx(\"p\",null,\"In Uniswap 2.0 traders pay a 0.30% fee to use the market. Most of that fee (0.25% of the trade) always goes to the liquidity providers. The remaining 0.05% can go either to the liquidity providers or to an address specified by the factory as a protocol fee, which pays Uniswap for their development effort.\"),mdx(\"p\",null,\"To reduce calculations (and therefore gas costs), this fee is only calculated when liquidity is added or removed from the pool, rather than at each transaction.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        address feeTo = IUniswapV2Factory(factory).feeTo();\n        feeOn = feeTo != address(0);\n`)),mdx(\"p\",null,\"Read the fee destination of the factory. If it is zero then there is no protocol fee and no need to calculate it that fee.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        uint _kLast = kLast; // gas savings\n`)),mdx(\"p\",null,\"The \",mdx(\"inlineCode\",{parentName:\"p\"},\"kLast\"),` state variable is located in storage, so it will have a value between different calls to the contract.\nAccess to storage is a lot more expensive than access to the volatile memory that is released when the function call to the contract ends, so we use an internal variable to save on gas.`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        if (feeOn) {\n            if (_kLast != 0) {\n`)),mdx(\"p\",null,\"The liquidity providers get their cut simply by the appreciation of their liquidity tokens. But the protocol fee requires new liquidity tokens to be minted and provided to the \",mdx(\"inlineCode\",{parentName:\"p\"},\"feeTo\"),\" address.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`                uint rootK = Math.sqrt(uint(_reserve0).mul(_reserve1));\n                uint rootKLast = Math.sqrt(_kLast);\n                if (rootK \u003e rootKLast) {\n`)),mdx(\"p\",null,\"If there is new liquidity on which to collect a protocol fee. You can see the square root function \",mdx(\"a\",e({parentName:\"p\"},{href:\"#Math\"}),\"later in this article\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`                    uint numerator = totalSupply.mul(rootK.sub(rootKLast));\n                    uint denominator = rootK.mul(5).add(rootKLast);\n                    uint liquidity = numerator / denominator;\n`)),mdx(\"p\",null,\"This complicated calculation of fees is explained in \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://uniswap.org/whitepaper.pdf\"}),\"the whitepaper\"),\" on page 5. We know that between the time \",mdx(\"inlineCode\",{parentName:\"p\"},\"kLast\"),\" was calculated and the present no liquidity was added or removed (because we run this calculation every time liquidity is added or removed, before it actually changes), so any change in \",mdx(\"inlineCode\",{parentName:\"p\"},\"reserve0 * reserve1\"),\" has to come from transaction fees (without them we'd keep \",mdx(\"inlineCode\",{parentName:\"p\"},\"reserve0 * reserve1\"),\" constant).\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`                    if (liquidity \u003e 0) _mint(feeTo, liquidity);\n                }\n            }\n`)),mdx(\"p\",null,\"Use the \",mdx(\"inlineCode\",{parentName:\"p\"},\"UniswapV2ERC20._mint\"),\" function to actually create the additional liquidity tokens and assign them to \",mdx(\"inlineCode\",{parentName:\"p\"},\"feeTo\"),\".\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        } else if (_kLast != 0) {\n            kLast = 0;\n        }\n    }\n`)),mdx(\"p\",null,\"If there is no fee set \",mdx(\"inlineCode\",{parentName:\"p\"},\"kLast\"),\" to zero (if it isn't that already). When this contract was written there was a \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://eips.ethereum.org/EIPS/eip-3298\"}),\"gas refund feature\"),` that encouraged contracts to reduce the overall size of the Ethereum state by zeroing out storage they did not need.\nThis code gets that refund when possible.`),mdx(\"h4\",e({},{id:\"pair-external\"}),\"Externally Accessible Functions\"),mdx(\"p\",null,\"Note that while any transaction or contract \",mdx(\"em\",{parentName:\"p\"},\"can\"),\" call these functions, they are designed to be called from the periphery contract. If you call them directly you won't be able to cheat the pair exchange, but you might lose value through a mistake.\"),mdx(\"h5\",e({},{id:\"mint\"}),\"mint\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // this low-level function should be called from a contract which performs important safety checks\n    function mint(address to) external lock returns (uint liquidity) {\n`)),mdx(\"p\",null,\"This function is called when a liquidity provider adds liquidity to the pool. It mints additional liquidity tokens as a reward. It should be called from \",mdx(\"a\",e({parentName:\"p\"},{href:\"#UniswapV2Router02\"}),\"a periphery contract\"),\" that calls it after adding the liquidity in the same transaction (so nobody else would be able to submit a transaction that claims the new liquidity before the legitimate owner).\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        (uint112 _reserve0, uint112 _reserve1,) = getReserves(); // gas savings\n`)),mdx(\"p\",null,\"This is the way to read the results of a Solidity function that returns multiple values. We discard the last returned values, the block timestamp, because we don't need it.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        uint balance0 = IERC20(token0).balanceOf(address(this));\n        uint balance1 = IERC20(token1).balanceOf(address(this));\n        uint amount0 = balance0.sub(_reserve0);\n        uint amount1 = balance1.sub(_reserve1);\n`)),mdx(\"p\",null,\"Get the current balances and see how much was added of each token type.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        bool feeOn = _mintFee(_reserve0, _reserve1);\n`)),mdx(\"p\",null,\"Calculate the protocol fees to collect, if any, and mint liquidity tokens accordingly. Because the parameters to \",mdx(\"inlineCode\",{parentName:\"p\"},\"_mintFee\"),\" are the old reserve values, the fee is calculated accurately based only on pool changes due to fees.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        uint _totalSupply = totalSupply; // gas savings, must be defined here since totalSupply can update in _mintFee\n        if (_totalSupply == 0) {\n            liquidity = Math.sqrt(amount0.mul(amount1)).sub(MINIMUM_LIQUIDITY);\n           _mint(address(0), MINIMUM_LIQUIDITY); // permanently lock the first MINIMUM_LIQUIDITY tokens\n`)),mdx(\"p\",null,\"If this is the first deposit, create \",mdx(\"inlineCode\",{parentName:\"p\"},\"MINIMUM_LIQUIDITY\"),\" tokens and send them to address zero to lock them. They can never be redeemed, which means the pool will never be emptied completely (this saves us from division by zero in some places). The value of \",mdx(\"inlineCode\",{parentName:\"p\"},\"MINIMUM_LIQUIDITY\"),\" is a thousand, which considering most ERC-20 are subdivided into units of 10^-18'th of a token, as ETH is divided into wei, is 10^-15 to the value of a single token. Not a high cost.\"),mdx(\"p\",null,\"In the time of the first deposit we don't know the relative value of the two tokens, so we just multiply the amounts and take a square root, assuming that the deposit provides us with equal value in both tokens.\"),mdx(\"p\",null,`We can trust this because it is in the depositor's interest to provide equal value, to avoid losing value to arbitrage.\nLet's say that the value of the two tokens is identical, but our depositor deposited four times as many of `,mdx(\"strong\",{parentName:\"p\"},\"Token1\"),\" as of \",mdx(\"strong\",{parentName:\"p\"},\"Token0\"),\". A trader can use the fact the pair exchange thinks that \",mdx(\"strong\",{parentName:\"p\"},\"Token0\"),\" is more valuable to extract value out of it.\"),mdx(\"table\",null,mdx(\"thead\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"thead\"},mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"Event\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"reserve0\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"reserve1\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"reserve0 \",\"*\",\" reserve1\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"Value of the pool (reserve0 + reserve1)\"))),mdx(\"tbody\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Initial setup\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"8\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"32\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"256\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"40\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Trader deposits 8 \",mdx(\"strong\",{parentName:\"td\"},\"Token0\"),\" tokens, gets back 16 \",mdx(\"strong\",{parentName:\"td\"},\"Token1\")),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"16\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"16\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"256\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"32\")))),mdx(\"p\",null,\"As you can see, the trader earned an extra 8 tokens, which come from a reduction in the value of the pool, hurting the depositor that owns it.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        } else {\n            liquidity = Math.min(amount0.mul(_totalSupply) / _reserve0, amount1.mul(_totalSupply) / _reserve1);\n`)),mdx(\"p\",null,\"With every subsequent deposit we already know the exchange rate between the two assets, and we expect liquidity providers to provide equal value in both. If they don't, we give them liquidity tokens based on the lesser value they provided as a punishment.\"),mdx(\"p\",null,\"Whether it is the initial deposit or a subsequent one, the number of liquidity tokens we provide is equal to the square root of the change in \",mdx(\"inlineCode\",{parentName:\"p\"},\"reserve0*reserve1\"),` and the value of the liquidity token doesn't change (unless we get a deposit that doesn't have equal values of both types, in which case the \"fine\" gets distributed). Here is another example with two tokens that have the same value, with three good deposits and one bad one (deposit of only one token type, so it doesn't produce any liquidity tokens).`),mdx(\"table\",null,mdx(\"thead\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"thead\"},mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"Event\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"reserve0\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"reserve1\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"reserve0 \",\"*\",\" reserve1\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"Pool value (reserve0 + reserve1)\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"Liquidity tokens minted for this deposit\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"Total liquidity tokens\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"value of each liquidity token\"))),mdx(\"tbody\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Initial setup\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"8.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"8.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"64\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"16.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"8\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"8\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"2.000\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Deposit four of each type\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"12.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"12.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"144\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"24.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"4\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"12\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"2.000\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Deposit two of each type\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"14.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"14.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"196\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"28.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"2\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"14\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"2.000\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Unequal value deposit\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"18.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"14.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"252\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"32.000\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"0\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"14\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"~2.286\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"After arbitrage\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"~15.874\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"~15.874\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"252\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"~31.748\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"0\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"14\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"~2.267\")))),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        }\n        require(liquidity \u003e 0, 'UniswapV2: INSUFFICIENT_LIQUIDITY_MINTED');\n        _mint(to, liquidity);\n`)),mdx(\"p\",null,\"Use the \",mdx(\"inlineCode\",{parentName:\"p\"},\"UniswapV2ERC20._mint\"),\" function to actually create the additional liquidity tokens and give them to the correct account.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`\n        _update(balance0, balance1, _reserve0, _reserve1);\n        if (feeOn) kLast = uint(reserve0).mul(reserve1); // reserve0 and reserve1 are up-to-date\n        emit Mint(msg.sender, amount0, amount1);\n    }\n`)),mdx(\"p\",null,\"Update the state variables (\",mdx(\"inlineCode\",{parentName:\"p\"},\"reserve0\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"reserve1\"),\", and if needed \",mdx(\"inlineCode\",{parentName:\"p\"},\"kLast\"),\") and emit the appropriate event.\"),mdx(\"h5\",e({},{id:\"burn\"}),\"burn\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // this low-level function should be called from a contract which performs important safety checks\n    function burn(address to) external lock returns (uint amount0, uint amount1) {\n`)),mdx(\"p\",null,`This function is called when liquidity is withdrawn and the appropriate liquidity tokens need to be burned.\nIt should also be called `,mdx(\"a\",e({parentName:\"p\"},{href:\"#UniswapV2Router02\"}),\"from a periphery account\"),\".\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        (uint112 _reserve0, uint112 _reserve1,) = getReserves(); // gas savings\n        address _token0 = token0;                                // gas savings\n        address _token1 = token1;                                // gas savings\n        uint balance0 = IERC20(_token0).balanceOf(address(this));\n        uint balance1 = IERC20(_token1).balanceOf(address(this));\n        uint liquidity = balanceOf[address(this)];\n`)),mdx(\"p\",null,\"The periphery contract transferred the liquidity to be burned to this contract before the call. That way we know how much liquidity to burn, and we can make sure that it gets burned.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        bool feeOn = _mintFee(_reserve0, _reserve1);\n        uint _totalSupply = totalSupply; // gas savings, must be defined here since totalSupply can update in _mintFee\n        amount0 = liquidity.mul(balance0) / _totalSupply; // using balances ensures pro-rata distribution\n        amount1 = liquidity.mul(balance1) / _totalSupply; // using balances ensures pro-rata distribution\n        require(amount0 \u003e 0 \u0026\u0026 amount1 \u003e 0, 'UniswapV2: INSUFFICIENT_LIQUIDITY_BURNED');\n`)),mdx(\"p\",null,\"The liquidity provider receives equal value of both tokens. This way we don't change the exchange rate.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        _burn(address(this), liquidity);\n        _safeTransfer(_token0, to, amount0);\n        _safeTransfer(_token1, to, amount1);\n        balance0 = IERC20(_token0).balanceOf(address(this));\n        balance1 = IERC20(_token1).balanceOf(address(this));\n\n        _update(balance0, balance1, _reserve0, _reserve1);\n        if (feeOn) kLast = uint(reserve0).mul(reserve1); // reserve0 and reserve1 are up-to-date\n        emit Burn(msg.sender, amount0, amount1, to);\n    }\n\n`)),mdx(\"p\",null,\"The rest of the \",mdx(\"inlineCode\",{parentName:\"p\"},\"burn\"),\" function is the mirror image of the \",mdx(\"inlineCode\",{parentName:\"p\"},\"mint\"),\" function above.\"),mdx(\"h5\",e({},{id:\"swap\"}),\"swap\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // this low-level function should be called from a contract which performs important safety checks\n    function swap(uint amount0Out, uint amount1Out, address to, bytes calldata data) external lock {\n`)),mdx(\"p\",null,\"This function is also supposed to be called from \",mdx(\"a\",e({parentName:\"p\"},{href:\"#UniswapV2Router02\"}),\"a periphery contract\"),\".\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        require(amount0Out \u003e 0 || amount1Out \u003e 0, 'UniswapV2: INSUFFICIENT_OUTPUT_AMOUNT');\n        (uint112 _reserve0, uint112 _reserve1,) = getReserves(); // gas savings\n        require(amount0Out \u003c _reserve0 \u0026\u0026 amount1Out \u003c _reserve1, 'UniswapV2: INSUFFICIENT_LIQUIDITY');\n\n        uint balance0;\n        uint balance1;\n        { // scope for _token{0,1}, avoids stack too deep errors\n`)),mdx(\"p\",null,`Local variables can be stored either in memory or, if there aren't too many of them, directly on the stack.\nIf we can limit the number so we'll use the stack we use less gas. For more details see `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://ethereum.github.io/yellowpaper/paper.pdf\"}),\"the yellow paper, the formal Ethereum specifications\"),\", p. 26, equation 298.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`            address _token0 = token0;\n            address _token1 = token1;\n            require(to != _token0 \u0026\u0026 to != _token1, 'UniswapV2: INVALID_TO');\n            if (amount0Out \u003e 0) _safeTransfer(_token0, to, amount0Out); // optimistically transfer tokens\n            if (amount1Out \u003e 0) _safeTransfer(_token1, to, amount1Out); // optimistically transfer tokens\n`)),mdx(\"p\",null,\"This transfer is optimistic, because we transfer before we are sure all the conditions are met. This is OK in Ethereum because if the conditions aren't met later in the call we revert out of it and any changes it created.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`            if (data.length \u003e 0) IUniswapV2Callee(to).uniswapV2Call(msg.sender, amount0Out, amount1Out, data);\n`)),mdx(\"p\",null,\"Inform the receiver about the swap if requested.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`            balance0 = IERC20(_token0).balanceOf(address(this));\n            balance1 = IERC20(_token1).balanceOf(address(this));\n        }\n`)),mdx(\"p\",null,\"Get the current balances. The periphery contract sends us the tokens before calling us for the swap. This makes it easy for the contract to check that it is not being cheated, a check that \",mdx(\"em\",{parentName:\"p\"},\"has\"),\" to happen in the core contract (because we can be called by other entities than our periphery contract).\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        uint amount0In = balance0 \u003e _reserve0 - amount0Out ? balance0 - (_reserve0 - amount0Out) : 0;\n        uint amount1In = balance1 \u003e _reserve1 - amount1Out ? balance1 - (_reserve1 - amount1Out) : 0;\n        require(amount0In \u003e 0 || amount1In \u003e 0, 'UniswapV2: INSUFFICIENT_INPUT_AMOUNT');\n        { // scope for reserve{0,1}Adjusted, avoids stack too deep errors\n            uint balance0Adjusted = balance0.mul(1000).sub(amount0In.mul(3));\n            uint balance1Adjusted = balance1.mul(1000).sub(amount1In.mul(3));\n            require(balance0Adjusted.mul(balance1Adjusted) \u003e= uint(_reserve0).mul(_reserve1).mul(1000**2), 'UniswapV2: K');\n`)),mdx(\"p\",null,\"This is a sanity check to make sure we don't lose from the swap. There is no circumstance in which a swap should reduce \",mdx(\"inlineCode\",{parentName:\"p\"},\"reserve0*reserve1\"),\". This is also where we ensure a fee of 0.3% is being sent on the swap; before sanity checking the value of K, we multiply both balances by 1000 subtracted by the amounts multiplied by 3, this means 0.3% (3/1000 = 0.003 = 0.3%) is being deducted from the balance before comparing its K value with the current reserves K value.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        }\n\n        _update(balance0, balance1, _reserve0, _reserve1);\n        emit Swap(msg.sender, amount0In, amount1In, amount0Out, amount1Out, to);\n    }\n`)),mdx(\"p\",null,\"Update \",mdx(\"inlineCode\",{parentName:\"p\"},\"reserve0\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"reserve1\"),\", and if necessary the price accumulators and the timestamp and emit an event.\"),mdx(\"h5\",e({},{id:\"sync-or-skim\"}),\"Sync or Skim\"),mdx(\"p\",null,`It is possible for the real balances to get out of sync with the reserves that the pair exchange thinks it has.\nThere is no way to withdraw tokens without the contract's consent, but deposits are a different matter. An account can transfer tokens to the exchange without calling either `,mdx(\"inlineCode\",{parentName:\"p\"},\"mint\"),\" or \",mdx(\"inlineCode\",{parentName:\"p\"},\"swap\"),\".\"),mdx(\"p\",null,\"In that case there are two solutions:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"sync\"),\", update the reserves to the current balances\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"skim\"),\", withdraw the extra amount. Note that any account is allowed to call \",mdx(\"inlineCode\",{parentName:\"li\"},\"skim\"),\" because we don't know who deposited the tokens. This information is emitted in an event, but events are not accessible from the blockchain.\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // force balances to match reserves\n    function skim(address to) external lock {\n        address _token0 = token0; // gas savings\n        address _token1 = token1; // gas savings\n        _safeTransfer(_token0, to, IERC20(_token0).balanceOf(address(this)).sub(reserve0));\n        _safeTransfer(_token1, to, IERC20(_token1).balanceOf(address(this)).sub(reserve1));\n    }\n\n\n\n    // force reserves to match balances\n    function sync() external lock {\n        _update(IERC20(token0).balanceOf(address(this)), IERC20(token1).balanceOf(address(this)), reserve0, reserve1);\n    }\n}\n`)),mdx(\"h3\",e({},{id:\"uniswapv2factory\"}),\"UniswapV2Factory.sol\"),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/Uniswap/uniswap-v2-core/blob/master/contracts/UniswapV2Factory.sol\"}),\"This contract\"),\" creates the pair exchanges.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`pragma solidity =0.5.16;\n\nimport './interfaces/IUniswapV2Factory.sol';\nimport './UniswapV2Pair.sol';\n\ncontract UniswapV2Factory is IUniswapV2Factory {\n    address public feeTo;\n    address public feeToSetter;\n`)),mdx(\"p\",null,\"These state variables are necessary to implement the protocol fee (see \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://uniswap.org/whitepaper.pdf\"}),\"the whitepaper\"),`, p. 5).\nThe `,mdx(\"inlineCode\",{parentName:\"p\"},\"feeTo\"),\" address accumulates the liquidity tokens for the protocol fee, and \",mdx(\"inlineCode\",{parentName:\"p\"},\"feeToSetter\"),\" is the address allowed to change \",mdx(\"inlineCode\",{parentName:\"p\"},\"feeTo\"),\" to a different address.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    mapping(address =\u003e mapping(address =\u003e address)) public getPair;\n    address[] public allPairs;\n`)),mdx(\"p\",null,\"These variables keep track of the pairs, the exchanges between two token types.\"),mdx(\"p\",null,\"The first one, \",mdx(\"inlineCode\",{parentName:\"p\"},\"getPair\"),\", is a mapping that identifies a pair exchange contract based on the two ERC-20 tokens it exchanges. ERC-20 tokens are identified by the addresses of the contracts that implement them, so the keys and the value are all addresses. To get the address of the pair exchange that lets you convert from \",mdx(\"inlineCode\",{parentName:\"p\"},\"tokenA\"),\" to \",mdx(\"inlineCode\",{parentName:\"p\"},\"tokenB\"),\", you use \",mdx(\"inlineCode\",{parentName:\"p\"},\"getPair[\u003ctokenA address\u003e][\u003ctokenB address\u003e]\"),\" (or the other way around).\"),mdx(\"p\",null,\"The second variable, \",mdx(\"inlineCode\",{parentName:\"p\"},\"allPairs\"),\", is an array that includes all the addresses of pair exchanges created by this factory. In Ethereum you cannot iterate over the content of a mapping, or get a list of all the keys, so this variable is the only way to know which exchanges this factory manages.\"),mdx(\"p\",null,\"Note: The reason you cannot iterate over all the keys of a mapping is that contract data storage is \",mdx(\"em\",{parentName:\"p\"},\"expensive\"),`, so the less of it we use the better, and the less often we change\nit the better. You can create `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/ethereum/dapp-bin/blob/master/library/iterable_mapping.sol\"}),\"mappings that support iteration\"),\", but they require extra storage for a list of keys. In most applications you do not need that.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    event PairCreated(address indexed token0, address indexed token1, address pair, uint);\n`)),mdx(\"p\",null,\"This event is emitted when a new pair exchange is created. It includes the tokens' addresses, the pair exchange's address, and the total number of exchanges managed by the factory.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    constructor(address _feeToSetter) public {\n        feeToSetter = _feeToSetter;\n    }\n`)),mdx(\"p\",null,\"The only thing the constructor does is specify the \",mdx(\"inlineCode\",{parentName:\"p\"},\"feeToSetter\"),\". Factories start without a fee, and only \",mdx(\"inlineCode\",{parentName:\"p\"},\"feeSetter\"),\" can change that.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    function allPairsLength() external view returns (uint) {\n        return allPairs.length;\n    }\n`)),mdx(\"p\",null,\"This function returns the number of exchange pairs.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    function createPair(address tokenA, address tokenB) external returns (address pair) {\n`)),mdx(\"p\",null,\"This is the main function of the factory, to create a pair exchange between two ERC-20 tokens. Note that anybody can call this function. You do not need permission from Uniswap to create a new pair exchange.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        require(tokenA != tokenB, 'UniswapV2: IDENTICAL_ADDRESSES');\n        (address token0, address token1) = tokenA \u003c tokenB ? (tokenA, tokenB) : (tokenB, tokenA);\n`)),mdx(\"p\",null,\"We want the address of the new exchange to be deterministic, so it can be calculated in advance off chain (this can be useful for \",mdx(\"a\",e({parentName:\"p\"},{href:\"/developers/docs/scaling/\"}),\"layer 2 transactions\"),`).\nTo do this we need to have a consistent order of the token addresses, regardless of the order in which we have received them, so we sort them here.`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        require(token0 != address(0), 'UniswapV2: ZERO_ADDRESS');\n        require(getPair[token0][token1] == address(0), 'UniswapV2: PAIR_EXISTS'); // single check is sufficient\n`)),mdx(\"p\",null,\"Large liquidity pools are better than small ones, because they have more stable prices. We don't want to have more than a single liquidity pool per pair of tokens. If there is already an exchange, there's no need to create another one for the same pair.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        bytes memory bytecode = type(UniswapV2Pair).creationCode;\n`)),mdx(\"p\",null,\"To create a new contract we need the code that creates it (both the constructor function and code that writes to memory the EVM bytecode of the actual contract). Normally in Solidity we just use \",mdx(\"inlineCode\",{parentName:\"p\"},\"addr = new \u003cname of contract\u003e(\u003cconstructor parameters\u003e)\"),\" and the compiler takes care of everything for us, but to have a deterministic contract address we need to use \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://eips.ethereum.org/EIPS/eip-1014\"}),\"the CREATE2 opcode\"),`.\nWhen this code was written that opcode was not yet supported by Solidity, so it was necessary to manually get the code. This is no longer an issue, because `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.soliditylang.org/en/v0.8.3/control-structures.html#salted-contract-creations-create2\"}),\"Solidity now supports CREATE2\"),\".\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        bytes32 salt = keccak256(abi.encodePacked(token0, token1));\n        assembly {\n            pair := create2(0, add(bytecode, 32), mload(bytecode), salt)\n        }\n`)),mdx(\"p\",null,\"When an opcode is not supported by Solidity yet we can call it using \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.soliditylang.org/en/v0.8.3/assembly.html\"}),\"inline assembly\"),\".\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        IUniswapV2Pair(pair).initialize(token0, token1);\n`)),mdx(\"p\",null,\"Call the \",mdx(\"inlineCode\",{parentName:\"p\"},\"initialize\"),\" function to tell the new exchange what two tokens it exchanges.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        getPair[token0][token1] = pair;\n        getPair[token1][token0] = pair; // populate mapping in the reverse direction\n        allPairs.push(pair);\n        emit PairCreated(token0, token1, pair, allPairs.length);\n    }\n`)),mdx(\"p\",null,\"Save the new pair information in the state variables and emit an event to inform the world of the new pair exchange.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    function setFeeTo(address _feeTo) external {\n        require(msg.sender == feeToSetter, 'UniswapV2: FORBIDDEN');\n        feeTo = _feeTo;\n    }\n\n    function setFeeToSetter(address _feeToSetter) external {\n        require(msg.sender == feeToSetter, 'UniswapV2: FORBIDDEN');\n        feeToSetter = _feeToSetter;\n    }\n}\n`)),mdx(\"p\",null,\"These two functions allow \",mdx(\"inlineCode\",{parentName:\"p\"},\"feeSetter\"),\" to control the fee recipient (if any), and to change \",mdx(\"inlineCode\",{parentName:\"p\"},\"feeSetter\"),\" to a new address.\"),mdx(\"h3\",e({},{id:\"uniswapv2erc20\"}),\"UniswapV2ERC20.sol\"),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/Uniswap/uniswap-v2-core/blob/master/contracts/UniswapV2ERC20.sol\"}),\"This contract\"),\" implements the ERC-20 liquidity token. It is similar to the \",mdx(\"a\",e({parentName:\"p\"},{href:\"/developers/tutorials/erc20-annotated-code\"}),\"OpenZeppelin ERC-20 contract\"),\", so I will only explain the part that is different, the \",mdx(\"inlineCode\",{parentName:\"p\"},\"permit\"),\" functionality.\"),mdx(\"p\",null,\"Transactions on Ethereum cost ether (ETH), which is equivalent to real money. If you have ERC-20 tokens but not ETH, you can't send transactions, so you can't do anything with them. One solution to avoid this problem is \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.uniswap.org/contracts/v2/guides/smart-contract-integration/supporting-meta-transactions\"}),\"meta-transactions\"),`.\nThe owner of the tokens signs a transaction that allows somebody else to withdraw tokens off chain and sends it using the Internet to the recipient. The recipient, which does have ETH, then submits the permit on behalf of the owner.`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    bytes32 public DOMAIN_SEPARATOR;\n    // keccak256(\"Permit(address owner,address spender,uint256 value,uint256 nonce,uint256 deadline)\");\n    bytes32 public constant PERMIT_TYPEHASH = 0x6e71edae12b1b97f4d1f60370fef10105fa2faae0126114a169c64845d6126c9;\n`)),mdx(\"p\",null,\"This hash is the \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://eips.ethereum.org/EIPS/eip-712#rationale-for-typehash\"}),\"identifier for the transaction type\"),\". The only one we support here is \",mdx(\"inlineCode\",{parentName:\"p\"},\"Permit\"),\" with these parameters.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    mapping(address =\u003e uint) public nonces;\n`)),mdx(\"p\",null,\"It is not feasible for a recipient to fake a digital signature. However, it is trivial to send the same transaction twice (this is a form of \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://wikipedia.org/wiki/Replay_attack\"}),\"replay attack\"),\"). To prevent this, we use a \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://wikipedia.org/wiki/Cryptographic_nonce\"}),\"nonce\"),\". If the nonce of a new \",mdx(\"inlineCode\",{parentName:\"p\"},\"Permit\"),\" is not one more than the last one used, we assume it is invalid.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    constructor() public {\n        uint chainId;\n        assembly {\n            chainId := chainid\n        }\n`)),mdx(\"p\",null,\"This is the code to retrieve the \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://chainid.network/\"}),\"chain identifier\"),\". It uses an EVM assembly dialect called \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.soliditylang.org/en/v0.8.4/yul.html\"}),\"Yul\"),\". Note that in the current version of Yul you have to use \",mdx(\"inlineCode\",{parentName:\"p\"},\"chainid()\"),\", not \",mdx(\"inlineCode\",{parentName:\"p\"},\"chainid\"),\".\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        DOMAIN_SEPARATOR = keccak256(\n            abi.encode(\n                keccak256('EIP712Domain(string name,string version,uint256 chainId,address verifyingContract)'),\n                keccak256(bytes(name)),\n                keccak256(bytes('1')),\n                chainId,\n                address(this)\n            )\n        );\n    }\n`)),mdx(\"p\",null,\"Calculate the \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://eips.ethereum.org/EIPS/eip-712#rationale-for-domainseparator\"}),\"domain separator\"),\" for EIP-712.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    function permit(address owner, address spender, uint value, uint deadline, uint8 v, bytes32 r, bytes32 s) external {\n`)),mdx(\"p\",null,\"This is the function that implements the permissions. It receives as parameters the relevant fields, and the three scalar values for \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://yos.io/2018/11/16/ethereum-signatures/\"}),\"the signature\"),\" (v, r, and s).\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        require(deadline \u003e= block.timestamp, 'UniswapV2: EXPIRED');\n`)),mdx(\"p\",null,\"Don't accept transactions after the deadline.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        bytes32 digest = keccak256(\n            abi.encodePacked(\n                '\\\\x19\\\\x01',\n                DOMAIN_SEPARATOR,\n                keccak256(abi.encode(PERMIT_TYPEHASH, owner, spender, value, nonces[owner]++, deadline))\n            )\n        );\n`)),mdx(\"p\",null,mdx(\"inlineCode\",{parentName:\"p\"},\"abi.encodePacked(...)\"),\" is the message we expect to get. We know what the nonce should be, so there is no need for us to get it as a parameter.\"),mdx(\"p\",null,\"The Ethereum signature algorithm expects to get 256 bits to sign, so we use the \",mdx(\"inlineCode\",{parentName:\"p\"},\"keccak256\"),\" hash function.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        address recoveredAddress = ecrecover(digest, v, r, s);\n`)),mdx(\"p\",null,\"From the digest and the signature we can get the address that signed it using \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://coders-errand.com/ecrecover-signature-verification-ethereum/\"}),\"ecrecover\"),\".\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        require(recoveredAddress != address(0) \u0026\u0026 recoveredAddress == owner, 'UniswapV2: INVALID_SIGNATURE');\n        _approve(owner, spender, value);\n    }\n\n`)),mdx(\"p\",null,\"If everything is OK, treat this as \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://eips.ethereum.org/EIPS/eip-20#approve\"}),\"an ERC-20 approve\"),\".\"),mdx(\"h2\",e({},{id:\"periphery-contracts\"}),\"The Periphery Contracts\"),mdx(\"p\",null,\"The periphery contracts are the API (application program interface) for Uniswap. They are available for external calls, either from other contracts or decentralized applications. You could call the core contracts directly, but that's more complicated and you might lose value if you make a mistake. The core contracts only contain tests to make sure they aren't cheated, not sanity checks for anybody else. Those are in the periphery so they can be updated as needed.\"),mdx(\"h3\",e({},{id:\"uniswapv2router01\"}),\"UniswapV2Router01.sol\"),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/Uniswap/uniswap-v2-periphery/blob/master/contracts/UniswapV2Router01.sol\"}),\"This contract\"),\" has problems, and \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-01\"}),\"should no longer be used\"),\". Luckily, the periphery contracts are stateless and don't hold any assets, so it is easy to deprecate it and suggest people use the replacement, \",mdx(\"inlineCode\",{parentName:\"p\"},\"UniswapV2Router02\"),\", instead.\"),mdx(\"h3\",e({},{id:\"uniswapv2router02\"}),\"UniswapV2Router02.sol\"),mdx(\"p\",null,\"In most cases you would use Uniswap through \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/Uniswap/uniswap-v2-periphery/blob/master/contracts/UniswapV2Router02.sol\"}),\"this contract\"),`.\nYou can see how to use it `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02\"}),\"here\"),\".\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`pragma solidity =0.6.6;\n\nimport '@uniswap/v2-core/contracts/interfaces/IUniswapV2Factory.sol';\nimport '@uniswap/lib/contracts/libraries/TransferHelper.sol';\n\nimport './interfaces/IUniswapV2Router02.sol';\nimport './libraries/UniswapV2Library.sol';\nimport './libraries/SafeMath.sol';\nimport './interfaces/IERC20.sol';\nimport './interfaces/IWETH.sol';\n`)),mdx(\"p\",null,\"Most of these we either encountered before, or are fairly obvious. The one exception is \",mdx(\"inlineCode\",{parentName:\"p\"},\"IWETH.sol\"),\". Uniswap v2 allows exchanges for any pair of ERC-20 tokens, but ether (ETH) itself isn't an ERC-20 token. It predates the standard and is transferred by unique mechanisms. To enable the use of ETH in contracts that apply to ERC-20 tokens people came up with the \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://weth.tkn.eth.limo/\"}),\"wrapped ether (WETH)\"),\" contract. You send this contract ETH, and it mints you an equivalent amount of WETH. Or you can burn WETH, and get ETH back.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`contract UniswapV2Router02 is IUniswapV2Router02 {\n    using SafeMath for uint;\n\n    address public immutable override factory;\n    address public immutable override WETH;\n`)),mdx(\"p\",null,\"The router needs to know what factory to use, and for transactions that require WETH what WETH contract to use. These values are \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.soliditylang.org/en/v0.8.3/contracts.html#constant-and-immutable-state-variables\"}),\"immutable\"),\", meaning they can only be set in the constructor. This gives users the confidence that nobody would be able to change them to point to less honest contracts.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    modifier ensure(uint deadline) {\n        require(deadline \u003e= block.timestamp, 'UniswapV2Router: EXPIRED');\n        _;\n    }\n`)),mdx(\"p\",null,`This modifier makes sure that time limited transactions (\"do X before time Y if you can\") don't happen after their time limit.`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    constructor(address _factory, address _WETH) public {\n        factory = _factory;\n        WETH = _WETH;\n    }\n`)),mdx(\"p\",null,\"The constructor just sets the immutable state variables.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    receive() external payable {\n        assert(msg.sender == WETH); // only accept ETH via fallback from the WETH contract\n    }\n`)),mdx(\"p\",null,\"This function is called when we redeem tokens from the WETH contract back into ETH. Only the WETH contract we use is authorized to do that.\"),mdx(\"h4\",e({},{id:\"add-liquidity\"}),\"Add Liquidity\"),mdx(\"p\",null,\"These functions add tokens to the pair exchange, which increases the liquidity pool.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`\n    // **** ADD LIQUIDITY ****\n    function _addLiquidity(\n`)),mdx(\"p\",null,\"This function is used to calculate the amount of A and B tokens that should be deposited into the pair exchange.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        address tokenA,\n        address tokenB,\n`)),mdx(\"p\",null,\"These are the addresses of the ERC-20 token contracts.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        uint amountADesired,\n        uint amountBDesired,\n`)),mdx(\"p\",null,\"These are the amounts the liquidity provider wants to deposit. They are also the maximum amounts of A and B to be deposited.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        uint amountAMin,\n        uint amountBMin\n`)),mdx(\"p\",null,\"These are the minimum acceptable amounts to deposit. If the transaction cannot take place with these amounts or more, revert out of it. If you don't want this feature, just specify zero.\"),mdx(\"p\",null,\"Liquidity providers specify a minimum, typically, because they want to limit the transaction to an exchange rate that is close to the current one. If the exchange rate fluctuates too much it might mean news that change the underlying values, and they want to decide manually what to do.\"),mdx(\"p\",null,\"For example, imagine a case where the exchange rate is one to one and the liquidity provider specifies these values:\"),mdx(\"table\",null,mdx(\"thead\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"thead\"},mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"Parameter\"),mdx(\"th\",e({parentName:\"tr\"},{align:\"right\"}),\"Value\"))),mdx(\"tbody\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"amountADesired\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1000\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"amountBDesired\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"1000\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"amountAMin\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"900\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"amountBMin\"),mdx(\"td\",e({parentName:\"tr\"},{align:\"right\"}),\"800\")))),mdx(\"p\",null,\"As long as the exchange rate stays between 0.9 and 1.25, the transaction takes place. If the exchange rate gets out of that range, the transaction gets cancelled.\"),mdx(\"p\",null,\"The reason for this precaution is that transactions are not immediate, you submit them and eventually a validator is going to include them in a block (unless your gas price is very low, in which case you'll need to submit another transaction with the same nonce and a higher gas price to overwrite it). You cannot control what happens during the interval between submission and inclusion.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    ) internal virtual returns (uint amountA, uint amountB) {\n`)),mdx(\"p\",null,\"The function returns the amounts the liquidity provider should deposit to have a ratio equal to the current ratio between reserves.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        // create the pair if it doesn't exist yet\n        if (IUniswapV2Factory(factory).getPair(tokenA, tokenB) == address(0)) {\n            IUniswapV2Factory(factory).createPair(tokenA, tokenB);\n        }\n`)),mdx(\"p\",null,\"If there is no exchange for this token pair yet, create it.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        (uint reserveA, uint reserveB) = UniswapV2Library.getReserves(factory, tokenA, tokenB);\n`)),mdx(\"p\",null,\"Get the current reserves in the pair.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        if (reserveA == 0 \u0026\u0026 reserveB == 0) {\n            (amountA, amountB) = (amountADesired, amountBDesired);\n`)),mdx(\"p\",null,\"If the current reserves are empty then this is a new pair exchange. The amounts to be deposited should be exactly the same as those the liquidity provider wants to provide.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        } else {\n            uint amountBOptimal = UniswapV2Library.quote(amountADesired, reserveA, reserveB);\n`)),mdx(\"p\",null,\"If we need to see what amounts will be, we get the optimal amount using \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/Uniswap/uniswap-v2-periphery/blob/master/contracts/libraries/UniswapV2Library.sol#L35\"}),\"this function\"),\". We want the same ratio as the current reserves.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`            if (amountBOptimal \u003c= amountBDesired) {\n                require(amountBOptimal \u003e= amountBMin, 'UniswapV2Router: INSUFFICIENT_B_AMOUNT');\n                (amountA, amountB) = (amountADesired, amountBOptimal);\n`)),mdx(\"p\",null,\"If \",mdx(\"inlineCode\",{parentName:\"p\"},\"amountBOptimal\"),\" is smaller than the amount the liquidity provider wants to deposit it means that token B is more valuable currently than the liquidity depositor thinks, so a smaller amount is required.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`            } else {\n                uint amountAOptimal = UniswapV2Library.quote(amountBDesired, reserveB, reserveA);\n                assert(amountAOptimal \u003c= amountADesired);\n                require(amountAOptimal \u003e= amountAMin, 'UniswapV2Router: INSUFFICIENT_A_AMOUNT');\n                (amountA, amountB) = (amountAOptimal, amountBDesired);\n`)),mdx(\"p\",null,\"If the optimal B amount is more than the desired B amount it means B tokens are less valuable currently than the liquidity depositor thinks, so a higher amount is required. However, the desired amount is a maximum, so we cannot do that. Instead we calculate the optimal number of A tokens for the desired amount of B tokens.\"),mdx(\"p\",null,\"Putting it all together we get this graph. Assume you're trying to deposit a thousand A tokens (blue line) and a thousand B tokens (red line). The x axis is the exchange rate, A/B. If x=1, they are equal in value and you deposit a thousand of each. If x=2, A is twice the value of B (you get two B tokens for each A token) so you deposit a thousand B tokens, but only 500 A tokens. If x=0.5, the situation is reversed, a thousand A tokens and five hundred B tokens.\"),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"/content/developers/tutorials/uniswap-v2-annotated-code/liquidityProviderDeposit.png\",alt:\"Graph\",width:1274,height:827,aspectRatio:1.5405078597339783,blurDataURL:\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAKCAIAAAAy3EnLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA40lEQVR4nGMQFxd/9+7df6IBQ2x8wsYtOxYsWbZ4+So3F/cZkycvX7QID2JoamoG6nv//sO506fbmpqnz5oH5ALt/PzpE1bE0NjYCFTx79/f6ZMmAvk7d+9btXYDPidBNOzbvXvz+vUQIaAeoAtxeYxhwoQJQArodKDxcNHbd+4C9QB13r//AIuG29evw42Hg99//ly/cWvFqjVAFwIR0IhXr18DEUjDmqVLHz96hMvRQEuAqoE6IYghMS4OGD54fInuJEFu7nPnzgHt2bdv3/z58yHkOhiAsIEkMH7Z2Ng8PDwAzk+Ml89AhSAAAAAASUVORK5CYII=\",placeholder:\"blur\"}))),mdx(\"p\",null,\"You could deposit liquidity directly into the core contract (using \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/Uniswap/uniswap-v2-core/blob/master/contracts/UniswapV2Pair.sol#L110\"}),\"UniswapV2Pair::mint\"),\"), but the core contract only checks that it is not getting cheated itself, so you run the risk of losing value if the exchange rate changes between the time you submit your transaction and the time it is executed. If you use the periphery contract, it figures the amount you should deposit and deposits it immediately, so the exchange rate doesn't change and you don't lose anything.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    function addLiquidity(\n        address tokenA,\n        address tokenB,\n        uint amountADesired,\n        uint amountBDesired,\n        uint amountAMin,\n        uint amountBMin,\n        address to,\n        uint deadline\n`)),mdx(\"p\",null,\"This function can be called by a transaction to deposit liquidity. Most parameters are the same as in \",mdx(\"inlineCode\",{parentName:\"p\"},\"_addLiquidity\"),\" above, with two exceptions:\"),mdx(\"p\",null,\". \",mdx(\"inlineCode\",{parentName:\"p\"},\"to\"),` is the address that gets the new liquidity tokens minted to show the liquidity provider's portion of the pool\n. `,mdx(\"inlineCode\",{parentName:\"p\"},\"deadline\"),\" is a time limit on the transaction\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    ) external virtual override ensure(deadline) returns (uint amountA, uint amountB, uint liquidity) {\n        (amountA, amountB) = _addLiquidity(tokenA, tokenB, amountADesired, amountBDesired, amountAMin, amountBMin);\n        address pair = UniswapV2Library.pairFor(factory, tokenA, tokenB);\n`)),mdx(\"p\",null,\"We calculate the amounts to actually deposit and then find the address of the liquidity pool. To save gas we don't do this by asking the factory, but using the library function \",mdx(\"inlineCode\",{parentName:\"p\"},\"pairFor\"),\" (see below in libraries)\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        TransferHelper.safeTransferFrom(tokenA, msg.sender, pair, amountA);\n        TransferHelper.safeTransferFrom(tokenB, msg.sender, pair, amountB);\n`)),mdx(\"p\",null,\"Transfer the correct amounts of tokens from the user into the pair exchange.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        liquidity = IUniswapV2Pair(pair).mint(to);\n    }\n`)),mdx(\"p\",null,\"In return give the \",mdx(\"inlineCode\",{parentName:\"p\"},\"to\"),\" address liquidity tokens for partial ownership of the pool. The \",mdx(\"inlineCode\",{parentName:\"p\"},\"mint\"),\" function of the core contract sees how many extra tokens it has (compared to what it had the last time liquidity changed) and mints liquidity accordingly.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    function addLiquidityETH(\n        address token,\n        uint amountTokenDesired,\n`)),mdx(\"p\",null,\"When a liquidity provider wants to provide liquidity to a Token/ETH pair exchange, there are a few differences. The contract handles wrapping the ETH for the liquidity provider. There is no need to specify how many ETH the user wants to deposit, because the user just sends them with the transaction (the amount is available in \",mdx(\"inlineCode\",{parentName:\"p\"},\"msg.value\"),\").\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        uint amountTokenMin,\n        uint amountETHMin,\n        address to,\n        uint deadline\n    ) external virtual override payable ensure(deadline) returns (uint amountToken, uint amountETH, uint liquidity) {\n        (amountToken, amountETH) = _addLiquidity(\n            token,\n            WETH,\n            amountTokenDesired,\n            msg.value,\n            amountTokenMin,\n            amountETHMin\n        );\n        address pair = UniswapV2Library.pairFor(factory, token, WETH);\n        TransferHelper.safeTransferFrom(token, msg.sender, pair, amountToken);\n        IWETH(WETH).deposit{value: amountETH}();\n        assert(IWETH(WETH).transfer(pair, amountETH));\n`)),mdx(\"p\",null,\"To deposit the ETH the contract first wraps it into WETH and then transfers the WETH into the pair. Notice that the transfer is wrapped in an \",mdx(\"inlineCode\",{parentName:\"p\"},\"assert\"),\". This means that if the transfer fails this contract call also fails, and therefore the wrapping doesn't really happen.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        liquidity = IUniswapV2Pair(pair).mint(to);\n        // refund dust eth, if any\n        if (msg.value \u003e amountETH) TransferHelper.safeTransferETH(msg.sender, msg.value - amountETH);\n    }\n`)),mdx(\"p\",null,\"The user has already sent us the ETH, so if there is any extra left over (because the other token is less valuable than the user thought), we need to issue a refund.\"),mdx(\"h4\",e({},{id:\"remove-liquidity\"}),\"Remove Liquidity\"),mdx(\"p\",null,\"These functions will remove liquidity and pay back the liquidity provider.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // **** REMOVE LIQUIDITY ****\n    function removeLiquidity(\n        address tokenA,\n        address tokenB,\n        uint liquidity,\n        uint amountAMin,\n        uint amountBMin,\n        address to,\n        uint deadline\n    ) public virtual override ensure(deadline) returns (uint amountA, uint amountB) {\n`)),mdx(\"p\",null,\"The simplest case of removing liquidity. There is a minimum amount of each token the liquidity provider agrees to accept, and it must happen before the deadline.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        address pair = UniswapV2Library.pairFor(factory, tokenA, tokenB);\n        IUniswapV2Pair(pair).transferFrom(msg.sender, pair, liquidity); // send liquidity to pair\n        (uint amount0, uint amount1) = IUniswapV2Pair(pair).burn(to);\n`)),mdx(\"p\",null,\"The core contract's \",mdx(\"inlineCode\",{parentName:\"p\"},\"burn\"),\" function handles paying the user back the tokens.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        (address token0,) = UniswapV2Library.sortTokens(tokenA, tokenB);\n`)),mdx(\"p\",null,\"When a function returns multiple values, but we are only interested in some of them, this is how we only get those values. It is somewhat cheaper in gas terms than reading a value and never using it.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        (amountA, amountB) = tokenA == token0 ? (amount0, amount1) : (amount1, amount0);\n`)),mdx(\"p\",null,\"Translate the amounts from the way the core contract returns them (lower address token first) to the way the user expects them (corresponding to \",mdx(\"inlineCode\",{parentName:\"p\"},\"tokenA\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"tokenB\"),\").\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        require(amountA \u003e= amountAMin, 'UniswapV2Router: INSUFFICIENT_A_AMOUNT');\n        require(amountB \u003e= amountBMin, 'UniswapV2Router: INSUFFICIENT_B_AMOUNT');\n    }\n`)),mdx(\"p\",null,\"It is OK to do the transfer first and then verify it is legitimate, because if it isn't we'll revert out of all the state changes.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    function removeLiquidityETH(\n        address token,\n        uint liquidity,\n        uint amountTokenMin,\n        uint amountETHMin,\n        address to,\n        uint deadline\n    ) public virtual override ensure(deadline) returns (uint amountToken, uint amountETH) {\n        (amountToken, amountETH) = removeLiquidity(\n            token,\n            WETH,\n            liquidity,\n            amountTokenMin,\n            amountETHMin,\n            address(this),\n            deadline\n        );\n        TransferHelper.safeTransfer(token, to, amountToken);\n        IWETH(WETH).withdraw(amountETH);\n        TransferHelper.safeTransferETH(to, amountETH);\n    }\n`)),mdx(\"p\",null,\"Remove liquidity for ETH is almost the same, except that we receive the WETH tokens and then redeem them for ETH to give back to the liquidity provider.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    function removeLiquidityWithPermit(\n        address tokenA,\n        address tokenB,\n        uint liquidity,\n        uint amountAMin,\n        uint amountBMin,\n        address to,\n        uint deadline,\n        bool approveMax, uint8 v, bytes32 r, bytes32 s\n    ) external virtual override returns (uint amountA, uint amountB) {\n        address pair = UniswapV2Library.pairFor(factory, tokenA, tokenB);\n        uint value = approveMax ? uint(-1) : liquidity;\n        IUniswapV2Pair(pair).permit(msg.sender, address(this), value, deadline, v, r, s);\n        (amountA, amountB) = removeLiquidity(tokenA, tokenB, liquidity, amountAMin, amountBMin, to, deadline);\n    }\n\n\n    function removeLiquidityETHWithPermit(\n        address token,\n        uint liquidity,\n        uint amountTokenMin,\n        uint amountETHMin,\n        address to,\n        uint deadline,\n        bool approveMax, uint8 v, bytes32 r, bytes32 s\n    ) external virtual override returns (uint amountToken, uint amountETH) {\n        address pair = UniswapV2Library.pairFor(factory, token, WETH);\n        uint value = approveMax ? uint(-1) : liquidity;\n        IUniswapV2Pair(pair).permit(msg.sender, address(this), value, deadline, v, r, s);\n        (amountToken, amountETH) = removeLiquidityETH(token, liquidity, amountTokenMin, amountETHMin, to, deadline);\n    }\n`)),mdx(\"p\",null,\"These functions relay meta-transactions to allow users without ether to withdraw from the pool, using \",mdx(\"a\",e({parentName:\"p\"},{href:\"#UniswapV2ERC20\"}),\"the permit mechanism\"),\".\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`\n    // **** REMOVE LIQUIDITY (supporting fee-on-transfer tokens) ****\n    function removeLiquidityETHSupportingFeeOnTransferTokens(\n        address token,\n        uint liquidity,\n        uint amountTokenMin,\n        uint amountETHMin,\n        address to,\n        uint deadline\n    ) public virtual override ensure(deadline) returns (uint amountETH) {\n        (, amountETH) = removeLiquidity(\n            token,\n            WETH,\n            liquidity,\n            amountTokenMin,\n            amountETHMin,\n            address(this),\n            deadline\n        );\n        TransferHelper.safeTransfer(token, to, IERC20(token).balanceOf(address(this)));\n        IWETH(WETH).withdraw(amountETH);\n        TransferHelper.safeTransferETH(to, amountETH);\n    }\n\n`)),mdx(\"p\",null,\"This function can be used for tokens that have transfer or storage fees. When a token has such fees we cannot rely on the \",mdx(\"inlineCode\",{parentName:\"p\"},\"removeLiquidity\"),\" function to tell us how much of the token we get back, so we need to withdraw first and then get the balance.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`\n\n    function removeLiquidityETHWithPermitSupportingFeeOnTransferTokens(\n        address token,\n        uint liquidity,\n        uint amountTokenMin,\n        uint amountETHMin,\n        address to,\n        uint deadline,\n        bool approveMax, uint8 v, bytes32 r, bytes32 s\n    ) external virtual override returns (uint amountETH) {\n        address pair = UniswapV2Library.pairFor(factory, token, WETH);\n        uint value = approveMax ? uint(-1) : liquidity;\n        IUniswapV2Pair(pair).permit(msg.sender, address(this), value, deadline, v, r, s);\n        amountETH = removeLiquidityETHSupportingFeeOnTransferTokens(\n            token, liquidity, amountTokenMin, amountETHMin, to, deadline\n        );\n    }\n`)),mdx(\"p\",null,\"The final function combines storage fees with meta-transactions.\"),mdx(\"h4\",e({},{id:\"trade\"}),\"Trade\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // **** SWAP ****\n    // requires the initial amount to have already been sent to the first pair\n    function _swap(uint[] memory amounts, address[] memory path, address _to) internal virtual {\n`)),mdx(\"p\",null,\"This function performs internal processing that is required for the functions that are exposed to traders.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        for (uint i; i \u003c path.length - 1; i++) {\n`)),mdx(\"p\",null,\"As I'm writing this there are \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://etherscan.io/tokens\"}),\"388,160 ERC-20 tokens\"),\". If there was a pair exchange for each token pair, it would be over a 150 billion pair exchanges. The entire chain, at the moment, \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://etherscan.io/chart/address\"}),\"only has 0.1% that number of accounts\"),\". Instead, the swap functions support the concept of a path. A trader can exchange A for B, B for C, and C for D, so there is no need for a direct A-D pair exchange.\"),mdx(\"p\",null,\"The prices on these markets tend to be synchronized, because when they are out of sync it creates an opportunity for arbitrage. Imagine, for example, three tokens, A, B, and C. There are three pair exchanges, one for each pair.\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"The initial situation\"),mdx(\"li\",{parentName:\"ol\"},\"A trader sells 24.695 A tokens and gets 25.305 B tokens.\"),mdx(\"li\",{parentName:\"ol\"},\"The trader sells 24.695 B tokens for 25.305 C tokens, keeping approximately 0.61 B tokens as profit.\"),mdx(\"li\",{parentName:\"ol\"},\"Then the trader sells 24.695 C tokens for 25.305 A tokens, keeping approximately 0.61 C tokens as profit. The trader also has 0.61 extra A tokens (the 25.305 the trader ends up with, minus the original investment of 24.695).\")),mdx(\"table\",null,mdx(\"thead\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"thead\"},mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"Step\"),mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"A-B Exchange\"),mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"B-C Exchange\"),mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"A-C Exchange\"))),mdx(\"tbody\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"1\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"A:1000 B:1050 A/B=1.05\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"B:1000 C:1050 B/C=1.05\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"A:1050 C:1000 C/A=1.05\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"2\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"A:1024.695 B:1024.695 A/B=1\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"B:1000 C:1050 B/C=1.05\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"A:1050 C:1000 C/A=1.05\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"3\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"A:1024.695 B:1024.695 A/B=1\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"B:1024.695 C:1024.695 B/C=1\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"A:1050 C:1000 C/A=1.05\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"4\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"A:1024.695 B:1024.695 A/B=1\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"B:1024.695 C:1024.695 B/C=1\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"A:1024.695 C:1024.695 C/A=1\")))),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`            (address input, address output) = (path[i], path[i + 1]);\n            (address token0,) = UniswapV2Library.sortTokens(input, output);\n            uint amountOut = amounts[i + 1];\n`)),mdx(\"p\",null,\"Get the pair we are currently handling, sort it (for use with the pair) and get the expected output amount.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`            (uint amount0Out, uint amount1Out) = input == token0 ? (uint(0), amountOut) : (amountOut, uint(0));\n`)),mdx(\"p\",null,\"Get the expected out amounts, sorted the way the pair exchange expects them to be.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`            address to = i \u003c path.length - 2 ? UniswapV2Library.pairFor(factory, output, path[i + 2]) : _to;\n`)),mdx(\"p\",null,\"Is this the last exchange? If so, send the tokens received for the trade to the destination. If not, send it to the next pair exchange.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`\n            IUniswapV2Pair(UniswapV2Library.pairFor(factory, input, output)).swap(\n                amount0Out, amount1Out, to, new bytes(0)\n            );\n        }\n    }\n`)),mdx(\"p\",null,\"Actually call the pair exchange to swap the tokens. We don't need a callback to be told about the exchange, so we don't send any bytes in that field.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    function swapExactTokensForTokens(\n`)),mdx(\"p\",null,\"This function is used directly by traders to swap one token for another.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        uint amountIn,\n        uint amountOutMin,\n        address[] calldata path,\n`)),mdx(\"p\",null,\"This parameter contains the addresses of the ERC-20 contracts. As explained above, this is an array because you might need to go through several pair exchanges to get from the asset you have to the asset you want.\"),mdx(\"p\",null,\"A function parameter in solidity can be stored either in \",mdx(\"inlineCode\",{parentName:\"p\"},\"memory\"),\" or the \",mdx(\"inlineCode\",{parentName:\"p\"},\"calldata\"),\". If the function is an entry point to the contract, called directly from a user (using a transaction) or from a different contract, then the parameter's value can be taken directly from the call data. If the function is called internally, as \",mdx(\"inlineCode\",{parentName:\"p\"},\"_swap\"),\" above, then the parameters have to be stored in \",mdx(\"inlineCode\",{parentName:\"p\"},\"memory\"),\". From the perspective of the called contract \",mdx(\"inlineCode\",{parentName:\"p\"},\"calldata\"),\" is read only.\"),mdx(\"p\",null,\"With scalar types such as \",mdx(\"inlineCode\",{parentName:\"p\"},\"uint\"),\" or \",mdx(\"inlineCode\",{parentName:\"p\"},\"address\"),\" the compiler handles the choice of storage for us, but with arrays, which are longer and more expensive, we specify the type of storage to be used.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        address to,\n        uint deadline\n    ) external virtual override ensure(deadline) returns (uint[] memory amounts) {\n`)),mdx(\"p\",null,\"Return values are always returned in memory.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        amounts = UniswapV2Library.getAmountsOut(factory, amountIn, path);\n        require(amounts[amounts.length - 1] \u003e= amountOutMin, 'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT');\n`)),mdx(\"p\",null,\"Calculate the amount to be purchased in each swap. If the result is less than the minimum the trader is willing to accept, revert out of the transaction.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        TransferHelper.safeTransferFrom(\n            path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]\n        );\n        _swap(amounts, path, to);\n    }\n`)),mdx(\"p\",null,\"Finally, transfer the initial ERC-20 token to the account for the first pair exchange and call \",mdx(\"inlineCode\",{parentName:\"p\"},\"_swap\"),\". This is all happening in the same transaction, so the pair exchange knows that any unexpected tokens are part of this transfer.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    function swapTokensForExactTokens(\n        uint amountOut,\n        uint amountInMax,\n        address[] calldata path,\n        address to,\n        uint deadline\n    ) external virtual override ensure(deadline) returns (uint[] memory amounts) {\n        amounts = UniswapV2Library.getAmountsIn(factory, amountOut, path);\n        require(amounts[0] \u003c= amountInMax, 'UniswapV2Router: EXCESSIVE_INPUT_AMOUNT');\n        TransferHelper.safeTransferFrom(\n            path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]\n        );\n        _swap(amounts, path, to);\n    }\n`)),mdx(\"p\",null,\"The previous function, \",mdx(\"inlineCode\",{parentName:\"p\"},\"swapTokensForTokens\"),\", allows a trader to specify an exact number of input tokens he is willing to give and the minimum number of output tokens he is willing to receive in return. This function does the reverse swap, it lets a trader specify the number of output tokens he wants, and the maximum number of input tokens he is willing to pay for them.\"),mdx(\"p\",null,\"In both cases, the trader has to give this periphery contract first an allowance to allow it to transfer them.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    function swapExactETHForTokens(uint amountOutMin, address[] calldata path, address to, uint deadline)\n        external\n        virtual\n        override\n        payable\n        ensure(deadline)\n        returns (uint[] memory amounts)\n    {\n        require(path[0] == WETH, 'UniswapV2Router: INVALID_PATH');\n        amounts = UniswapV2Library.getAmountsOut(factory, msg.value, path);\n        require(amounts[amounts.length - 1] \u003e= amountOutMin, 'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT');\n        IWETH(WETH).deposit{value: amounts[0]}();\n        assert(IWETH(WETH).transfer(UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]));\n        _swap(amounts, path, to);\n    }\n\n\n    function swapTokensForExactETH(uint amountOut, uint amountInMax, address[] calldata path, address to, uint deadline)\n        external\n        virtual\n        override\n        ensure(deadline)\n        returns (uint[] memory amounts)\n    {\n        require(path[path.length - 1] == WETH, 'UniswapV2Router: INVALID_PATH');\n        amounts = UniswapV2Library.getAmountsIn(factory, amountOut, path);\n        require(amounts[0] \u003c= amountInMax, 'UniswapV2Router: EXCESSIVE_INPUT_AMOUNT');\n        TransferHelper.safeTransferFrom(\n            path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]\n        );\n        _swap(amounts, path, address(this));\n        IWETH(WETH).withdraw(amounts[amounts.length - 1]);\n        TransferHelper.safeTransferETH(to, amounts[amounts.length - 1]);\n    }\n\n\n\n    function swapExactTokensForETH(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)\n        external\n        virtual\n        override\n        ensure(deadline)\n        returns (uint[] memory amounts)\n    {\n        require(path[path.length - 1] == WETH, 'UniswapV2Router: INVALID_PATH');\n        amounts = UniswapV2Library.getAmountsOut(factory, amountIn, path);\n        require(amounts[amounts.length - 1] \u003e= amountOutMin, 'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT');\n        TransferHelper.safeTransferFrom(\n            path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]\n        );\n        _swap(amounts, path, address(this));\n        IWETH(WETH).withdraw(amounts[amounts.length - 1]);\n        TransferHelper.safeTransferETH(to, amounts[amounts.length - 1]);\n    }\n\n\n    function swapETHForExactTokens(uint amountOut, address[] calldata path, address to, uint deadline)\n        external\n        virtual\n        override\n        payable\n        ensure(deadline)\n        returns (uint[] memory amounts)\n    {\n        require(path[0] == WETH, 'UniswapV2Router: INVALID_PATH');\n        amounts = UniswapV2Library.getAmountsIn(factory, amountOut, path);\n        require(amounts[0] \u003c= msg.value, 'UniswapV2Router: EXCESSIVE_INPUT_AMOUNT');\n        IWETH(WETH).deposit{value: amounts[0]}();\n        assert(IWETH(WETH).transfer(UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]));\n        _swap(amounts, path, to);\n        // refund dust eth, if any\n        if (msg.value \u003e amounts[0]) TransferHelper.safeTransferETH(msg.sender, msg.value - amounts[0]);\n    }\n`)),mdx(\"p\",null,\"These four variants all involve trading between ETH and tokens. The only difference is that we either receive ETH from the trader and use it to mint WETH, or we receive WETH from the last exchange in the path and burn it, sending the trader back the resulting ETH.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // **** SWAP (supporting fee-on-transfer tokens) ****\n    // requires the initial amount to have already been sent to the first pair\n    function _swapSupportingFeeOnTransferTokens(address[] memory path, address _to) internal virtual {\n`)),mdx(\"p\",null,\"This is the internal function to swap tokens that have transfer or storage fees to solve (\",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/Uniswap/uniswap-interface/issues/835\"}),\"this issue\"),\").\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        for (uint i; i \u003c path.length - 1; i++) {\n            (address input, address output) = (path[i], path[i + 1]);\n            (address token0,) = UniswapV2Library.sortTokens(input, output);\n            IUniswapV2Pair pair = IUniswapV2Pair(UniswapV2Library.pairFor(factory, input, output));\n            uint amountInput;\n            uint amountOutput;\n            { // scope to avoid stack too deep errors\n            (uint reserve0, uint reserve1,) = pair.getReserves();\n            (uint reserveInput, uint reserveOutput) = input == token0 ? (reserve0, reserve1) : (reserve1, reserve0);\n            amountInput = IERC20(input).balanceOf(address(pair)).sub(reserveInput);\n            amountOutput = UniswapV2Library.getAmountOut(amountInput, reserveInput, reserveOutput);\n`)),mdx(\"p\",null,\"Because of the transfer fees we cannot rely on the \",mdx(\"inlineCode\",{parentName:\"p\"},\"getAmountsOut\"),\" function to tell us how much we get out of each transfer (the way we do before calling the original \",mdx(\"inlineCode\",{parentName:\"p\"},\"_swap\"),\"). Instead we have to transfer first and then see how many tokens we got back.\"),mdx(\"p\",null,\"Note: In theory we could just use this function instead of \",mdx(\"inlineCode\",{parentName:\"p\"},\"_swap\"),\", but in certain cases (for example, if the transfer ends up being reverted because there isn't enough at the end to meet the required minimum) that would end up costing more gas. Transfer fee tokens are pretty rare, so while we need to accommodate them there's no need to all swaps to assume they go through at least one of them.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`            }\n            (uint amount0Out, uint amount1Out) = input == token0 ? (uint(0), amountOutput) : (amountOutput, uint(0));\n            address to = i \u003c path.length - 2 ? UniswapV2Library.pairFor(factory, output, path[i + 2]) : _to;\n            pair.swap(amount0Out, amount1Out, to, new bytes(0));\n        }\n    }\n\n\n    function swapExactTokensForTokensSupportingFeeOnTransferTokens(\n        uint amountIn,\n        uint amountOutMin,\n        address[] calldata path,\n        address to,\n        uint deadline\n    ) external virtual override ensure(deadline) {\n        TransferHelper.safeTransferFrom(\n            path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amountIn\n        );\n        uint balanceBefore = IERC20(path[path.length - 1]).balanceOf(to);\n        _swapSupportingFeeOnTransferTokens(path, to);\n        require(\n            IERC20(path[path.length - 1]).balanceOf(to).sub(balanceBefore) \u003e= amountOutMin,\n            'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT'\n        );\n    }\n\n\n    function swapExactETHForTokensSupportingFeeOnTransferTokens(\n        uint amountOutMin,\n        address[] calldata path,\n        address to,\n        uint deadline\n    )\n        external\n        virtual\n        override\n        payable\n        ensure(deadline)\n    {\n        require(path[0] == WETH, 'UniswapV2Router: INVALID_PATH');\n        uint amountIn = msg.value;\n        IWETH(WETH).deposit{value: amountIn}();\n        assert(IWETH(WETH).transfer(UniswapV2Library.pairFor(factory, path[0], path[1]), amountIn));\n        uint balanceBefore = IERC20(path[path.length - 1]).balanceOf(to);\n        _swapSupportingFeeOnTransferTokens(path, to);\n        require(\n            IERC20(path[path.length - 1]).balanceOf(to).sub(balanceBefore) \u003e= amountOutMin,\n            'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT'\n        );\n    }\n\n\n    function swapExactTokensForETHSupportingFeeOnTransferTokens(\n        uint amountIn,\n        uint amountOutMin,\n        address[] calldata path,\n        address to,\n        uint deadline\n    )\n        external\n        virtual\n        override\n        ensure(deadline)\n    {\n        require(path[path.length - 1] == WETH, 'UniswapV2Router: INVALID_PATH');\n        TransferHelper.safeTransferFrom(\n            path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amountIn\n        );\n        _swapSupportingFeeOnTransferTokens(path, address(this));\n        uint amountOut = IERC20(WETH).balanceOf(address(this));\n        require(amountOut \u003e= amountOutMin, 'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT');\n        IWETH(WETH).withdraw(amountOut);\n        TransferHelper.safeTransferETH(to, amountOut);\n    }\n`)),mdx(\"p\",null,\"These are the same variants used for normal tokens, but they call \",mdx(\"inlineCode\",{parentName:\"p\"},\"_swapSupportingFeeOnTransferTokens\"),\" instead.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // **** LIBRARY FUNCTIONS ****\n    function quote(uint amountA, uint reserveA, uint reserveB) public pure virtual override returns (uint amountB) {\n        return UniswapV2Library.quote(amountA, reserveA, reserveB);\n    }\n\n    function getAmountOut(uint amountIn, uint reserveIn, uint reserveOut)\n        public\n        pure\n        virtual\n        override\n        returns (uint amountOut)\n    {\n        return UniswapV2Library.getAmountOut(amountIn, reserveIn, reserveOut);\n    }\n\n    function getAmountIn(uint amountOut, uint reserveIn, uint reserveOut)\n        public\n        pure\n        virtual\n        override\n        returns (uint amountIn)\n    {\n        return UniswapV2Library.getAmountIn(amountOut, reserveIn, reserveOut);\n    }\n\n    function getAmountsOut(uint amountIn, address[] memory path)\n        public\n        view\n        virtual\n        override\n        returns (uint[] memory amounts)\n    {\n        return UniswapV2Library.getAmountsOut(factory, amountIn, path);\n    }\n\n    function getAmountsIn(uint amountOut, address[] memory path)\n        public\n        view\n        virtual\n        override\n        returns (uint[] memory amounts)\n    {\n        return UniswapV2Library.getAmountsIn(factory, amountOut, path);\n    }\n}\n`)),mdx(\"p\",null,\"These functions are just proxies that call the \",mdx(\"a\",e({parentName:\"p\"},{href:\"#uniswapV2library\"}),\"UniswapV2Library functions\"),\".\"),mdx(\"h3\",e({},{id:\"uniswapv2migrator\"}),\"UniswapV2Migrator.sol\"),mdx(\"p\",null,\"This contract was used to migrate exchanges from the old v1 to v2. Now that they have been migrated, it is no longer relevant.\"),mdx(\"h2\",e({},{id:\"libraries\"}),\"The Libraries\"),mdx(\"p\",null,\"The \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.openzeppelin.com/contracts/2.x/api/math\"}),\"SafeMath library\"),\" is well documented, so there's no need to document it here.\"),mdx(\"h3\",e({},{id:\"math\"}),\"Math\"),mdx(\"p\",null,\"This library contains some math functions that are not normally needed in Solidity code, so they aren't part of the language.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`pragma solidity =0.5.16;\n\n// a library for performing various math operations\n\nlibrary Math {\n    function min(uint x, uint y) internal pure returns (uint z) {\n        z = x \u003c y ? x : y;\n    }\n\n    // babylonian method (https://wikipedia.org/wiki/Methods_of_computing_square_roots#Babylonian_method)\n    function sqrt(uint y) internal pure returns (uint z) {\n        if (y \u003e 3) {\n            z = y;\n            uint x = y / 2 + 1;\n`)),mdx(\"p\",null,\"Start with x as an estimate that is higher than the square root (that is the reason we need to treat 1-3 as special cases).\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`            while (x \u003c z) {\n                z = x;\n                x = (y / x + x) / 2;\n`)),mdx(\"p\",null,\"Get a closer estimate, the average of the previous estimate and the number whose square root we're trying to find divided by the previous estimate. Repeat until the new estimate isn't lower than the existing one. For more details, \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://wikipedia.org/wiki/Methods_of_computing_square_roots#Babylonian_method\"}),\"see here\"),\".\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`            }\n        } else if (y != 0) {\n            z = 1;\n`)),mdx(\"p\",null,\"We should never need the square root of zero. The square roots of one, two, and three are roughly one (we use integers, so we ignore the fraction).\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        }\n    }\n}\n`)),mdx(\"h3\",e({},{id:\"fixedpoint\"}),\"Fixed Point Fractions (UQ112x112)\"),mdx(\"p\",null,\"This library handles fractions, which are normally not part of Ethereum arithmetic. It does this by encoding the number \",mdx(\"em\",{parentName:\"p\"},\"x\"),\" as \",mdx(\"em\",{parentName:\"p\"},\"x\",\"*\",\"2^112\"),\". This lets us use the original addition and subtraction opcodes without a change.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`pragma solidity =0.5.16;\n\n// a library for handling binary fixed point numbers (https://wikipedia.org/wiki/Q_(number_format))\n\n// range: [0, 2**112 - 1]\n// resolution: 1 / 2**112\n\nlibrary UQ112x112 {\n    uint224 constant Q112 = 2**112;\n`)),mdx(\"p\",null,mdx(\"inlineCode\",{parentName:\"p\"},\"Q112\"),\" is the encoding for one.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // encode a uint112 as a UQ112x112\n    function encode(uint112 y) internal pure returns (uint224 z) {\n        z = uint224(y) * Q112; // never overflows\n    }\n`)),mdx(\"p\",null,\"Because y is \",mdx(\"inlineCode\",{parentName:\"p\"},\"uint112\"),\", the most it can be is 2^112-1. That number can still be encoded as a \",mdx(\"inlineCode\",{parentName:\"p\"},\"UQ112x112\"),\".\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // divide a UQ112x112 by a uint112, returning a UQ112x112\n    function uqdiv(uint224 x, uint112 y) internal pure returns (uint224 z) {\n        z = x / uint224(y);\n    }\n}\n`)),mdx(\"p\",null,\"If we divide two \",mdx(\"inlineCode\",{parentName:\"p\"},\"UQ112x112\"),\" values, the result is no longer multiplied by 2^112. So instead we take an integer for the denominator. We would have needed to use a similar trick to do multiplication, but we don't need to do multiplication of \",mdx(\"inlineCode\",{parentName:\"p\"},\"UQ112x112\"),\" values.\"),mdx(\"h3\",e({},{id:\"uniswapv2library\"}),\"UniswapV2Library\"),mdx(\"p\",null,\"This library is used only by the periphery contracts\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`pragma solidity \u003e=0.5.0;\n\nimport '@uniswap/v2-core/contracts/interfaces/IUniswapV2Pair.sol';\n\nimport \"./SafeMath.sol\";\n\nlibrary UniswapV2Library {\n    using SafeMath for uint;\n\n    // returns sorted token addresses, used to handle return values from pairs sorted in this order\n    function sortTokens(address tokenA, address tokenB) internal pure returns (address token0, address token1) {\n        require(tokenA != tokenB, 'UniswapV2Library: IDENTICAL_ADDRESSES');\n        (token0, token1) = tokenA \u003c tokenB ? (tokenA, tokenB) : (tokenB, tokenA);\n        require(token0 != address(0), 'UniswapV2Library: ZERO_ADDRESS');\n    }\n`)),mdx(\"p\",null,\"Sort the two tokens by address, so we'll be able to get the address of the pair exchange for them. This is necessary because otherwise we'd have two possibilities, one for the parameters A,B and another for the parameters B,A, leading to two exchanges instead of one.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // calculates the CREATE2 address for a pair without making any external calls\n    function pairFor(address factory, address tokenA, address tokenB) internal pure returns (address pair) {\n        (address token0, address token1) = sortTokens(tokenA, tokenB);\n        pair = address(uint(keccak256(abi.encodePacked(\n                hex'ff',\n                factory,\n                keccak256(abi.encodePacked(token0, token1)),\n                hex'96e8ac4277198ff8b6f785478aa9a39f403cb768dd02cbee326c3e7da348845f' // init code hash\n            ))));\n    }\n`)),mdx(\"p\",null,\"This function calculates the address of the pair exchange for the two tokens. This contract is created using \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://eips.ethereum.org/EIPS/eip-1014\"}),\"the CREATE2 opcode\"),\", so we can calculate the address using the same algorithm if we know the parameters it uses. This is a lot cheaper than asking the factory, and\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // fetches and sorts the reserves for a pair\n    function getReserves(address factory, address tokenA, address tokenB) internal view returns (uint reserveA, uint reserveB) {\n        (address token0,) = sortTokens(tokenA, tokenB);\n        (uint reserve0, uint reserve1,) = IUniswapV2Pair(pairFor(factory, tokenA, tokenB)).getReserves();\n        (reserveA, reserveB) = tokenA == token0 ? (reserve0, reserve1) : (reserve1, reserve0);\n    }\n`)),mdx(\"p\",null,\"This function returns the reserves of the two tokens that the pair exchange has. Note that it can receive the tokens in either order, and sorts them for internal use.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // given some amount of an asset and pair reserves, returns an equivalent amount of the other asset\n    function quote(uint amountA, uint reserveA, uint reserveB) internal pure returns (uint amountB) {\n        require(amountA \u003e 0, 'UniswapV2Library: INSUFFICIENT_AMOUNT');\n        require(reserveA \u003e 0 \u0026\u0026 reserveB \u003e 0, 'UniswapV2Library: INSUFFICIENT_LIQUIDITY');\n        amountB = amountA.mul(reserveB) / reserveA;\n    }\n`)),mdx(\"p\",null,\"This function gives you the amount of token B you'll get in return for token A if there is no fee involved. This calculation takes into account that the transfer changes the exchange rate.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // given an input amount of an asset and pair reserves, returns the maximum output amount of the other asset\n    function getAmountOut(uint amountIn, uint reserveIn, uint reserveOut) internal pure returns (uint amountOut) {\n`)),mdx(\"p\",null,\"The \",mdx(\"inlineCode\",{parentName:\"p\"},\"quote\"),\" function above works great if there is no fee to use the pair exchange. However, if there is a 0.3% exchange fee the amount you actually get is lower. This function calculates the amount after the exchange fee.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`\n        require(amountIn \u003e 0, 'UniswapV2Library: INSUFFICIENT_INPUT_AMOUNT');\n        require(reserveIn \u003e 0 \u0026\u0026 reserveOut \u003e 0, 'UniswapV2Library: INSUFFICIENT_LIQUIDITY');\n        uint amountInWithFee = amountIn.mul(997);\n        uint numerator = amountInWithFee.mul(reserveOut);\n        uint denominator = reserveIn.mul(1000).add(amountInWithFee);\n        amountOut = numerator / denominator;\n    }\n`)),mdx(\"p\",null,\"Solidity does not handle fractions natively, so we can't just multiply the amount out by 0.997. Instead, we multiply the numerator by 997 and the denominator by 1000, achieving the same effect.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`    // given an output amount of an asset and pair reserves, returns a required input amount of the other asset\n    function getAmountIn(uint amountOut, uint reserveIn, uint reserveOut) internal pure returns (uint amountIn) {\n        require(amountOut \u003e 0, 'UniswapV2Library: INSUFFICIENT_OUTPUT_AMOUNT');\n        require(reserveIn \u003e 0 \u0026\u0026 reserveOut \u003e 0, 'UniswapV2Library: INSUFFICIENT_LIQUIDITY');\n        uint numerator = reserveIn.mul(amountOut).mul(1000);\n        uint denominator = reserveOut.sub(amountOut).mul(997);\n        amountIn = (numerator / denominator).add(1);\n    }\n`)),mdx(\"p\",null,\"This function does roughly the same thing, but it gets the output amount and provides the input.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`\n    // performs chained getAmountOut calculations on any number of pairs\n    function getAmountsOut(address factory, uint amountIn, address[] memory path) internal view returns (uint[] memory amounts) {\n        require(path.length \u003e= 2, 'UniswapV2Library: INVALID_PATH');\n        amounts = new uint[](path.length);\n        amounts[0] = amountIn;\n        for (uint i; i \u003c path.length - 1; i++) {\n            (uint reserveIn, uint reserveOut) = getReserves(factory, path[i], path[i + 1]);\n            amounts[i + 1] = getAmountOut(amounts[i], reserveIn, reserveOut);\n        }\n    }\n\n    // performs chained getAmountIn calculations on any number of pairs\n    function getAmountsIn(address factory, uint amountOut, address[] memory path) internal view returns (uint[] memory amounts) {\n        require(path.length \u003e= 2, 'UniswapV2Library: INVALID_PATH');\n        amounts = new uint[](path.length);\n        amounts[amounts.length - 1] = amountOut;\n        for (uint i = path.length - 1; i \u003e 0; i--) {\n            (uint reserveIn, uint reserveOut) = getReserves(factory, path[i - 1], path[i]);\n            amounts[i - 1] = getAmountIn(amounts[i], reserveIn, reserveOut);\n        }\n    }\n}\n`)),mdx(\"p\",null,\"These two functions handle identifying the values when it is necessary to go through several pair exchanges.\"),mdx(\"h3\",e({},{id:\"transfer-helper\"}),\"Transfer Helper\"),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/Uniswap/uniswap-lib/blob/master/contracts/libraries/TransferHelper.sol\"}),\"This library\"),\" adds success checks around ERC-20 and Ethereum transfers to treat a revert and a \",mdx(\"inlineCode\",{parentName:\"p\"},\"false\"),\" value return the same way.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`// SPDX-License-Identifier: GPL-3.0-or-later\n\npragma solidity \u003e=0.6.0;\n\n// helper methods for interacting with ERC20 tokens and sending ETH that do not consistently return true/false\nlibrary TransferHelper {\n    function safeApprove(\n        address token,\n        address to,\n        uint256 value\n    ) internal {\n        // bytes4(keccak256(bytes('approve(address,uint256)')));\n        (bool success, bytes memory data) = token.call(abi.encodeWithSelector(0x095ea7b3, to, value));\n\n`)),mdx(\"p\",null,\"We can call a different contract in one of two ways:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"Use an interface definition to create a function call\"),mdx(\"li\",{parentName:\"ul\"},\"Use the \",mdx(\"a\",e({parentName:\"li\"},{href:\"https://docs.soliditylang.org/en/v0.8.3/abi-spec.html\"}),\"application binary interface (ABI)\"),' \"manually\" to create the call. This is what the author of the code decided to do it.')),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`        require(\n            success \u0026\u0026 (data.length == 0 || abi.decode(data, (bool))),\n            'TransferHelper::safeApprove: approve failed'\n        );\n    }\n`)),mdx(\"p\",null,\"For the sake of backwards compatibility with token that were created prior to the ERC-20 standard, an ERC-20 call can fail either by reverting (in which case \",mdx(\"inlineCode\",{parentName:\"p\"},\"success\"),\" is \",mdx(\"inlineCode\",{parentName:\"p\"},\"false\"),\") or by being successful and returning a \",mdx(\"inlineCode\",{parentName:\"p\"},\"false\"),\" value (in which case there is output data, and if you decode it as a boolean you get \",mdx(\"inlineCode\",{parentName:\"p\"},\"false\"),\").\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`\n\n    function safeTransfer(\n        address token,\n        address to,\n        uint256 value\n    ) internal {\n        // bytes4(keccak256(bytes('transfer(address,uint256)')));\n        (bool success, bytes memory data) = token.call(abi.encodeWithSelector(0xa9059cbb, to, value));\n        require(\n            success \u0026\u0026 (data.length == 0 || abi.decode(data, (bool))),\n            'TransferHelper::safeTransfer: transfer failed'\n        );\n    }\n`)),mdx(\"p\",null,\"This function implements \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://eips.ethereum.org/EIPS/eip-20#transfer\"}),\"ERC-20's transfer functionality\"),\", which allows an account to spend out the allowance provided by a different account.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`\n    function safeTransferFrom(\n        address token,\n        address from,\n        address to,\n        uint256 value\n    ) internal {\n        // bytes4(keccak256(bytes('transferFrom(address,address,uint256)')));\n        (bool success, bytes memory data) = token.call(abi.encodeWithSelector(0x23b872dd, from, to, value));\n        require(\n            success \u0026\u0026 (data.length == 0 || abi.decode(data, (bool))),\n            'TransferHelper::transferFrom: transferFrom failed'\n        );\n    }\n`)),mdx(\"p\",null,\"This function implements \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://eips.ethereum.org/EIPS/eip-20#transferfrom\"}),\"ERC-20's transferFrom functionality\"),\", which allows an account to spend out the allowance provided by a different account.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-solidity\"}),`\n    function safeTransferETH(address to, uint256 value) internal {\n        (bool success, ) = to.call{value: value}(new bytes(0));\n        require(success, 'TransferHelper::safeTransferETH: ETH transfer failed');\n    }\n}\n`)),mdx(\"p\",null,\"This function transfers ether to an account. Any call to a different contract can attempt to send ether. Because we don't need to actually call any function, we don't send any data with the call.\"),mdx(\"h2\",e({},{id:\"conclusion\"}),\"Conclusion\"),mdx(\"p\",null,\"This is a long article of about 50 pages. If you made it here, congratulations! Hopefully by now you've understood the considerations in writing a real-life application (as opposed to short sample programs) and are better to be able to write contracts for your own use cases.\"),mdx(\"p\",null,\"Now go and write something useful and amaze us.\"))}MDXContent.isMDXComponent=!0;\n","scope":{}},"slug":"/developers/tutorials/uniswap-v2-annotated-code/","frontmatter":{"title":"Uniswap-v2 Contract Walk-Through","description":"How does the Uniswap-v2 contract work? Why is it written that way?","author":"Ori Pomerantz","tags":["solidity"],"skill":"intermediate","published":"2021-05-01","lang":"en"},"lastUpdatedDate":"2024-04-02T18:47:41.000Z","lastDeployDate":"2024-05-22T00:00:00.000Z","contentNotTranslated":false,"layout":"tutorial","timeToRead":60,"tocItems":[{"title":"Introduction","url":"#introduction","items":[{"title":"What Does Uniswap Do?","url":"#what-does-uniswap-do"},{"title":"Why v2? Why not v3?","url":"#why-v2"},{"title":"Core Contracts vs Periphery Contracts","url":"#contract-types"}]},{"title":"Data and Control Flows","url":"#flows","items":[{"title":"Swap","url":"#swap-flow","items":[{"title":"Caller","url":"#caller"},{"title":"In the periphery contract (UniswapV2Router02.sol)","url":"#in-the-periphery-contract-uniswapv2router02-sol"},{"title":"In the core contract (UniswapV2Pair.sol)","url":"#in-the-core-contract-uniswapv2pairsol-2"},{"title":"Back in the periphery contract (UniswapV2Router02.sol)","url":"#back-in-the-periphery-contract-uniswapv2router02-sol"}]},{"title":"Add Liquidity","url":"#add-liquidity-flow","items":[{"title":"Caller","url":"#caller-2"},{"title":"In the periphery contract (UniswapV2Router02.sol)","url":"#in-the-periphery-contract-uniswapv2router02sol-2"},{"title":"In the core contract (UniswapV2Pair.sol)","url":"#in-the-core-contract-uniswapv2pairsol-2"}]},{"title":"Remove Liquidity","url":"#remove-liquidity-flow","items":[{"title":"Caller","url":"#caller-3"},{"title":"In the periphery contract (UniswapV2Router02.sol)","url":"#in-the-periphery-contract-uniswapv2router02sol-3"},{"title":"In the core contract (UniswapV2Pair.sol)","url":"#in-the-core-contract-uniswapv2pairsol-3"}]}]},{"title":"The Core Contracts","url":"#core-contracts","items":[{"title":"UniswapV2Pair.sol","url":"#uniswapv2pair","items":[{"title":"Variables","url":"#pair-vars"},{"title":"Lock","url":"#pair-lock"},{"title":"Misc. functions","url":"#pair-misc"},{"title":"Events","url":"#pair-events"},{"title":"Setup Functions","url":"#pair-setup"},{"title":"Internal Update Functions","url":"#pair-update-internal","items":[{"title":"_update","url":"#_update"},{"title":"_mintFee","url":"#_mintfee"}]},{"title":"Externally Accessible Functions","url":"#pair-external","items":[{"title":"mint","url":"#mint"},{"title":"burn","url":"#burn"},{"title":"swap","url":"#swap"},{"title":"Sync or Skim","url":"#sync-or-skim"}]}]},{"title":"UniswapV2Factory.sol","url":"#uniswapv2factory"},{"title":"UniswapV2ERC20.sol","url":"#uniswapv2erc20"}]},{"title":"The Periphery Contracts","url":"#periphery-contracts","items":[{"title":"UniswapV2Router01.sol","url":"#uniswapv2router01"},{"title":"UniswapV2Router02.sol","url":"#uniswapv2router02","items":[{"title":"Add Liquidity","url":"#add-liquidity"},{"title":"Remove Liquidity","url":"#remove-liquidity"},{"title":"Trade","url":"#trade"}]},{"title":"UniswapV2Migrator.sol","url":"#uniswapv2migrator"}]},{"title":"The Libraries","url":"#libraries","items":[{"title":"Math","url":"#math"},{"title":"Fixed Point Fractions (UQ112x112)","url":"#fixedpoint"},{"title":"UniswapV2Library","url":"#uniswapv2library"},{"title":"Transfer Helper","url":"#transfer-helper"}]},{"title":"Conclusion","url":"#conclusion"}],"crowdinContributors":[],"gfissues":[{"url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12965","repository_url":"https://api.github.com/repos/ethereum/ethereum-org-website","labels_url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12965/labels{/name}","comments_url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12965/comments","events_url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12965/events","html_url":"https://github.com/ethereum/ethereum-org-website/issues/12965","id":2297441581,"node_id":"I_kwDOBvEA_s6I8C0t","number":12965,"title":"Bug report - overlapping elements","user":{"login":"wackerow","id":54227730,"node_id":"MDQ6VXNlcjU0MjI3NzMw","avatar_url":"https://avatars.githubusercontent.com/u/54227730?v=4","gravatar_id":"","url":"https://api.github.com/users/wackerow","html_url":"https://github.com/wackerow","followers_url":"https://api.github.com/users/wackerow/followers","following_url":"https://api.github.com/users/wackerow/following{/other_user}","gists_url":"https://api.github.com/users/wackerow/gists{/gist_id}","starred_url":"https://api.github.com/users/wackerow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wackerow/subscriptions","organizations_url":"https://api.github.com/users/wackerow/orgs","repos_url":"https://api.github.com/users/wackerow/repos","events_url":"https://api.github.com/users/wackerow/events{/privacy}","received_events_url":"https://api.github.com/users/wackerow/received_events","type":"User","site_admin":false},"labels":[{"id":796509427,"node_id":"MDU6TGFiZWw3OTY1MDk0Mjc=","url":"https://api.github.com/repos/ethereum/ethereum-org-website/labels/bug%20:bug:","name":"bug :bug:","color":"ee0701","default":false,"description":"Something isn't working"},{"id":1632703486,"node_id":"MDU6TGFiZWwxNjMyNzAzNDg2","url":"https://api.github.com/repos/ethereum/ethereum-org-website/labels/low%20priority","name":"low priority","color":"0e8a16","default":false,"description":"This has a low priority"},{"id":2847180148,"node_id":"MDU6TGFiZWwyODQ3MTgwMTQ4","url":"https://api.github.com/repos/ethereum/ethereum-org-website/labels/good%20first%20issue","name":"good first issue","color":"6C5DF6","default":true,"description":"Good item to try if you're new to contributing"},{"id":5018762711,"node_id":"LA_kwDOBvEA_s8AAAABKyQ91w","url":"https://api.github.com/repos/ethereum/ethereum-org-website/labels/dev%20required","name":"dev required","color":"90AE07","default":false,"description":""}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-05-15T10:10:27Z","updated_at":"2024-05-22T18:28:02Z","closed_at":null,"author_association":"MEMBER","active_lock_reason":null,"body":"### Describe the bug\n\nThe LanguagePicker component has a keyboard shortcut `[\\]` available, which is noted inside the text input to filter languages once the menu is open. In left-to-right (LTR) languages this works well, but with right-to-left (RTL) languages (`fa`, `he`, `ar`, `ur`) this keyboard shortcut indicator is not adjusting to the left side of the input, causing it to overlap with the placeholder/input text.\n\n### To reproduce\n\n1. Go to https://ethereum.org/he/\r\n2. Click on HE (language menu top left) \r\n\u003cimg width=\"153\" alt=\"image\" src=\"https://github.com/ethereum/ethereum-org-website/assets/54227730/fa31af6d-4f81-43fb-8680-1ccbeb8d249d\"\u003e\r\n3. See overlapping elements\r\n\n\n### Expected behavior\n\nKeyboard shortcut indicator `[\\]` should be on the left for RTL languages, and should also not overlap the clearing X once user starts typing.\n\n### Screenshots\n\n\u003cimg width=\"612\" alt=\"image\" src=\"https://github.com/ethereum/ethereum-org-website/assets/54227730/0037659c-6f82-4ad1-9573-a495079ff842\"\u003e\r\n\n\n### Desktop (please complete the following information)\n\n_No response_\n\n### Smartphone (please complete the following information)\n\n_No response_\n\n### Additional context\n\n_No response_\n\n### Would you like to work on this issue?\n\n- [ ] Yes\n- [X] No","reactions":{"url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12965/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12965/timeline","performed_via_github_app":null,"state_reason":null},{"url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12061","repository_url":"https://api.github.com/repos/ethereum/ethereum-org-website","labels_url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12061/labels{/name}","comments_url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12061/comments","events_url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12061/events","html_url":"https://github.com/ethereum/ethereum-org-website/issues/12061","id":2107761164,"node_id":"I_kwDOBvEA_s59oeIM","number":12061,"title":"Contradiction between smart contract accounts and wallets","user":{"login":"shoenseiwaso","id":5861379,"node_id":"MDQ6VXNlcjU4NjEzNzk=","avatar_url":"https://avatars.githubusercontent.com/u/5861379?v=4","gravatar_id":"","url":"https://api.github.com/users/shoenseiwaso","html_url":"https://github.com/shoenseiwaso","followers_url":"https://api.github.com/users/shoenseiwaso/followers","following_url":"https://api.github.com/users/shoenseiwaso/following{/other_user}","gists_url":"https://api.github.com/users/shoenseiwaso/gists{/gist_id}","starred_url":"https://api.github.com/users/shoenseiwaso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shoenseiwaso/subscriptions","organizations_url":"https://api.github.com/users/shoenseiwaso/orgs","repos_url":"https://api.github.com/users/shoenseiwaso/repos","events_url":"https://api.github.com/users/shoenseiwaso/events{/privacy}","received_events_url":"https://api.github.com/users/shoenseiwaso/received_events","type":"User","site_admin":false},"labels":[{"id":796509431,"node_id":"MDU6TGFiZWw3OTY1MDk0MzE=","url":"https://api.github.com/repos/ethereum/ethereum-org-website/labels/help%20wanted","name":"help wanted","color":"206699","default":true,"description":"Extra attention is needed or someone is needed to help"},{"id":1553318847,"node_id":"MDU6TGFiZWwxNTUzMzE4ODQ3","url":"https://api.github.com/repos/ethereum/ethereum-org-website/labels/content%20%F0%9F%96%8B%EF%B8%8F","name":"content ","color":"70e855","default":false,"description":"This involves copy additions or edits"},{"id":2847180148,"node_id":"MDU6TGFiZWwyODQ3MTgwMTQ4","url":"https://api.github.com/repos/ethereum/ethereum-org-website/labels/good%20first%20issue","name":"good first issue","color":"6C5DF6","default":true,"description":"Good item to try if you're new to contributing"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-01-30T12:34:38Z","updated_at":"2024-05-14T16:51:07Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"In the following section, it describes both \"contract accounts\", and then goes on to say, \"An account is the keypair for a user-owned Ethereum account.\" So therefore a contract account is not an account?\r\n\r\nHappy to suggest a revision through a PR!\r\n\r\nhttps://github.com/ethereum/ethereum-org-website/blob/9c48ba8c9305a351c815aa494974923f9dbb0b97/public/content/developers/docs/accounts/index.md?plain=1#L94-L112","reactions":{"url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12061/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12061/timeline","performed_via_github_app":null,"state_reason":"reopened"},{"url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12059","repository_url":"https://api.github.com/repos/ethereum/ethereum-org-website","labels_url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12059/labels{/name}","comments_url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12059/comments","events_url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12059/events","html_url":"https://github.com/ethereum/ethereum-org-website/issues/12059","id":2107352464,"node_id":"I_kwDOBvEA_s59m6WQ","number":12059,"title":"RANDAO explanation in Node Architecture page","user":{"login":"aslikaya","id":9151261,"node_id":"MDQ6VXNlcjkxNTEyNjE=","avatar_url":"https://avatars.githubusercontent.com/u/9151261?v=4","gravatar_id":"","url":"https://api.github.com/users/aslikaya","html_url":"https://github.com/aslikaya","followers_url":"https://api.github.com/users/aslikaya/followers","following_url":"https://api.github.com/users/aslikaya/following{/other_user}","gists_url":"https://api.github.com/users/aslikaya/gists{/gist_id}","starred_url":"https://api.github.com/users/aslikaya/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aslikaya/subscriptions","organizations_url":"https://api.github.com/users/aslikaya/orgs","repos_url":"https://api.github.com/users/aslikaya/repos","events_url":"https://api.github.com/users/aslikaya/events{/privacy}","received_events_url":"https://api.github.com/users/aslikaya/received_events","type":"User","site_admin":false},"labels":[{"id":1553318847,"node_id":"MDU6TGFiZWwxNTUzMzE4ODQ3","url":"https://api.github.com/repos/ethereum/ethereum-org-website/labels/content%20%F0%9F%96%8B%EF%B8%8F","name":"content ","color":"70e855","default":false,"description":"This involves copy additions or edits"},{"id":2847180148,"node_id":"MDU6TGFiZWwyODQ3MTgwMTQ4","url":"https://api.github.com/repos/ethereum/ethereum-org-website/labels/good%20first%20issue","name":"good first issue","color":"6C5DF6","default":true,"description":"Good item to try if you're new to contributing"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2024-01-30T09:31:57Z","updated_at":"2024-05-14T16:51:45Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"In [Node Comparison](https://ethereum.org/developers/docs/nodes-and-clients/node-architecture#node-comparison) section, RANDAO is mentioned for the first time, and is explained in later sections. It is easy to find through searching the website but it would be nice to have a brief explanation about what it is when mentioned for the first time. ","reactions":{"url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12059/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/12059/timeline","performed_via_github_app":null,"state_reason":"reopened"},{"url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/6400","repository_url":"https://api.github.com/repos/ethereum/ethereum-org-website","labels_url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/6400/labels{/name}","comments_url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/6400/comments","events_url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/6400/events","html_url":"https://github.com/ethereum/ethereum-org-website/issues/6400","id":1241942409,"node_id":"I_kwDOBvEA_s5KBomJ","number":6400,"title":"Create a new page for \"Ethereum research bounties\"","user":{"login":"samajammin","id":8097623,"node_id":"MDQ6VXNlcjgwOTc2MjM=","avatar_url":"https://avatars.githubusercontent.com/u/8097623?v=4","gravatar_id":"","url":"https://api.github.com/users/samajammin","html_url":"https://github.com/samajammin","followers_url":"https://api.github.com/users/samajammin/followers","following_url":"https://api.github.com/users/samajammin/following{/other_user}","gists_url":"https://api.github.com/users/samajammin/gists{/gist_id}","starred_url":"https://api.github.com/users/samajammin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samajammin/subscriptions","organizations_url":"https://api.github.com/users/samajammin/orgs","repos_url":"https://api.github.com/users/samajammin/repos","events_url":"https://api.github.com/users/samajammin/events{/privacy}","received_events_url":"https://api.github.com/users/samajammin/received_events","type":"User","site_admin":false},"labels":[{"id":796509429,"node_id":"MDU6TGFiZWw3OTY1MDk0Mjk=","url":"https://api.github.com/repos/ethereum/ethereum-org-website/labels/feature%20:sparkles:","name":"feature :sparkles:","color":"1d76db","default":false,"description":"This is enhancing something existing or creating something new"},{"id":1553318847,"node_id":"MDU6TGFiZWwxNTUzMzE4ODQ3","url":"https://api.github.com/repos/ethereum/ethereum-org-website/labels/content%20%F0%9F%96%8B%EF%B8%8F","name":"content ","color":"70e855","default":false,"description":"This involves copy additions or edits"},{"id":2847180148,"node_id":"MDU6TGFiZWwyODQ3MTgwMTQ4","url":"https://api.github.com/repos/ethereum/ethereum-org-website/labels/good%20first%20issue","name":"good first issue","color":"6C5DF6","default":true,"description":"Good item to try if you're new to contributing"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2022-05-19T15:16:46Z","updated_at":"2024-05-16T14:16:43Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Is your feature request related to a problem? Please describe.**\r\n\r\nWe have an Ethereum bug bounty page:\r\nhttps://ethereum.org/en/bug-bounty/\r\nThis page covers a specific set of bounties (specification bugs, client bugs, solidity bugs, deposit contract bugs). \r\n\r\nMeanwhile there are many other (primarily research-based) bounties that the EF \u0026 other projects/orgs are funding. One primary issue of these is discoverability - there's no main place (that I know of, LMK if I'm wrong) where these bounties are aggregated for people to find \u0026 tackle.\r\n\r\n**Describe the solution you'd like**\r\n\r\nCreate a new page for \"Ethereum research bounties\" page that lists various bounties within the Ethereum space.\r\n\r\nThis page could include such bounties as:\r\n- https://rsa.cash/bounties/\r\n- https://legendreprf.org/bounties\r\n- http://zkhashbounties.info/\r\n- https://web.archive.org/web/20210304022013/https://mimchash.org/\r\n\r\n**Describe alternatives you've considered**\r\n\r\n- Not sure if \"research bounties\" is the best name, is there a better name?\r\n- We have a page with a broader scope than \"research bounties\", e.g. just \"Ethereum bounties\" or \"community bounties\" that cover all bounty programs in the space (e.g. including smart contract bounties of applications or bounties of Ethereum L2 protocols)?\r\n- This may overlap with an existing initiative to build out resources on open/active area of Ethereum research (https://github.com/ethereum/ethereum-org-website/pull/6144) - perhaps this idea could be merged into that in some form (e.g. linking out to various bounties within each research category)\r\n\r\n**Additional context**\r\n\r\n**Edit**: there is a place that somewhat accomplishes this : challenges.ethereum.org but it's a bit janky  e.g. there's not much context \u0026 the listed bounties aren't actual HTML links. I suspect creating a page directly on ethereum.org for discoverability \u0026 internationalization support would still be worthwhile.\r\n\r\nHave spoken to a few different research teams who have expressed interest in something like this existing.\r\n\r\n**Want to contribute?**\r\n\r\nWe love contributions from the Ethereum community! Please comment on an issue if you're interested in helping out with a PR.\r\n","reactions":{"url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/6400/reactions","total_count":3,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":1,"eyes":0},"timeline_url":"https://api.github.com/repos/ethereum/ethereum-org-website/issues/6400/timeline","performed_via_github_app":null,"state_reason":null}],"gitContributors":[{"login":"wackerow","avatar_url":"https://avatars.githubusercontent.com/u/54227730?v=4","html_url":"https://github.com/wackerow","date":"2024-04-02T18:47:41Z"},{"login":"minimalsm","avatar_url":"https://avatars.githubusercontent.com/u/62268199?v=4","html_url":"https://github.com/minimalsm","date":"2024-02-23T15:01:01Z"},{"login":"pettinarip","avatar_url":"https://avatars.githubusercontent.com/u/468158?v=4","html_url":"https://github.com/pettinarip","date":"2023-10-30T14:00:56Z"},{"login":"nhsz","avatar_url":"https://avatars.githubusercontent.com/u/948922?v=4","html_url":"https://github.com/nhsz","date":"2023-08-15T14:19:33Z"},{"login":"corwintines","avatar_url":"https://avatars.githubusercontent.com/u/15589226?v=4","html_url":"https://github.com/corwintines","date":"2023-03-23T20:51:22Z"},{"login":"Dom-Mac","avatar_url":"https://avatars.githubusercontent.com/u/52203820?v=4","html_url":"https://github.com/Dom-Mac","date":"2023-02-20T22:16:27Z"},{"login":"consentsam","avatar_url":"https://avatars.githubusercontent.com/u/16432541?v=4","html_url":"https://github.com/consentsam","date":"2023-02-13T14:47:46Z"},{"login":"Pandapip1","avatar_url":"https://avatars.githubusercontent.com/u/45835846?v=4","html_url":"https://github.com/Pandapip1","date":"2023-01-10T18:47:08Z"},{"login":"rex4539","avatar_url":"https://avatars.githubusercontent.com/u/227442?v=4","html_url":"https://github.com/rex4539","date":"2023-01-09T13:05:49Z"},{"login":"aviggiano","avatar_url":"https://avatars.githubusercontent.com/u/3029017?v=4","html_url":"https://github.com/aviggiano","date":"2022-12-19T20:35:43Z"},{"login":"giorgionocera","avatar_url":"https://avatars.githubusercontent.com/u/13519292?v=4","html_url":"https://github.com/giorgionocera","date":"2022-10-11T16:39:28Z"},{"login":"pankajjagtapp","avatar_url":"https://avatars.githubusercontent.com/u/89507661?v=4","html_url":"https://github.com/pankajjagtapp","date":"2022-09-07T04:35:35Z"},{"login":"jmcook1186","avatar_url":"https://avatars.githubusercontent.com/u/33655003?v=4","html_url":"https://github.com/jmcook1186","date":"2022-08-17T13:53:04Z"},{"login":"carllippert","avatar_url":"https://avatars.githubusercontent.com/u/16457876?v=4","html_url":"https://github.com/carllippert","date":"2022-08-09T20:48:23Z"},{"login":"MATsxm","avatar_url":"https://avatars.githubusercontent.com/u/1972717?v=4","html_url":"https://github.com/MATsxm","date":"2022-05-15T06:20:58Z"},{"login":"albertlieyingadrian","avatar_url":"https://avatars.githubusercontent.com/u/12984659?v=4","html_url":"https://github.com/albertlieyingadrian","date":"2022-05-01T17:38:20Z"},{"login":"hursittarcan","avatar_url":"https://avatars.githubusercontent.com/u/75273616?v=4","html_url":"https://github.com/hursittarcan","date":"2022-03-31T11:54:55Z"},{"login":"0xbrito","avatar_url":"https://avatars.githubusercontent.com/u/84880186?v=4","html_url":"https://github.com/0xbrito","date":"2022-03-26T02:19:22Z"},{"login":"tnkrxyz","avatar_url":"https://avatars.githubusercontent.com/u/97625120?v=4","html_url":"https://github.com/tnkrxyz","date":"2022-03-22T20:08:18Z"}]},"__N_SSG":true},"page":"/[...slug]","query":{"slug":["developers","tutorials","uniswap-v2-annotated-code"]},"buildId":"QEaqpGwTe2tBcFk8hwuEt","isFallback":false,"gsp":true,"locale":"en","locales":["default","en","am","ar","az","be","bg","bn","bs","ca","cs","da","de","el","es","fa","fi","fr","gl","gu","he","hi","hr","hu","hy-am","id","ig","it","ja","ka","kk","km","kn","ko","lt","ml","mr","ms","ne-np","nl","nb","pcm","fil","pl","pt-br","pt","ro","ru","se","sk","sl","sr","sw","ta","te","tk","th","tr","uk","ur","uz","vi","zh-tw","zh"],"defaultLocale":"default","scriptLoader":[]}</script>
<script async="" id="netlify-rum-container" src="/.netlify/scripts/rum" data-netlify-rum-site-id="e8f2e766-888b-4954-8500-1b647d84db99" data-netlify-deploy-branch="master" data-netlify-deploy-context="production" data-netlify-cwv-token="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzaXRlX2lkIjoiZThmMmU3NjYtODg4Yi00OTU0LTg1MDAtMWI2NDdkODRkYjk5IiwiYWNjb3VudF9pZCI6IjVjZDVlNTVlNTljNGE3YzA0NDVjYTg1ZCIsImRlcGxveV9pZCI6IjY2NGY2MzBkZDc5MzE0MDAwODY4MDM2ZSIsImlzc3VlciI6Im5mc2VydmVyIn0._r1eyLaaET-ENEKTexjfSGDS2BaAYYnDCTKOKQTg9d8"></script><next-route-announcer><p aria-live="assertive" id="__next-route-announcer__" role="alert" style="border: 0px; clip: rect(0px, 0px, 0px, 0px); height: 1px; margin: -1px; overflow: hidden; padding: 0px; position: absolute; top: 0px; width: 1px; white-space: nowrap; overflow-wrap: normal;"></p></next-route-announcer><div class="chakra-portal"></div></body></html>