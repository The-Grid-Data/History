Skip to content

## Navigation Menu

Toggle navigation

[ ](https://github.com/)

[ Sign in
](/login?return_to=https%3A%2F%2Fgithub.com%2FSharkyFi%2Fclient%3Ftab%3Dreadme-
ov-file)

  * Product 

    * [ Actions Automate any workflow  ](https://github.com/features/actions)
    * [ Packages Host and manage packages  ](https://github.com/features/packages)
    * [ Security Find and fix vulnerabilities  ](https://github.com/features/security)
    * [ Codespaces Instant dev environments  ](https://github.com/features/codespaces)
    * [ Copilot Write better code with AI  ](https://github.com/features/copilot)
    * [ Code review Manage code changes  ](https://github.com/features/code-review)
    * [ Issues Plan and track work  ](https://github.com/features/issues)
    * [ Discussions Collaborate outside of code  ](https://github.com/features/discussions)

Explore

    * [ All features ](https://github.com/features)
    * [ Documentation  ](https://docs.github.com)
    * [ GitHub Skills  ](https://skills.github.com)
    * [ Blog  ](https://github.blog)

  * Solutions 

For

    * [ Enterprise ](https://github.com/enterprise)
    * [ Teams ](https://github.com/team)
    * [ Startups ](https://github.com/enterprise/startups)
    * [ Education  ](https://education.github.com)

By Solution

    * [ CI/CD & Automation ](https://github.com/solutions/ci-cd)
    * [ DevOps ](https://github.com/solutions/devops)
    * [ DevSecOps  ](https://resources.github.com/devops/fundamentals/devsecops)

Resources

    * [ Learning Pathways  ](https://resources.github.com/learn/pathways)
    * [ White papers, Ebooks, Webinars  ](https://resources.github.com)
    * [ Customer Stories ](https://github.com/customer-stories)
    * [ Partners  ](https://partner.github.com)

  * Open Source 

    * [ GitHub Sponsors Fund open source developers  ](https://github.com/sponsors)

    * [ The ReadME Project GitHub community articles  ](https://github.com/readme)

Repositories

    * [ Topics ](https://github.com/topics)
    * [ Trending ](https://github.com/trending)
    * [ Collections ](https://github.com/collections)

  * [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[ Search syntax tips ](https://docs.github.com/search-github/github-code-
search/understanding-github-code-search-syntax)

#  Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

Cancel  Submit feedback

#  Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our
[documentation](https://docs.github.com/search-github/github-code-
search/understanding-github-code-search-syntax).

Cancel  Create saved search

[ Sign in
](/login?return_to=https%3A%2F%2Fgithub.com%2FSharkyFi%2Fclient%3Ftab%3Dreadme-
ov-file)

[ Sign up
](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-
name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=SharkyFi%2Fclient)

You signed in with another tab or window. [Reload]() to refresh your session.
You signed out in another tab or window. [Reload]() to refresh your session.
You switched accounts on another tab or window. [Reload]() to refresh your
session. Dismiss alert

{{ message }}

[ SharkyFi ](/SharkyFi) / **[client](/SharkyFi/client) ** Public

  * [ Notifications ](/login?return_to=%2FSharkyFi%2Fclient) You must be signed in to change notification settings
  * [ Fork 11 ](/login?return_to=%2FSharkyFi%2Fclient)
  * [ Star  30 ](/login?return_to=%2FSharkyFi%2Fclient)

  * 

Documentation for the @sharkyfi/client program library

### License

[ GPL-3.0 license ](/SharkyFi/client/blob/main/LICENSE)

[ 30 stars ](/SharkyFi/client/stargazers) [ 11 forks ](/SharkyFi/client/forks)
[ Branches ](/SharkyFi/client/branches) [ Tags ](/SharkyFi/client/tags) [
Activity ](/SharkyFi/client/activity)

[ Star  ](/login?return_to=%2FSharkyFi%2Fclient)

[ Notifications ](/login?return_to=%2FSharkyFi%2Fclient) You must be signed in
to change notification settings

  * [ Code ](/SharkyFi/client)
  * [ Issues 2 ](/SharkyFi/client/issues)
  * [ Pull requests 0 ](/SharkyFi/client/pulls)
  * [ Actions ](/SharkyFi/client/actions)
  * [ Projects 0 ](/SharkyFi/client/projects)
  * [ Security ](/SharkyFi/client/security)
  * [ Insights ](/SharkyFi/client/pulse)

Additional navigation options

  * [ Code ](/SharkyFi/client)
  * [ Issues ](/SharkyFi/client/issues)
  * [ Pull requests ](/SharkyFi/client/pulls)
  * [ Actions ](/SharkyFi/client/actions)
  * [ Projects ](/SharkyFi/client/projects)
  * [ Security ](/SharkyFi/client/security)
  * [ Insights ](/SharkyFi/client/pulse)

# SharkyFi/client

This commit does not belong to any branch on this repository, and may belong
to a fork outside of the repository.

 main

[Branches](/SharkyFi/client/branches)[Tags](/SharkyFi/client/tags)

[](/SharkyFi/client/branches)[](/SharkyFi/client/tags)

Go to file

Code

## Folders and files

Name| Name| Last commit message| Last commit date  
---|---|---|---  
  
## Latest commit



## History

[39 Commits](/SharkyFi/client/commits/main/)[](/SharkyFi/client/commits/main/)  
  
### [.vscode](/SharkyFi/client/tree/main/.vscode ".vscode")

|

### [.vscode](/SharkyFi/client/tree/main/.vscode ".vscode")

|  |    
  
### [.yarn/releases](/SharkyFi/client/tree/main/.yarn/releases "This path
skips through empty directories")

|

### [.yarn/releases](/SharkyFi/client/tree/main/.yarn/releases "This path
skips through empty directories")

|  |    
  
### [examples](/SharkyFi/client/tree/main/examples "examples")

|

### [examples](/SharkyFi/client/tree/main/examples "examples")

|  |    
  
### [idl](/SharkyFi/client/tree/main/idl "idl")

|

### [idl](/SharkyFi/client/tree/main/idl "idl")

|  |    
  
### [.gitignore](/SharkyFi/client/blob/main/.gitignore ".gitignore")

|

### [.gitignore](/SharkyFi/client/blob/main/.gitignore ".gitignore")

|  |    
  
### [.prettierrc](/SharkyFi/client/blob/main/.prettierrc ".prettierrc")

|

### [.prettierrc](/SharkyFi/client/blob/main/.prettierrc ".prettierrc")

|  |    
  
### [.yarnrc.yml](/SharkyFi/client/blob/main/.yarnrc.yml ".yarnrc.yml")

|

### [.yarnrc.yml](/SharkyFi/client/blob/main/.yarnrc.yml ".yarnrc.yml")

|  |    
  
### [LICENSE](/SharkyFi/client/blob/main/LICENSE "LICENSE")

|

### [LICENSE](/SharkyFi/client/blob/main/LICENSE "LICENSE")

|  |    
  
### [README.md](/SharkyFi/client/blob/main/README.md "README.md")

|

### [README.md](/SharkyFi/client/blob/main/README.md "README.md")

|  |    
  
### [package.json](/SharkyFi/client/blob/main/package.json "package.json")

|

### [package.json](/SharkyFi/client/blob/main/package.json "package.json")

|  |    
  
### [tsconfig.json](/SharkyFi/client/blob/main/tsconfig.json "tsconfig.json")

|

### [tsconfig.json](/SharkyFi/client/blob/main/tsconfig.json "tsconfig.json")

|  |    
  
### [yarn.lock](/SharkyFi/client/blob/main/yarn.lock "yarn.lock")

|

### [yarn.lock](/SharkyFi/client/blob/main/yarn.lock "yarn.lock")

|  |    
View all files  
  
## Repository files navigation

  * README
  * GPL-3.0 license

[![](https://user-
images.githubusercontent.com/377261/172073343-4b84d462-1f04-465d-9c93-cdba5b5dcdf3.png)](https://user-
images.githubusercontent.com/377261/172073343-4b84d462-1f04-465d-9c93-cdba5b5dcdf3.png)

# @sharkyfi/client

This repo gives examples for how to use the
[@sharkyfi/client](https://www.npmjs.com/package/@sharkyfi/client) library to
interact with the [Sharky](https://sharky.fi) solana program. It doesn't yet
contain the client's code, because we use monorepo and publish package from
there. But eventually the client's code will be migrated.

The `examples` directory contains scripts that provide a reference for
performing automated lending actions. You can copy-paste code from there into
your own code, or run the scripts directly.

Keep in mind that this repo and the Sharky library are licensed under
[GPLv3](https://www.gnu.org/licenses/gpl-3.0.en.html).

## How to use the package

The recommended way is to fork this repo and use examples as a starting point
for your scripting.

The more custom alternative is to run:

    
    
    npm install @sharkyfi/client
    

And write your own scripts from scratch.

## Examples

To run the scripts, run `yarn` or `npm install`, then:

Get the current list of orderbooks (name and pubkey):

    
    
    npx ts-node examples/list-order-books.ts --wallet-path ~/.config/solana/id.json

Place a loan offer on an orderbook:

    
    
    npx ts-node examples/place-offer.ts --wallet-path ~/.config/solana/id.json --order-book <order-book-pubkey> --amount-sol 1

List your current offers:

    
    
    npx ts-node examples/list-offers.ts --wallet-path ~/.config/solana/id.json

Revoke an offer:

    
    
    npx ts-node examples/revoke-offer.ts --wallet-path ~/.config/solana/id.json --loan <loan-pubkey>

## Gotchas / things to know about how our data is structured

### APR and APY

We originally named a property on loans and orderbooks "APY" when actually
using it mathematically as APR. We've corrected this on the frontend, but in
the data structure that is returned from the chain data,
`orderBook.apy.fixed?.apy` is actually APR, as is
`loan.data.loanState.taken?.taken.apy.fixed!.apy`.

Additionally, those are stored as millpercents — thousandths of a percent, to
allow for higher precision while being stored as integers.

To get regular APR and APY as percents from the values we store on chain:

    
    
    import { aprToApy, apyToApr, aprToInterestRatio, interestRatioToApr } from '@sharkyfi/client'
    
    // Get values from the loan and orderbook
    // for orderbooks:
    const apr = orderBook.apy.fixed!.apy / 1000
    // or for taken loans:
    const apr = loan.data.loanState.taken?.taken.apy.fixed!.apy / 1000
    
    const principalLamports = loan.data.principalLamports.toNumber()
    const feePermillicentage = orderBook.feePermillicentage
    const durationSeconds =
        loan.data.loanState.taken?.taken.terms.time?.duration.toNumber() ||
        loan.data.loanState.offer?.offer.termsSpec.time?.duration.toNumber()
    
    // Calculations
    const interestRatio = aprToInterestRatio(apr, durationSeconds)
    const interestWithFeeLamports = interestRatio * principalLamports
    const totalOwedLamports = principalLamports + interestWithFeeLamports
    const feeLamports = Math.floor((interestWithFeeLamports * feePermillicentage) / 100_000)
    const interestWithoutFeeLamports = interestWithFeeLamports - feeLamports
    const interestRatioAfterFee = interestWithoutFeeLamports / principalLamports
    const aprAfterFee = interestRatioToApr(interestRatioAfterFee, durationSeconds)
    const apyAfterFee = aprToApy(aprAfterFee)
    
    console.log({
      interestRatio, // Shown to borrowers
      interestWithFeeLamports, // Shown to borrowers
      totalOwedLamports, // Shown to borrowers
      apyAfterFee, // Shown to lenders
    })
    

For example, given these inputs, you will get these values:

    
    
    const principalLamports = 1e9
    const apr = 145365 / 1000
    const feePermillicentage = 16000
    const durationSeconds = 7 * 24 * 60 * 60
    
    // ...calculations
    
    console.log({
      interestRatio, // 0.028270453175256227 (shown as 2.82%)
      interestWithFeeLamports, // 28270453 (shown as 0.028 SOL)
      totalOwedLamports, // 1028270453 (shown as 1.028 SOL)
      apyAfterFee, // 239.9988789793601 (shown as 240%)
    })
    

# How to get historical events

It depends for what purpose. If you want to get parsed transactions
programmatically from the beginning of time, please refer to our official
partner - Hello Moon, if you want to just do explorative analysis via SQL, we
have pre-parsed table on Dune, if you want some super custom integration, we
can give you acess to our own database for some unique use-cases.

## Hello Moon API

For example: <https://docs.hellomoon.io/reference/post_v0-sharky-loan-events>

Example response

    
    
    {
      "data": [
        {
          "blockTime": "1677959719",
          "blockId": "180767604",
          "transactionPosition": 977,
          "instructionOrdinal": 1,
          "transactionId": "4QovotWNSLvByYZCBpg83oLtW8rXdeAyFWfuEDeDh455QUgW43pBWCDYYjdPBAy5kb3vSVVHi338MeaWcjEdtCEp",
          "orderBook": "7yJpf4UzKkeWveDvW6KmHunbuXRAEZdcwgcv4zMyNU5y",
          "loan": "GY6kuy6rYwdRDR3tjz8idcH7vatKnhYkz8UQ1GzCCEtv",
          "actionType": "repay",
          "lender": "9sP8D7wcqHHNSdUqvXLeYFetvAk2G7rnLbnEfH29HHwM",
          "borrower": "FAWGVTAEyfBX2TcMLCQnUusW4CPh6REtTmCkDAURPETn",
          "collateralMint": "FiX2tBUWjWvjF1JhL15VzshFeyVc4P755gbh5apByZSA",
          "tokenMint": "So11111111111111111111111111111111111111112",
          "loanDurationSeconds": null,
          "amountOffered": null,
          "amountCancelled": null,
          "amountTaken": null,
          "amountRepayed": 0.122393078,
          "isRepayEscrow": true,
          "isDefaultEscrow": null
        }
      ],
      "paginationToken": "eyJibG9ja1RpbWUiOiIxNjc3OTU5NzE5IiwidHJhbnNhY3Rpb25JZCI6IjIxTlpta3FLZ0M0bzlyQllBSmZXZ2N4YzNKUXlKcjJxNlhEM3RyODR2QWQ1ZTV1SEFjd3FoOU1Nd3NSQ3lqamFNeGl3eURRbkVLcmM4cWpCeUs2ODc0ODUifQ=="
    }

By using the pagination token you can fetch events since the beginning of
time.

## Dune

Refer to this example query: <https://dune.com/queries/2015361>

## Custom Database Access

Please open a support ticket in our [discord](http://discord.gg/sharkyfi)
clearly describing the use-case.

## About

Documentation for the @sharkyfi/client program library

### Resources

Readme

### License

GPL-3.0 license

[ Activity ](/SharkyFi/client/activity)

[ Custom properties ](/SharkyFi/client/custom-properties)

### Stars

[ **30** stars ](/SharkyFi/client/stargazers)

### Watchers

[ **2** watching ](/SharkyFi/client/watchers)

### Forks

[ **11** forks ](/SharkyFi/client/forks)

[ Report repository ](/contact/report-
content?content_url=https%3A%2F%2Fgithub.com%2FSharkyFi%2Fclient&report=SharkyFi+%28user%29)

##  [ Releases ](/SharkyFi/client/releases)

No releases published

##  [ Packages 0 ](/orgs/SharkyFi/packages?repo_name=client)

No packages published  

##  [ Contributors 5 ](/SharkyFi/client/graphs/contributors)

  * [ ![@phoenixeliot](https://avatars.githubusercontent.com/u/491376?s=64&v=4) ](https://github.com/phoenixeliot)
  * [ ![@Restuta](https://avatars.githubusercontent.com/u/377261?s=64&v=4) ](https://github.com/Restuta)
  * [ ![@bowtiedpyro](https://avatars.githubusercontent.com/u/101187520?s=64&v=4) ](https://github.com/bowtiedpyro)
  * [ ![@akkoucai](https://avatars.githubusercontent.com/u/77622018?s=64&v=4) ](https://github.com/akkoucai)
  * [ ![@cotemper](https://avatars.githubusercontent.com/u/92621583?s=64&v=4) ](https://github.com/cotemper)

## Footer

[ ](https://github.com "GitHub") © 2024 GitHub, Inc.

### Footer navigation

  * [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
  * [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
  * [Security](https://github.com/security)
  * [Status](https://www.githubstatus.com/)
  * [Docs](https://docs.github.com/)
  * [Contact](https://support.github.com?tags=dotcom-footer)
  * Manage cookies 
  * Do not share my personal information 

You can’t perform that action at this time.

